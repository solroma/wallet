"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[33030],{433030:(e,t,n)=>{n.r(t),n.d(t,{default:()=>U});var l=n(539144),i=n(877531),o=n(785192),s=n(510374),a=n(561220),r=n(433996),c=n(612210),d=n(10918),u=n(18861),f=n(435581),p=n(634795),m=n(196234),h=n(609850),x=n.n(h),g=n(202784),v=n(459494),C=n(571747),_=n(783112),y=n(626015),j=n(613549),w=n(945821),b=n(859071),M=n(776553),S=n(793525),I=n(170766),A=n(321668),P=n(866904),V=n(669083),k=n(953150),D=n(284315),L=n(552322);const W=function(e){var t=e.onClose,n=(0,g.useState)(""),l=(0,m.default)(n,2),i=l[0],o=l[1],s=(0,_.default)(),a=(0,D.useClipboard)(),r=a.getClipboard,d=a.canGetClipboard,u=(0,b.useActiveWalletAccount)().networkImpl;return(0,L.jsx)(c.default,{visible:!0,onClose:t,footerButtonProps:{primaryActionTranslationId:"action__add",primaryActionProps:{type:"primary"},onPrimaryActionPress:function(){var e=(0,p.default)((function*(){var e=i.trim();if(/^wc:.+@.+\?.+/.test(e))k.default.openConnectToDappModal({uri:e});else if(e.length>0){e.startsWith("http://")||e.startsWith("https://")||(e=`https://${e}`);try{var n=new URL(e),l=n.hostname,o=n.origin;if(l.includes(".")||l.includes("localhost")){var a=yield w.default.serviceDapp.getActiveConnectedAccountsAsync({origin:o,impl:u});null!=a&&a.length?V.default.show({title:s.formatMessage({id:"msg__this_address_already_exists"})}):setTimeout((0,p.default)((function*(){yield w.default.serviceDapp.openConnectionModal({origin:o})})),600)}}catch(r){}}null==t||t()}));return function(){return e.apply(this,arguments)}}()},contentProps:{title:s.formatMessage({id:"title__add_site_connection"}),contentElement:(0,L.jsx)(I.default,{rightCustomElement:d?(0,L.jsx)(A.default,{type:"plain",onPress:(0,p.default)((function*(){var e=yield r();e&&o(e)})),children:(0,L.jsx)(P.default,{color:"text-success",children:s.formatMessage({id:"action__paste"})})}):null,autoFocus:!0,w:"full",mt:"2",type:"text",placeholder:s.formatMessage({id:"form__start_with_wc_or_https_placeholder"}),value:i,onChangeText:function(e){o(e)}})}})};var E=n(25655),R=n(249831),T=n(201663);const O=(0,g.memo)((function(e){var t=e.connections,n=e.onAddConnectSite,l=e.onDisConnectWalletConnected,i=(0,_.default)(),o=(0,b.useActiveWalletAccount)(),s=o.accountId,c=o.networkId,h=o.walletId,x=(0,g.useState)((function(){return[]})),C=(0,m.default)(x,2),j=C[0],S=C[1],I=(0,b.useAppSelector)((function(e){return e.refresher.refreshConnectedSitesTs})),P=(0,g.useState)({connected:!1}),V=(0,m.default)(P,2),k=V[0],D=V[1];(0,g.useEffect)((function(){var e=function(){var e=(0,p.default)((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;yield(0,M.wait)(e);var t=yield w.default.serviceDapp.getWalletConnectSession(),n=(yield w.default.serviceDapp.getWalletConnectSessionV2()).sessions,l=[];t&&l.push({sessionV1:t}),n.forEach((function(e){l.push({sessionV2:e})})),S((function(){return l}));var i=yield w.default.walletConnect.checkWssConnectionStatusV2();D(i)}));return function(){return e.apply(this,arguments)}}();e(),e(600)}),[t,I,s,c,h]);var W=(0,g.useCallback)((function(e){var t,n,i,o,s,c,f,m,h,x,g,C,_,b,S,I,A,P,V,k,D,W,E,R,T,O,z,B,N,$,F,H,U=e.item,X=e.index,G="",Q="",q=[];U.sessionV1&&(G=null!=(n=null!=(i=null==(o=U.sessionV1)||null==(s=o.peerMeta)?void 0:s.name)?i:null==(c=U.sessionV1)||null==(f=c.peerMeta)?void 0:f.url)?n:"",Q=null!=(m=null==(h=U.sessionV1)||null==(x=h.peerMeta)||null==(g=x.icons)?void 0:g[0])?m:"",q=null!=(C=null==(_=U.sessionV1)?void 0:_.accounts)?C:[]);U.sessionV2&&(G=null!=(b=null!=(S=null==(I=U.sessionV2)||null==(A=I.peer)||null==(P=A.metadata)?void 0:P.name)?S:null==(V=U.sessionV2)||null==(k=V.peer)||null==(D=k.metadata)?void 0:D.url)?b:"",Q=null!=(W=null==(E=U.sessionV2)||null==(R=E.peer)||null==(T=R.metadata)||null==(O=T.icons)?void 0:O[0])?W:"",q=(null==(z=U.sessionV2)||null==(B=z.namespaces)||null==(N=B.eip155)||null==($=N.accounts)||null==(F=$[0])||null==(H=F.split(":"))?void 0:H.slice(-1))||[]);return(0,L.jsx)(a.default,{children:(0,L.jsx)(u.default,{padding:"16px",height:"76px",width:"100%",bgColor:"surface-default",borderTopRadius:0===X?"12px":"0px",borderRadius:X===(null==j?void 0:j.length)-1?"12px":"0px",borderWidth:1,borderTopWidth:0===X?1:0,borderBottomWidth:X===(null==j?void 0:j.length)-1?1:0,borderColor:"border-subdued",children:(0,L.jsxs)(u.default,{alignItems:"center",flexDirection:"row",flex:1,children:[(0,L.jsx)(u.default,{size:"32px",overflow:"hidden",rounded:"full",children:(0,L.jsx)(v.default,{w:"full",h:"full",src:Q,alt:Q},Q)}),(0,L.jsxs)(u.default,{ml:"3",flex:1,children:[(0,L.jsx)(d.default.Body2Strong,{noOfLines:2,children:G}),(0,L.jsx)(d.default.Body2,{color:"text-subdued",children:q[0]?`${(0,y.shortenAddress)(null!=(t=q[0])?t:"0x000000")} \xb7 EVM`:"EVM"})]}),(0,L.jsx)(r.default,{name:"XCircleMini",type:"plain",circle:!0,onPress:function(){l(G,(0,p.default)((function*(){try{U.sessionV1&&(yield w.default.walletConnect.disconnect()),U.sessionV2&&(yield w.default.walletConnect.disconnectV2({sessionV2:U.sessionV2})),yield(0,M.wait)(600)}finally{w.default.walletConnect.refreshConnectedSites()}})))}})]})})})}),[l,null==j?void 0:j.length]);return(0,L.jsx)(u.default,{children:(0,L.jsx)(E.default,{renderItem:W,data:j,ListHeaderComponent:(0,L.jsxs)(u.default,{flexDirection:"column",children:[(0,L.jsxs)(u.default,{flexDirection:"row",alignItems:"center",justifyContent:"space-around",flex:1,children:[(0,L.jsx)(A.default,{type:"basic",leftIconName:"PlusMini",iconSize:20,size:"lg",flex:1,mr:"4",onPress:n,children:i.formatMessage({id:"action__add"})}),(0,L.jsx)(A.default,{type:"basic",size:"lg",flex:1,leftIconName:"ViewfinderCircleMini",iconSize:20,onPress:function(){(0,R.gotoScanQrcode)()},children:i.formatMessage({id:"action__scan"})})]}),(0,L.jsxs)(u.default,{flexDirection:"row",alignItems:"center",mb:1,mt:3,flex:1,children:[(0,L.jsx)(f.default,{name:"WalletconnectLogoIllus"}),(0,L.jsx)(d.default.Subheading,{ml:"2",color:"text-subdued",children:i.formatMessage({id:"form__walletconnect__uppercase"})}),(0,L.jsx)(u.default,{ml:"2",children:(0,L.jsx)(T.default,{borderWidth:0,backgroundColor:k.connected?"icon-success":"icon-critical"})})]})]}),ListFooterComponent:(0,L.jsx)(u.default,{display:"flex",flexDirection:"row",alignItems:"center",flex:1,mb:"1",mt:"6",children:(0,L.jsx)(d.default.Subheading,{color:"text-subdued",children:i.formatMessage({id:"title__connect_sites"})})}),ListEmptyComponent:(0,L.jsx)(a.default,{borderRadius:"12",flexDirection:"row",p:"4",alignItems:"center",bg:"surface-default",onPress:function(){(0,R.gotoScanQrcode)()},children:(0,L.jsxs)(u.default,{display:"flex",alignItems:"center",flexDirection:"row",flex:1,children:[(0,L.jsx)(u.default,{alignItems:"center",justifyContent:"center",size:"32px",overflow:"hidden",rounded:"full",backgroundColor:"surface-neutral-default",children:(0,L.jsx)(f.default,{name:"ViewfinderCircleMini",size:20})}),(0,L.jsx)(d.default.Body2Strong,{ml:"3",children:i.formatMessage({id:"action__scan_to_connect"})})]})})})})}));var z=function(e){switch(e){case j.IMPL_SOL:return"Solana";case j.IMPL_EVM:case j.IMPL_NEAR:case j.IMPL_ALGO:case j.IMPL_CFX:case j.IMPL_STC:case j.IMPL_TRON:return e.toUpperCase();default:return""}};function B(e){var t=e.item,n=(0,g.useState)(t.site.icon),l=(0,m.default)(n,2),i=l[0],o=l[1];return(0,g.useEffect)((function(){t.site.icon||(0,p.default)((function*(){yield(0,M.wait)(0);var e=yield w.default.serviceDapp.getWalletConnectSession();o((function(){var n,l;return e&&(null==(n=e.peerMeta)?void 0:n.url)===t.site.origin?null==(l=e.peerMeta)?void 0:l.icons[0]:`${t.site.origin}/favicon.ico`}))}))()}),[t.site.origin,t.site.icon]),(0,L.jsx)(u.default,{size:"32px",overflow:"hidden",rounded:"full",children:(0,L.jsx)(v.default,{w:"full",h:"full",src:i,alt:i,fallbackElement:(0,L.jsx)(f.default,{name:"LinkOutline",size:32})},i)})}function N(e){var t=e.item,n=w.default.serviceDapp,l=(0,b.useActiveWalletAccount)(),i=l.accountId,o=l.networkId,s=l.walletId,a=(0,g.useState)(t.address),r=(0,m.default)(a,2),c=r[0],u=r[1];return(0,g.useEffect)((function(){(0,p.default)((function*(){var e;yield(0,M.wait)(0);var l=yield n.getActiveConnectedAccountsAsync({origin:t.site.origin,impl:t.networkImpl}),i=null==l||null==(e=l[0])?void 0:e.address;u(i)}))()}),[t.networkImpl,t.site.origin,n,i,o,s]),(0,L.jsx)(d.default.Body2,{color:"text-subdued",numberOfLines:1,children:`${(0,y.shortenAddress)(c)} \xb7 ${z(t.networkImpl)}`})}var $=n(910884),F=(0,n(324665).default)(),H=[{name:$.ManageConnectedSitesRoutes.ManageConnectedSitesModel,component:function(){var e=(0,_.default)(),t=(0,b.useAppSelector)((function(e){return e.dapp.connections})),n=(0,g.useMemo)((function(){return function(e){var t=x()(e),n=[],l=new Map;for(var i of t)if(i.site.origin){var o=i.site.origin+i.address+i.networkImpl;if(!l.has(o)){try{i.site.hostname=new URL(i.site.origin).hostname}catch(s){console.error(s),i.site.hostname=""}n.push(i),l.set(o,1)}}return n.sort((function(e,t){return(0,C.default)({insensitive:!0})(e.site.hostname,t.site.hostname)}))}(t)}),[t]),l=(0,g.useCallback)((function(t,n){(0,S.showOverlay)((function(l){return(0,L.jsx)(c.default,{visible:!0,onClose:l,footerButtonProps:{primaryActionTranslationId:"action__disconnect",primaryActionProps:{type:"destructive",onPromise:function(){var e=(0,p.default)((function*(){try{yield n()}finally{l()}}));return function(){return e.apply(this,arguments)}}()},wrap:!0},contentProps:{iconType:"danger",iconName:"ConnectOffOutline",title:e.formatMessage({id:"dialog__disconnect_from_this_site"}),content:e.formatMessage({id:"dialog__disconnect_all_accounts_desc"},{0:t})}})}))}),[e]),m=(0,g.useCallback)((function(){(0,S.showDialog)((0,L.jsx)(W,{}))}),[]),h=(0,g.useCallback)((function(e){var t=e.item,i=e.index;return(0,L.jsx)(a.default,{children:(0,L.jsx)(u.default,{padding:"16px",height:"76px",width:"100%",bgColor:"surface-default",borderTopRadius:0===i?"12px":"0px",borderRadius:i===(null==n?void 0:n.length)-1?"12px":"0px",borderWidth:1,borderTopWidth:0===i?1:0,borderBottomWidth:i===(null==n?void 0:n.length)-1?1:0,borderColor:"border-subdued",children:(0,L.jsxs)(u.default,{flexDirection:"row",flex:1,alignItems:"center",children:[(0,L.jsx)(B,{item:t}),(0,L.jsxs)(u.default,{flexDirection:"column",ml:"3",justifyContent:"center",flex:1,children:[(0,L.jsx)(d.default.Body1Strong,{children:t.site.hostname}),(0,L.jsx)(N,{item:t})]}),(0,L.jsx)(r.default,{name:"XCircleMini",type:"plain",circle:!0,onPress:function(){l(t.site.origin,(0,p.default)((function*(){try{yield w.default.serviceDapp.cancelConnectedSite(t)}catch(e){throw console.error("cancelConnectedSite ERROR: ",e),e}})))}})]})})})}),[l,null==n?void 0:n.length]),v=(0,g.useCallback)((function(){return(0,L.jsx)(O,{connections:t,onDisConnectWalletConnected:l,onAddConnectSite:m})}),[t,l,m]);return(0,L.jsx)(i.default,{hidePrimaryAction:!0,maxHeight:"560px",header:e.formatMessage({id:"title__connect_sites"}),footer:null,flatListProps:{ListHeaderComponent:v,data:n,renderItem:h,ListEmptyComponent:(0,L.jsx)(u.default,{flexDirection:"column",alignItems:"center",justifyContent:"center",height:"350px",children:(0,L.jsx)(s.default,{icon:(0,L.jsx)(f.default,{name:"InboxOutline",size:48}),title:e.formatMessage({id:"empty__no_connected_sites"}),subTitle:e.formatMessage({id:"empty__no_connected_sites_desc"})})}),ItemSeparatorComponent:o.default,showsVerticalScrollIndicator:!1}})}}];const U=function(){var e=(0,l.default)();return(0,L.jsx)(F.Navigator,{screenOptions:{headerShown:!1,animationEnabled:!!e},children:H.map((function(e){return(0,L.jsx)(F.Screen,{name:e.name,component:e.component},e.name)}))})}},910884:(e,t,n)=>{var l;n.r(t),n.d(t,{ManageConnectedSitesRoutes:()=>l}),function(e){e.ManageConnectedSitesModel="ManageConnectedSitesModal"}(l||(l={}))}}]);