"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[85068],{786141:(e,t,n)=>{n.r(t),n.d(t,{VaultBase:()=>B,VaultBaseChainOnly:()=>O});var r=n(72579),i=n.n(r),o=n(256666),a=n(301842),u=n.n(a),s=n(634795),c=n(887371),d=n(545754),l=n(411987),f=n(695058),p=n(206391),v=n.n(p),h=n(636393),y=n(613549),g=n(292147),w=n(213208),m=n(992431),I=n(940915),T=n(278489),x=n(969618),b=n(398514),A=n(114540),k=n(348834).Buffer;function E(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function C(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?E(Object(n),!0).forEach((function(t){(0,o.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):E(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function P(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,f.default)(e);if(t){var i=(0,f.default)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,l.default)(this,n)}}if(w.default.isExtensionUi)throw new Error("engine/VaultBase is not allowed imported from ui");var O=function(e){(0,d.default)(n,e);var t=P(n);function n(){return t.apply(this,arguments)}var r=n.prototype;return r.initProvider=function(){var e=(0,s.default)((function*(){var e=(yield this.getNetwork()).impl;u()(x.IMPL_MAPPINGS[e])||(this.engineProvider=yield this.engine.providerManager.getProvider(this.networkId))}));return function(){return e.apply(this,arguments)}}(),r.proxyJsonRPCCall=function(){var e=(0,s.default)((function*(e){throw new I.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),r.createClientFromURL=function(e){throw new I.NotImplemented},r.getEthersProvider=function(){var e=(0,s.default)((function*(){throw new I.NotImplemented}));return function(){return e.apply(this,arguments)}}(),r.getClientEndpointStatus=function(){var e=(0,s.default)((function*(e){var t=this.createClientFromURL(e),n=performance.now(),r=(yield t.getInfo()).bestBlockNumber;return{responseTime:Math.floor(performance.now()-n),latestBlock:r}}));return function(t){return e.apply(this,arguments)}}(),r.checkRpcBatchSupport=function(){var e=(0,s.default)((function*(e){throw new I.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),r.getDisplayAddress=function(){var e=(0,s.default)((function*(e){return Promise.resolve(e)}));return function(t){return e.apply(this,arguments)}}(),r.validateAddress=function(){var e=(0,s.default)((function*(e){var t=yield this.engineProvider.verifyAddress(e),n=t.normalizedAddress;if(!t.isValid||!n)throw new I.InvalidAddress;return Promise.resolve(n)}));return function(t){return e.apply(this,arguments)}}(),r.validateImportedCredential=function(e){return Promise.resolve(this.settings.importedAccountEnabled&&/^(0x)?[0-9a-zA-Z]{64}$/.test(e))},r.validateWatchingCredential=function(){var e=(0,s.default)((function*(e){return Promise.resolve(this.settings.watchingAccountEnabled&&(yield this.engineProvider.verifyAddress(e)).isValid)}));return function(t){return e.apply(this,arguments)}}(),r.validateTokenAddress=function(){var e=(0,s.default)((function*(e){var t=yield this.engineProvider.verifyTokenAddress(e),n=t.normalizedAddress;if(!t.isValid||"undefined"===typeof n)throw new I.InvalidTokenAddress;return Promise.resolve(n)}));return function(t){return e.apply(this,arguments)}}(),r.validateCanCreateNextAccount=function(){var e=(0,s.default)((function*(e,t){return Promise.resolve(!0)}));return function(t,n){return e.apply(this,arguments)}}(),r.checkAccountExistence=function(){var e=(0,s.default)((function*(e,t){return Promise.resolve(!0)}));return function(t,n){return e.apply(this,arguments)}}(),r.getBalances=function(){var e=(0,s.default)((function*(e,t,n){return(yield this.engine.providerManager.getClient(this.networkId)).getBalances(e.map((function(e){var t=e.address,n=e.tokenAddress;return{address:t,coin:C({},"string"===typeof n?{tokenAddress:n}:{})}})))}));return function(t,n,r){return e.apply(this,arguments)}}(),r.getFrozenBalance=function(){var e=(0,s.default)((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.password,e.useRecycleBalance,e.ignoreInscriptions,e.useCustomAddressesBalance;return 0}));return function(){return e.apply(this,arguments)}}(),r.fetchBalanceDetails=function(){var e=(0,s.default)((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.password,e.useRecycleBalance,e.ignoreInscriptions,e.useCustomAddressesBalance;return Promise.resolve(void 0)}));return function(){return e.apply(this,arguments)}}(),r.getTransactionStatuses=function(e){return this.engine.providerManager.getTransactionStatuses(this.networkId,e)},r.getTransactionFeeInNative=function(e){return Promise.resolve("")},r.isContractAddress=function(){var e=(0,s.default)((function*(e){return!1}));return function(t){return e.apply(this,arguments)}}(),r.getAccountNameInfoMap=function(){var e=(0,s.default)((function*(){var e=yield this.getNetwork();return(0,T.getAccountNameInfoByImpl)(e.impl)}));return function(){return e.apply(this,arguments)}}(),r.canAutoCreateNextAccount=function(){var e=(0,s.default)((function*(e){return Promise.resolve(!1)}));return function(t){return e.apply(this,arguments)}}(),r.filterAccounts=function(){var e=(0,s.default)((function*(e){var t=e.accounts;e.networkId;return Promise.resolve(t)}));return function(t){return e.apply(this,arguments)}}(),r.shouldChangeAccountWhenNetworkChanged=function(){var e=(0,s.default)((function*(e){e.previousNetwork,e.newNetwork,e.activeAccountId;return Promise.resolve({shouldReloadAccountList:!1,shouldChangeActiveAccount:!1})}));return function(t){return e.apply(this,arguments)}}(),r.getAccountNameInfosByImportedOrWatchingCredential=function(){var e=(0,s.default)((function*(e){return Promise.resolve([])}));return function(t){return e.apply(this,arguments)}}(),r.checkIsUnlimitedAllowance=function(){var e=(0,s.default)((function*(e){throw new I.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),r.checkIsApprovedForAll=function(){var e=(0,s.default)((function*(e){throw new I.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),r.checkIsBatchTransfer=function(){var e=(0,s.default)((function*(e){throw new I.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),r.getFeePricePerUnit=function(){var e=(0,s.default)((function*(){throw new I.NotImplemented}));return function(){return e.apply(this,arguments)}}(),r.fetchRpcChainId=function(){var e=(0,s.default)((function*(e){return null}));return function(t){return e.apply(this,arguments)}}(),r.getTxWaitingSeconds=function(){var e=(0,s.default)((function*(){return[]}));return function(){return e.apply(this,arguments)}}(),r.getUserNFTAssets=function(){var e=(0,s.default)((function*(e){e.serviceData;return Promise.resolve(void 0)}));return function(t){return e.apply(this,arguments)}}(),r.getTransactionDetail=function(){var e=(0,s.default)((function*(e){return Promise.resolve(void 0)}));return function(t){return e.apply(this,arguments)}}(),(0,c.default)(n)}(A.VaultContext),B=function(e){(0,d.default)(n,e);var t=P(n);function n(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).uuid=h.default.v4().toString(),e}var r=n.prototype;return r.init=function(){var e=(0,s.default)((function*(e){yield this.initProvider(),yield this.initKeyring(e)}));return function(t){return e.apply(this,arguments)}}(),r.initKeyring=function(){var e=(0,s.default)((function*(e){this.keyring=yield e.keyringCreator(this)}));return function(t){return e.apply(this,arguments)}}(),r.signTransaction=function(){var e=(0,s.default)((function*(e,t){return this.keyring.signTransaction(e,t)}));return function(t,n){return e.apply(this,arguments)}}(),r.signAndSendTransaction=function(){var e=(0,s.default)((function*(e,t,n){var r=yield this.signTransaction(e,t);return n?C(C({},r),{},{encodedTx:e.encodedTx}):this.broadcastTransaction(C(C({},r),{},{encodedTx:e.encodedTx}))}));return function(t,n,r){return e.apply(this,arguments)}}(),r.broadcastTransaction=function(){var e=(0,s.default)((function*(e,t){g.default.engine.info("broadcastTransaction START:",{rawTx:e.rawTx});var n=yield this.engine.providerManager.broadcastTransaction(this.networkId,e.rawTx,t);return g.default.engine.info("broadcastTransaction END:",{txid:n,rawTx:e.rawTx}),C(C({},e),{},{txid:n,encodedTx:e.encodedTx})}));return function(t,n){return e.apply(this,arguments)}}(),r.buildEncodedTxFromBatchTransfer=function(){var e=(0,s.default)((function*(e){throw new I.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),r.buildEncodedTxsFromSetApproveForAll=function(){var e=(0,s.default)((function*(e,t){throw new I.NotImplemented}));return function(t,n){return e.apply(this,arguments)}}(),r.activateAccount=function(){var e=(0,s.default)((function*(){throw new I.NotImplemented}));return function(){return e.apply(this,arguments)}}(),r.activateToken=function(){var e=(0,s.default)((function*(e,t){throw new I.NotImplemented}));return function(t,n){return e.apply(this,arguments)}}(),r.getTokenAllowance=function(){var e=(0,s.default)((function*(e,t){throw new I.NotImplemented}));return function(t,n){return e.apply(this,arguments)}}(),r.batchTokensAllowance=function(){var e=(0,s.default)((function*(e,t){throw new I.NotImplemented}));return function(t,n){return e.apply(this,arguments)}}(),r.getOutputAccount=function(){var e=(0,s.default)((function*(){var e=yield this.getDbAccount({noCache:!0});return{id:e.id,name:e.name,type:e.type,path:e.path,coinType:e.coinType,tokens:[],address:e.address,template:e.template,pubKey:i()(e,"pub","")}}));return function(){return e.apply(this,arguments)}}(),r.getAccountBalance=function(){var e=(0,s.default)((function*(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,i=(yield this.getDbAccount()).address;return this.getBalances((t?[{address:i}]:[]).concat(e.map((function(e){return{address:i,tokenAddress:e}}))),n,r)}));return function(t){return e.apply(this,arguments)}}(),r.updatePendingTxs=function(){var e=(0,s.default)((function*(e){throw new I.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),r.getAccountNonce=function(){var e=(0,s.default)((function*(){return Promise.resolve(null)}));return function(){return e.apply(this,arguments)}}(),r.fixActionDirection=function(){var e=(0,s.default)((function*(e){var t,n,r,i,o=e.action,a=e.accountAddress;(o.direction=b.IDecodedTxDirection.OTHER,o.type===b.IDecodedTxActionType.NATIVE_TRANSFER)&&(o.direction=yield this.buildTxActionDirection({from:(null==(t=o.nativeTransfer)?void 0:t.from)||"",to:(null==(n=o.nativeTransfer)?void 0:n.to)||"",address:a}));o.type===b.IDecodedTxActionType.TOKEN_TRANSFER&&(o.direction=yield this.buildTxActionDirection({from:(null==(r=o.tokenTransfer)?void 0:r.from)||"",to:(null==(i=o.tokenTransfer)?void 0:i.to)||"",address:a}));return o}));return function(t){return e.apply(this,arguments)}}(),r.fixDecodedTx=function(){var e=(0,s.default)((function*(e){var t,n;e.createdAt=null!=(t=e.createdAt)?t:Date.now();var r=null==(n=e.encodedTx)?void 0:n.nonce;e.nonce=u()(r)?e.nonce:new(v())(r).toNumber();for(var i=e.owner,o=0;o<e.actions.length;o+=1){var a=e.actions[o];yield this.fixActionDirection({action:a,accountAddress:i})}if(e.outputActions)for(var s=0;s<e.outputActions.length;s+=1){var c=e.outputActions[s];yield this.fixActionDirection({action:c,accountAddress:i})}return Promise.resolve(e)}));return function(t){return e.apply(this,arguments)}}(),r.fixHistoryTx=function(){var e=(0,s.default)((function*(e){return e.decodedTx=yield this.fixDecodedTx(e.decodedTx),Promise.resolve(e)}));return function(t){return e.apply(this,arguments)}}(),r.buildHistoryTx=function(){var e=(0,s.default)((function*(e){var t=e.historyTxToMerge,n=(e.encodedTx,e.decodedTx),r=e.signedTx,i=e.isSigner,o=e.isLocalCreated,a=(null==r?void 0:r.txid)||(null==n?void 0:n.txid)||"";if(!a)throw new Error("buildHistoryTx txid not found");var u=yield this.getAccountAddress();n.txid=a||n.txid,n.owner=u,i&&(n.signer=u),null!=r&&r.txKey&&(n.extraInfo?n.extraInfo.txKey=r.txKey:n.extraInfo={txKey:r.txKey});var s=C(C({id:`${this.networkId}_${a}_${this.accountId}`,isLocalCreated:Boolean(o)},t),{},{decodedTx:n});return s=yield this.fixHistoryTx(s),Promise.resolve(s)}));return function(t){return e.apply(this,arguments)}}(),r.checkIsScamHistoryTx=function(){var e=(0,s.default)((function*(e){return!1}));return function(t){return e.apply(this,arguments)}}(),r.fetchOnChainHistory=function(){var e=(0,s.default)((function*(e){throw new I.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),r.fixAddressCase=function(e){return Promise.resolve(e)},r.buildTxActionDirection=function(){var e=(0,s.default)((function*(e){var t=e.from,n=e.to,r=e.address;return t=yield this.fixAddressCase(t||""),n=yield this.fixAddressCase(n),r=yield this.fixAddressCase(r),t===n&&t===r?b.IDecodedTxDirection.SELF:t&&t===r?b.IDecodedTxDirection.OUT:n&&n===r?b.IDecodedTxDirection.IN:b.IDecodedTxDirection.OTHER}));return function(t){return e.apply(this,arguments)}}(),r.getNextNonce=function(){var e=(0,s.default)((function*(e,t){var n,r=null==(n=(yield this.engine.providerManager.getAddresses(e,[t.address]))[0])?void 0:n.nonce;if(u()(r))throw new I.OneKeyError("Get on-chain nonce failed.");yield this.engine.getHistory(e,t.id,void 0,!1);var i=yield m.default.history.getMaxPendingNonce({accountId:this.accountId,networkId:e}),o=yield m.default.history.getPendingNonceList({accountId:this.accountId,networkId:e}),a=Math.max(u()(i)?0:i+1,r);if(Number.isNaN(a)&&(a=r),a>r)for(var s=r;s<a;s+=1)if(!o.includes(s)){a=s;break}if(a<r&&(a=r),a-r>=y.HISTORY_CONSTS.PENDING_QUEUE_MAX_LENGTH)throw new I.PendingQueueTooLong(y.HISTORY_CONSTS.PENDING_QUEUE_MAX_LENGTH);return a}));return function(t,n){return e.apply(this,arguments)}}(),r.validateSendAmount=function(e,t,n){return Promise.resolve(!0)},r.notifyChainChanged=function(e,t){},r.getFetchBalanceAddress=function(e){return Promise.resolve(e.address)},r.getPrivateKeyByCredential=function(e){return Promise.resolve(k.from(e.startsWith("0x")?e.slice(2):e,"hex"))},r.getMinDepositAmount=function(){var e=(0,s.default)((function*(){return"0"}));return function(){return e.apply(this,arguments)}}(),r.specialCheckEncodedTx=function(){var e=(0,s.default)((function*(e){return{success:!0}}));return function(t){return e.apply(this,arguments)}}(),r.getAllUsedAddress=function(){var e=(0,s.default)((function*(){return Promise.resolve([])}));return function(){return e.apply(this,arguments)}}(),(0,c.default)(n)}(O)},565147:(e,t,n)=>{n.r(t),n.d(t,{KeyringBase:()=>c,KeyringBaseMock:()=>d});var r=n(634795),i=n(887371),o=n(545754),a=n(411987),u=n(695058);function s(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,u.default)(e);if(t){var i=(0,u.default)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,a.default)(this,n)}}var c=function(e){(0,o.default)(n,e);var t=s(n);function n(e){var n;return(n=t.call(this,e.options)).vault=e,n}return n.prototype.addressFromBase=function(){var e=(0,r.default)((function*(e){return this.vault.addressFromBase(e)}));return function(t){return e.apply(this,arguments)}}(),(0,i.default)(n)}(n(114540).VaultContext),d=function(e){(0,o.default)(n,e);var t=s(n);function n(){return t.apply(this,arguments)}return(0,i.default)(n)}(c)},82406:(e,t,n)=>{n.r(t),n.d(t,{KeyringHardwareBase:()=>l});var r=n(634795),i=n(887371),o=n(545754),a=n(411987),u=n(695058),s=n(799075),c=n(814817);function d(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,u.default)(e);if(t){var i=(0,u.default)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,a.default)(this,n)}}var l=function(e){(0,o.default)(a,e);var t=d(a);function a(){return t.apply(this,arguments)}var u=a.prototype;return u.getHardwareInfo=function(){var e=(0,r.default)((function*(){var e,t,n,r=yield this.engine.getHWDeviceByWalletId(this.vault.walletId);return{connectId:null!=(e=null==r?void 0:r.mac)?e:"",deviceId:null!=(t=null==r?void 0:r.deviceId)?t:"",deviceType:null!=(n=null==r?void 0:r.deviceType)?n:""}}));return function(){return e.apply(this,arguments)}}(),u.getWalletPassphraseState=function(){var e=(0,r.default)((function*(){var e=yield this.engine.getWallet(this.vault.walletId);return{passphraseState:null==e?void 0:e.passphraseState,useEmptyPassphrase:!(0,c.isPassphraseWallet)(e)}}));return function(){return e.apply(this,arguments)}}(),u.getHardwareSDKInstance=function(){var e=(0,r.default)((function*(){var e,t,r,i,o;return null!=(o=yield null==(e=n.g)||null==(t=e.$backgroundApiProxy)||null==(r=t.backgroundApi)||null==(i=r.serviceHardware)||null==i.getSDKInstance?void 0:i.getSDKInstance())?o:s.HardwareSDK}));return function(){return e.apply(this,arguments)}}(),u.prepareAccountByAddressIndex=function(e){throw new Error("Method not implemented.")},(0,i.default)(a)}(n(565147).KeyringBase)},810887:(e,t,n)=>{n.r(t),n.d(t,{KeyringHdBase:()=>v});var r=n(256666),i=n(634795),o=n(887371),a=n(545754),u=n(411987),s=n(695058),c=n(605851),d=n(940915);function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function f(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){(0,r.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function p(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,s.default)(e);if(t){var i=(0,s.default)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,u.default)(this,n)}}var v=function(e){(0,a.default)(n,e);var t=p(n);function n(){return t.apply(this,arguments)}var r=n.prototype;return r.getPrivateKeys=function(){var e=(0,i.default)((function*(e,t){var n=(yield this.getDbAccount()).path.split("/"),r=t||[n.pop()],i=n.join("/"),o=(yield this.engine.dbApi.getCredential(this.walletId,e)).seed;if("undefined"===typeof o)throw new d.OneKeyInternalError("Unable to get credential.");var a=(yield this.engine.providerManager.getChainInfoByNetworkId(this.networkId)).curve;return(0,c.batchGetPrivateKeys)(a,o,e,i,r).reduce((function(e,t){var n;return f(f({},e),{},((n={})[t.path]=t.extendedKey.key,n))}),{})}));return function(t,n){return e.apply(this,arguments)}}(),r.getAddress=function(){throw new Error("Method not implemented.")},r.batchGetAddress=function(){throw new Error("Method not implemented.")},r.prepareAccountByAddressIndex=function(e){throw new Error("Method not implemented.")},(0,o.default)(n)}(n(280306).KeyringSoftwareBase)},255942:(e,t,n)=>{n.r(t),n.d(t,{KeyringImportedBase:()=>d});var r=n(634795),i=n(887371),o=n(545754),a=n(411987),u=n(695058),s=n(940915);function c(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,u.default)(e);if(t){var i=(0,u.default)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,a.default)(this,n)}}var d=function(e){(0,o.default)(n,e);var t=c(n);function n(){return t.apply(this,arguments)}var a=n.prototype;return a.getPrivateKeys=function(){var e=(0,r.default)((function*(e,t){if("undefined"!==typeof t)throw new s.NotImplemented("Getting private keys from extended private key");var n=(yield this.engine.dbApi.getCredential(this.accountId,e)).privateKey;if("undefined"===typeof n)throw new s.OneKeyInternalError("Unable to get credential.");return{"":n}}));return function(t,n){return e.apply(this,arguments)}}(),a.getAddress=function(){throw new Error("Method not implemented.")},a.batchGetAddress=function(){throw new Error("Method not implemented.")},a.prepareAccountByAddressIndex=function(){throw new Error("Method not implemented.")},(0,i.default)(n)}(n(280306).KeyringSoftwareBase)},280306:(e,t,n)=>{n.r(t),n.d(t,{KeyringSoftwareBase:()=>h});var r=n(196234),i=n(256666),o=n(634795),a=n(887371),u=n(545754),s=n(411987),c=n(695058),d=n(292147),l=n(940915);function f(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?f(Object(n),!0).forEach((function(t){(0,i.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function v(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,c.default)(e);if(t){var i=(0,c.default)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,s.default)(this,n)}}var h=function(e){(0,u.default)(n,e);var t=v(n);function n(){return t.apply(this,arguments)}var i=n.prototype;return i.signTransaction=function(){var e=(0,o.default)((function*(e,t){var n=t.password;if("undefined"===typeof n)throw new l.OneKeyInternalError("Software signing requires a password.");var r=yield this.getSigners(n,e.inputs.map((function(e){return e.address})));return d.default.engine.info("signTransaction",this.networkId,e),p(p({},yield this.engine.providerManager.signTransaction(this.networkId,e,r)),{},{encodedTx:e.encodedTx})}));return function(t,n){return e.apply(this,arguments)}}(),i.signMessage=function(){var e=(0,o.default)((function*(e,t){var n=this,i=t.password;if("undefined"===typeof i)throw new l.OneKeyInternalError("Software signing requires a password.");var o=yield this.getDbAccount(),a=Object.values(yield this.getSigners(i,[o.address])),u=(0,r.default)(a,1)[0];return d.default.engine.info("signMessage",this.networkId,e),Promise.all(e.map((function(e){return n.engine.providerManager.signMessage(n.networkId,e,u)})))}));return function(t,n){return e.apply(this,arguments)}}(),i.getAddress=function(){throw new Error("Method not implemented.")},i.batchGetAddress=function(){throw new Error("Method not implemented.")},i.prepareAccountByAddressIndex=function(e){throw new Error("Method not implemented.")},(0,a.default)(n)}(n(565147).KeyringBase)},701625:(e,t,n)=>{n.r(t),n.d(t,{KeyringWatchingBase:()=>d});var r=n(634795),i=n(887371),o=n(545754),a=n(411987),u=n(695058),s=n(940915);function c(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,u.default)(e);if(t){var i=(0,u.default)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,a.default)(this,n)}}var d=function(e){(0,o.default)(n,e);var t=c(n);function n(){return t.apply(this,arguments)}var a=n.prototype;return a.signTransaction=function(){var e=(0,r.default)((function*(e,t){throw new s.OneKeyInternalError("signTransaction is not supported for watching accounts")}));return function(t,n){return e.apply(this,arguments)}}(),a.signMessage=function(){var e=(0,r.default)((function*(e,t){throw new s.OneKeyInternalError("signMessage is not supported for watching accounts")}));return function(t,n){return e.apply(this,arguments)}}(),a.getAddress=function(){throw new Error("Method not implemented.")},a.batchGetAddress=function(){throw new Error("Method not implemented.")},a.prepareAccountByAddressIndex=function(){throw new Error("Method not implemented.")},(0,i.default)(n)}(n(565147).KeyringBase)},479480:(e,t,n)=>{n.r(t),n.d(t,{KeyringHardware:()=>E});var r=n(968079),i=n(256666),o=n(634795),a=n(887371),u=n(545754),s=n(411987),c=n(695058),d=n(84658),l=n(376314),f=n(153546),p=n(799075),v=n(613549),h=n(292147),y=n(940915),g=n(997293),w=n(278489),m=n(398145),I=n(82406),T=n(16280),x=n(348834).Buffer;function b(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function A(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?b(Object(n),!0).forEach((function(t){(0,i.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):b(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function k(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,c.default)(e);if(t){var i=(0,c.default)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,s.default)(this,n)}}var E=function(e){(0,u.default)(n,e);var t=k(n);function n(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).buildHardwareInput=function(){var e=(0,o.default)((function*(e,t){var n=yield(0,p.CoreSDKLoader)(),r=n.getHDPath,i=n.getScriptType,o=r(t),a=i(o),u=e.utxo;return{prev_index:u.vout,prev_hash:u.txid,amount:u.value.integerValue().toString(),address_n:o,script_type:a}}));return function(t,n){return e.apply(this,arguments)}}(),e.buildHardwareOutput=function(){var e=(0,o.default)((function*(e){var t=e.payload||{},n=t.isCharge,r=t.bip44Path,i=t.opReturn;if(i&&"string"===typeof i&&i.length>0)return{script_type:"PAYTOOPRETURN",amount:"0",op_return_data:(0,d.bytesToHex)(x.from(i))};if(n&&r){var o=yield(0,p.CoreSDKLoader)(),a=o.getHDPath,u=o.getOutputScriptType,s=a(r);return{script_type:u(s),address_n:s,amount:e.value.integerValue().toString()}}return{script_type:"PAYTOADDRESS",address:e.address,amount:e.value.integerValue().toString()}}));return function(t){return e.apply(this,arguments)}}(),e.buildPrevTx=function(e){var t=l.Transaction.fromHex(e);return{hash:t.getId(),version:t.version,inputs:t.ins.map((function(e){return{prev_hash:e.hash.reverse().toString("hex"),prev_index:e.index,script_sig:e.script.toString("hex"),sequence:e.sequence}})),bin_outputs:t.outs.map((function(e){return{amount:e.value,script_pubkey:e.script.toString("hex")}})),lock_time:t.locktime}},e}var i=n.prototype;return i.signTransaction=function(){var e=(0,o.default)((function*(e){var t,n=this,r=e.inputs,i=e.outputs,a=this.vault.getCoinName(),u=e.inputs.map((function(e){return e.address}));if(e.encodedTx.transferInfo.useCustomAddressesBalance){var s=yield this.getDbAccount();t=this.vault.getCustomAddressMap(s)}var c=(yield this.vault.collectUTXOsInfo({checkInscription:!1,customAddressMap:t})).utxos,d={};for(var v of c){var h=v.address,y=v.path;u.includes(h)&&(d[h]=y)}var g=yield this.vault.getProvider(),w=Array.from(new Set(r.map((function(e){return e.utxo.txid})))),m=yield g.collectTxs(w),I=yield this.getHardwareInfo(),T=I.connectId,x=I.deviceId,b=yield this.getWalletPassphraseState();yield this.getHardwareSDKInstance();var k=yield p.HardwareSDK.btcSignTransaction(T,x,A({coin:a.toLowerCase(),inputs:yield Promise.all(r.map(function(){var e=(0,o.default)((function*(e){return n.buildHardwareInput(e,d[e.address])}));return function(t){return e.apply(this,arguments)}}())),outputs:yield Promise.all(i.map(function(){var e=(0,o.default)((function*(e){return n.buildHardwareOutput(e)}));return function(t){return e.apply(this,arguments)}}())),refTxs:Object.values(m).map((function(e){return n.buildPrevTx(e)}))},b));if(k.success){var E=k.payload.serializedTx;return{txid:l.Transaction.fromHex(E).getId(),rawTx:E}}throw(0,f.convertDeviceError)(k.payload)}));return function(t){return e.apply(this,arguments)}}(),i.prepareAccounts=function(){var e=(0,o.default)((function*(e){var t=e.indexes,n=e.purpose,r=e.names,i=e.template,a=e.skipCheckAccountExist,u=e.confirmOnDevice,s=yield this.vault.getProvider(),c=yield this.createAccount({indexes:t,purpose:n,names:r,template:i,addressIndex:0,isChange:!1,isCustomAddress:!1,confirmOnDevice:u,validator:a?void 0:function(){var e=(0,o.default)((function*(e){var t=e.xpub,n=e.addressEncoding;return(yield s.getAccount({type:"simple",xpub:t},n)).txs>0}));return function(t){return e.apply(this,arguments)}}()});return c}));return function(t){return e.apply(this,arguments)}}(),i.createAccount=function(){var e=(0,o.default)((function*(e){var t,n,i=e.indexes,o=e.purpose,a=e.names,u=e.template,s=e.addressIndex,c=e.isChange,d=e.isCustomAddress,l=e.confirmOnDevice,h=e.validator,I=yield this.getNetworkImpl(),x=this.vault,b=x.getDefaultPurpose(),k=x.getCoinName(),E=x.getCoinType(),C=o||b,P=0!==i[0],O=[].concat((0,r.default)(P?[i[0]-1]:[]),(0,r.default)(i)),B=(0,T.getAccountDefaultByPurpose)(C,k).addressEncoding,D=(0,w.getAccountNameInfoByTemplate)(I,u).prefix,N=yield this.vault.getProvider();try{var S=yield this.getHardwareInfo(),R=S.connectId,F=S.deviceId,U=yield this.getWalletPassphraseState();yield this.getHardwareSDKInstance();var H=(0,g.slicePathTemplate)(u).pathPrefix;t=yield p.HardwareSDK.btcGetPublicKey(R,F,A({bundle:O.map((function(e){return{path:`${H}/${e}'`,coin:k.toLowerCase(),showOnOneKey:!!l&&e===O[O.length-1]}}))},U)),n=yield p.HardwareSDK.btcGetPublicKey(R,F,A({bundle:O.map((function(e){return{path:`${H}/${e}'/0/0`,coin:k.toLowerCase(),showOnOneKey:!1}}))},U))}catch(ee){throw console.error(ee),new y.OneKeyHardwareError(ee)}if(!t.success||!t.payload||!n.success||!n.payload)throw console.error(t.payload),(0,f.convertDeviceError)(t.payload);if(t.payload.length!==O.length)throw new y.OneKeyInternalError("Unable to get publick key.");for(var K=[],_=0,M=0,j=t.payload.length;M<j;M+=1){var V,L,$=t.payload[M],W=$.path,X=$.xpub,G=$.xpubSegwit,z=n.payload[M].node,q=`${c?"1":"0"}/${s}`,Y=N.xpubToAddresses(X,[q],B)[q],Q=d?((V={})[q]=Y,V):void 0,J=[v.COINTYPE_DOGE,v.COINTYPE_BCH].includes(E)?k:D,Z=(a||[])[_]||`${J} #${O[_]+1}`;if(!P||_>0)K.push({id:`${this.walletId}--${W}`,name:Z,type:m.AccountType.UTXO,path:W,coinType:E,pub:z.public_key,xpub:X,xpubSegwit:G||X,address:Y,addresses:(L={},L[q]=Y,L),customAddresses:Q,template:u});if(1===O.length)break;if(h){if(!(yield null==h?void 0:h({xpub:G||X,address:Y,addressEncoding:B})))break;_+=1,yield new Promise((function(e){return setTimeout(e,200)}))}else _+=1}return K}));return function(t){return e.apply(this,arguments)}}(),i.prepareAccountByAddressIndex=function(){var e=(0,o.default)((function*(e){var t,n=e.template,r=e.accountIndex,i=e.addressIndex,o=parseInt(null==(t=n.split("/"))?void 0:t[1],10);return this.createAccount({indexes:[r],purpose:o,template:n,addressIndex:i,isChange:!1,isCustomAddress:!0})}));return function(t){return e.apply(this,arguments)}}(),i.getAddress=function(){var e=(0,o.default)((function*(e){var t=this.vault.getCoinName(),n="";if(e.isTemplatePath)n=e.path;else{var r=yield this.getDbAccount({noCache:!0}),i=r.addresses,o=r.address,a=Object.keys(r.addresses).find((function(e){return i[e]===o}));if(!a)return"";n=`${r.path}/${a}`}yield this.getHardwareSDKInstance();var u=yield this.getHardwareInfo(),s=u.connectId,c=u.deviceId,d=yield this.getWalletPassphraseState(),l=yield p.HardwareSDK.btcGetAddress(s,c,A({path:n,showOnOneKey:e.showOnOneKey,coin:t.toLowerCase()},d));if(l.success)return l.payload.address;throw(0,f.convertDeviceError)(l.payload)}));return function(t){return e.apply(this,arguments)}}(),i.batchGetAddress=function(){var e=(0,o.default)((function*(e){var t=this.vault.getCoinName(),n=yield this.getHardwareInfo(),r=n.connectId,i=n.deviceId,o=yield this.getWalletPassphraseState(),a=yield p.HardwareSDK.btcGetAddress(r,i,A(A({},o),{},{bundle:e.map((function(e){return{path:e.path,showOnOneKey:!!e.showOnOneKey,coin:t.toLowerCase()}}))}));if(!a.success)throw(0,f.convertDeviceError)(a.payload);return a.payload.map((function(e){var t,n;return{path:null!=(t=e.path)?t:"",address:null!=(n=e.address)?n:""}}))}));return function(t){return e.apply(this,arguments)}}(),i.signMessage=function(){var e=(0,o.default)((function*(e){h.default.common.info("BTCFork signMessage",e);var t=this.vault.getCoinName(),n=yield this.getDbAccount(),r=yield this.getHardwareInfo(),i=r.connectId,a=r.deviceId,u=yield this.getWalletPassphraseState();yield this.getHardwareSDKInstance();var s=yield Promise.all(e.map(function(){var e=(0,o.default)((function*(e){var r,o=yield p.HardwareSDK.btcSignMessage(i,a,A(A({},u),{},{path:`${n.path}/0/0`,coin:t,messageHex:x.from(e.message).toString("hex"),noScriptType:null==(r=e.sigOptions)?void 0:r.noScriptType}));if(!o.success)throw(0,f.convertDeviceError)(o.payload);return o.payload}));return function(t){return e.apply(this,arguments)}}()));return s.map((function(e){return e.signature}))}));return function(t){return e.apply(this,arguments)}}(),(0,a.default)(n)}(I.KeyringHardwareBase)},111365:(e,t,n)=>{n.r(t),n.d(t,{KeyringHd:()=>C});var r=n(968079),i=n(196234),o=n(634795),a=n(887371),u=n(545754),s=n(411987),c=n(695058),d=n(376314),l=n(344075),f=n.n(l),p=n(605851),v=n(613549),h=n(292147),y=n(471453),g=n(940915),w=n(997293),m=n(278489),I=n(794292),T=n(398145),x=n(572801),b=n(810887),A=n(16280),k=n(348834).Buffer;function E(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,c.default)(e);if(t){var i=(0,c.default)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,s.default)(this,n)}}var C=function(e){(0,u.default)(n,e);var t=E(n);function n(){return t.apply(this,arguments)}var s=n.prototype;return s.signTransaction=function(){var e=(0,o.default)((function*(e,t){(0,A.initBitcoinEcc)();var n=t.password,r=e.psbtHex,i=e.inputsToSign;if("undefined"===typeof n)throw new g.OneKeyInternalError("Software signing requires a password.");var o=e.encodedTx.transferInfo,a=yield this.getSigners(n,(i||e.inputs).map((function(e){return e.address})),o.useCustomAddressesBalance);h.default.engine.info("signTransaction",this.networkId,e);var u=yield this.vault.getProvider();if(r&&i){var s=u.network,c=d.Psbt.fromHex(r,{network:s});return u.signPsbt({psbt:c,signers:a,inputsToSign:i})}return u.signTransaction(e,a)}));return function(t,n){return e.apply(this,arguments)}}(),s.getSigners=function(){var e=(0,o.default)((function*(e,t,n){var r,o={};if(n){var a=yield this.getDbAccount();r=this.vault.getCustomAddressMap(a)}var u=(yield this.vault.collectUTXOsInfo({checkInscription:!1,customAddressMap:r})).utxos;for(var s of u){var c=s.address,d=s.path;t.includes(c)&&(o[d]=c)}var l=Object.keys(o).map((function(e){return e.split("/").slice(-2).join("/")}));if(0===l.length)throw new g.OneKeyInternalError("No signers would be chosen.");var f=yield this.getPrivateKeys(e,l),p={};for(var h of Object.entries(f)){var y=(0,i.default)(h,2),w=y[0],m=y[1],T=o[w];if((yield this.getNetworkImpl())===v.IMPL_TBTC){if(!T)T=o[w.replace("m/86'/0'/","m/86'/1'/")];if(!T)T=o[w.replace("m/86'/1'/","m/86'/0'/")]}var x=new I.Signer(m,e,"secp256k1");if(T!==T)throw new Error("addressFromPrivateKey and utxoAddress not matched");p[T]=x}return p}));return function(t,n,r){return e.apply(this,arguments)}}(),s.prepareAccounts=function(){var e=(0,o.default)((function*(e){var t=e.password,n=e.indexes,r=e.purpose,i=e.names,a=e.template,u=e.skipCheckAccountExist;(0,A.initBitcoinEcc)();var s=yield this.vault.getProvider(),c=yield this.createAccount({password:t,indexes:n,purpose:r,names:i,template:a,addressIndex:0,isChange:!1,isCustomAddress:!1,validator:u?void 0:function(){var e=(0,o.default)((function*(e){var t=e.xpub,n=e.addressEncoding;return(yield s.getAccount({type:"simple",xpub:t},n)).txs>0}));return function(t){return e.apply(this,arguments)}}()});return c}));return function(t){return e.apply(this,arguments)}}(),s.createAccount=function(){var e=(0,o.default)((function*(e){var t=e.password,n=e.indexes,i=e.purpose,o=e.names,a=e.template,u=e.addressIndex,s=e.isChange,c=e.isCustomAddress,d=e.validator,l=yield this.getNetworkImpl(),h=this.vault,y=h.getDefaultPurpose(),I=h.getCoinName(),x=h.getCoinType(),b=i||y,E=0!==n[0],C=[].concat((0,r.default)(E?[n[0]-1]:[]),(0,r.default)(n)),P=(0,A.getAccountDefaultByPurpose)(b,I).addressEncoding,O=(0,m.getAccountNameInfoByTemplate)(l,a).prefix,B=(yield this.engine.dbApi.getCredential(this.walletId,t)).seed,D=yield this.vault.getProvider(),N=D.network,S=(0,w.slicePathTemplate)(a).pathPrefix,R=(0,p.batchGetPublicKeys)("secp256k1",B,t,S,C.map((function(e){return`${e.toString()}'`})));if(R.length!==C.length)throw new g.OneKeyInternalError("Unable to get publick key.");var F=((N.segwitVersionBytes||{})[P]||N.bip32).public,U=[],H=0;for(var K of R){var _,M,j=K.path,V=K.parentFingerPrint,L=K.extendedKey,$=f().encode(k.concat([k.from(F.toString(16).padStart(8,"0"),"hex"),k.from([3]),V,k.from((C[H]+2**31).toString(16).padStart(8,"0"),"hex"),L.chainCode,L.key])),W=`${s?"1":"0"}/${u}`,X=D.xpubToAddresses($,[W],P)[W],G=c?((_={})[W]=X,_):void 0,z=[v.COINTYPE_DOGE,v.COINTYPE_BCH].includes(x)?I:O,q=(o||[])[H]||`${z} #${C[H]+1}`;if(!E||H>0)U.push({id:`${this.walletId}--${j}`,name:q,type:T.AccountType.UTXO,path:j,coinType:x,xpub:$,address:X,addresses:(M={},M[W]=X,M),customAddresses:G,template:a});if(1===C.length)break;if(d){if(!(yield null==d?void 0:d({xpub:$,address:X,addressEncoding:P})))break;H+=1,yield new Promise((function(e){return setTimeout(e,200)}))}else H+=1}return U}));return function(t){return e.apply(this,arguments)}}(),s.prepareAccountByAddressIndex=function(){var e=(0,o.default)((function*(e){var t,n=e.password,r=e.template,i=e.accountIndex,o=e.addressIndex,a=parseInt(null==(t=r.split("/"))?void 0:t[1],10);return yield this.createAccount({password:n,indexes:[i],purpose:a,template:r,addressIndex:o,isChange:!1,isCustomAddress:!0})}));return function(t){return e.apply(this,arguments)}}(),s.signMessage=function(){var e=(0,o.default)((function*(e,t){h.default.common.info("BTCFork signMessage",e);for(var n=t.password,r=void 0===n?"":n,i=(yield this.engine.dbApi.getCredential(this.walletId,r)).entropy,o=yield this.engine.getAccount(this.accountId,this.networkId),a=yield this.getNetwork(),u=`${o.path}/0/0`,s=yield this.vault.getProvider(),c=[],d=0,l=e.length;d<l;d+=1){var f=e[d],p=f.message,v=f.type,g=f.sigOptions;if(v===x.BtcMessageTypes.BIP322_SIMPLE){var w=yield this.getSigners(r,[o.address]),m=yield s.signBip322MessageSimple({account:o,message:p,signers:w,psbtNetwork:(0,y.toPsbtNetwork)(a)});c.push(m)}else{var I=s.signMessage({password:r,entropy:i,path:u,message:p,sigOptions:g});c.push(I)}}return c.map((function(e){return e.toString("hex")}))}));return function(t,n){return e.apply(this,arguments)}}(),(0,a.default)(n)}(b.KeyringHdBase)},602219:(e,t,n)=>{n.r(t),n.d(t,{KeyringImported:()=>C});var r=n(968079),i=n(196234),o=n(634795),a=n(887371),u=n(545754),s=n(411987),c=n(695058),d=n(376314),l=n(344075),f=n.n(l),p=n(672758),v=n(478557),h=n(901187),y=n(292147),g=n(471453),w=n(940915),m=n(794292),I=n(398145),T=n(572801),x=n(255942),b=n(16280),A=n(348834).Buffer;function k(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,c.default)(e);if(t){var i=(0,c.default)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,s.default)(this,n)}}var E=new p.BaseBip32KeyDeriver(A.from("Bitcoin seed"),v.secp256k1),C=function(e){(0,u.default)(n,e);var t=k(n);function n(){return t.apply(this,arguments)}var s=n.prototype;return s.signTransaction=function(){var e=(0,o.default)((function*(e,t){(0,b.initBitcoinEcc)();var n=t.password,r=e.psbtHex,i=e.inputsToSign;if("undefined"===typeof n)throw new w.OneKeyInternalError("Software signing requires a password.");var o=yield this.getSigners(n,e.inputs.map((function(e){return e.address})));y.default.engine.info("signTransaction",this.networkId,e);var a=yield this.vault.getProvider();if(r&&i){var u=a.network,s=d.Psbt.fromHex(r,{network:u});return a.signPsbt({psbt:s,signers:o,inputsToSign:i})}return a.signTransaction(e,o)}));return function(t,n){return e.apply(this,arguments)}}(),s.getSigners=function(){var e=(0,o.default)((function*(e,t){var n={},r=(yield this.vault.collectUTXOsInfo({checkInscription:!1})).utxos;for(var o of r){var a=o.address,u=o.path;if(t.includes(a)){var s=u.split("/").slice(-2).join("/");n[s]=a}}var c=Object.keys(n);if(0===c.length)throw new w.OneKeyInternalError("No signers would be chosen.");var d={},l={},f=Object.values(yield this.getPrivateKeys(e)),p=(0,i.default)(f,1)[0],v=(0,h.decrypt)(e,p),y={chainCode:v.slice(13,45),key:v.slice(46,78)};return c.forEach((function(t){var r=t.split("/"),i="",o=y;r.forEach((function(e){if(i=i.length>0?`${i}/${e}`:e,"undefined"===typeof l[i]){var t=e.endsWith("'")?parseInt(e.slice(0,-1))+2**31:parseInt(e),n=E.CKDPriv(o,t);l[i]=n}o=l[i]}));var a=n[t];d[a]=new m.Signer((0,h.encrypt)(e,l[t].key),e,"secp256k1")})),d}));return function(t,n){return e.apply(this,arguments)}}(),s.prepareAccounts=function(){var e=(0,o.default)((function*(e){var t;(0,b.initBitcoinEcc)();var n=e.privateKey,i=e.name,o=e.template,a=yield this.vault.getProvider(),u=this.vault.getCoinType(),s="",c=a.network,d=parseInt(n.slice(0,4).toString("hex"),16);for(var l of[].concat((0,r.default)(Object.values(c.segwitVersionBytes||{})),[c.bip32]))if(l.private===d){var p=v.secp256k1.publicFromPrivate(n.slice(46,78)),h=A.from(l.public.toString(16).padStart(8,"0"),"hex");try{s=f().encode(n.fill(h,0,4).fill(p,45,78))}catch(m){console.error(m)}}if(""===s)throw new w.OneKeyInternalError("Invalid private key.");var y="0/0",g=a.xpubToAddresses(s,[y])[y];return Promise.resolve([{id:`imported--${u}--${s}`,name:i||"",type:I.AccountType.UTXO,path:"",coinType:u,xpub:s,address:g,addresses:(t={},t[y]=g,t),template:o}])}));return function(t){return e.apply(this,arguments)}}(),s.signMessage=function(){var e=(0,o.default)((function*(e,t){(0,b.initBitcoinEcc)(),y.default.common.info("BTCFork signMessage",e);for(var n=yield this.vault.getProvider(),r=this.vault.getCoinType(),o=t.password,a=void 0===o?"":o,u=yield this.engine.getAccount(this.accountId,this.networkId),s=Object.values(yield this.getPrivateKeys(a)),c=(0,i.default)(s,1)[0],d=f().encode((0,h.decrypt)(a,c)),l=(0,b.getBip32FromBase58)({coinType:r,key:d}).derivePath("0/0"),p=(0,b.getBitcoinECPair)().fromWIF(l.toWIF()),v=yield this.getNetwork(),w=`${u.path}/0/0`,m=[],I=0,x=e.length;I<x;I+=1){var k=e[I],E=k.message,C=k.type,P=k.sigOptions;if(C===T.BtcMessageTypes.BIP322_SIMPLE){var O=yield this.getSigners(a,[u.address]),B=yield n.signBip322MessageSimple({account:u,message:E,signers:O,psbtNetwork:(0,g.toPsbtNetwork)(v)});m.push(B)}else{var D=n.signMessage({password:a,entropy:A.from([]),path:w,message:E,sigOptions:P,keyPair:p});m.push(D)}}return m.map((function(e){return e.toString("hex")}))}));return function(t,n){return e.apply(this,arguments)}}(),(0,a.default)(n)}(x.KeyringImportedBase)},520173:(e,t,n)=>{n.r(t),n.d(t,{KeyringWatching:()=>l});var r=n(634795),i=n(887371),o=n(545754),a=n(411987),u=n(695058),s=n(940915),c=n(398145);function d(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,u.default)(e);if(t){var i=(0,u.default)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,a.default)(this,n)}}var l=function(e){(0,o.default)(n,e);var t=d(n);function n(){return t.apply(this,arguments)}return n.prototype.prepareAccounts=function(){var e=(0,r.default)((function*(e){var t;console.log("btcfork watching prepareAccount");var n=e.target,r=e.name,i=e.accountIdPrefix,o=yield this.vault.getProvider(),a=this.vault.getCoinType();try{if(!o.isValidXpub(n))throw new s.InvalidAddress}catch(l){throw new s.InvalidAddress}var u="0/0",d=o.xpubToAddresses(n,[u])[u];return[{id:`${i}--${a}--${n}`,name:r||"",type:c.AccountType.UTXO,path:"",coinType:a,xpub:n,address:d,addresses:(t={},t[u]=d,t)}]}));return function(t){return e.apply(this,arguments)}}(),(0,i.default)(n)}(n(701625).KeyringWatchingBase)},690350:(e,t,n)=>{n.r(t),n.d(t,{default:()=>Y});var r=n(968079),i=n(459740),o=n(301842),a=n.n(o),u=n(256666),s=n(196234),c=n(161049),d=n.n(c),l=n(634795),f=n(887371),p=n(545754),v=n(411987),h=n(695058),y=n(206391),g=n.n(y),w=n(344075),m=n.n(w),I=n(636393),T=n(992431),x=n(901187),b=n(380845),A=n(402814),k=n(613549),E=n(292147),C=n(471453),P=n(396564),O=n(313503),B=n(732349),D=n(940915),N=n(997293),S=n(278489),R=n(790656),F=n(556658),U=n(63450),H=n(459729),K=n(631368),_=n(398514),M=n(786141),j=n(392853),V=n(882914),L=n(331489),$=n(16280),W=n(348834).Buffer,X=["txId","value"];function G(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function z(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?G(Object(n),!0).forEach((function(t){(0,u.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):G(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function q(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,h.default)(e);if(t){var i=(0,h.default)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,v.default)(this,n)}}var Y=function(e){(0,p.default)(n,e);var t=q(n);function n(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).keyringMap={},e.settings={},e.providerClass=V.Provider,e.collectUTXOsInfo=(0,P.memoizee)((0,l.default)((function*(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=yield e.getProvider(),r=yield e.getDbAccount();try{var i=yield n.getUTXOs(e.getAccountXpub(r),t);if("ERROR"===i.ordQueryStatus&&d()(n.getUTXOs.clear))try{n.getUTXOs.clear()}catch(o){}return i}catch(a){throw console.error(a),new D.OneKeyInternalError("Failed to get UTXOs of the account.")}})),{promise:!0,max:4,maxAge:3e4}),e.getFeeRate=(0,P.memoizee)((0,l.default)((function*(){var t=yield(yield e.getProvider()).blockbook,n=e.getDefaultBlockNums();try{for(var r=yield Promise.all(n.map((function(e){return t.estimateFee(e).then((function(e){return new(g())(e).toFixed(0)}))}))),i=r.findIndex((function(e){return new(g())(e).lt(0)}));i>=0;){for(var o=i-1,a=i+1;;){if(o>=0&&new(g())(r[o]).gte(0)){r[i]=r[o];break}if(a<r.length&&new(g())(r[a]).gte(0)){r[i]=r[a];break}if(a+=1,(o-=1)<0&&a>=r.length)break}i=r.findIndex((function(e){return new(g())(e).lt(0)}))}return r.sort((function(e,t){return new(g())(e).comparedTo(new(g())(t))}))}catch(u){throw console.error(u),new D.OneKeyInternalError("Failed to get fee rates.")}})),{promise:!0,max:1,maxAge:3e4}),e}var o=n.prototype;return o.getDefaultPurpose=function(){return(0,N.getDefaultPurpose)(k.IMPL_BTC)},o.getCoinName=function(){return"BTC"},o.getCoinType=function(){return k.COINTYPE_BTC},o.getXprvReg=function(){return/^[xyz]prv/},o.getXpubReg=function(){return/^[xyz]pub/},o.getDefaultBlockNums=function(){return[5,2,1]},o.getDefaultBlockTime=function(){return 600},o.getAccountXpub=function(e){return e.xpub},o.getProvider=function(){var e=(0,l.default)((function*(){var e,t,n=yield this.getRpcUrl(),r="";null!=(e=this.provider)&&e.chainInfo&&(r=(0,L.getRpcUrlFromChainInfo)(null==(t=this.provider)?void 0:t.chainInfo));if(!this.provider||r!==n){var i=yield this.engine.providerManager.getChainInfoByNetworkId(this.networkId),o=this.providerClass;this.provider=new o(i)}return this.provider}));return function(){return e.apply(this,arguments)}}(),o.getTransactionDetail=function(){var e=(0,l.default)((function*(e){return(yield this.getProvider()).getTransactionDetail(e)}));return function(t){return e.apply(this,arguments)}}(),o.getOutputAccount=function(){var e=(0,l.default)((function*(){var e=yield this.getDbAccount({noCache:!0});return{id:e.id,name:e.name,type:e.type,path:e.path,coinType:e.coinType,tokens:[],address:e.address,pubKey:e.pub,xpub:this.getAccountXpub(e),template:e.template,customAddresses:JSON.stringify(e.customAddresses)}}));return function(){return e.apply(this,arguments)}}(),o.getFetchBalanceAddress=function(e){return Promise.resolve(this.getAccountXpub(e))},o.validateAddress=function(){var e=(0,l.default)((function*(e){var t=(yield this.getProvider()).verifyAddress(e),n=t.normalizedAddress;if(!t.isValid||"undefined"===typeof n)throw new D.InvalidAddress;return Promise.resolve(n)}));return function(t){return e.apply(this,arguments)}}(),o.validateTokenAddress=function(){var e=(0,l.default)((function*(e){return(0,O.isBRC20Token)(e)?Promise.resolve(e):Promise.reject(new D.InvalidTokenAddress)}));return function(t){return e.apply(this,arguments)}}(),o.validateImportedCredential=function(){var e=(0,l.default)((function*(e){var t=this.getXprvReg(),n=!1;try{n=this.settings.importedAccountEnabled&&t.test(e)&&(yield this.getProvider()).isValidXprv(e)}catch(r){}return Promise.resolve(n)}));return function(t){return e.apply(this,arguments)}}(),o.validateWatchingCredential=function(){var e=(0,l.default)((function*(e){if(!e)return Promise.resolve(!1);var t=this.getXpubReg(),n=!1;try{n=this.settings.watchingAccountEnabled&&t.test(e)&&(yield this.getProvider()).isValidXpub(e)}catch(r){}if(!n){console.error(`BTCfork validateWatchingCredential ERROR: not valid xpub:${e}`);try{n=Boolean(yield this.validateAddress(e))}catch(i){n=!1,console.error(`BTCfork validateWatchingCredential ERROR: not valid address:${e}`)}}return Promise.resolve(n)}));return function(t){return e.apply(this,arguments)}}(),o.validateCanCreateNextAccount=function(){var e=(0,l.default)((function*(e,t){var n=yield Promise.all([this.engine.getWallet(e),this.engine.getNetwork(this.networkId)]),r=(0,s.default)(n,2),i=r[0],o=r[1],a=(0,N.getLastAccountId)(i,o.impl,t);if(!a)return!0;var u=yield this.engine.dbApi.getAccounts([a]),c=(0,s.default)(u,1)[0];if("undefined"!==typeof c&&!(yield this.checkAccountExistence(this.getAccountXpub(c)))){var d=(0,S.getAccountNameInfoByTemplate)(o.impl,t).label;throw new D.PreviousAccountIsEmpty(d)}return!0}));return function(t,n){return e.apply(this,arguments)}}(),o.checkAccountExistence=function(){var e=(0,l.default)((function*(e,t){var n=!1,r=0;try{var i=yield this.getProvider();if(t)r=(yield i.getAccountWithAddress({type:"simple",address:e})).txs;else r=(yield i.getAccount({type:"simple",xpub:e})).txs;n=r>0}catch(o){console.error(o)}return Promise.resolve(n)}));return function(t,n){return e.apply(this,arguments)}}(),o.getAccountBalance=function(){var e=(0,l.default)((function*(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=e.map((function(e){}));if(!t)return n;var r,i=yield this.getDbAccount(),o=this.getAccountXpub(i);if(o){var a=yield this.getBalances([{address:o}]);r=(0,s.default)(a,1)[0]}else if(i.address){var u=yield this.getBalancesByAddress([{address:i.address}]);r=(0,s.default)(u,1)[0]}return[r].concat(n)}));return function(t){return e.apply(this,arguments)}}(),o.getBalances=function(){var e=(0,l.default)((function*(e){return(yield this.getProvider()).getBalances(e)}));return function(t){return e.apply(this,arguments)}}(),o.getBalancesByAddress=function(){var e=(0,l.default)((function*(e){return(yield this.getProvider()).getBalancesByAddress(e)}));return function(t){return e.apply(this,arguments)}}(),o.getExportedCredential=function(){var e=(0,l.default)((function*(e){var t=yield this.getDbAccount();if(t.id.startsWith("hd-")){var n=parseInt(t.path.split("/")[1]),r=(0,$.getAccountDefaultByPurpose)(n,this.getCoinName()).addressEncoding,i=(yield this.getProvider()).network,o=((i.segwitVersionBytes||{})[r]||i.bip32).private,a=this.keyring,u=Object.values(yield a.getPrivateKeys(e)),c=(0,s.default)(u,1)[0];return m().encode(m().decode(t.xpub).fill(W.from(o.toString(16).padStart(8,"0"),"hex"),0,4).fill(W.concat([W.from([0]),(0,x.decrypt)(e,c)]),45,78))}if(t.id.startsWith("imported-")){var d=(yield this.engine.dbApi.getCredential(this.accountId,e)).privateKey;if("undefined"===typeof d)throw new D.OneKeyInternalError("Unable to get credential.");return m().encode((0,x.decrypt)(e,d))}throw new D.OneKeyInternalError("Only credential of HD or imported accounts can be exported")}));return function(t){return e.apply(this,arguments)}}(),o.attachFeeInfoToEncodedTx=function(){var e=(0,l.default)((function*(e){var t=yield this.engine.getNetwork(this.networkId),n=e.encodedTx,r=e.feeInfoValue,i=r.feeRate?new(g())(r.feeRate).shiftedBy(-t.feeDecimals).toFixed():r.price;return"string"===typeof i?n.transferInfos?this.buildEncodedTxFromBatchTransfer({transferInfos:n.transferInfos,specifiedFeeRate:i}):this.buildEncodedTxFromTransfer(n.transferInfo,i):Promise.resolve(e.encodedTx)}));return function(t){return e.apply(this,arguments)}}(),o.decodedTxToLegacy=function(e){var t=e.actions[0],n=t.type,r=t.nativeTransfer;t.inscriptionInfo;return n===_.IDecodedTxActionType.NATIVE_TRANSFER&&r?Promise.resolve({txType:K.EVMDecodedTxType.NATIVE_TRANSFER,symbol:"UNKNOWN",amount:r.amount,value:r.amountValue,fromAddress:r.from,toAddress:r.to,data:"",totalFeeInNative:e.totalFeeInNative,total:g().sum.apply(null,(r.utxoFrom||[]).map((function(e){return e.balanceValue}))).toFixed()}):Promise.resolve({})},o.decodePsbt=function(){var e=(0,l.default)((function*(e,t){for(var n=e.inputs,r=e.outputs,i=e.totalFee,o=new(g())(i).isNegative()||new(g())(i).isNaN(),a=yield this.engine.getNativeTokenInfo(this.networkId),u=yield this.getDbAccount(),s=yield this.getNetwork(),c=[],d=new(g())("0"),l=0,f=n.length;l<f;l+=1){var p,v=n[l];if(v.address===u.address)null!=(p=v.inscriptions)&&p[0]?c.push(yield this.buildInscriptionAction({from:u.address,to:"unknown",amount:"0",asset:z(z({},v.inscriptions[0]),{},{type:F.NFTAssetType.BTC})})):d=d.minus(v.value)}for(var h=0,y=r.length;h<y;h+=1){var w,m=r[h];if(m.address===u.address)o?c.push({type:_.IDecodedTxActionType.NATIVE_TRANSFER,direction:_.IDecodedTxDirection.IN,nativeTransfer:{tokenInfo:a,from:"unknown",to:u.address,amount:new(g())(m.value).shiftedBy(-s.decimals).toFixed(),amountValue:m.value,extraInfo:null}}):null!=(w=m.inscriptions)&&w[0]?c.push(yield this.buildInscriptionAction({from:"unknown",to:u.address,amount:"0",asset:z(z({},m.inscriptions[0]),{},{type:F.NFTAssetType.BTC})})):d=d.plus(m.value)}if(!d.isZero()){var T=d.isGreaterThan(0);c.push({type:_.IDecodedTxActionType.NATIVE_TRANSFER,direction:T?_.IDecodedTxDirection.IN:_.IDecodedTxDirection.OUT,nativeTransfer:{tokenInfo:a,from:T?"unknown":u.address,to:T?u.address:"unknown",amount:d.abs().shiftedBy(-s.decimals).toFixed(),amountValue:d.abs().toFixed(),extraInfo:null}})}return{txid:o?I.default.v4().toString():"",owner:u.address,signer:u.address,nonce:0,actions:c,status:o?_.IDecodedTxStatus.Offline:_.IDecodedTxStatus.Pending,networkId:this.networkId,accountId:this.accountId,extraInfo:null,encodedTx:e,totalFeeInNative:e.totalFeeInNative}}));return function(t,n){return e.apply(this,arguments)}}(),o.decodeTx=function(){var e=(0,l.default)((function*(e,t){var n,r,i,o=e.inputs,a=e.outputs,u=e.psbtHex,s=e.inputsToSign,c=null!=(n=e.transferInfo)?n:null==(r=e.transferInfos)?void 0:r[0],d=yield this.engine.getNetwork(this.networkId),l=yield this.getDbAccount(),f=yield this.engine.getNativeTokenInfo(this.networkId),p=(null!=(i=null==t?void 0:t.nftInfos)?i:[null==t?void 0:t.nftInfo]).filter(Boolean),v=c.isNFT?o.filter((function(e){return e.forceSelect})):null,h=[];if(u&&s)return this.decodePsbt(e,t);if(v&&v.length>0&&p.length>0)for(var y=0,w=p.length;y<w;y+=1){var m=p[y];h.push(yield this.buildInscriptionAction(m))}else{var I=o.map((function(e){return{address:e.address,balance:new(g())(e.value).shiftedBy(-d.decimals).toFixed(),balanceValue:e.value,symbol:d.symbol,isMine:!0}})),T=a.filter((function(e){var t;return!(null!=(t=e.payload)&&t.isCharge)})).map((function(e){return{address:e.address,balance:new(g())(e.value).shiftedBy(-d.decimals).toFixed(),balanceValue:e.value,symbol:d.symbol,isMine:e.address===l.address}}));h=T.map((function(t){return{type:_.IDecodedTxActionType.NATIVE_TRANSFER,direction:a[0].address===l.address?_.IDecodedTxDirection.OUT:_.IDecodedTxDirection.SELF,nativeTransfer:{tokenInfo:f,from:l.address,to:t.address,amount:t.balance,amountValue:t.balanceValue,extraInfo:null,utxoFrom:I,utxoTo:T,isInscribeTransfer:e.isInscribeTransfer}}}))}return{txid:"",owner:l.address,signer:l.address,nonce:0,actions:h,status:_.IDecodedTxStatus.Pending,networkId:this.networkId,accountId:this.accountId,extraInfo:null,encodedTx:e,totalFeeInNative:e.totalFeeInNative}}));return function(t,n){return e.apply(this,arguments)}}(),o.buildBRC20TokenAction=function(e){var t=e.nftInfo,n=e.token,r=e.dbAccount,i=e.brc20Content,o=e.isInscribeTransfer,a=t.from,u=t.to,s=_.IDecodedTxActionType.UNKNOWN,c=_.IDecodedTxDirection.OTHER,d={};return(null==i?void 0:i.op)===U.BRC20TokenOperation.Deploy&&(s=_.IDecodedTxActionType.TOKEN_BRC20_DEPLOY,c=_.IDecodedTxDirection.OUT,d={limit:i.lim,max:i.max}),(null==i?void 0:i.op)===U.BRC20TokenOperation.Mint&&(s=_.IDecodedTxActionType.TOKEN_BRC20_MINT,c=_.IDecodedTxDirection.IN,d={amount:i.amt||"0"}),(null==i?void 0:i.op)===U.BRC20TokenOperation.Transfer&&(s=_.IDecodedTxActionType.TOKEN_BRC20_TRANSFER,d={amount:i.amt||"0"},a===u&&a===r.address?c=_.IDecodedTxDirection.SELF:a===r.address?c=_.IDecodedTxDirection.OUT:u===r.address&&(c=_.IDecodedTxDirection.IN)),(null==i?void 0:i.op)===U.BRC20TokenOperation.InscribeTransfer&&(s=_.IDecodedTxActionType.TOKEN_BRC20_INSCRIBE,c=_.IDecodedTxDirection.IN,d={amount:i.amt||"0"}),i?{type:s,direction:c,brc20Info:z({token:n,asset:t.asset,sender:t.from,receiver:t.to,extraInfo:null,isInscribeTransfer:o},d)}:{type:s,direction:c}},o.buildNFTAction=function(){var e=(0,l.default)((function*(e){var t=e.nftInfo,n=e.dbAccount,r=t.from,i=t.to,o=t.asset,a=_.IDecodedTxDirection.OTHER;r===i&&r===n.address?a=_.IDecodedTxDirection.SELF:r===n.address?a=_.IDecodedTxDirection.OUT:i===n.address&&(a=_.IDecodedTxDirection.IN);var u=(yield(0,R.getAllAssetsFromLocal)({networkId:this.networkId,accountId:this.accountId})).filter((function(e){return e.inscription_id!==o.inscription_id&&e.owner===o.owner&&e.output===o.output&&e.output_value_sat===o.output_value_sat}));return{type:_.IDecodedTxActionType.NFT_TRANSFER_BTC,direction:a,inscriptionInfo:{send:t.from,receive:null==t?void 0:t.to,asset:null==t?void 0:t.asset,assetsInSameUtxo:u,extraInfo:null}}}));return function(t){return e.apply(this,arguments)}}(),o.buildInscriptionAction=function(){var e=(0,l.default)((function*(e){var t,n=e.asset,r=n.content,i=n.content_type,o=n.contentUrl,a=yield this.getDbAccount(),u=yield(0,O.parseBRC20Content)({content:r,contentType:i,contentUrl:o}),s=u.isBRC20Content,c=u.brc20Content,d=`brc-20--${null!=(t=null==c?void 0:c.tick)?t:""}`,l=yield this.engine.findToken({networkId:this.networkId,tokenIdOnNetwork:d});return s&&l?this.buildBRC20TokenAction({nftInfo:e,dbAccount:a,token:l,brc20Content:c}):this.buildNFTAction({nftInfo:e,dbAccount:a})}));return function(t){return e.apply(this,arguments)}}(),o.buildEncodedTxFromTransfer=function(){var e=(0,l.default)((function*(e,t){if(!e.to)throw new Error("Invalid transferInfo.to params");return this.buildEncodedTxFromBatchTransfer({transferInfos:[e],specifiedFeeRate:t})}));return function(t,n){return e.apply(this,arguments)}}(),o.buildEncodedTxFromBatchTransfer=function(){var e=(0,l.default)((function*(e){var t=e.transferInfos,n=e.specifiedFeeRate,r=t[0],o=yield this.engine.getNetwork(this.networkId),u=yield this.getDbAccount(),s=Boolean(t.find((function(e){return e.isInscribe}))),c=yield this.buildTransferParamsWithCoinSelector({transferInfos:t,specifiedFeeRate:n,isInscribeTransfer:s}),d=c.inputs,l=c.outputs,f=c.fee,p=c.inputsForCoinSelect,v=c.outputsForCoinSelect,h=c.feeRate;if(!d||!l||a()(f))throw new D.InsufficientBalance("Failed to select UTXOs");var y=f.toString(),w=new(g())(y).shiftedBy(-1*o.feeDecimals).toFixed();return{inputs:d.map((function(e){var t=e.txId,n=e.value;return z(z({address:"",path:""},(0,i.default)(e,X)),{},{txid:t,value:n.toString()})})),outputs:l.map((function(e){var t=e.value,n=e.address,i=e.script,o=null==t?void 0:t.toString();if(o&&new(g())(o).eq(0)&&!n&&i===r.opReturn)return{address:"",value:o,payload:{opReturn:r.opReturn}};var a=n||u.address;if(!a)throw new Error("buildEncodedTxFromBatchTransfer ERROR: Invalid change address");if(!o||new(g())(o).lte(0))throw new Error("buildEncodedTxFromBatchTransfer ERROR: Invalid value");return{address:a,value:o,payload:n?void 0:{isCharge:!0,bip44Path:(0,$.getBIP44Path)(u,u.address)}}})),totalFee:y,totalFeeInNative:w,transferInfo:r,transferInfos:t,feeRate:h,isInscribeTransfer:s,inputsForCoinSelect:p,outputsForCoinSelect:v}}));return function(t){return e.apply(this,arguments)}}(),o.buildEncodedTxFromApprove=function(e){throw new D.NotImplemented},o.updateEncodedTxTokenApprove=function(e,t){throw new D.NotImplemented},o.updateEncodedTx=function(){var e=(0,l.default)((function*(e,t,n){if(n.type===_.IEncodedTxUpdateType.advancedSettings&&Array.isArray(t.selectedUtxos)&&t.selectedUtxos.length){var r=yield this.engine.getNetwork(this.networkId);return this.buildEncodedTxFromTransfer(z(z({},e.transferInfo),{},{selectedUtxos:t.selectedUtxos}),new(g())(e.feeRate).shiftedBy(-r.feeDecimals).toFixed())}return Promise.resolve(e)}));return function(t,n,r){return e.apply(this,arguments)}}(),o.buildUnsignedTxFromEncodedTx=function(e){var t=e.inputs,n=e.outputs,r=e.psbtHex,i=e.inputsToSign,o=[];for(var a of t){var u=new(g())(a.value);o.push({address:a.address,value:u,utxo:{txid:a.txid,vout:a.vout,value:u}})}var s=n.map((function(e){var t=e.address,n=e.value,r=e.payload;return{address:t,value:new(g())(n),payload:r}})),c={inputs:o,outputs:s,psbtHex:r,inputsToSign:i,payload:{},encodedTx:e};return Promise.resolve(c)},o.fetchFeeInfo=function(){var e=(0,l.default)((function*(e,t,n){var r=yield this.engine.getNetwork(this.networkId),i=yield this.getProvider(),o=(yield i.buildUnsignedTx(z(z({},yield this.buildUnsignedTxFromEncodedTx(e)),{},{feePricePerUnit:new(g())(1),encodedTx:e}))).feeLimit,a=(n?[n]:yield this.getFeeRate()).map((function(e){return new(g())(e).shiftedBy(-r.feeDecimals).toFixed()})),u=a.map((function(t){return(0,$.coinSelect)({inputsForCoinSelect:e.inputsForCoinSelect,outputsForCoinSelect:e.outputsForCoinSelect,feeRate:new(g())(t).shiftedBy(r.feeDecimals).toFixed()}).fee})).filter(Boolean);return{isBtcForkChain:!0,limit:(null!=o?o:new(g())(0)).toFixed(),prices:a,feeList:u,waitingSeconds:yield this.getTxWaitingSeconds(),defaultPresetIndex:"1",feeSymbol:"BTC",feeDecimals:r.feeDecimals,nativeSymbol:r.symbol,nativeDecimals:r.decimals,tx:null}}));return function(t,n,r){return e.apply(this,arguments)}}(),o.getTxWaitingSeconds=function(){var e=(0,l.default)((function*(){var e=this;return this.getDefaultBlockNums().map((function(t){return t*e.getDefaultBlockTime()}))}));return function(){return e.apply(this,arguments)}}(),o.getFeePricePerUnit=function(){var e=(0,l.default)((function*(){var e=(yield this.getFeeRate()).map((function(e){return new(g())(e)}));return{normal:{price:e[1]},others:[{price:e[0]},{price:e[2]}]}}));return function(){return e.apply(this,arguments)}}(),o.broadcastTransaction=function(){var e=(0,l.default)((function*(e){var t,n=this;E.default.engine.info("broadcastTransaction START:",{rawTx:e.rawTx});var r=yield this.getProvider(),i=yield r.broadcastTransaction(e.rawTx);E.default.engine.info("broadcastTransaction END:",{txid:i,rawTx:e.rawTx});var o=(null!=(t=e.encodedTx)?t:{inputs:[]}).inputs.map((function(e){return(0,B.getUtxoId)(n.networkId,e)}));try{yield T.default.utxoAccounts.deleteCoinControlItem(o)}catch(a){}return z(z({},e),{},{txid:i})}));return function(t){return e.apply(this,arguments)}}(),o.getTransactionStatuses=function(){var e=(0,l.default)((function*(e){return(yield this.getProvider()).getTransactionStatuses(e)}));return function(t){return e.apply(this,arguments)}}(),o.buildActionsFromBTCTransaction=function(){var e=(0,l.default)((function*(e){var t=e.transaction,n=e.address,r=e.isInscribeTransfer,i=_.IDecodedTxActionType.UNKNOWN,o=t.send,a=t.receive,u=t.event_type,s=t.asset;if(!s)return[];var c=s.content_type,d=s.content,l=s.contentUrl,f=yield(0,O.parseBRC20Content)({content:d,contentType:c,contentUrl:l}),p=f.isBRC20Content,v=f.brc20Content;if(p){var h,y=yield this.getDbAccount(),g=yield this.engine.findToken({networkId:this.networkId,tokenIdOnNetwork:`brc-20--${null!=(h=null==v?void 0:v.tick)?h:""}`});if(g)return[this.buildBRC20TokenAction({nftInfo:{asset:s,amount:"0",from:o,to:a},token:g,dbAccount:y,brc20Content:v,isInscribeTransfer:r})]}var w={send:o,receive:a,asset:s,extraInfo:null,isInscribeTransfer:r};return"Transfer"===u?i=_.IDecodedTxActionType.NFT_TRANSFER_BTC:"Mint"===u&&(i=_.IDecodedTxActionType.NFT_INSCRIPTION),[{type:i,hidden:!(o===n||a===n),direction:o===n?_.IDecodedTxDirection.OUT:_.IDecodedTxDirection.IN,extraInfo:null,inscriptionInfo:w}]}));return function(t){return e.apply(this,arguments)}}(),o.mergeNFTTransaction=function(){var e=(0,l.default)((function*(e){var t,n=this,r=e.nftTxs,i=e.nativeActions,o=e.address,a=e.isInscribeTransfer,u=(yield Promise.all(null!=(t=null==r?void 0:r.map((function(e){return n.buildActionsFromBTCTransaction({transaction:e,address:o,isInscribeTransfer:a})})))?t:"")).flat().filter(Boolean);return(0,C.checkIsUnListOrderPsbt)(u,o)?[u[0],z(z({},u[1]),{},{direction:_.IDecodedTxDirection.IN})]:(null==u?void 0:u.length)>0?u:i}));return function(t){return e.apply(this,arguments)}}(),o.fetchOnChainHistory=function(){var e=(0,l.default)((function*(e){var t=this,n=e.localHistory,r=void 0===n?[]:n,i=e.tokenIdOnNetwork,o=yield this.getProvider(),a=yield this.getDbAccount(),u=yield this.engine.getNetwork(this.networkId),s=u.decimals,c=u.symbol,d=u.impl,f=yield this.engine.getNativeTokenInfo(this.networkId);if(i&&(0,O.isBRC20Token)(i)){var p,v=yield(0,R.getBRC20TransactionHistory)({networkId:this.networkId,address:a.address,tokenAddress:i}),h=v.map((function(e){return{token_id:e.inscriptionId}}));h.length&&(p=yield(0,R.batchAsset)({chain:this.networkId,items:h}));var y=new Set,w=v.map(function(){var e=(0,l.default)((function*(e){try{var n,i=r.find((function(t){return t.decodedTx.txid===e.txId}));if(i&&i.decodedTx.isFinal)return null;if(y.has(e.txId))return null;y.add(e.txId);for(var o=v.filter((function(t){return t.txId===e.txId})),u=[],s=0,c=o.length;s<c;s+=1){var d=o[s],l=d.fromAddress,f=d.toAddress,h=d.token,w=d.actionType,m=d.amount,I=`brc-20--${h}`,T=yield t.engine.findToken({networkId:t.networkId,tokenIdOnNetwork:I}),x="inscribeTransfer"===w;if(T){var b,A={type:F.NFTAssetType.BTC,inscription_id:e.inscriptionId,inscription_number:new(g())(e.inscriptionNumber).toNumber(),tx_hash:e.txId,content:"",content_length:0,content_type:"",timestamp:e.time,output:e.index,owner:"",output_value_sat:H.INSCRIPTION_PADDING_SATS_VALUES.default,genesis_transaction_hash:"",location:e.location,contentUrl:""},k=t.buildBRC20TokenAction({nftInfo:{from:x?f:l,to:f,amount:m,asset:z(z({},A),null==(b=p)?void 0:b.find((function(t){return t.inscription_id===e.inscriptionId})))},dbAccount:a,token:T,brc20Content:{p:"brc20",op:w,tick:h,amt:m}});u.push(k)}}var E=o[0],C=E.time,P=E.state,O={txid:e.txId,owner:a.address,signer:a.address,nonce:0,actions:u,status:"fail"===P?_.IDecodedTxStatus.Failed:_.IDecodedTxStatus.Confirmed,networkId:t.networkId,accountId:t.accountId,extraInfo:null};return O.updatedAt="undefined"!==typeof C?new(g())(C).toNumber():Date.now(),O.createdAt=null!=(n=null==i?void 0:i.decodedTx.createdAt)?n:O.updatedAt,O.isFinal=O.status===_.IDecodedTxStatus.Confirmed,yield t.buildHistoryTx({decodedTx:O,historyTxToMerge:i})}catch(B){return console.error(B),Promise.resolve(null)}}));return function(t){return e.apply(this,arguments)}}());return(yield Promise.all(w)).filter(Boolean)}var m=[];try{var I;m=null!=(I=(yield o.getHistory({type:"history",xpub:this.getAccountXpub(a)},d,this.networkId,a.address,c,s)).transactions)?I:[]}catch(b){console.error(b)}var T={};try{T=yield(0,R.getNFTTransactionHistory)(a.address,this.networkId)}catch(b){console.error(b)}var x=m.map(function(){var e=(0,l.default)((function*(e){try{var n,i,o=r.find((function(t){return t.decodedTx.txid===e.txid})),u=e.direction,c=e.utxoFrom,d=e.utxoTo,l=e.from,p=e.to,v=e.amount,h=e.amountValue,y=null==d?void 0:d.filter((function(e){return!e.isMine})),w=Boolean(m.find((function(t){return t.txid!==e.txid&&t.blockTime===e.blockTime&&t.from===e.to&&t.to===e.from}))),I=y&&y.length?y.filter((function(e){return!e.isMine})).map((function(e){return{type:_.IDecodedTxActionType.NATIVE_TRANSFER,direction:u,nativeTransfer:{tokenInfo:f,utxoFrom:c,utxoTo:d,from:l,to:e.address,amount:e.balance,amountValue:e.balanceValue,extraInfo:null,isInscribeTransfer:w}}})):[{type:_.IDecodedTxActionType.NATIVE_TRANSFER,direction:u,nativeTransfer:{tokenInfo:f,utxoFrom:c,utxoTo:d,from:l,to:p,amount:v,amountValue:h,extraInfo:null,isInscribeTransfer:w}}],x=T[e.txid],A=yield t.mergeNFTTransaction({nftTxs:x,nativeActions:I,address:a.address,isInscribeTransfer:w}),k=A,E=null==o?void 0:o.decodedTx.actions;E&&E.some((function(e){return e.type!==_.IDecodedTxActionType.NATIVE_TRANSFER}))&&A.every((function(e){return e.type===_.IDecodedTxActionType.NATIVE_TRANSFER}))&&(k=E);var C={txid:e.txid,owner:a.address,signer:a.address,nonce:0,actions:k,status:(null!=(n=e.confirmations)?n:0)>0?_.IDecodedTxStatus.Confirmed:_.IDecodedTxStatus.Pending,networkId:t.networkId,accountId:t.accountId,extraInfo:null,totalFeeInNative:new(g())(e.fees).shiftedBy(-s).toFixed()};return C.updatedAt="undefined"!==typeof e.blockTime?1e3*e.blockTime:Date.now(),C.createdAt=null!=(i=null==o?void 0:o.decodedTx.createdAt)?i:C.updatedAt,C.isFinal=C.status===_.IDecodedTxStatus.Confirmed,yield t.buildHistoryTx({decodedTx:C,historyTxToMerge:o})}catch(b){return console.error(b),Promise.resolve(null)}}));return function(t){return e.apply(this,arguments)}}());return(yield Promise.all(x)).filter(Boolean)}));return function(t){return e.apply(this,arguments)}}(),o.fixActionDirection=function(){var e=(0,l.default)((function*(e){var t,n,r=e.action,i=e.accountAddress;r.type!==_.IDecodedTxActionType.NATIVE_TRANSFER||r.direction||(r.direction=yield this.buildTxActionDirection({from:(null==(t=r.nativeTransfer)?void 0:t.from)||"",to:(null==(n=r.nativeTransfer)?void 0:n.to)||"",address:i}));return r}));return function(t){return e.apply(this,arguments)}}(),o.createClientFromURL=function(e){return new L.BlockBook(e)},o.fetchTokenInfos=function(){var e=(0,l.default)((function*(e){var t=yield(0,A.fetchData)("/token/meta/batch",{networkId:this.networkId,addresses:e},{},"POST");return Object.values(t)}));return function(t){return e.apply(this,arguments)}}(),o.getPrivateKeyByCredential=function(){var e=(0,l.default)((function*(e){var t=m().decode(e);return Promise.resolve(t)}));return function(t){return e.apply(this,arguments)}}(),o.getAllUsedAddress=function(){var e=(0,l.default)((function*(){var e=yield this.getDbAccount(),t=this.getAccountXpub(e);if(!t)return[];var n=yield this.getProvider(),r=(yield n.getAccount({type:"usedAddress",xpub:t})).tokens;return(void 0===r?[]:r).filter((function(e){var t=e.path.split("/"),n=Number.isSafeInteger(+t[4])&&1===+t[4];return e.transfers>0&&!n})).map((function(e){return z(z({},e),{},{displayTotalReceived:new(g())(e.totalReceived).shiftedBy(-8).toFixed()})}))}));return function(){return e.apply(this,arguments)}}(),o.getAccountInfo=function(){var e=(0,l.default)((function*(e){var t=e.details,n=void 0===t?"txs":t,r=e.from,i=e.to,o=e.pageSize,a=yield this.getDbAccount(),u=this.getAccountXpub(a);return u?(yield this.getProvider()).getAccount({type:"accountInfo",xpub:u,details:n,from:r,to:i,pageSize:o}):[]}));return function(t){return e.apply(this,arguments)}}(),o.getFrozenUtxos=function(){var e=(0,l.default)((function*(e,t){var n,r=this,i=[];if(!(null==(n=(0,b.appSelector)((function(e){var t;return null==(t=e.settings.advancedSettings)?void 0:t.useDustUtxo})))||n)){var o,a=yield this.getNetwork(),u=new(g())((null!=(o=this.settings.dust)?o:this.settings.minTransferAmount)||0).shiftedBy(a.decimals);i=t.filter((function(e){return new(g())(e.value).isLessThanOrEqualTo(u)})).map((function(e){return z(z({},e),{},{id:(0,B.getUtxoId)(r.networkId,e),key:(0,B.getUtxoUniqueKey)(e)})}))}return(yield T.default.utxoAccounts.getCoinControlList(this.networkId,e)).filter((function(e){return e.frozen})).concat(i)}));return function(t,n){return e.apply(this,arguments)}}(),o.getRecycleInscriptionUtxos=function(){var e=(0,l.default)((function*(e){return(yield T.default.utxoAccounts.getCoinControlList(this.networkId,e)).filter((function(e){return e.recycle}))}));return function(t){return e.apply(this,arguments)}}(),o.buildTransferParamsWithCoinSelector=function(){var e=(0,l.default)((function*(e){var t=this,n=e.transferInfos,i=e.specifiedFeeRate,o=e.isInscribeTransfer;if(!n.length)throw new Error("buildTransferParamsWithCoinSelector ERROR: transferInfos is required");var a,u=n.length>1,c=Boolean(n.find((function(e){return e.isNFT||e.nftInscription}))),d=Boolean(n.find((function(e){return e.isBRC20}))),l=yield this.engine.getNetwork(this.networkId),f=yield this.getDbAccount(),p=[],v=!0;if(c){if(u&&!d)throw new Error("BTC nft transfer is not supported in batch transfer");n.forEach((function(e){var t=e.nftInscription;if(!t)throw new Error("nftInscription is required for nft transfer");var n=t.output,r=t.address,i=n.split(":"),o=(0,s.default)(i,2),a=o[0],u=o[1];if(!a||!u||!r)throw new Error("invalid nftInscription output");var c=parseInt(u,10);if(Number.isNaN(c))throw new Error("invalid nftInscription output: vout");p.push({txId:a,vout:c,address:r})}))}else if(!o){if(n[0].ignoreInscriptions)v=!1;else(yield this.getRecycleInscriptionUtxos(f.xpub)).forEach((function(e){var t=e.key.split("_"),n=(0,s.default)(t,2),r=n[0],i=n[1];p.push({txId:r,vout:parseInt(i,10),address:f.address})}))}n[0].useCustomAddressesBalance&&(a=this.getCustomAddressMap(f));var h=(yield this.collectUTXOsInfo({forceSelectUtxos:p,checkInscription:v,customAddressMap:a})).utxos,y="undefined"!==typeof i?new(g())(i).shiftedBy(l.feeDecimals).toFixed():(yield this.getFeeRate())[1],w=yield this.getFrozenUtxos(f.xpub,h),m=h.filter((function(e){return w.findIndex((function(n){return n.id===(0,B.getUtxoId)(t.networkId,e)}))<0}));h=m;var I=n.reduce((function(e,t){return Array.isArray(t.selectedUtxos)&&t.selectedUtxos.length&&e.push.apply(e,(0,r.default)(t.selectedUtxos)),e}),[]);Array.isArray(I)&&I.length&&(h=h.filter((function(e){return(null!=I?I:[]).includes((0,B.getUtxoUniqueKey)(e))})));var T=h.map((function(e){var t=e.txid,n=e.vout,r=e.value,i=e.address,o=e.path;return{txId:t,vout:n,value:parseInt(r),address:i,path:o}})),x=[];if(u){if(c&&!d)throw new Error("NFT Inscription transfer can only be single transfer");if(d){var b=this.validateInscriptionInputsForCoinSelect({inputsForCoinSelect:T,forceSelectUtxos:p}).values;x=n.map((function(e,t){return{address:e.to,value:b[t]}}))}else x=n.map((function(e){var t=e.to,n=e.amount;return{address:t,value:parseInt(new(g())(n).shiftedBy(l.decimals).toFixed())}}))}else{var A=n[0],k=A.to,E=A.amount,C=m.reduce((function(e,t){var n=t.value;return e.plus(n)}),new(g())("0")).shiftedBy(-l.decimals);if(C.lt(E))throw new D.InsufficientBalance;var P=C.lte(E),O=parseInt(new(g())(E).shiftedBy(l.decimals).toFixed());if(c){A.coinControlDisabled=!0,P=!1,O=H.INSCRIPTION_PADDING_SATS_VALUES.default;var N=this.validateInscriptionInputsForCoinSelect({inputsForCoinSelect:T,forceSelectUtxos:p}).values;O=(0,s.default)(N,1)[0]}x=[P?{address:k,isMax:!0}:{address:k,value:O}],A.opReturn&&"string"===typeof A.opReturn&&A.opReturn.length&&x.push({address:"",value:0,script:A.opReturn})}var S=u?void 0:n[0].coinSelectAlgorithm;if(!u&&x.length>2)throw new Error("single transfer should only have one output");var R=c?(0,$.coinSelectForOrdinal)({inputsForCoinSelect:T,outputsForCoinSelect:x,feeRate:y,isBRC20Transfer:d}):(0,$.coinSelect)({inputsForCoinSelect:T,outputsForCoinSelect:x,feeRate:y,algorithm:S});return{inputs:R.inputs,outputs:R.outputs,fee:R.fee,inputsForCoinSelect:T,outputsForCoinSelect:x,feeRate:y}}));return function(t){return e.apply(this,arguments)}}(),o.getCustomAddressMap=function(e){var t={};if(e.customAddresses){var n=e.path;return Object.entries(e.customAddresses).forEach((function(e){var r=(0,s.default)(e,2),i=r[0],o=r[1];t[`${n}/${i}`]=o})),t}},o.validateInscriptionInputsForCoinSelect=function(e){var t=e.inputsForCoinSelect,n=e.forceSelectUtxos,r=[],i=[],o=function(e){if(n.find((function(t){return t.address===e.address&&t.txId===e.txId&&t.vout===e.vout}))){if(e.value<0||a()(e.value))throw new Error("Sending inscription utxo value is not valid.");if(e.forceSelect=!0,i.push(e.value),r.push(e),1===n.length)return"break"}};for(var u of t){if("break"===o(u))break}if(0===r.length)throw new D.UtxoNotFoundError;return{foundedUtxos:r,values:i}},o.getFrozenBalance=function(){var e=(0,l.default)((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.useRecycleBalance,n=e.ignoreInscriptions,r=e.useCustomAddressesBalance,i=yield this.fetchBalanceDetails({useRecycleBalance:t,ignoreInscriptions:n,useCustomAddressesBalance:r});if(i&&!a()(null==i?void 0:i.unavailable))return new(g())(i.unavailable).toNumber();throw new Error("getFrozenBalance ERROR")}));return function(){return e.apply(this,arguments)}}(),o.fetchBalanceDetails=function(){var e=(0,l.default)((function*(){var e,t,n=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=r.useRecycleBalance,o=r.ignoreInscriptions,a=r.useCustomAddressesBalance,u=yield Promise.all([this.getDbAccount(),this.getNetwork()]),c=(0,s.default)(u,2),d=c[0],l=c[1];if(o)t={checkInscription:!1};else if(i){t={forceSelectUtxos:(yield this.getRecycleInscriptionUtxos(d.xpub)).map((function(e){var t=e.key.split("_"),n=(0,s.default)(t,2),r=n[0],i=n[1];return{txId:r,vout:parseInt(i,10),address:d.address}}))}}a&&(t={customAddressMap:this.getCustomAddressMap(d)});var f=yield this.collectUTXOsInfo(t),p=f.utxos,v=f.valueDetails,h=f.ordQueryStatus;"ERROR"===h&&this.collectUTXOsInfo.clear();var y=yield this.getFrozenUtxos(d.xpub,p),w=p.filter((function(e){return y.find((function(t){return t.id===(0,B.getUtxoId)(n.networkId,e)}))})).reduce((function(e,t){return e.plus(t.value)}),new(g())(0)),m=w;null!=v&&v.unavailableValue&&(m=m.plus(null==v?void 0:v.unavailableValue));var I,T,x,b=(0,j.convertFeeValueToNative)({value:w,network:l}),A=(0,j.convertFeeValueToNative)({value:m,network:l}),k=p.reduce((function(e,t){return e.plus(t.value)}),new(g())(0)),E=(0,j.convertFeeValueToNative)({value:null!=(e=null==v?void 0:v.totalValue)?e:k,network:l}),C=new(g())(E).minus(A).toFixed();if(v){var P=v.unavailableValueOfUnchecked,O=v.unavailableValueOfUnconfirmed,D=v.unavailableValueOfInscription,N=function(e){return e&&new(g())(e).gt(0)};N(P)&&(x=(0,j.convertFeeValueToNative)({value:P,network:l})),N(O)&&(I=(0,j.convertFeeValueToNative)({value:O,network:l})),N(D)&&(T=(0,j.convertFeeValueToNative)({value:D,network:l}))}var S={errorMessageKey:"ERROR"===h?"msg__the_ordinal_service_failure_refresh_and_try_again":void 0,total:E,available:C,unavailable:A,unavailableOfLocalFrozen:b,unavailableOfInscription:T,unavailableOfUnconfirmed:I,unavailableOfUnchecked:x};return Promise.resolve(S)}));return function(){return e.apply(this,arguments)}}(),o.getUserNFTAssets=function(){var e=(0,l.default)((function*(e){var t=e.serviceData;return Promise.resolve({type:F.NFTAssetType.BTC,data:t})}));return function(t){return e.apply(this,arguments)}}(),(0,f.default)(n)}(M.VaultBase)},882914:(e,t,n)=>{n.r(t),n.d(t,{BlockBook:()=>r.BlockBook,Provider:()=>i.Provider});var r=n(331489),i=n(527427)},153546:(e,t,n)=>{n.r(t),n.d(t,{convertDeviceError:()=>u});var r=n(703599),i=n(302478),o=n(292147);n(213208);function a(e,t){return"string"!==typeof t?null:e===r.HardwareErrorCode.DeviceInitializeFailed&&t.includes("ECONNABORTED")?new i.ConnectTimeoutError({message:t}):t.includes("Bridge network error")?new i.BridgeNetworkError({message:t}):null}function u(e){var t,n=e||{},u=n.code,s=n.error,c=n.message,d=null!=(t=null!=s?s:c)?t:"Unknown error";if(a(u,d))return a(u,d);switch(o.default.hardwareSDK.info("Device Utils Convert Device Error:",u,d),u){case r.HardwareErrorCode.UnknownError:return new i.UnknownHardwareError(e);case r.HardwareErrorCode.DeviceFwException:return new i.FirmwareVersionTooLow(e);case r.HardwareErrorCode.DeviceUnexpectedMode:return"string"===typeof d&&-1!==d.indexOf("ui-device_bootloader_mode")?new i.NotInBootLoaderMode(e):new i.UnknownHardwareError(e);case r.HardwareErrorCode.DeviceCheckDeviceIdError:return new i.DeviceNotSame(e);case r.HardwareErrorCode.DeviceNotFound:return new i.DeviceNotFind(e);case r.HardwareErrorCode.DeviceUnexpectedBootloaderMode:return new i.NotInBootLoaderMode(e);case r.HardwareErrorCode.DeviceInterruptedFromOutside:case r.HardwareErrorCode.DeviceInterruptedFromUser:return new i.UserCancelFromOutside(e);case r.HardwareErrorCode.DeviceNotSupportPassphrase:return new i.NotSupportPassphraseError(e);case r.HardwareErrorCode.IFrameLoadFail:return new i.InitIframeLoadFail(e);case r.HardwareErrorCode.IframeTimeout:return new i.InitIframeTimeout(e);case r.HardwareErrorCode.FirmwareUpdateDownloadFailed:return new i.FirmwareDownloadFailed(e);case r.HardwareErrorCode.FirmwareUpdateManuallyEnterBoot:return new i.FirmwareUpdateManuallyEnterBoot(e);case r.HardwareErrorCode.FirmwareUpdateAutoEnterBootFailure:return new i.FirmwareUpdateAutoEnterBootFailure(e);case r.HardwareErrorCode.FirmwareUpdateLimitOneDevice:return new i.FirmwareUpdateLimitOneDevice(e);case r.HardwareErrorCode.CallMethodNeedUpgradeFirmware:return new i.FirmwareVersionTooLow(e);case r.HardwareErrorCode.NewFirmwareUnRelease:return new i.NewFirmwareUnRelease(e);case r.HardwareErrorCode.NewFirmwareForceUpdate:return new i.NewFirmwareForceUpdate(e);case r.HardwareErrorCode.NetworkError:return new i.NetworkError(e);case r.HardwareErrorCode.BlePermissionError:return new i.NeedBluetoothTurnedOn(e);case r.HardwareErrorCode.BleLocationError:return new i.NeedBluetoothPermissions({message:d});case r.HardwareErrorCode.BleLocationServicesDisabled:return new i.BleLocationServiceError({message:d});case r.HardwareErrorCode.BleDeviceNotBonded:return new i.DeviceNotBonded(e);case r.HardwareErrorCode.BleDeviceBondError:return new i.DeviceBondError(e);case r.HardwareErrorCode.BleWriteCharacteristicError:return new i.BleWriteCharacteristicError(e);case r.HardwareErrorCode.BleScanError:return new i.BleScanError({message:d});case r.HardwareErrorCode.BleAlreadyConnected:return new i.BleAlreadyConnectedError(e);case r.HardwareErrorCode.RuntimeError:return-1!==d.indexOf("EIP712 blind sign is disabled")?new i.OpenBlindSign(e):-1!==d.indexOf("Unknown message")||-1!==d.indexOf("Failure_UnexpectedMessage")?new i.UnknownMethod(e):new i.UnknownHardwareError(e);case r.HardwareErrorCode.PinInvalid:return new i.InvalidPIN(e);case r.HardwareErrorCode.DeviceCheckPassphraseStateError:return new i.InvalidPassphrase(e);case r.HardwareErrorCode.DeviceOpenedPassphrase:return new i.DeviceOpenedPassphrase(e);case r.HardwareErrorCode.DeviceNotOpenedPassphrase:return new i.DeviceNotOpenedPassphrase(e);case r.HardwareErrorCode.PinCancelled:case r.HardwareErrorCode.ActionCancelled:return new i.UserCancel(e);case r.HardwareErrorCode.BridgeNotInstalled:case i.CustomOneKeyHardwareError.NeedOneKeyBridge:return new i.NeedOneKeyBridge(e);case r.HardwareErrorCode.BridgeNetworkError:return new i.BridgeNetworkError(e);case r.HardwareErrorCode.BridgeTimeoutError:return new i.BridgeTimeoutError(e);case r.HardwareErrorCode.PollingTimeout:return new i.ConnectTimeoutError(e);case r.HardwareErrorCode.PollingStop:return new i.ConnectPollingStopError(e);case r.HardwareErrorCode.BlindSignDisabled:return new i.OpenBlindSign(e);case r.HardwareErrorCode.FileAlreadyExists:return new i.FileAlreadyExistError(e);case r.HardwareErrorCode.CheckDownloadFileError:return new i.IncompleteFileError(e);case r.HardwareErrorCode.NotInSigningMode:return new i.NotInSigningModeError(e);case r.HardwareErrorCode.DataOverload:return new i.DeviceDataOverload(e);default:return new i.UnknownHardwareError(e)}}}}]);