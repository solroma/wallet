"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[11973],{786141:(e,t,r)=>{r.r(t),r.d(t,{VaultBase:()=>b,VaultBaseChainOnly:()=>N});var n=r(72579),o=r.n(n),i=r(256666),a=r(301842),u=r.n(a),c=r(634795),s=r(887371),d=r(545754),f=r(411987),l=r(695058),p=r(206391),h=r.n(p),y=r(636393),v=r(613549),O=r(292147),P=r(213208),g=r(992431),w=r(940915),m=r(278489),E=r(969618),T=r(398514),I=r(114540),A=r(348834).Buffer;function _(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function S(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?_(Object(r),!0).forEach((function(t){(0,i.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function x(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,l.default)(e);if(t){var o=(0,l.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,f.default)(this,r)}}if(P.default.isExtensionUi)throw new Error("engine/VaultBase is not allowed imported from ui");var N=function(e){(0,d.default)(r,e);var t=x(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.initProvider=function(){var e=(0,c.default)((function*(){var e=(yield this.getNetwork()).impl;u()(E.IMPL_MAPPINGS[e])||(this.engineProvider=yield this.engine.providerManager.getProvider(this.networkId))}));return function(){return e.apply(this,arguments)}}(),n.proxyJsonRPCCall=function(){var e=(0,c.default)((function*(e){throw new w.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.createClientFromURL=function(e){throw new w.NotImplemented},n.getEthersProvider=function(){var e=(0,c.default)((function*(){throw new w.NotImplemented}));return function(){return e.apply(this,arguments)}}(),n.getClientEndpointStatus=function(){var e=(0,c.default)((function*(e){var t=this.createClientFromURL(e),r=performance.now(),n=(yield t.getInfo()).bestBlockNumber;return{responseTime:Math.floor(performance.now()-r),latestBlock:n}}));return function(t){return e.apply(this,arguments)}}(),n.checkRpcBatchSupport=function(){var e=(0,c.default)((function*(e){throw new w.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.getDisplayAddress=function(){var e=(0,c.default)((function*(e){return Promise.resolve(e)}));return function(t){return e.apply(this,arguments)}}(),n.validateAddress=function(){var e=(0,c.default)((function*(e){var t=yield this.engineProvider.verifyAddress(e),r=t.normalizedAddress;if(!t.isValid||!r)throw new w.InvalidAddress;return Promise.resolve(r)}));return function(t){return e.apply(this,arguments)}}(),n.validateImportedCredential=function(e){return Promise.resolve(this.settings.importedAccountEnabled&&/^(0x)?[0-9a-zA-Z]{64}$/.test(e))},n.validateWatchingCredential=function(){var e=(0,c.default)((function*(e){return Promise.resolve(this.settings.watchingAccountEnabled&&(yield this.engineProvider.verifyAddress(e)).isValid)}));return function(t){return e.apply(this,arguments)}}(),n.validateTokenAddress=function(){var e=(0,c.default)((function*(e){var t=yield this.engineProvider.verifyTokenAddress(e),r=t.normalizedAddress;if(!t.isValid||"undefined"===typeof r)throw new w.InvalidTokenAddress;return Promise.resolve(r)}));return function(t){return e.apply(this,arguments)}}(),n.validateCanCreateNextAccount=function(){var e=(0,c.default)((function*(e,t){return Promise.resolve(!0)}));return function(t,r){return e.apply(this,arguments)}}(),n.checkAccountExistence=function(){var e=(0,c.default)((function*(e,t){return Promise.resolve(!0)}));return function(t,r){return e.apply(this,arguments)}}(),n.getBalances=function(){var e=(0,c.default)((function*(e,t,r){return(yield this.engine.providerManager.getClient(this.networkId)).getBalances(e.map((function(e){var t=e.address,r=e.tokenAddress;return{address:t,coin:S({},"string"===typeof r?{tokenAddress:r}:{})}})))}));return function(t,r,n){return e.apply(this,arguments)}}(),n.getFrozenBalance=function(){var e=(0,c.default)((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.password,e.useRecycleBalance,e.ignoreInscriptions,e.useCustomAddressesBalance;return 0}));return function(){return e.apply(this,arguments)}}(),n.fetchBalanceDetails=function(){var e=(0,c.default)((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.password,e.useRecycleBalance,e.ignoreInscriptions,e.useCustomAddressesBalance;return Promise.resolve(void 0)}));return function(){return e.apply(this,arguments)}}(),n.getTransactionStatuses=function(e){return this.engine.providerManager.getTransactionStatuses(this.networkId,e)},n.getTransactionFeeInNative=function(e){return Promise.resolve("")},n.isContractAddress=function(){var e=(0,c.default)((function*(e){return!1}));return function(t){return e.apply(this,arguments)}}(),n.getAccountNameInfoMap=function(){var e=(0,c.default)((function*(){var e=yield this.getNetwork();return(0,m.getAccountNameInfoByImpl)(e.impl)}));return function(){return e.apply(this,arguments)}}(),n.canAutoCreateNextAccount=function(){var e=(0,c.default)((function*(e){return Promise.resolve(!1)}));return function(t){return e.apply(this,arguments)}}(),n.filterAccounts=function(){var e=(0,c.default)((function*(e){var t=e.accounts;e.networkId;return Promise.resolve(t)}));return function(t){return e.apply(this,arguments)}}(),n.shouldChangeAccountWhenNetworkChanged=function(){var e=(0,c.default)((function*(e){e.previousNetwork,e.newNetwork,e.activeAccountId;return Promise.resolve({shouldReloadAccountList:!1,shouldChangeActiveAccount:!1})}));return function(t){return e.apply(this,arguments)}}(),n.getAccountNameInfosByImportedOrWatchingCredential=function(){var e=(0,c.default)((function*(e){return Promise.resolve([])}));return function(t){return e.apply(this,arguments)}}(),n.checkIsUnlimitedAllowance=function(){var e=(0,c.default)((function*(e){throw new w.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.checkIsApprovedForAll=function(){var e=(0,c.default)((function*(e){throw new w.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.checkIsBatchTransfer=function(){var e=(0,c.default)((function*(e){throw new w.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.getFeePricePerUnit=function(){var e=(0,c.default)((function*(){throw new w.NotImplemented}));return function(){return e.apply(this,arguments)}}(),n.fetchRpcChainId=function(){var e=(0,c.default)((function*(e){return null}));return function(t){return e.apply(this,arguments)}}(),n.getTxWaitingSeconds=function(){var e=(0,c.default)((function*(){return[]}));return function(){return e.apply(this,arguments)}}(),n.getUserNFTAssets=function(){var e=(0,c.default)((function*(e){e.serviceData;return Promise.resolve(void 0)}));return function(t){return e.apply(this,arguments)}}(),n.getTransactionDetail=function(){var e=(0,c.default)((function*(e){return Promise.resolve(void 0)}));return function(t){return e.apply(this,arguments)}}(),(0,s.default)(r)}(I.VaultContext),b=function(e){(0,d.default)(r,e);var t=x(r);function r(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))).uuid=y.default.v4().toString(),e}var n=r.prototype;return n.init=function(){var e=(0,c.default)((function*(e){yield this.initProvider(),yield this.initKeyring(e)}));return function(t){return e.apply(this,arguments)}}(),n.initKeyring=function(){var e=(0,c.default)((function*(e){this.keyring=yield e.keyringCreator(this)}));return function(t){return e.apply(this,arguments)}}(),n.signTransaction=function(){var e=(0,c.default)((function*(e,t){return this.keyring.signTransaction(e,t)}));return function(t,r){return e.apply(this,arguments)}}(),n.signAndSendTransaction=function(){var e=(0,c.default)((function*(e,t,r){var n=yield this.signTransaction(e,t);return r?S(S({},n),{},{encodedTx:e.encodedTx}):this.broadcastTransaction(S(S({},n),{},{encodedTx:e.encodedTx}))}));return function(t,r,n){return e.apply(this,arguments)}}(),n.broadcastTransaction=function(){var e=(0,c.default)((function*(e,t){O.default.engine.info("broadcastTransaction START:",{rawTx:e.rawTx});var r=yield this.engine.providerManager.broadcastTransaction(this.networkId,e.rawTx,t);return O.default.engine.info("broadcastTransaction END:",{txid:r,rawTx:e.rawTx}),S(S({},e),{},{txid:r,encodedTx:e.encodedTx})}));return function(t,r){return e.apply(this,arguments)}}(),n.buildEncodedTxFromBatchTransfer=function(){var e=(0,c.default)((function*(e){throw new w.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.buildEncodedTxsFromSetApproveForAll=function(){var e=(0,c.default)((function*(e,t){throw new w.NotImplemented}));return function(t,r){return e.apply(this,arguments)}}(),n.activateAccount=function(){var e=(0,c.default)((function*(){throw new w.NotImplemented}));return function(){return e.apply(this,arguments)}}(),n.activateToken=function(){var e=(0,c.default)((function*(e,t){throw new w.NotImplemented}));return function(t,r){return e.apply(this,arguments)}}(),n.getTokenAllowance=function(){var e=(0,c.default)((function*(e,t){throw new w.NotImplemented}));return function(t,r){return e.apply(this,arguments)}}(),n.batchTokensAllowance=function(){var e=(0,c.default)((function*(e,t){throw new w.NotImplemented}));return function(t,r){return e.apply(this,arguments)}}(),n.getOutputAccount=function(){var e=(0,c.default)((function*(){var e=yield this.getDbAccount({noCache:!0});return{id:e.id,name:e.name,type:e.type,path:e.path,coinType:e.coinType,tokens:[],address:e.address,template:e.template,pubKey:o()(e,"pub","")}}));return function(){return e.apply(this,arguments)}}(),n.getAccountBalance=function(){var e=(0,c.default)((function*(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,o=(yield this.getDbAccount()).address;return this.getBalances((t?[{address:o}]:[]).concat(e.map((function(e){return{address:o,tokenAddress:e}}))),r,n)}));return function(t){return e.apply(this,arguments)}}(),n.updatePendingTxs=function(){var e=(0,c.default)((function*(e){throw new w.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.getAccountNonce=function(){var e=(0,c.default)((function*(){return Promise.resolve(null)}));return function(){return e.apply(this,arguments)}}(),n.fixActionDirection=function(){var e=(0,c.default)((function*(e){var t,r,n,o,i=e.action,a=e.accountAddress;(i.direction=T.IDecodedTxDirection.OTHER,i.type===T.IDecodedTxActionType.NATIVE_TRANSFER)&&(i.direction=yield this.buildTxActionDirection({from:(null==(t=i.nativeTransfer)?void 0:t.from)||"",to:(null==(r=i.nativeTransfer)?void 0:r.to)||"",address:a}));i.type===T.IDecodedTxActionType.TOKEN_TRANSFER&&(i.direction=yield this.buildTxActionDirection({from:(null==(n=i.tokenTransfer)?void 0:n.from)||"",to:(null==(o=i.tokenTransfer)?void 0:o.to)||"",address:a}));return i}));return function(t){return e.apply(this,arguments)}}(),n.fixDecodedTx=function(){var e=(0,c.default)((function*(e){var t,r;e.createdAt=null!=(t=e.createdAt)?t:Date.now();var n=null==(r=e.encodedTx)?void 0:r.nonce;e.nonce=u()(n)?e.nonce:new(h())(n).toNumber();for(var o=e.owner,i=0;i<e.actions.length;i+=1){var a=e.actions[i];yield this.fixActionDirection({action:a,accountAddress:o})}if(e.outputActions)for(var c=0;c<e.outputActions.length;c+=1){var s=e.outputActions[c];yield this.fixActionDirection({action:s,accountAddress:o})}return Promise.resolve(e)}));return function(t){return e.apply(this,arguments)}}(),n.fixHistoryTx=function(){var e=(0,c.default)((function*(e){return e.decodedTx=yield this.fixDecodedTx(e.decodedTx),Promise.resolve(e)}));return function(t){return e.apply(this,arguments)}}(),n.buildHistoryTx=function(){var e=(0,c.default)((function*(e){var t=e.historyTxToMerge,r=(e.encodedTx,e.decodedTx),n=e.signedTx,o=e.isSigner,i=e.isLocalCreated,a=(null==n?void 0:n.txid)||(null==r?void 0:r.txid)||"";if(!a)throw new Error("buildHistoryTx txid not found");var u=yield this.getAccountAddress();r.txid=a||r.txid,r.owner=u,o&&(r.signer=u),null!=n&&n.txKey&&(r.extraInfo?r.extraInfo.txKey=n.txKey:r.extraInfo={txKey:n.txKey});var c=S(S({id:`${this.networkId}_${a}_${this.accountId}`,isLocalCreated:Boolean(i)},t),{},{decodedTx:r});return c=yield this.fixHistoryTx(c),Promise.resolve(c)}));return function(t){return e.apply(this,arguments)}}(),n.checkIsScamHistoryTx=function(){var e=(0,c.default)((function*(e){return!1}));return function(t){return e.apply(this,arguments)}}(),n.fetchOnChainHistory=function(){var e=(0,c.default)((function*(e){throw new w.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.fixAddressCase=function(e){return Promise.resolve(e)},n.buildTxActionDirection=function(){var e=(0,c.default)((function*(e){var t=e.from,r=e.to,n=e.address;return t=yield this.fixAddressCase(t||""),r=yield this.fixAddressCase(r),n=yield this.fixAddressCase(n),t===r&&t===n?T.IDecodedTxDirection.SELF:t&&t===n?T.IDecodedTxDirection.OUT:r&&r===n?T.IDecodedTxDirection.IN:T.IDecodedTxDirection.OTHER}));return function(t){return e.apply(this,arguments)}}(),n.getNextNonce=function(){var e=(0,c.default)((function*(e,t){var r,n=null==(r=(yield this.engine.providerManager.getAddresses(e,[t.address]))[0])?void 0:r.nonce;if(u()(n))throw new w.OneKeyError("Get on-chain nonce failed.");yield this.engine.getHistory(e,t.id,void 0,!1);var o=yield g.default.history.getMaxPendingNonce({accountId:this.accountId,networkId:e}),i=yield g.default.history.getPendingNonceList({accountId:this.accountId,networkId:e}),a=Math.max(u()(o)?0:o+1,n);if(Number.isNaN(a)&&(a=n),a>n)for(var c=n;c<a;c+=1)if(!i.includes(c)){a=c;break}if(a<n&&(a=n),a-n>=v.HISTORY_CONSTS.PENDING_QUEUE_MAX_LENGTH)throw new w.PendingQueueTooLong(v.HISTORY_CONSTS.PENDING_QUEUE_MAX_LENGTH);return a}));return function(t,r){return e.apply(this,arguments)}}(),n.validateSendAmount=function(e,t,r){return Promise.resolve(!0)},n.notifyChainChanged=function(e,t){},n.getFetchBalanceAddress=function(e){return Promise.resolve(e.address)},n.getPrivateKeyByCredential=function(e){return Promise.resolve(A.from(e.startsWith("0x")?e.slice(2):e,"hex"))},n.getMinDepositAmount=function(){var e=(0,c.default)((function*(){return"0"}));return function(){return e.apply(this,arguments)}}(),n.specialCheckEncodedTx=function(){var e=(0,c.default)((function*(e){return{success:!0}}));return function(t){return e.apply(this,arguments)}}(),n.getAllUsedAddress=function(){var e=(0,c.default)((function*(){return Promise.resolve([])}));return function(){return e.apply(this,arguments)}}(),(0,s.default)(r)}(N)},511973:(e,t,r)=>{r.r(t),r.d(t,{default:()=>ht});var n=r(196234),o=r(256666),i=r(634795),a=r(887371),u=r(545754),c=r(411987),s=r(695058),d=r(206391),f=r.n(d),l=r(223556),p=r.n(l),h=r(901187),y=r(776553),v=r(292147),O=r(940915),P=r(398145),g=r(398514),w=r(786141),m=r(997293),E=r(278489),T=r(82406),I=r(153546),A=r(613549),_=r(162197),S=r.n(_),x=r(836009),N=r(942349);r(213208);var b=new Map,D=new Map,C=function(){function e(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2e4,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:6e4;this.url=e,this.timeout=t,this.expiredTimeout=r,this.establishConnection()}var t=e.prototype;return t.waitForSocketConnection=function(e,t,r){var n=this,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;o>300?r():setTimeout((function(){1===e.readyState?t():e.readyState>1?r():n.waitForSocketConnection(e,t,r,o+1)}),10)},t.readySocketConnection=function(e){var t=this;return new Promise((function(r,n){t.waitForSocketConnection(e,(function(){r(e)}),(function(){n(new Error("WebSocket connection timeout."))}))}))},t.establishConnection=function(){var e=this,t=b.get(this.url);if(t&&t.readyState<2)return 1===t.readyState?Promise.resolve(t):this.readySocketConnection(t);var r=this.url,o=new WebSocket(r);return b.set(this.url,o),new Promise((function(t,r){o.onopen=function(){e.waitForSocketConnection(o,(function(){t(o)}),(function(){r(new Error("WebSocket connection timeout."))}))},o.onmessage=function(){var t=(0,i.default)((function*(t){yield e.refreshConnectionStatus();var r=e.parseRPCResponse(t.data),o=r.id,i=r.result,a=r.error,u=D.get(o);if(u){var c=(0,n.default)(u,3),s=c[0],d=c[1],f=c[2];if(clearTimeout(f),a){var l=`Error JSON PRC response ${a.code}: ${a.message}`;v.default.websocket.error(l),d(new N.JsonPRCResponseError(l))}else s(i)}D.delete(o)}));return function(e){return t.apply(this,arguments)}}(),o.onerror=function(e){r(e),console.error(e)}}))},t.closeConnection=function(){var e=b.get(this.url);e&&(e.close(),b.delete(this.url))},t.parseRPCResponse=function(e){var t;try{t=JSON.parse(e)}catch(r){throw new N.ResponseError(`Invalid JSON RPC response, result not found: ${e}`)}return t},t.refreshConnectionStatus=function(){var e=(0,i.default)((function*(){var e=this,t=yield this.establishConnection();return clearTimeout(this.expiredTimerId),this.expiredTimerId=setTimeout((function(){e.closeConnection()}),this.expiredTimeout),t}));return function(){return e.apply(this,arguments)}}(),t.call=function(){var e=(0,i.default)((function*(e,t,r){var n=this,o=yield this.refreshConnectionStatus();return new Promise((function(i,a){var u=(0,y.generateUUID)(),c=setTimeout((function(){D.delete(u),a(new Error("Timeout Error"))}),r||n.timeout);D.set(u,[i,a,c]);var s=function(e,t,r){return{jsonrpc:"2.0",id:r,method:e,params:t}}(e,t,u);o&&o.send(`${JSON.stringify(s)}\n`)}))}));return function(t,r,n){return e.apply(this,arguments)}}(),(0,a.default)(e)}(),R=r(764550),U=r(740727);function B(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,s.default)(e);if(t){var o=(0,s.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,c.default)(this,r)}}var F,H=function(e){(0,u.default)(r,e);var t=B(r);function r(e){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"optimistic";return(r=t.call(this)).defaultFinality=n,r.rpc=new C(e),r}var n=r.prototype;return n.getAddress=function(){throw new Error("Method not implemented.")},n.getInfo=function(){var e=(0,i.default)((function*(){return{bestBlockNumber:(yield this.rpc.call("blockchain.headers.tip")).height,isReady:!0}}));return function(){return e.apply(this,arguments)}}(),n.getFeePricePerUnit=function(){throw new Error("Method not implemented.")},n.broadcastTransaction=function(){var e=(0,i.default)((function*(e){return this.rpc.call("blockchain.transaction.broadcast",[e])}));return function(t){return e.apply(this,arguments)}}(),n.getBalance=function(){var e=(0,i.default)((function*(e){var t=yield this.rpc.call("blockchain.address.get_balance",[e]);return new(f())(t.confirmed)}));return function(t){return e.apply(this,arguments)}}(),n.getTransaction=function(){var e=(0,i.default)((function*(e){return this.rpc.call("blockchain.transaction.get",[e,!0])}));return function(t){return e.apply(this,arguments)}}(),n.estimateFee=function(){var e=(0,i.default)((function*(e){var t=yield this.rpc.call("blockchain.estimatefee",[e]);return Number(t)||0}));return function(t){return e.apply(this,arguments)}}(),n.getNexaUTXOs=function(){var e=(0,i.default)((function*(e){return this.rpc.call("blockchain.address.listunspent",[e])}));return function(t){return e.apply(this,arguments)}}(),n.getHistoryByAddress=function(){var e=(0,i.default)((function*(e){return this.rpc.call("blockchain.address.get_history",[e])}));return function(t){return e.apply(this,arguments)}}(),n.getTransactionStatus=function(){var e=(0,i.default)((function*(e){return(yield this.getTransaction(e)).confirmations>0?U.TransactionStatus.CONFIRM_AND_SUCCESS:U.TransactionStatus.PENDING}));return function(t){return e.apply(this,arguments)}}(),n.getTransactionStatuses=function(e){var t=this;return Promise.all(e.map((function(e){return t.getTransactionStatus(e)})))},(0,a.default)(r)}(R.SimpleClient),k=r(348834),K=r(548166),L=r.n(K),M=r(348834).Buffer;function V(e,t){var r=new Uint8Array(e.length+t.length);return r.set(e),r.set(t,e.length),r}function j(e,t,r,n){for(var o=n?Math.floor(e.length*t/r):Math.ceil(e.length*t/r),i=(1<<r)-1,a=new Uint8Array(o),u=0,c=0,s=0,d=0;d<e.length;d+=1){for(c=c<<t|e[d],s+=t;s>=r;)s-=r,a[u]=c>>s&i,u+=1}return n||s>0&&(a[u]=c<<r-s&i,u+=1),a}!function(e){e.PayToPublicKeyHash="P2PKH",e.PayToScriptHash="SCRIPT",e.PayToScriptTemplate="TEMPLATE",e.GroupedPayToPublicKeyTemplate="GROUP"}(F||(F={}));var G="qpzry9x8gf2tvdw0s3jn54khce6mua7l";function X(e,t,r){var n=V(function(e){for(var t=new Uint8Array(e.length),r=0;r<e.length;r+=1)t[r]=31&e[r].charCodeAt(0);return t}(e),new Uint8Array(1)),o=function(e){switch(e){case"P2PKH":return 0;case"SCRIPT":return 8;case"TEMPLATE":return 152;case"GROUP":return 88;default:throw new Error(`Invalid type: ${e}.`)}}(t),i=j(M.from(V(M.from(new Uint8Array([o])),r)),8,5),a=V(V(n,i),new Uint8Array(8)),u=V(i,function(e){for(var t=new Uint8Array(8),r=0;r<8;r+=1)t[7-r]=e.and(31).toJSNumber(),e=e.shiftRight(5);return t}(function(e){for(var t=[656907472481,522768456162,0xf33e5fb3c4,748107326120,130178868336],r=L()(1),n=0;n<e.length;n+=1){var o=e[n],i=r.shiftRight(35);r=r.and(34359738367).shiftLeft(5).xor(o);for(var a=0;a<t.length;a+=1)i.shiftRight(a).and(1).equals(1)&&(r=r.xor(t[a]))}return r.xor(1)}(a)));return`${e}:${function(e){for(var t="",r=0;r<e.length;r+=1){var n=e[r];t+=G[n]}return t}(u)}`}function Y(e){var t=e.toLowerCase().split(":"),r=t[0],n=function(e){for(var t=new Uint8Array(e.length),r=0;r<e.length;r+=1){var n=e[r];t[r]=String(G).indexOf(n)}return t}(t[1]),o=j(M.from(n.subarray(0,-8)),5,8,!0),i=o[0],a=o.subarray(1),u=function(e){switch(248&e){case 0:return"P2PKH";case 8:return"SCRIPT";case 152:return"TEMPLATE";case 88:return"GROUP";default:throw new Error(`Invalid address type in version byte: ${e}.`)}}(i);return{prefix:r,type:u,hash:a}}var W,$=r(348834).Buffer;function Q(e,t,r){try{return e.toBuffer(t,r)}catch(n){return e.toArrayLike($,t,r)}}function q(e){var t,r=e.length;if(r>=0&&r<W.OP_PUSHDATA1)t=r;else if(r<256)t=W.OP_PUSHDATA1;else if(r<65536)t=W.OP_PUSHDATA2;else{if(!(r<2**32))throw new Error("You can't push that much data");t=W.OP_PUSHDATA4}return{buf:e,len:r,opcodenum:t}}function z(e){var t=k.Buffer.alloc(1);return t.writeUInt8(e,0),t}function J(e){var t=k.Buffer.alloc(2);return t.writeUInt16LE(e,0),t}function Z(e){var t=k.Buffer.alloc(4);return t.writeUInt32LE(e,0),t}function ee(e){var t=k.Buffer.alloc(4);return t.writeInt32LE(e,0),t}function te(e){return Q(e,"le",8)}function re(e){var t;return e<253?(t=k.Buffer.alloc(1)).writeUInt8(e,0):e<65536?((t=k.Buffer.alloc(3)).writeUInt8(253,0),t.writeUInt16LE(e,1)):e<4294967296?((t=k.Buffer.alloc(5)).writeUInt8(254,0),t.writeUInt32LE(e,1)):((t=k.Buffer.alloc(9)).writeUInt8(255,0),t.writeInt32LE(-1&e,1),t.writeUInt32LE(Math.floor(e/4294967296),5)),t}function ne(e){for(var t=[],r=0,n=0;n<e.length;n+=1){var o=e[n],i=o.opcodenum,a=o.buf,u=z(i);if(t.push(u),r+=u.length,a){var c=void 0;i===W.OP_PUSHDATA1?c=z(i):i===W.OP_PUSHDATA2?c=J(o.len||0):i===W.OP_PUSHDATA4&&(c=Z(o.len||0)),c&&(t.push(c),r+=c.length),t.push(a),r+=a.length}}return k.Buffer.concat(t,r)}function oe(e){var t=0,r=e.readUInt8(0);switch(t+=1,r){case 253:r=e.readUInt16LE(0),t+=2;break;case 254:r=e.readUInt32LE(0),t+=4;break;case 255:var n=function(e,t){var r,n=e.readUInt32LE(t),o=4294967296*e.readUInt32LE(t+4)+n;if(o<=9007199254740991)r=new(S())(o);else{var i=Array.prototype.slice.call(e,t,t+8);r=new(S())(i,10,"le")}return{bn:r,position:t+8}}(e,t),o=n.bn,i=n.position,a=o.toNumber();if(t=i,!(a<=2**53))throw new Error("number too large to retain precision - use readVarintBN");r=a}return{position:t,length:r}}function ie(e){var t=Y(e).hash;return function(e){var t=oe(e),r=t.position,n=t.length;return e.slice(r,n+r)}(k.Buffer.from(t))}function ae(e){for(var t=0,r=[],n=k.Buffer.prototype.readUInt8.bind(e);t<e.length;){var o=n(t);t+=1;var i=0;o>0&&o<W.OP_PUSHDATA1?(i=o,r.push({buf:e.slice(t,t+i),len:i,opcodenum:o})):o===W.OP_PUSHDATA1?(i=e.readUint8(t),t+=1,r.push({buf:e.slice(t,t+i),len:i,opcodenum:o})):o===W.OP_PUSHDATA2?(i=e.readUInt16LE(t),t+=2,r.push({buf:e.slice(t,t+i),len:i,opcodenum:o})):o===W.OP_PUSHDATA4?(i=e.readUInt32LE(t),t+=4,r.push({buf:e.slice(t,t+i),len:i,opcodenum:o})):r.push({opcodenum:o}),t+=i}return r}!function(e){e[e.OP_FALSE=0]="OP_FALSE",e[e.OP_0=0]="OP_0",e[e.OP_PUSHDATA1=76]="OP_PUSHDATA1",e[e.OP_PUSHDATA2=77]="OP_PUSHDATA2",e[e.OP_PUSHDATA4=78]="OP_PUSHDATA4",e[e.OP_1NEGATE=79]="OP_1NEGATE",e[e.OP_RESERVED=80]="OP_RESERVED",e[e.OP_TRUE=81]="OP_TRUE",e[e.OP_1=81]="OP_1",e[e.OP_2=82]="OP_2",e[e.OP_3=83]="OP_3",e[e.OP_4=84]="OP_4",e[e.OP_5=85]="OP_5",e[e.OP_6=86]="OP_6",e[e.OP_7=87]="OP_7",e[e.OP_8=88]="OP_8",e[e.OP_9=89]="OP_9",e[e.OP_10=90]="OP_10",e[e.OP_11=91]="OP_11",e[e.OP_12=92]="OP_12",e[e.OP_13=93]="OP_13",e[e.OP_14=94]="OP_14",e[e.OP_15=95]="OP_15",e[e.OP_16=96]="OP_16",e[e.OP_NOP=97]="OP_NOP",e[e.OP_VER=98]="OP_VER",e[e.OP_IF=99]="OP_IF",e[e.OP_NOTIF=100]="OP_NOTIF",e[e.OP_VERIF=101]="OP_VERIF",e[e.OP_VERNOTIF=102]="OP_VERNOTIF",e[e.OP_ELSE=103]="OP_ELSE",e[e.OP_ENDIF=104]="OP_ENDIF",e[e.OP_VERIFY=105]="OP_VERIFY",e[e.OP_RETURN=106]="OP_RETURN",e[e.OP_TOALTSTACK=107]="OP_TOALTSTACK",e[e.OP_FROMALTSTACK=108]="OP_FROMALTSTACK",e[e.OP_2DROP=109]="OP_2DROP",e[e.OP_2DUP=110]="OP_2DUP",e[e.OP_3DUP=111]="OP_3DUP",e[e.OP_2OVER=112]="OP_2OVER",e[e.OP_2ROT=113]="OP_2ROT",e[e.OP_2SWAP=114]="OP_2SWAP",e[e.OP_IFDUP=115]="OP_IFDUP",e[e.OP_DEPTH=116]="OP_DEPTH",e[e.OP_DROP=117]="OP_DROP",e[e.OP_DUP=118]="OP_DUP",e[e.OP_NIP=119]="OP_NIP",e[e.OP_OVER=120]="OP_OVER",e[e.OP_PICK=121]="OP_PICK",e[e.OP_ROLL=122]="OP_ROLL",e[e.OP_ROT=123]="OP_ROT",e[e.OP_SWAP=124]="OP_SWAP",e[e.OP_TUCK=125]="OP_TUCK",e[e.OP_CAT=126]="OP_CAT",e[e.OP_SPLIT=127]="OP_SPLIT",e[e.OP_NUM2BIN=128]="OP_NUM2BIN",e[e.OP_BIN2NUM=129]="OP_BIN2NUM",e[e.OP_SIZE=130]="OP_SIZE",e[e.OP_INVERT=131]="OP_INVERT",e[e.OP_AND=132]="OP_AND",e[e.OP_OR=133]="OP_OR",e[e.OP_XOR=134]="OP_XOR",e[e.OP_EQUAL=135]="OP_EQUAL",e[e.OP_EQUALVERIFY=136]="OP_EQUALVERIFY",e[e.OP_RESERVED1=137]="OP_RESERVED1",e[e.OP_RESERVED2=138]="OP_RESERVED2",e[e.OP_1ADD=139]="OP_1ADD",e[e.OP_1SUB=140]="OP_1SUB",e[e.OP_2MUL=141]="OP_2MUL",e[e.OP_2DIV=142]="OP_2DIV",e[e.OP_NEGATE=143]="OP_NEGATE",e[e.OP_ABS=144]="OP_ABS",e[e.OP_NOT=145]="OP_NOT",e[e.OP_0NOTEQUAL=146]="OP_0NOTEQUAL",e[e.OP_ADD=147]="OP_ADD",e[e.OP_SUB=148]="OP_SUB",e[e.OP_MUL=149]="OP_MUL",e[e.OP_DIV=150]="OP_DIV",e[e.OP_MOD=151]="OP_MOD",e[e.OP_LSHIFT=152]="OP_LSHIFT",e[e.OP_RSHIFT=153]="OP_RSHIFT",e[e.OP_BOOLAND=154]="OP_BOOLAND",e[e.OP_BOOLOR=155]="OP_BOOLOR",e[e.OP_NUMEQUAL=156]="OP_NUMEQUAL",e[e.OP_NUMEQUALVERIFY=157]="OP_NUMEQUALVERIFY",e[e.OP_NUMNOTEQUAL=158]="OP_NUMNOTEQUAL",e[e.OP_LESSTHAN=159]="OP_LESSTHAN",e[e.OP_GREATERTHAN=160]="OP_GREATERTHAN",e[e.OP_LESSTHANOREQUAL=161]="OP_LESSTHANOREQUAL",e[e.OP_GREATERTHANOREQUAL=162]="OP_GREATERTHANOREQUAL",e[e.OP_MIN=163]="OP_MIN",e[e.OP_MAX=164]="OP_MAX",e[e.OP_WITHIN=165]="OP_WITHIN",e[e.OP_RIPEMD160=166]="OP_RIPEMD160",e[e.OP_SHA1=167]="OP_SHA1",e[e.OP_SHA256=168]="OP_SHA256",e[e.OP_HASH160=169]="OP_HASH160",e[e.OP_HASH256=170]="OP_HASH256",e[e.OP_CODESEPARATOR=171]="OP_CODESEPARATOR",e[e.OP_CHECKSIG=172]="OP_CHECKSIG",e[e.OP_CHECKSIGVERIFY=173]="OP_CHECKSIGVERIFY",e[e.OP_CHECKMULTISIG=174]="OP_CHECKMULTISIG",e[e.OP_CHECKMULTISIGVERIFY=175]="OP_CHECKMULTISIGVERIFY",e[e.OP_NOP2=177]="OP_NOP2",e[e.OP_CHECKLOCKTIMEVERIFY=177]="OP_CHECKLOCKTIMEVERIFY",e[e.OP_NOP3=178]="OP_NOP3",e[e.OP_CHECKSEQUENCEVERIFY=178]="OP_CHECKSEQUENCEVERIFY",e[e.OP_NOP1=176]="OP_NOP1",e[e.OP_NOP4=179]="OP_NOP4",e[e.OP_NOP5=180]="OP_NOP5",e[e.OP_NOP6=181]="OP_NOP6",e[e.OP_NOP7=182]="OP_NOP7",e[e.OP_NOP8=183]="OP_NOP8",e[e.OP_NOP9=184]="OP_NOP9",e[e.OP_NOP10=185]="OP_NOP10",e[e.OP_CHECKDATASIG=186]="OP_CHECKDATASIG",e[e.OP_CHECKDATASIGVERIFY=187]="OP_CHECKDATASIGVERIFY",e[e.OP_REVERSEBYTES=188]="OP_REVERSEBYTES",e[e.OP_PREFIX_BEGIN=240]="OP_PREFIX_BEGIN",e[e.OP_PREFIX_END=241]="OP_PREFIX_END",e[e.OP_SMALLINTEGER=250]="OP_SMALLINTEGER",e[e.OP_PUBKEYS=251]="OP_PUBKEYS",e[e.OP_PUBKEYHASH=253]="OP_PUBKEYHASH",e[e.OP_PUBKEY=254]="OP_PUBKEY",e[e.OP_INVALIDOPCODE=255]="OP_INVALIDOPCODE",e[e.OP_INPUTINDEX=192]="OP_INPUTINDEX",e[e.OP_ACTIVEBYTECODE=193]="OP_ACTIVEBYTECODE",e[e.OP_TXVERSION=194]="OP_TXVERSION",e[e.OP_TXINPUTCOUNT=195]="OP_TXINPUTCOUNT",e[e.OP_TXOUTPUTCOUNT=196]="OP_TXOUTPUTCOUNT",e[e.OP_TXLOCKTIME=197]="OP_TXLOCKTIME",e[e.OP_UTXOVALUE=198]="OP_UTXOVALUE",e[e.OP_UTXOBYTECODE=199]="OP_UTXOBYTECODE",e[e.OP_OUTPOINTTXHASH=200]="OP_OUTPOINTTXHASH",e[e.OP_OUTPOINTINDEX=201]="OP_OUTPOINTINDEX",e[e.OP_INPUTBYTECODE=202]="OP_INPUTBYTECODE",e[e.OP_INPUTSEQUENCENUMBER=203]="OP_INPUTSEQUENCENUMBER",e[e.OP_OUTPUTVALUE=204]="OP_OUTPUTVALUE",e[e.OP_OUTPUTBYTECODE=205]="OP_OUTPUTBYTECODE",e[e.OP_RESERVED3=206]="OP_RESERVED3",e[e.OP_RESERVED4=207]="OP_RESERVED4"}(W||(W={}));var ue,ce=r(887554),se=r.n(ce),de=r(348834).Buffer,fe=new(0,se().ec)("secp256k1");function le(e){for(var t="string"===typeof e?de.from(e,"hex"):e,r=t.length,n=de.alloc(r),o=0;o<r;o+=1)n[o]=t[r-o-1];return n}function pe(e){var t=(arguments.length>1&&void 0!==arguments[1]&&arguments[1]?le(e):e).toString("hex");return new(S())(t,16)}function he(e){return!e.isInfinity()&&function(e){var t=new(S())("FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFC2F","hex");return new(S())(e).toRed(S().red(t)).redPow(t.sub(new(S())(1)).div(new(S())(2))).fromRed().eq(new(S())(1))}(new(S())(e.getY().toArray()))}function ye(e){return Q(e).length<32?Q(e,"be",32):Q(e)}function ve(e){var t,r=Q(e.getX(),"be",32),n=Q(e.getY(),"be",32);return t=n[n.length-1]%2?de.from([3]):de.from([2]),de.concat([t,r])}function Oe(e,t){var r=fe.curve.g,n=new(S())(fe.curve.n.toArray()),o=function(e,t){var r=de.from("0101010101010101010101010101010101010101010101010101010101010101","hex"),n=de.from("0000000000000000000000000000000000000000000000000000000000000000","hex"),o=de.concat([e,t,de.from("","ascii"),de.from("Schnorr+SHA256  ","ascii")]);n=(0,x.hmacSHA256)(n,de.concat([r,de.from("00","hex"),o])),r=(0,x.hmacSHA256)(n,r),n=(0,x.hmacSHA256)(n,de.concat([r,de.from("01","hex"),o])),r=(0,x.hmacSHA256)(n,r);for(var i=new(S())(0),a=new(S())(fe.curve.n.toArray());!(i=pe(r=(0,x.hmacSHA256)(n,r))).gt(new(S())(0))||!i.lt(a);)n=(0,x.hmacSHA256)(n,de.concat([r,de.from("00","hex")])),r=(0,x.hmacSHA256)(n,r);return i}(Q(e,"be",32),Q(t,"be",32)),i=r.mul(e),a=r.mul(o);he(a)||(o=n.sub(o));var u=a.getX();return{r:u,s:pe((0,x.sha256)(de.concat([ye(u),ve(i),Q(t,"be",32)]))).mul(e).add(o).mod(n)}}!function(e){e[e.SIGHASH_NEXA_ALL=0]="SIGHASH_NEXA_ALL",e[e.SIGHASH_ALL=1]="SIGHASH_ALL",e[e.SIGHASH_NONE=2]="SIGHASH_NONE",e[e.SIGHASH_SINGLE=3]="SIGHASH_SINGLE",e[e.SIGHASH_FORKID=64]="SIGHASH_FORKID",e[e.SIGHASH_ANYONECANPAY=128]="SIGHASH_ANYONECANPAY"}(ue||(ue={}));var Pe=r(348834).Buffer;function ge(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function we(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ge(Object(r),!0).forEach((function(t){(0,o.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ge(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function me(e){try{return Y(e),{isValid:!0,normalizedAddress:e}}catch(t){return{isValid:!1}}}var Ee={mainnet:{name:"livenet",alias:"mainnet",prefix:"nexa",pubkeyhash:25,privatekey:35,scripthash:68,xpubkey:1114203936,xprivkey:1114401651,networkMagic:1915163169},testnet:{name:"nexatest",prefix:"nexatest",pubkeyhash:111,privatekey:239,scripthash:196,xpubkey:70617039,xprivkey:70615956,networkMagic:4108710900}};function Te(e){return"testnet"===e?Ee.testnet:Ee.mainnet}function Ie(e){return Te(e).prefix}function Ae(e){return ne([q(e)])}function _e(e){return e.startsWith("nexa:")||e.startsWith("nexatest:")}function Se(e,t){var r,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:F.PayToScriptTemplate,o=Te(t);if(n===F.PayToPublicKeyHash)r=(0,x.hash160)(e);else{if(n!==F.PayToScriptTemplate)throw new O.InvalidAddress;var i=ne([q(e)]),a=(0,x.hash160)(i),u=[{opcodenum:W.OP_FALSE},{opcodenum:W.OP_1},q(a)];r=ne([q(ne(u))])}return X(o.prefix,n,r)}function xe(e){return(0,x.sha256)((0,x.sha256)(e))}var Ne=4294967295,be=3e3,De=33;function Ce(e){var t=5;return t+=e.inputs.length<253?1:3,e.inputs.forEach((function(){t+=146})),e.outputs.forEach((function(e){var r=ie(e.address);t+=Ae(r).length+1+8+1})),t}function Re(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:be/1e3,r=Ce(e);return Math.ceil(r*t+De*t)}function Ue(e,t){return ne([q(ne([q(e)])),q(t)])}function Be(e){var t=e.sigtype,r=e.prevTxId,n=e.scriptBuffer,o=e.sequenceNumber,i=e.amount;return Pe.concat([z(t),le(r),re(n.length),n,Z(o),te(i)])}function Fe(e){var t=e.sigtype,r=e.prevTxId,n=e.sequenceNumber,o=e.amount;return Pe.concat([z(t),le(r),Z(n),te(o)])}function He(e){var t=e.outType,r=e.satoshi,n=e.scriptBuffer;return Pe.concat([z(t),te(r),re(n.length),n])}function ke(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=Pe.concat(e.map(n?Be:Fe)),i=Pe.concat(t.map(He));return Pe.concat([z(0),re(e.length),o,re(t.length),i,Z(r)])}function Ke(e,t){var r=xe(ke(e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0)),n=xe(Pe.concat([ee(e.length),Pe.concat(e.map((function(e){var t=e.scriptBuffer;return Pe.concat([t,z(W.OP_INVALIDOPCODE)])})))]));return le(xe(Pe.concat([r,n]))).toString("hex")}function Le(e,t){var r=e.inputs,n=xe(Pe.concat(r.map((function(e){return Pe.concat([z(0),le(Pe.from(e.txId,"hex"))])})))),o=xe(Pe.concat(r.map((function(e){return Z(e.sequenceNumber||Ne)})))),i=xe(Pe.concat(r.map((function(e){return te(new(S())(e.satoshis))})))),a=function(e,t){var r=e.inputs,n=e.outputs,o=e.gas,i=n.slice(),a=r.reduce((function(e,t){return e.add(new(S())(t.satoshis))}),new(S())(0)),u=i.reduce((function(e,t){return e.add(new(S())(t.satoshis))}),new(S())(0)),c=new(S())(o||Re(e)),s=a.sub(c);if(s.lt(new(S())(0)))throw console.error(a.toString(),c.toString()),new Error(`Available balance cannot be less than 0, inputAmount: ${a.toString()}, dust: ${c.toString()}`);return s.gt(u)?i.push({address:t,satoshis:s.sub(u).toString(),outType:1}):i[0].satoshis=s.gt(u)?i[0].satoshis:s.toString(),{outputSignatures:i.map((function(e){return{address:e.address,satoshi:new(S())(e.satoshis),outType:1,scriptBuffer:ie(e.address)}})),inputSignatures:r.map((function(e,t){return{prevTxId:e.txId,outputIndex:e.outputIndex,inputIndex:t,sequenceNumber:e.sequenceNumber||Ne,amount:new(S())(e.satoshis),sigtype:ue.SIGHASH_NEXA_ALL}}))}}(e,t),u=a.outputSignatures,c=a.inputSignatures,s=xe(Pe.concat(u.map((function(e){return Pe.concat([z(e.outType),te(new(S())(e.satoshi)),re(e.scriptBuffer.length),e.scriptBuffer])})))),d=ne([{opcodenum:W.OP_FROMALTSTACK},{opcodenum:W.OP_CHECKSIGVERIFY}]);return{signatureBuffer:Pe.concat([z(0),n,i,o,re(d.length),d,s,Z(0),z(0)]),inputSignatures:c,outputSignatures:u}}function Me(e,t,r){return Ve.apply(this,arguments)}function Ve(){return(Ve=(0,i.default)((function*(e,t,r){var n=e.encodedTx,o=yield t.getPrvkey(),i=yield t.getPubkey(!0),a=Le(n,r),u=a.outputSignatures,c=a.inputSignatures,s=xe(a.signatureBuffer),d=function(e,t){var r=Oe(pe(e),pe(t)),n=r.r,o=r.s;return de.concat([Q(n,"be",32),Q(o,"be",32)])}(o,s),f=c.map((function(e){return we(we({},e),{},{publicKey:i,signature:d,scriptBuffer:Ue(i,d)})}));return{txid:Ke(f,u),rawTx:ke(f,u,0,!0).toString("hex"),signature:d.toString("hex"),digest:s.toString("hex"),encodedTx:n}}))).apply(this,arguments)}function je(e,t){var r=ae(e);if(function(e){if(2===e.length){var t=e[0].buf,r=e[1].buf;if(r&&64===r.length&&t&&34===t.length){var n=ae(t)[0].buf;if(n&&33===n.length&&(3===n[0]||2===n[0]))return!0}}return!1}(r)&&r[0].buf){var n=(0,x.hash160)(r[0].buf),o=Ae(ne([{opcodenum:W.OP_FALSE},{opcodenum:W.OP_1},q(n)]));return X(t,F.PayToScriptTemplate,o)}if(function(e){return!(3!==e.length||e[0].opcodenum!==W.OP_FALSE||e[1].opcodenum!==W.OP_1||!e[2].buf||20!==e[2].buf.length)}(r)&&r[2].buf){var i=Ae(ne([{opcodenum:W.OP_FALSE},{opcodenum:W.OP_1},q(r[2].buf)]));return X(t,F.PayToScriptTemplate,i)}return""}var Ge=function(e,t,r){return t&&r?g.IDecodedTxDirection.SELF:t?g.IDecodedTxDirection.OUT:r?g.IDecodedTxDirection.IN:g.IDecodedTxDirection.OTHER};var Xe=r(348834).Buffer;function Ye(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function We(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ye(Object(r),!0).forEach((function(t){(0,o.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ye(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function $e(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,s.default)(e);if(t){var o=(0,s.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,c.default)(this,r)}}var Qe="Schnorr",qe=function(e){(0,u.default)(r,e);var t=$e(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.prepareAccounts=function(){var e=(0,i.default)((function*(e){var t,r=this,n=e.indexes,o=e.names,i=e.template,a=(0,m.slicePathTemplate)(i),u=a.pathPrefix,c=a.pathSuffix,s=n.map((function(e){return`${u}/${c.replace("{index}",e.toString())}`})),d=n.map((function(e){return`${u}/${e}'`})),f=yield this.getHardwareSDKInstance(),l=yield this.getHardwareInfo(),p=l.connectId,h=l.deviceId,y=yield this.getWalletPassphraseState(),g=(0,E.getAccountNameInfoByImpl)(A.IMPL_NEXA).default.prefix,w=yield this.getNetworkChainId();try{t=yield f.nexaGetAddress(p,h,We({bundle:s.map((function(e){return{path:e,showOnOneKey:false,prefix:Ie(w)}}))},y))}catch(_){throw v.default.common.error(_),new O.OneKeyHardwareError(_)}if(!t.success)throw v.default.common.error(t.payload),(0,I.convertDeviceError)(t.payload);var T=[];return t.payload.map((function(e,t){var a,u=e.path,c=e.pub,s=(o||[])[t]||`${g} #${n[t]+1}`;return T.push(),{id:`${r.walletId}--${d[t]}`,name:s,type:P.AccountType.UTXO,path:u,coinType:A.COINTYPE_NEXA,xpub:"",address:c,addresses:(a={},a[r.networkId]=c,a),template:i}}))}));return function(t){return e.apply(this,arguments)}}(),n.getAddress=function(){var e=(0,i.default)((function*(e){var t,r,n=yield this.getHardwareSDKInstance(),o=yield this.getHardwareInfo(),i=o.connectId,a=o.deviceId,u=yield this.getWalletPassphraseState(),c=yield this.getNetworkChainId(),s=yield n.nexaGetAddress(i,a,We({path:e.path,showOnOneKey:e.showOnOneKey,prefix:Ie(c),scheme:Qe},u));if(s.success&&null!=(t=s.payload)&&t.address)return null==(r=s.payload)?void 0:r.address;throw(0,I.convertDeviceError)(s.payload)}));return function(t){return e.apply(this,arguments)}}(),n.batchGetAddress=function(){var e=(0,i.default)((function*(e){var t=yield this.getHardwareSDKInstance(),r=yield this.getHardwareInfo(),n=r.connectId,o=r.deviceId,i=yield this.getWalletPassphraseState(),a=yield this.getNetworkChainId(),u=yield t.nexaGetAddress(n,o,We(We({},i),{},{bundle:e.map((function(e){return{path:e.path,showOnOneKey:!!e.showOnOneKey,prefix:Ie(a),scheme:Qe}}))}));if(!u.success)throw(0,I.convertDeviceError)(u.payload);return u.payload.map((function(e){var t,r;return{path:null!=(t=e.path)?t:"",address:null!=(r=e.address)?r:""}}))}));return function(t){return e.apply(this,arguments)}}(),n.signTransaction=function(){var e=(0,i.default)((function*(e){v.default.common.info("signTransaction",e);var t=yield this.getDbAccount(),r=yield this.getNetworkChainId(),n=e.payload.encodedTx,o=Le(n,yield this.vault.getDisplayAddress(t.address)),i=o.inputSignatures,a=o.outputSignatures,u=o.signatureBuffer,c=yield this.getHardwareInfo(),s=c.connectId,d=c.deviceId,f=yield this.getWalletPassphraseState(),l=yield this.getHardwareSDKInstance(),p=yield l.nexaSignTransaction(s,d,We(We({},f),{},{inputs:[{path:t.path,prefix:Ie(r),message:u.toString("hex")}]}));if(p.success){var h=p.payload,y=Xe.from(t.address,"hex"),O=Xe.from(h[0].signature,"hex"),P=i.map((function(e){return We(We({},e),{},{publicKey:y,signature:O,scriptBuffer:Ue(y,O)})}));return{txid:Ke(P,a),rawTx:ke(P,a,0,!0).toString("hex"),encodedTx:n}}throw(0,I.convertDeviceError)(p.payload)}));return function(t){return e.apply(this,arguments)}}(),(0,a.default)(r)}(T.KeyringHardwareBase),ze=r(794292),Je=r(605851),Ze=r(810887);function et(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,s.default)(e);if(t){var o=(0,s.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,c.default)(this,r)}}var tt="secp256k1",rt=function(e){(0,u.default)(r,e);var t=et(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.getSigners=function(){var e=(0,i.default)((function*(e,t){var r,n=yield this.getDbAccount();if(1!==t.length)throw new O.OneKeyInternalError("NEXA signers number should be 1.");if(t[0]!==n.address)throw new O.OneKeyInternalError("Wrong address required for signing.");var o=(yield this.getPrivateKeys(e))[n.path];if("undefined"===typeof o)throw new O.OneKeyInternalError("Unable to get signer.");return(r={})[n.address]=new ze.Signer(o,e,tt),r}));return function(t,r){return e.apply(this,arguments)}}(),n.getSigner=function(){var e=(0,i.default)((function*(e,t){var r=t.address;return(yield this.getSigners((null==e?void 0:e.password)||"",[r]))[r]}));return function(t,r){return e.apply(this,arguments)}}(),n.signTransaction=function(){var e=(0,i.default)((function*(e,t){var r=yield this.getDbAccount(),n=yield this.getSigner(t,{address:r.address});return yield Me(e,n,yield this.vault.getDisplayAddress(r.address))}));return function(t,r){return e.apply(this,arguments)}}(),n.prepareAccounts=function(){var e=(0,i.default)((function*(e){var t=this,r=e.password,n=e.indexes,o=e.names,i=e.template,a=(yield this.engine.dbApi.getCredential(this.walletId,r)).seed,u=(0,m.slicePathTemplate)(i),c=u.pathPrefix,s=u.pathSuffix,d=(0,Je.batchGetPublicKeys)(tt,a,r,c,n.map((function(e){return s.replace("{index}",e.toString())}))),f=n.map((function(e){return`${c}/${e}'`}));if(d.length!==n.length)throw new O.OneKeyInternalError("Unable to get publick key.");return d.map((function(e,r){var a,u=e.path,c=e.extendedKey.key,s=(o||[])[r]||`NEXA #${n[r]+1}`,d=c.toString("hex");return{id:`${t.walletId}--${f[r]}`,name:s,type:P.AccountType.UTXO,path:u,coinType:A.COINTYPE_NEXA,xpub:"",address:d,addresses:(a={},a[t.networkId]=d,a),template:i}}))}));return function(t){return e.apply(this,arguments)}}(),(0,a.default)(r)}(Ze.KeyringHdBase),nt=r(478557),ot=r(255942);function it(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,s.default)(e);if(t){var o=(0,s.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,c.default)(this,r)}}var at=function(e){(0,u.default)(r,e);var t=it(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.prepareAccounts=function(){var e=(0,i.default)((function*(e){var t,r=e.name,n=e.privateKey;if(32!==n.length)throw new O.OneKeyInternalError("Invalid private key.");var o=nt.secp256k1.publicFromPrivate(n).toString("hex");return Promise.resolve([{id:`imported--${A.COINTYPE_NEXA}--${o}`,name:r||"",type:P.AccountType.UTXO,path:"",coinType:A.COINTYPE_NEXA,xpub:"",address:o,addresses:(t={},t[this.networkId]=o,t)}])}));return function(t){return e.apply(this,arguments)}}(),n.getSigners=function(){var e=(0,i.default)((function*(e,t){var r,n=yield this.getDbAccount();if(1!==t.length)throw new O.OneKeyInternalError("NEXA signers number should be 1.");if(t[0]!==n.address)throw new O.OneKeyInternalError("Wrong address required for signing.");var o=(yield this.getPrivateKeys(e))[n.path];if("undefined"===typeof o)throw new O.OneKeyInternalError("Unable to get signer.");return(r={})[n.address]=new ze.Signer(o,e,"secp256k1"),r}));return function(t,r){return e.apply(this,arguments)}}(),n.getSigner=function(){var e=(0,i.default)((function*(e,t){var r=t.address;return(yield this.getSigners(e.password||"",[r]))[r]}));return function(t,r){return e.apply(this,arguments)}}(),n.signTransaction=function(){var e=(0,i.default)((function*(e,t){var r=yield this.getDbAccount(),n=yield this.getSigner(t,r);return yield Me(e,n,yield this.vault.getDisplayAddress(r.address))}));return function(t,r){return e.apply(this,arguments)}}(),n.signMessage=function(e,t){console.log(e,t)},(0,a.default)(r)}(ot.KeyringImportedBase);function ut(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,s.default)(e);if(t){var o=(0,s.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,c.default)(this,r)}}var ct=function(e){(0,u.default)(r,e);var t=ut(r);function r(){return t.apply(this,arguments)}return r.prototype.prepareAccounts=function(){var e=(0,i.default)((function*(e){var t=e.name,r=e.target,n=e.accountIdPrefix,o="",i=P.AccountType.SIMPLE;if(_e(r)){var a=r.split(":")[0];if(Te(yield this.vault.getNetworkChainId()).prefix!==a)throw new O.InvalidAddress;var u=me(r);if(o=u.normalizedAddress||"",!u.isValid||"undefined"===typeof o)throw new O.InvalidAddress}else try{me(yield this.vault.getDisplayAddress(r)),o=r,i=P.AccountType.UTXO}catch(c){throw new O.InvalidAddress}return Promise.resolve([{id:`${n}--${A.COINTYPE_NEXA}--${r}`,name:t||"",type:i,path:"",coinType:A.COINTYPE_NEXA,pub:"",address:o}])}));return function(t){return e.apply(this,arguments)}}(),(0,a.default)(r)}(r(701625).KeyringWatchingBase),st=r(844215),dt=r(348834).Buffer;function ft(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function lt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ft(Object(r),!0).forEach((function(t){(0,o.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ft(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function pt(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,s.default)(e);if(t){var o=(0,s.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,c.default)(this,r)}}var ht=function(e){(0,u.default)(r,e);var t=pt(r);function r(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))).keyringMap={hd:rt,hw:qe,imported:at,watching:ct,external:ct},e.settings=st.default,e.createSDKClient=p()(function(){var t=(0,i.default)((function*(t,r){var n=e.createClientFromURL(t),o=yield e.engine.providerManager.getChainInfoByNetworkId(r);return n.setChainInfo(o),n}));return function(e,r){return t.apply(this,arguments)}}(),{promise:!0,primitive:!0,normalizer:function(e){return`${e[0]}:${e[1]}`},max:1,maxAge:(0,y.getTimeDurationMs)({seconds:15})}),e}var o=r.prototype;return o.createClientFromURL=function(e){return new H(e)},o.getFetchBalanceAddress=function(e){return this.getDisplayAddress(e.address)},o.getOutputAccount=function(){var e=(0,i.default)((function*(){var e=yield this.getDbAccount({noCache:!0}),t=e.type===P.AccountType.SIMPLE?e.address:yield this.getDisplayAddress(e.address);return{id:e.id,name:e.name,type:e.type,path:e.path,coinType:e.coinType,tokens:[],address:t,displayAddress:t,template:e.template,pubKey:e.address}}));return function(){return e.apply(this,arguments)}}(),o.getAccountAddress=function(){var e=(0,i.default)((function*(){return(yield this.getOutputAccount()).address}));return function(){return e.apply(this,arguments)}}(),o.getDisplayAddress=function(){var e=(0,i.default)((function*(e){if(_e(e))return e;var t=yield this.getNetworkChainId();return Se(dt.from(e,"hex"),t)}));return function(t){return e.apply(this,arguments)}}(),o.addressFromBase=function(){var e=(0,i.default)((function*(e){var t=yield this.getNetworkChainId();return Se(dt.from(e.address,"hex"),t)}));return function(t){return e.apply(this,arguments)}}(),o.getSDKClient=function(){var e=(0,i.default)((function*(){var e=(yield this.getNetwork()).rpcURL;return this.createSDKClient(e,this.networkId)}));return function(){return e.apply(this,arguments)}}(),o.getClientEndpointStatus=function(){var e=(0,i.default)((function*(){var e=yield this.getSDKClient(),t=performance.now(),r=(yield e.getInfo()).bestBlockNumber;return{responseTime:Math.floor(performance.now()-t),latestBlock:r}}));return function(){return e.apply(this,arguments)}}(),o.validateWatchingCredential=function(){var e=(0,i.default)((function*(e){return this.settings.watchingAccountEnabled?e.startsWith("nexa")?Promise.resolve(me(e).isValid):me(yield this.getDisplayAddress(e)).isValid:Promise.resolve(!1)}));return function(t){return e.apply(this,arguments)}}(),o.validateAddress=function(){var e=(0,i.default)((function*(e){var t=me(e),r=t.isValid,n=t.normalizedAddress;return r?Promise.resolve(n||e):Promise.reject(new O.InvalidAddress)}));return function(t){return e.apply(this,arguments)}}(),o.getBalances=function(){var e=(0,i.default)((function*(e){var t=this,r=yield this.getSDKClient(),n=yield Promise.all(e.map((function(e){var r=e.address;return t.getDisplayAddress(r)})));return r.getBalances(e.map((function(e,t){var r=e.tokenAddress;return{address:n[t],coin:lt({},"string"===typeof r?{tokenAddress:r}:{})}})))}));return function(t){return e.apply(this,arguments)}}(),o.attachFeeInfoToEncodedTx=function(){var e=(0,i.default)((function*(e){var t=e.feeInfoValue.btcFee;return t&&(e.encodedTx.gas=t.toString()),Promise.resolve(e.encodedTx)}));return function(t){return e.apply(this,arguments)}}(),o.decodeTx=function(){var e=(0,i.default)((function*(e,t){var r=yield this.getAccountAddress(),n=e.outputs.reduce((function(e,t){return e.plus(new(f())(t.satoshis))}),new(f())(0)),o=yield this.engine.getNativeTokenInfo(this.networkId),i={type:g.IDecodedTxActionType.TOKEN_TRANSFER,direction:g.IDecodedTxDirection.OUT,tokenTransfer:{tokenInfo:o,from:r,to:e.outputs[0].address,amount:n.shiftedBy(-o.decimals).toFixed(),amountValue:n.toString(),extraInfo:null}};return{txid:"",owner:r,signer:r,networkId:this.networkId,accountId:this.accountId,encodedTx:e,payload:t,extraInfo:null,nonce:0,actions:[i],status:g.IDecodedTxStatus.Pending}}));return function(t,r){return e.apply(this,arguments)}}(),o.getNextNonce=function(){return Promise.resolve(0)},o.decodedTxToLegacy=function(){return Promise.resolve({})},o.buildEncodedTxFromTransfer=function(){var e=(0,i.default)((function*(e){var t=yield this.getSDKClient(),r=e.from,n=(yield t.getNexaUTXOs(r)).filter((function(e){return!e.has_token})),o=yield this.getNetwork();return{inputs:n.map((function(e){return{txId:e.outpoint_hash,outputIndex:e.tx_pos,satoshis:new(f())(e.value).toFixed(),address:r}})),outputs:[{address:e.to,satoshis:new(f())(e.amount).shiftedBy(o.decimals).toFixed(),outType:1}],transferInfo:{from:r,to:e.to,amount:e.amount}}}));return function(t){return e.apply(this,arguments)}}(),o.buildEncodedTxFromApprove=function(){throw new Error("Method not implemented.")},o.updateEncodedTxTokenApprove=function(){throw new Error("Method not implemented.")},o.updateEncodedTx=function(e){return Promise.resolve(e)},o.buildUnsignedTxFromEncodedTx=function(e){return Promise.resolve({inputs:[],outputs:[],payload:{encodedTx:e},encodedTx:e})},o.getTransactionStatuses=function(){var e=(0,i.default)((function*(e){return(yield this.getSDKClient()).getTransactionStatuses(e)}));return function(t){return e.apply(this,arguments)}}(),o.fetchFeeInfo=function(){var e=(0,i.default)((function*(e,t,r){var n=yield this.getNetwork(),o=yield this.getSDKClient(),i=Ce(e),a=yield o.estimateFee(i),u=Re(e),c=r?Re(e,Number(r)):Math.max(a,u);return{nativeSymbol:n.symbol,nativeDecimals:n.decimals,feeSymbol:n.feeSymbol,feeDecimals:n.feeDecimals,prices:[new(f())(1).shiftedBy(-n.decimals).toFixed()],feeList:[c],defaultPresetIndex:"1",isBtcForkChain:!0,tx:null}}));return function(t,r,n){return e.apply(this,arguments)}}(),o.getExportedCredential=function(){var e=(0,i.default)((function*(e){var t=yield this.getDbAccount();if(t.id.startsWith("hd-")||t.id.startsWith("imported")){var r=this.keyring,o=Object.values(yield r.getPrivateKeys(e)),i=(0,n.default)(o,1)[0];return(0,h.decrypt)(e,i).toString("hex")}throw new O.OneKeyInternalError("Only credential of HD or imported accounts can be exported")}));return function(t){return e.apply(this,arguments)}}(),o.fetchTokenInfos=function(){throw new Error("Method not implemented.")},o.broadcastTransaction=function(){var e=(0,i.default)((function*(e){var t=yield this.getSDKClient();return yield t.broadcastTransaction(e.rawTx),e}));return function(t){return e.apply(this,arguments)}}(),o.buildDecodeTx=function(){var e=(0,i.default)((function*(e){var t,r=yield this.getSDKClient();try{t=yield r.getTransaction(e)}catch(c){return v.default.common.error("Failed to fetch Nexa transaction. ",e),!1}var n=yield this.getDbAccount(),o=yield this.getDisplayAddress(n.address),i=(yield this.engine.getNetwork(this.networkId)).decimals,a=Te(yield this.getNetworkChainId()),u=yield this.engine.getNativeTokenInfo(this.networkId);return function(e){var t=e.tx,r=e.dbAccountAddress,n=e.addressPrefix,o=e.decimals,i=e.token,a=e.networkId,u=e.accountId,c=t.vin.map((function(e){return je(Pe.from(e.scriptSig.hex,"hex"),n)})),s=t.vout.map((function(e){return je(Pe.from(e.scriptPubKey.hex,"hex"),n)})),d=c.includes(r)?r:c[0],l=c.includes(r)?s[0]:r,p={txid:t.txid,owner:r,signer:d,nonce:0,actions:t.vin.map((function(e,t){var n=new(f())(e.value_satoshi).shiftedBy(-i.decimals),o=c[t];return{type:g.IDecodedTxActionType.TOKEN_TRANSFER,direction:Ge(0,o===r,l===r),tokenTransfer:{tokenInfo:i,from:o,to:l,amount:n.toFixed(),amountValue:n.toFixed(),extraInfo:null}}})),outputActions:t.vout.map((function(e,t){var n=new(f())(e.value_satoshi).shiftedBy(-i.decimals),o=s[t];return(d===r||o===r)&&{type:g.IDecodedTxActionType.TOKEN_TRANSFER,direction:Ge(0,d===r,o===r),tokenTransfer:{tokenInfo:i,from:d,to:o,amount:n.toFixed(),amountValue:n.toFixed(),extraInfo:null}}})).filter(Boolean),status:t.confirmations?g.IDecodedTxStatus.Confirmed:g.IDecodedTxStatus.Pending,networkId:a,accountId:u,extraInfo:null,totalFeeInNative:new(f())(t.fee_satoshi).shiftedBy(-o).toFixed()};return p.updatedAt=t.time?1e3*t.time:Date.now(),p.createdAt=p.updatedAt,p.isFinal=p.status===g.IDecodedTxStatus.Confirmed,p}({tx:t,dbAccountAddress:o,decimals:i,addressPrefix:a.prefix,token:u,networkId:this.networkId,accountId:this.accountId})}));return function(t){return e.apply(this,arguments)}}(),o.fetchOnChainHistory=function(){var e=(0,i.default)((function*(e){var t=this,r=e.tokenIdOnNetwork,n=e.localHistory,o=void 0===n?[]:n;if(r)return Promise.resolve([]);var a=yield this.getDbAccount(),u=yield this.getSDKClient(),c=yield this.getDisplayAddress(a.address),s=yield u.getHistoryByAddress(c);return(yield Promise.all(s.map(function(){var e=(0,i.default)((function*(e){var r=o.find((function(t){return t.decodedTx.txid===e.tx_hash}));if(r){if(!r.decodedTx.isFinal){var n,i=yield t.buildDecodeTx(e.tx_hash);if(i)return i.createdAt=null!=(n=null==r?void 0:r.decodedTx.createdAt)?n:i.createdAt,t.buildHistoryTx({decodedTx:i,historyTxToMerge:r})}return r}var a=yield t.buildDecodeTx(e.tx_hash);return!!a&&t.buildHistoryTx({decodedTx:a})}));return function(t){return e.apply(this,arguments)}}()))).filter(Boolean)}));return function(t){return e.apply(this,arguments)}}(),(0,a.default)(r)}(w.VaultBase)},565147:(e,t,r)=>{r.r(t),r.d(t,{KeyringBase:()=>s,KeyringBaseMock:()=>d});var n=r(634795),o=r(887371),i=r(545754),a=r(411987),u=r(695058);function c(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,u.default)(e);if(t){var o=(0,u.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,a.default)(this,r)}}var s=function(e){(0,i.default)(r,e);var t=c(r);function r(e){var r;return(r=t.call(this,e.options)).vault=e,r}return r.prototype.addressFromBase=function(){var e=(0,n.default)((function*(e){return this.vault.addressFromBase(e)}));return function(t){return e.apply(this,arguments)}}(),(0,o.default)(r)}(r(114540).VaultContext),d=function(e){(0,i.default)(r,e);var t=c(r);function r(){return t.apply(this,arguments)}return(0,o.default)(r)}(s)},82406:(e,t,r)=>{r.r(t),r.d(t,{KeyringHardwareBase:()=>f});var n=r(634795),o=r(887371),i=r(545754),a=r(411987),u=r(695058),c=r(799075),s=r(814817);function d(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,u.default)(e);if(t){var o=(0,u.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,a.default)(this,r)}}var f=function(e){(0,i.default)(a,e);var t=d(a);function a(){return t.apply(this,arguments)}var u=a.prototype;return u.getHardwareInfo=function(){var e=(0,n.default)((function*(){var e,t,r,n=yield this.engine.getHWDeviceByWalletId(this.vault.walletId);return{connectId:null!=(e=null==n?void 0:n.mac)?e:"",deviceId:null!=(t=null==n?void 0:n.deviceId)?t:"",deviceType:null!=(r=null==n?void 0:n.deviceType)?r:""}}));return function(){return e.apply(this,arguments)}}(),u.getWalletPassphraseState=function(){var e=(0,n.default)((function*(){var e=yield this.engine.getWallet(this.vault.walletId);return{passphraseState:null==e?void 0:e.passphraseState,useEmptyPassphrase:!(0,s.isPassphraseWallet)(e)}}));return function(){return e.apply(this,arguments)}}(),u.getHardwareSDKInstance=function(){var e=(0,n.default)((function*(){var e,t,n,o,i;return null!=(i=yield null==(e=r.g)||null==(t=e.$backgroundApiProxy)||null==(n=t.backgroundApi)||null==(o=n.serviceHardware)||null==o.getSDKInstance?void 0:o.getSDKInstance())?i:c.HardwareSDK}));return function(){return e.apply(this,arguments)}}(),u.prepareAccountByAddressIndex=function(e){throw new Error("Method not implemented.")},(0,o.default)(a)}(r(565147).KeyringBase)},810887:(e,t,r)=>{r.r(t),r.d(t,{KeyringHdBase:()=>h});var n=r(256666),o=r(634795),i=r(887371),a=r(545754),u=r(411987),c=r(695058),s=r(605851),d=r(940915);function f(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?f(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):f(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function p(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,c.default)(e);if(t){var o=(0,c.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,u.default)(this,r)}}var h=function(e){(0,a.default)(r,e);var t=p(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.getPrivateKeys=function(){var e=(0,o.default)((function*(e,t){var r=(yield this.getDbAccount()).path.split("/"),n=t||[r.pop()],o=r.join("/"),i=(yield this.engine.dbApi.getCredential(this.walletId,e)).seed;if("undefined"===typeof i)throw new d.OneKeyInternalError("Unable to get credential.");var a=(yield this.engine.providerManager.getChainInfoByNetworkId(this.networkId)).curve;return(0,s.batchGetPrivateKeys)(a,i,e,o,n).reduce((function(e,t){var r;return l(l({},e),{},((r={})[t.path]=t.extendedKey.key,r))}),{})}));return function(t,r){return e.apply(this,arguments)}}(),n.getAddress=function(){throw new Error("Method not implemented.")},n.batchGetAddress=function(){throw new Error("Method not implemented.")},n.prepareAccountByAddressIndex=function(e){throw new Error("Method not implemented.")},(0,i.default)(r)}(r(280306).KeyringSoftwareBase)},255942:(e,t,r)=>{r.r(t),r.d(t,{KeyringImportedBase:()=>d});var n=r(634795),o=r(887371),i=r(545754),a=r(411987),u=r(695058),c=r(940915);function s(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,u.default)(e);if(t){var o=(0,u.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,a.default)(this,r)}}var d=function(e){(0,i.default)(r,e);var t=s(r);function r(){return t.apply(this,arguments)}var a=r.prototype;return a.getPrivateKeys=function(){var e=(0,n.default)((function*(e,t){if("undefined"!==typeof t)throw new c.NotImplemented("Getting private keys from extended private key");var r=(yield this.engine.dbApi.getCredential(this.accountId,e)).privateKey;if("undefined"===typeof r)throw new c.OneKeyInternalError("Unable to get credential.");return{"":r}}));return function(t,r){return e.apply(this,arguments)}}(),a.getAddress=function(){throw new Error("Method not implemented.")},a.batchGetAddress=function(){throw new Error("Method not implemented.")},a.prepareAccountByAddressIndex=function(){throw new Error("Method not implemented.")},(0,o.default)(r)}(r(280306).KeyringSoftwareBase)},280306:(e,t,r)=>{r.r(t),r.d(t,{KeyringSoftwareBase:()=>y});var n=r(196234),o=r(256666),i=r(634795),a=r(887371),u=r(545754),c=r(411987),s=r(695058),d=r(292147),f=r(940915);function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){(0,o.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function h(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,s.default)(e);if(t){var o=(0,s.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,c.default)(this,r)}}var y=function(e){(0,u.default)(r,e);var t=h(r);function r(){return t.apply(this,arguments)}var o=r.prototype;return o.signTransaction=function(){var e=(0,i.default)((function*(e,t){var r=t.password;if("undefined"===typeof r)throw new f.OneKeyInternalError("Software signing requires a password.");var n=yield this.getSigners(r,e.inputs.map((function(e){return e.address})));return d.default.engine.info("signTransaction",this.networkId,e),p(p({},yield this.engine.providerManager.signTransaction(this.networkId,e,n)),{},{encodedTx:e.encodedTx})}));return function(t,r){return e.apply(this,arguments)}}(),o.signMessage=function(){var e=(0,i.default)((function*(e,t){var r=this,o=t.password;if("undefined"===typeof o)throw new f.OneKeyInternalError("Software signing requires a password.");var i=yield this.getDbAccount(),a=Object.values(yield this.getSigners(o,[i.address])),u=(0,n.default)(a,1)[0];return d.default.engine.info("signMessage",this.networkId,e),Promise.all(e.map((function(e){return r.engine.providerManager.signMessage(r.networkId,e,u)})))}));return function(t,r){return e.apply(this,arguments)}}(),o.getAddress=function(){throw new Error("Method not implemented.")},o.batchGetAddress=function(){throw new Error("Method not implemented.")},o.prepareAccountByAddressIndex=function(e){throw new Error("Method not implemented.")},(0,a.default)(r)}(r(565147).KeyringBase)},701625:(e,t,r)=>{r.r(t),r.d(t,{KeyringWatchingBase:()=>d});var n=r(634795),o=r(887371),i=r(545754),a=r(411987),u=r(695058),c=r(940915);function s(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,u.default)(e);if(t){var o=(0,u.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,a.default)(this,r)}}var d=function(e){(0,i.default)(r,e);var t=s(r);function r(){return t.apply(this,arguments)}var a=r.prototype;return a.signTransaction=function(){var e=(0,n.default)((function*(e,t){throw new c.OneKeyInternalError("signTransaction is not supported for watching accounts")}));return function(t,r){return e.apply(this,arguments)}}(),a.signMessage=function(){var e=(0,n.default)((function*(e,t){throw new c.OneKeyInternalError("signMessage is not supported for watching accounts")}));return function(t,r){return e.apply(this,arguments)}}(),a.getAddress=function(){throw new Error("Method not implemented.")},a.batchGetAddress=function(){throw new Error("Method not implemented.")},a.prepareAccountByAddressIndex=function(){throw new Error("Method not implemented.")},(0,o.default)(r)}(r(565147).KeyringBase)},153546:(e,t,r)=>{r.r(t),r.d(t,{convertDeviceError:()=>u});var n=r(703599),o=r(302478),i=r(292147);r(213208);function a(e,t){return"string"!==typeof t?null:e===n.HardwareErrorCode.DeviceInitializeFailed&&t.includes("ECONNABORTED")?new o.ConnectTimeoutError({message:t}):t.includes("Bridge network error")?new o.BridgeNetworkError({message:t}):null}function u(e){var t,r=e||{},u=r.code,c=r.error,s=r.message,d=null!=(t=null!=c?c:s)?t:"Unknown error";if(a(u,d))return a(u,d);switch(i.default.hardwareSDK.info("Device Utils Convert Device Error:",u,d),u){case n.HardwareErrorCode.UnknownError:return new o.UnknownHardwareError(e);case n.HardwareErrorCode.DeviceFwException:return new o.FirmwareVersionTooLow(e);case n.HardwareErrorCode.DeviceUnexpectedMode:return"string"===typeof d&&-1!==d.indexOf("ui-device_bootloader_mode")?new o.NotInBootLoaderMode(e):new o.UnknownHardwareError(e);case n.HardwareErrorCode.DeviceCheckDeviceIdError:return new o.DeviceNotSame(e);case n.HardwareErrorCode.DeviceNotFound:return new o.DeviceNotFind(e);case n.HardwareErrorCode.DeviceUnexpectedBootloaderMode:return new o.NotInBootLoaderMode(e);case n.HardwareErrorCode.DeviceInterruptedFromOutside:case n.HardwareErrorCode.DeviceInterruptedFromUser:return new o.UserCancelFromOutside(e);case n.HardwareErrorCode.DeviceNotSupportPassphrase:return new o.NotSupportPassphraseError(e);case n.HardwareErrorCode.IFrameLoadFail:return new o.InitIframeLoadFail(e);case n.HardwareErrorCode.IframeTimeout:return new o.InitIframeTimeout(e);case n.HardwareErrorCode.FirmwareUpdateDownloadFailed:return new o.FirmwareDownloadFailed(e);case n.HardwareErrorCode.FirmwareUpdateManuallyEnterBoot:return new o.FirmwareUpdateManuallyEnterBoot(e);case n.HardwareErrorCode.FirmwareUpdateAutoEnterBootFailure:return new o.FirmwareUpdateAutoEnterBootFailure(e);case n.HardwareErrorCode.FirmwareUpdateLimitOneDevice:return new o.FirmwareUpdateLimitOneDevice(e);case n.HardwareErrorCode.CallMethodNeedUpgradeFirmware:return new o.FirmwareVersionTooLow(e);case n.HardwareErrorCode.NewFirmwareUnRelease:return new o.NewFirmwareUnRelease(e);case n.HardwareErrorCode.NewFirmwareForceUpdate:return new o.NewFirmwareForceUpdate(e);case n.HardwareErrorCode.NetworkError:return new o.NetworkError(e);case n.HardwareErrorCode.BlePermissionError:return new o.NeedBluetoothTurnedOn(e);case n.HardwareErrorCode.BleLocationError:return new o.NeedBluetoothPermissions({message:d});case n.HardwareErrorCode.BleLocationServicesDisabled:return new o.BleLocationServiceError({message:d});case n.HardwareErrorCode.BleDeviceNotBonded:return new o.DeviceNotBonded(e);case n.HardwareErrorCode.BleDeviceBondError:return new o.DeviceBondError(e);case n.HardwareErrorCode.BleWriteCharacteristicError:return new o.BleWriteCharacteristicError(e);case n.HardwareErrorCode.BleScanError:return new o.BleScanError({message:d});case n.HardwareErrorCode.BleAlreadyConnected:return new o.BleAlreadyConnectedError(e);case n.HardwareErrorCode.RuntimeError:return-1!==d.indexOf("EIP712 blind sign is disabled")?new o.OpenBlindSign(e):-1!==d.indexOf("Unknown message")||-1!==d.indexOf("Failure_UnexpectedMessage")?new o.UnknownMethod(e):new o.UnknownHardwareError(e);case n.HardwareErrorCode.PinInvalid:return new o.InvalidPIN(e);case n.HardwareErrorCode.DeviceCheckPassphraseStateError:return new o.InvalidPassphrase(e);case n.HardwareErrorCode.DeviceOpenedPassphrase:return new o.DeviceOpenedPassphrase(e);case n.HardwareErrorCode.DeviceNotOpenedPassphrase:return new o.DeviceNotOpenedPassphrase(e);case n.HardwareErrorCode.PinCancelled:case n.HardwareErrorCode.ActionCancelled:return new o.UserCancel(e);case n.HardwareErrorCode.BridgeNotInstalled:case o.CustomOneKeyHardwareError.NeedOneKeyBridge:return new o.NeedOneKeyBridge(e);case n.HardwareErrorCode.BridgeNetworkError:return new o.BridgeNetworkError(e);case n.HardwareErrorCode.BridgeTimeoutError:return new o.BridgeTimeoutError(e);case n.HardwareErrorCode.PollingTimeout:return new o.ConnectTimeoutError(e);case n.HardwareErrorCode.PollingStop:return new o.ConnectPollingStopError(e);case n.HardwareErrorCode.BlindSignDisabled:return new o.OpenBlindSign(e);case n.HardwareErrorCode.FileAlreadyExists:return new o.FileAlreadyExistError(e);case n.HardwareErrorCode.CheckDownloadFileError:return new o.IncompleteFileError(e);case n.HardwareErrorCode.NotInSigningMode:return new o.NotInSigningModeError(e);case n.HardwareErrorCode.DataOverload:return new o.DeviceDataOverload(e);default:return new o.UnknownHardwareError(e)}}}}]);