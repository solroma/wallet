"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[11346],{786141:(t,n,e)=>{e.r(n),e.d(n,{VaultBase:()=>O,VaultBaseChainOnly:()=>D});var r=e(72579),i=e.n(r),o=e(256666),u=e(301842),a=e.n(u),c=e(634795),s=e(887371),d=e(545754),f=e(411987),l=e(695058),p=e(206391),h=e.n(p),v=e(636393),y=e(613549),g=e(292147),m=e(213208),w=e(992431),T=e(940915),A=e(278489),x=e(969618),I=e(398514),P=e(114540),N=e(348834).Buffer;function k(t,n){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),e.push.apply(e,r)}return e}function b(t){for(var n=1;n<arguments.length;n++){var e=null!=arguments[n]?arguments[n]:{};n%2?k(Object(e),!0).forEach((function(n){(0,o.default)(t,n,e[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):k(Object(e)).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))}))}return t}function C(t){var n=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var e,r=(0,l.default)(t);if(n){var i=(0,l.default)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,f.default)(this,e)}}if(m.default.isExtensionUi)throw new Error("engine/VaultBase is not allowed imported from ui");var D=function(t){(0,d.default)(e,t);var n=C(e);function e(){return n.apply(this,arguments)}var r=e.prototype;return r.initProvider=function(){var t=(0,c.default)((function*(){var t=(yield this.getNetwork()).impl;a()(x.IMPL_MAPPINGS[t])||(this.engineProvider=yield this.engine.providerManager.getProvider(this.networkId))}));return function(){return t.apply(this,arguments)}}(),r.proxyJsonRPCCall=function(){var t=(0,c.default)((function*(t){throw new T.NotImplemented}));return function(n){return t.apply(this,arguments)}}(),r.createClientFromURL=function(t){throw new T.NotImplemented},r.getEthersProvider=function(){var t=(0,c.default)((function*(){throw new T.NotImplemented}));return function(){return t.apply(this,arguments)}}(),r.getClientEndpointStatus=function(){var t=(0,c.default)((function*(t){var n=this.createClientFromURL(t),e=performance.now(),r=(yield n.getInfo()).bestBlockNumber;return{responseTime:Math.floor(performance.now()-e),latestBlock:r}}));return function(n){return t.apply(this,arguments)}}(),r.checkRpcBatchSupport=function(){var t=(0,c.default)((function*(t){throw new T.NotImplemented}));return function(n){return t.apply(this,arguments)}}(),r.getDisplayAddress=function(){var t=(0,c.default)((function*(t){return Promise.resolve(t)}));return function(n){return t.apply(this,arguments)}}(),r.validateAddress=function(){var t=(0,c.default)((function*(t){var n=yield this.engineProvider.verifyAddress(t),e=n.normalizedAddress;if(!n.isValid||!e)throw new T.InvalidAddress;return Promise.resolve(e)}));return function(n){return t.apply(this,arguments)}}(),r.validateImportedCredential=function(t){return Promise.resolve(this.settings.importedAccountEnabled&&/^(0x)?[0-9a-zA-Z]{64}$/.test(t))},r.validateWatchingCredential=function(){var t=(0,c.default)((function*(t){return Promise.resolve(this.settings.watchingAccountEnabled&&(yield this.engineProvider.verifyAddress(t)).isValid)}));return function(n){return t.apply(this,arguments)}}(),r.validateTokenAddress=function(){var t=(0,c.default)((function*(t){var n=yield this.engineProvider.verifyTokenAddress(t),e=n.normalizedAddress;if(!n.isValid||"undefined"===typeof e)throw new T.InvalidTokenAddress;return Promise.resolve(e)}));return function(n){return t.apply(this,arguments)}}(),r.validateCanCreateNextAccount=function(){var t=(0,c.default)((function*(t,n){return Promise.resolve(!0)}));return function(n,e){return t.apply(this,arguments)}}(),r.checkAccountExistence=function(){var t=(0,c.default)((function*(t,n){return Promise.resolve(!0)}));return function(n,e){return t.apply(this,arguments)}}(),r.getBalances=function(){var t=(0,c.default)((function*(t,n,e){return(yield this.engine.providerManager.getClient(this.networkId)).getBalances(t.map((function(t){var n=t.address,e=t.tokenAddress;return{address:n,coin:b({},"string"===typeof e?{tokenAddress:e}:{})}})))}));return function(n,e,r){return t.apply(this,arguments)}}(),r.getFrozenBalance=function(){var t=(0,c.default)((function*(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.password,t.useRecycleBalance,t.ignoreInscriptions,t.useCustomAddressesBalance;return 0}));return function(){return t.apply(this,arguments)}}(),r.fetchBalanceDetails=function(){var t=(0,c.default)((function*(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.password,t.useRecycleBalance,t.ignoreInscriptions,t.useCustomAddressesBalance;return Promise.resolve(void 0)}));return function(){return t.apply(this,arguments)}}(),r.getTransactionStatuses=function(t){return this.engine.providerManager.getTransactionStatuses(this.networkId,t)},r.getTransactionFeeInNative=function(t){return Promise.resolve("")},r.isContractAddress=function(){var t=(0,c.default)((function*(t){return!1}));return function(n){return t.apply(this,arguments)}}(),r.getAccountNameInfoMap=function(){var t=(0,c.default)((function*(){var t=yield this.getNetwork();return(0,A.getAccountNameInfoByImpl)(t.impl)}));return function(){return t.apply(this,arguments)}}(),r.canAutoCreateNextAccount=function(){var t=(0,c.default)((function*(t){return Promise.resolve(!1)}));return function(n){return t.apply(this,arguments)}}(),r.filterAccounts=function(){var t=(0,c.default)((function*(t){var n=t.accounts;t.networkId;return Promise.resolve(n)}));return function(n){return t.apply(this,arguments)}}(),r.shouldChangeAccountWhenNetworkChanged=function(){var t=(0,c.default)((function*(t){t.previousNetwork,t.newNetwork,t.activeAccountId;return Promise.resolve({shouldReloadAccountList:!1,shouldChangeActiveAccount:!1})}));return function(n){return t.apply(this,arguments)}}(),r.getAccountNameInfosByImportedOrWatchingCredential=function(){var t=(0,c.default)((function*(t){return Promise.resolve([])}));return function(n){return t.apply(this,arguments)}}(),r.checkIsUnlimitedAllowance=function(){var t=(0,c.default)((function*(t){throw new T.NotImplemented}));return function(n){return t.apply(this,arguments)}}(),r.checkIsApprovedForAll=function(){var t=(0,c.default)((function*(t){throw new T.NotImplemented}));return function(n){return t.apply(this,arguments)}}(),r.checkIsBatchTransfer=function(){var t=(0,c.default)((function*(t){throw new T.NotImplemented}));return function(n){return t.apply(this,arguments)}}(),r.getFeePricePerUnit=function(){var t=(0,c.default)((function*(){throw new T.NotImplemented}));return function(){return t.apply(this,arguments)}}(),r.fetchRpcChainId=function(){var t=(0,c.default)((function*(t){return null}));return function(n){return t.apply(this,arguments)}}(),r.getTxWaitingSeconds=function(){var t=(0,c.default)((function*(){return[]}));return function(){return t.apply(this,arguments)}}(),r.getUserNFTAssets=function(){var t=(0,c.default)((function*(t){t.serviceData;return Promise.resolve(void 0)}));return function(n){return t.apply(this,arguments)}}(),r.getTransactionDetail=function(){var t=(0,c.default)((function*(t){return Promise.resolve(void 0)}));return function(n){return t.apply(this,arguments)}}(),(0,s.default)(e)}(P.VaultContext),O=function(t){(0,d.default)(e,t);var n=C(e);function e(){for(var t,e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];return(t=n.call.apply(n,[this].concat(r))).uuid=v.default.v4().toString(),t}var r=e.prototype;return r.init=function(){var t=(0,c.default)((function*(t){yield this.initProvider(),yield this.initKeyring(t)}));return function(n){return t.apply(this,arguments)}}(),r.initKeyring=function(){var t=(0,c.default)((function*(t){this.keyring=yield t.keyringCreator(this)}));return function(n){return t.apply(this,arguments)}}(),r.signTransaction=function(){var t=(0,c.default)((function*(t,n){return this.keyring.signTransaction(t,n)}));return function(n,e){return t.apply(this,arguments)}}(),r.signAndSendTransaction=function(){var t=(0,c.default)((function*(t,n,e){var r=yield this.signTransaction(t,n);return e?b(b({},r),{},{encodedTx:t.encodedTx}):this.broadcastTransaction(b(b({},r),{},{encodedTx:t.encodedTx}))}));return function(n,e,r){return t.apply(this,arguments)}}(),r.broadcastTransaction=function(){var t=(0,c.default)((function*(t,n){g.default.engine.info("broadcastTransaction START:",{rawTx:t.rawTx});var e=yield this.engine.providerManager.broadcastTransaction(this.networkId,t.rawTx,n);return g.default.engine.info("broadcastTransaction END:",{txid:e,rawTx:t.rawTx}),b(b({},t),{},{txid:e,encodedTx:t.encodedTx})}));return function(n,e){return t.apply(this,arguments)}}(),r.buildEncodedTxFromBatchTransfer=function(){var t=(0,c.default)((function*(t){throw new T.NotImplemented}));return function(n){return t.apply(this,arguments)}}(),r.buildEncodedTxsFromSetApproveForAll=function(){var t=(0,c.default)((function*(t,n){throw new T.NotImplemented}));return function(n,e){return t.apply(this,arguments)}}(),r.activateAccount=function(){var t=(0,c.default)((function*(){throw new T.NotImplemented}));return function(){return t.apply(this,arguments)}}(),r.activateToken=function(){var t=(0,c.default)((function*(t,n){throw new T.NotImplemented}));return function(n,e){return t.apply(this,arguments)}}(),r.getTokenAllowance=function(){var t=(0,c.default)((function*(t,n){throw new T.NotImplemented}));return function(n,e){return t.apply(this,arguments)}}(),r.batchTokensAllowance=function(){var t=(0,c.default)((function*(t,n){throw new T.NotImplemented}));return function(n,e){return t.apply(this,arguments)}}(),r.getOutputAccount=function(){var t=(0,c.default)((function*(){var t=yield this.getDbAccount({noCache:!0});return{id:t.id,name:t.name,type:t.type,path:t.path,coinType:t.coinType,tokens:[],address:t.address,template:t.template,pubKey:i()(t,"pub","")}}));return function(){return t.apply(this,arguments)}}(),r.getAccountBalance=function(){var t=(0,c.default)((function*(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],e=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,i=(yield this.getDbAccount()).address;return this.getBalances((n?[{address:i}]:[]).concat(t.map((function(t){return{address:i,tokenAddress:t}}))),e,r)}));return function(n){return t.apply(this,arguments)}}(),r.updatePendingTxs=function(){var t=(0,c.default)((function*(t){throw new T.NotImplemented}));return function(n){return t.apply(this,arguments)}}(),r.getAccountNonce=function(){var t=(0,c.default)((function*(){return Promise.resolve(null)}));return function(){return t.apply(this,arguments)}}(),r.fixActionDirection=function(){var t=(0,c.default)((function*(t){var n,e,r,i,o=t.action,u=t.accountAddress;(o.direction=I.IDecodedTxDirection.OTHER,o.type===I.IDecodedTxActionType.NATIVE_TRANSFER)&&(o.direction=yield this.buildTxActionDirection({from:(null==(n=o.nativeTransfer)?void 0:n.from)||"",to:(null==(e=o.nativeTransfer)?void 0:e.to)||"",address:u}));o.type===I.IDecodedTxActionType.TOKEN_TRANSFER&&(o.direction=yield this.buildTxActionDirection({from:(null==(r=o.tokenTransfer)?void 0:r.from)||"",to:(null==(i=o.tokenTransfer)?void 0:i.to)||"",address:u}));return o}));return function(n){return t.apply(this,arguments)}}(),r.fixDecodedTx=function(){var t=(0,c.default)((function*(t){var n,e;t.createdAt=null!=(n=t.createdAt)?n:Date.now();var r=null==(e=t.encodedTx)?void 0:e.nonce;t.nonce=a()(r)?t.nonce:new(h())(r).toNumber();for(var i=t.owner,o=0;o<t.actions.length;o+=1){var u=t.actions[o];yield this.fixActionDirection({action:u,accountAddress:i})}if(t.outputActions)for(var c=0;c<t.outputActions.length;c+=1){var s=t.outputActions[c];yield this.fixActionDirection({action:s,accountAddress:i})}return Promise.resolve(t)}));return function(n){return t.apply(this,arguments)}}(),r.fixHistoryTx=function(){var t=(0,c.default)((function*(t){return t.decodedTx=yield this.fixDecodedTx(t.decodedTx),Promise.resolve(t)}));return function(n){return t.apply(this,arguments)}}(),r.buildHistoryTx=function(){var t=(0,c.default)((function*(t){var n=t.historyTxToMerge,e=(t.encodedTx,t.decodedTx),r=t.signedTx,i=t.isSigner,o=t.isLocalCreated,u=(null==r?void 0:r.txid)||(null==e?void 0:e.txid)||"";if(!u)throw new Error("buildHistoryTx txid not found");var a=yield this.getAccountAddress();e.txid=u||e.txid,e.owner=a,i&&(e.signer=a),null!=r&&r.txKey&&(e.extraInfo?e.extraInfo.txKey=r.txKey:e.extraInfo={txKey:r.txKey});var c=b(b({id:`${this.networkId}_${u}_${this.accountId}`,isLocalCreated:Boolean(o)},n),{},{decodedTx:e});return c=yield this.fixHistoryTx(c),Promise.resolve(c)}));return function(n){return t.apply(this,arguments)}}(),r.checkIsScamHistoryTx=function(){var t=(0,c.default)((function*(t){return!1}));return function(n){return t.apply(this,arguments)}}(),r.fetchOnChainHistory=function(){var t=(0,c.default)((function*(t){throw new T.NotImplemented}));return function(n){return t.apply(this,arguments)}}(),r.fixAddressCase=function(t){return Promise.resolve(t)},r.buildTxActionDirection=function(){var t=(0,c.default)((function*(t){var n=t.from,e=t.to,r=t.address;return n=yield this.fixAddressCase(n||""),e=yield this.fixAddressCase(e),r=yield this.fixAddressCase(r),n===e&&n===r?I.IDecodedTxDirection.SELF:n&&n===r?I.IDecodedTxDirection.OUT:e&&e===r?I.IDecodedTxDirection.IN:I.IDecodedTxDirection.OTHER}));return function(n){return t.apply(this,arguments)}}(),r.getNextNonce=function(){var t=(0,c.default)((function*(t,n){var e,r=null==(e=(yield this.engine.providerManager.getAddresses(t,[n.address]))[0])?void 0:e.nonce;if(a()(r))throw new T.OneKeyError("Get on-chain nonce failed.");yield this.engine.getHistory(t,n.id,void 0,!1);var i=yield w.default.history.getMaxPendingNonce({accountId:this.accountId,networkId:t}),o=yield w.default.history.getPendingNonceList({accountId:this.accountId,networkId:t}),u=Math.max(a()(i)?0:i+1,r);if(Number.isNaN(u)&&(u=r),u>r)for(var c=r;c<u;c+=1)if(!o.includes(c)){u=c;break}if(u<r&&(u=r),u-r>=y.HISTORY_CONSTS.PENDING_QUEUE_MAX_LENGTH)throw new T.PendingQueueTooLong(y.HISTORY_CONSTS.PENDING_QUEUE_MAX_LENGTH);return u}));return function(n,e){return t.apply(this,arguments)}}(),r.validateSendAmount=function(t,n,e){return Promise.resolve(!0)},r.notifyChainChanged=function(t,n){},r.getFetchBalanceAddress=function(t){return Promise.resolve(t.address)},r.getPrivateKeyByCredential=function(t){return Promise.resolve(N.from(t.startsWith("0x")?t.slice(2):t,"hex"))},r.getMinDepositAmount=function(){var t=(0,c.default)((function*(){return"0"}));return function(){return t.apply(this,arguments)}}(),r.specialCheckEncodedTx=function(){var t=(0,c.default)((function*(t){return{success:!0}}));return function(n){return t.apply(this,arguments)}}(),r.getAllUsedAddress=function(){var t=(0,c.default)((function*(){return Promise.resolve([])}));return function(){return t.apply(this,arguments)}}(),(0,s.default)(e)}(D)},111346:(t,n,e)=>{e.r(n),e.d(n,{default:()=>f});var r=e(887371),i=e(545754),o=e(411987),u=e(695058),a=e(786141),c=e(834723);function s(t){var n=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var e,r=(0,u.default)(t);if(n){var i=(0,u.default)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,o.default)(this,e)}}var d=function(){},f=function(t){(0,i.default)(e,t);var n=s(e);function e(){for(var t,e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];return(t=n.call.apply(n,[this].concat(r))).settings=c.default,t.keyringMap={hd:d,hw:d,imported:d,watching:d,external:d},t}return(0,r.default)(e)}(a.VaultBase)}}]);