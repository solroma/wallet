"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[59074],{786141:(e,r,t)=>{t.r(r),t.d(r,{VaultBase:()=>B,VaultBaseChainOnly:()=>N});var n=t(72579),o=t.n(n),i=t(256666),a=t(301842),u=t.n(a),c=t(634795),d=t(887371),s=t(545754),l=t(411987),f=t(695058),p=t(206391),h=t.n(p),y=t(636393),v=t(613549),w=t(292147),g=t(213208),m=t(992431),E=t(940915),I=t(278489),A=t(969618),O=t(398514),x=t(114540),b=t(348834).Buffer;function P(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function T(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?P(Object(t),!0).forEach((function(r){(0,i.default)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):P(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function D(e){var r=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,n=(0,f.default)(e);if(r){var o=(0,f.default)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,l.default)(this,t)}}if(g.default.isExtensionUi)throw new Error("engine/VaultBase is not allowed imported from ui");var N=function(e){(0,s.default)(t,e);var r=D(t);function t(){return r.apply(this,arguments)}var n=t.prototype;return n.initProvider=function(){var e=(0,c.default)((function*(){var e=(yield this.getNetwork()).impl;u()(A.IMPL_MAPPINGS[e])||(this.engineProvider=yield this.engine.providerManager.getProvider(this.networkId))}));return function(){return e.apply(this,arguments)}}(),n.proxyJsonRPCCall=function(){var e=(0,c.default)((function*(e){throw new E.NotImplemented}));return function(r){return e.apply(this,arguments)}}(),n.createClientFromURL=function(e){throw new E.NotImplemented},n.getEthersProvider=function(){var e=(0,c.default)((function*(){throw new E.NotImplemented}));return function(){return e.apply(this,arguments)}}(),n.getClientEndpointStatus=function(){var e=(0,c.default)((function*(e){var r=this.createClientFromURL(e),t=performance.now(),n=(yield r.getInfo()).bestBlockNumber;return{responseTime:Math.floor(performance.now()-t),latestBlock:n}}));return function(r){return e.apply(this,arguments)}}(),n.checkRpcBatchSupport=function(){var e=(0,c.default)((function*(e){throw new E.NotImplemented}));return function(r){return e.apply(this,arguments)}}(),n.getDisplayAddress=function(){var e=(0,c.default)((function*(e){return Promise.resolve(e)}));return function(r){return e.apply(this,arguments)}}(),n.validateAddress=function(){var e=(0,c.default)((function*(e){var r=yield this.engineProvider.verifyAddress(e),t=r.normalizedAddress;if(!r.isValid||!t)throw new E.InvalidAddress;return Promise.resolve(t)}));return function(r){return e.apply(this,arguments)}}(),n.validateImportedCredential=function(e){return Promise.resolve(this.settings.importedAccountEnabled&&/^(0x)?[0-9a-zA-Z]{64}$/.test(e))},n.validateWatchingCredential=function(){var e=(0,c.default)((function*(e){return Promise.resolve(this.settings.watchingAccountEnabled&&(yield this.engineProvider.verifyAddress(e)).isValid)}));return function(r){return e.apply(this,arguments)}}(),n.validateTokenAddress=function(){var e=(0,c.default)((function*(e){var r=yield this.engineProvider.verifyTokenAddress(e),t=r.normalizedAddress;if(!r.isValid||"undefined"===typeof t)throw new E.InvalidTokenAddress;return Promise.resolve(t)}));return function(r){return e.apply(this,arguments)}}(),n.validateCanCreateNextAccount=function(){var e=(0,c.default)((function*(e,r){return Promise.resolve(!0)}));return function(r,t){return e.apply(this,arguments)}}(),n.checkAccountExistence=function(){var e=(0,c.default)((function*(e,r){return Promise.resolve(!0)}));return function(r,t){return e.apply(this,arguments)}}(),n.getBalances=function(){var e=(0,c.default)((function*(e,r,t){return(yield this.engine.providerManager.getClient(this.networkId)).getBalances(e.map((function(e){var r=e.address,t=e.tokenAddress;return{address:r,coin:T({},"string"===typeof t?{tokenAddress:t}:{})}})))}));return function(r,t,n){return e.apply(this,arguments)}}(),n.getFrozenBalance=function(){var e=(0,c.default)((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.password,e.useRecycleBalance,e.ignoreInscriptions,e.useCustomAddressesBalance;return 0}));return function(){return e.apply(this,arguments)}}(),n.fetchBalanceDetails=function(){var e=(0,c.default)((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.password,e.useRecycleBalance,e.ignoreInscriptions,e.useCustomAddressesBalance;return Promise.resolve(void 0)}));return function(){return e.apply(this,arguments)}}(),n.getTransactionStatuses=function(e){return this.engine.providerManager.getTransactionStatuses(this.networkId,e)},n.getTransactionFeeInNative=function(e){return Promise.resolve("")},n.isContractAddress=function(){var e=(0,c.default)((function*(e){return!1}));return function(r){return e.apply(this,arguments)}}(),n.getAccountNameInfoMap=function(){var e=(0,c.default)((function*(){var e=yield this.getNetwork();return(0,I.getAccountNameInfoByImpl)(e.impl)}));return function(){return e.apply(this,arguments)}}(),n.canAutoCreateNextAccount=function(){var e=(0,c.default)((function*(e){return Promise.resolve(!1)}));return function(r){return e.apply(this,arguments)}}(),n.filterAccounts=function(){var e=(0,c.default)((function*(e){var r=e.accounts;e.networkId;return Promise.resolve(r)}));return function(r){return e.apply(this,arguments)}}(),n.shouldChangeAccountWhenNetworkChanged=function(){var e=(0,c.default)((function*(e){e.previousNetwork,e.newNetwork,e.activeAccountId;return Promise.resolve({shouldReloadAccountList:!1,shouldChangeActiveAccount:!1})}));return function(r){return e.apply(this,arguments)}}(),n.getAccountNameInfosByImportedOrWatchingCredential=function(){var e=(0,c.default)((function*(e){return Promise.resolve([])}));return function(r){return e.apply(this,arguments)}}(),n.checkIsUnlimitedAllowance=function(){var e=(0,c.default)((function*(e){throw new E.NotImplemented}));return function(r){return e.apply(this,arguments)}}(),n.checkIsApprovedForAll=function(){var e=(0,c.default)((function*(e){throw new E.NotImplemented}));return function(r){return e.apply(this,arguments)}}(),n.checkIsBatchTransfer=function(){var e=(0,c.default)((function*(e){throw new E.NotImplemented}));return function(r){return e.apply(this,arguments)}}(),n.getFeePricePerUnit=function(){var e=(0,c.default)((function*(){throw new E.NotImplemented}));return function(){return e.apply(this,arguments)}}(),n.fetchRpcChainId=function(){var e=(0,c.default)((function*(e){return null}));return function(r){return e.apply(this,arguments)}}(),n.getTxWaitingSeconds=function(){var e=(0,c.default)((function*(){return[]}));return function(){return e.apply(this,arguments)}}(),n.getUserNFTAssets=function(){var e=(0,c.default)((function*(e){e.serviceData;return Promise.resolve(void 0)}));return function(r){return e.apply(this,arguments)}}(),n.getTransactionDetail=function(){var e=(0,c.default)((function*(e){return Promise.resolve(void 0)}));return function(r){return e.apply(this,arguments)}}(),(0,d.default)(t)}(x.VaultContext),B=function(e){(0,s.default)(t,e);var r=D(t);function t(){for(var e,t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return(e=r.call.apply(r,[this].concat(n))).uuid=y.default.v4().toString(),e}var n=t.prototype;return n.init=function(){var e=(0,c.default)((function*(e){yield this.initProvider(),yield this.initKeyring(e)}));return function(r){return e.apply(this,arguments)}}(),n.initKeyring=function(){var e=(0,c.default)((function*(e){this.keyring=yield e.keyringCreator(this)}));return function(r){return e.apply(this,arguments)}}(),n.signTransaction=function(){var e=(0,c.default)((function*(e,r){return this.keyring.signTransaction(e,r)}));return function(r,t){return e.apply(this,arguments)}}(),n.signAndSendTransaction=function(){var e=(0,c.default)((function*(e,r,t){var n=yield this.signTransaction(e,r);return t?T(T({},n),{},{encodedTx:e.encodedTx}):this.broadcastTransaction(T(T({},n),{},{encodedTx:e.encodedTx}))}));return function(r,t,n){return e.apply(this,arguments)}}(),n.broadcastTransaction=function(){var e=(0,c.default)((function*(e,r){w.default.engine.info("broadcastTransaction START:",{rawTx:e.rawTx});var t=yield this.engine.providerManager.broadcastTransaction(this.networkId,e.rawTx,r);return w.default.engine.info("broadcastTransaction END:",{txid:t,rawTx:e.rawTx}),T(T({},e),{},{txid:t,encodedTx:e.encodedTx})}));return function(r,t){return e.apply(this,arguments)}}(),n.buildEncodedTxFromBatchTransfer=function(){var e=(0,c.default)((function*(e){throw new E.NotImplemented}));return function(r){return e.apply(this,arguments)}}(),n.buildEncodedTxsFromSetApproveForAll=function(){var e=(0,c.default)((function*(e,r){throw new E.NotImplemented}));return function(r,t){return e.apply(this,arguments)}}(),n.activateAccount=function(){var e=(0,c.default)((function*(){throw new E.NotImplemented}));return function(){return e.apply(this,arguments)}}(),n.activateToken=function(){var e=(0,c.default)((function*(e,r){throw new E.NotImplemented}));return function(r,t){return e.apply(this,arguments)}}(),n.getTokenAllowance=function(){var e=(0,c.default)((function*(e,r){throw new E.NotImplemented}));return function(r,t){return e.apply(this,arguments)}}(),n.batchTokensAllowance=function(){var e=(0,c.default)((function*(e,r){throw new E.NotImplemented}));return function(r,t){return e.apply(this,arguments)}}(),n.getOutputAccount=function(){var e=(0,c.default)((function*(){var e=yield this.getDbAccount({noCache:!0});return{id:e.id,name:e.name,type:e.type,path:e.path,coinType:e.coinType,tokens:[],address:e.address,template:e.template,pubKey:o()(e,"pub","")}}));return function(){return e.apply(this,arguments)}}(),n.getAccountBalance=function(){var e=(0,c.default)((function*(e){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],t=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,o=(yield this.getDbAccount()).address;return this.getBalances((r?[{address:o}]:[]).concat(e.map((function(e){return{address:o,tokenAddress:e}}))),t,n)}));return function(r){return e.apply(this,arguments)}}(),n.updatePendingTxs=function(){var e=(0,c.default)((function*(e){throw new E.NotImplemented}));return function(r){return e.apply(this,arguments)}}(),n.getAccountNonce=function(){var e=(0,c.default)((function*(){return Promise.resolve(null)}));return function(){return e.apply(this,arguments)}}(),n.fixActionDirection=function(){var e=(0,c.default)((function*(e){var r,t,n,o,i=e.action,a=e.accountAddress;(i.direction=O.IDecodedTxDirection.OTHER,i.type===O.IDecodedTxActionType.NATIVE_TRANSFER)&&(i.direction=yield this.buildTxActionDirection({from:(null==(r=i.nativeTransfer)?void 0:r.from)||"",to:(null==(t=i.nativeTransfer)?void 0:t.to)||"",address:a}));i.type===O.IDecodedTxActionType.TOKEN_TRANSFER&&(i.direction=yield this.buildTxActionDirection({from:(null==(n=i.tokenTransfer)?void 0:n.from)||"",to:(null==(o=i.tokenTransfer)?void 0:o.to)||"",address:a}));return i}));return function(r){return e.apply(this,arguments)}}(),n.fixDecodedTx=function(){var e=(0,c.default)((function*(e){var r,t;e.createdAt=null!=(r=e.createdAt)?r:Date.now();var n=null==(t=e.encodedTx)?void 0:t.nonce;e.nonce=u()(n)?e.nonce:new(h())(n).toNumber();for(var o=e.owner,i=0;i<e.actions.length;i+=1){var a=e.actions[i];yield this.fixActionDirection({action:a,accountAddress:o})}if(e.outputActions)for(var c=0;c<e.outputActions.length;c+=1){var d=e.outputActions[c];yield this.fixActionDirection({action:d,accountAddress:o})}return Promise.resolve(e)}));return function(r){return e.apply(this,arguments)}}(),n.fixHistoryTx=function(){var e=(0,c.default)((function*(e){return e.decodedTx=yield this.fixDecodedTx(e.decodedTx),Promise.resolve(e)}));return function(r){return e.apply(this,arguments)}}(),n.buildHistoryTx=function(){var e=(0,c.default)((function*(e){var r=e.historyTxToMerge,t=(e.encodedTx,e.decodedTx),n=e.signedTx,o=e.isSigner,i=e.isLocalCreated,a=(null==n?void 0:n.txid)||(null==t?void 0:t.txid)||"";if(!a)throw new Error("buildHistoryTx txid not found");var u=yield this.getAccountAddress();t.txid=a||t.txid,t.owner=u,o&&(t.signer=u),null!=n&&n.txKey&&(t.extraInfo?t.extraInfo.txKey=n.txKey:t.extraInfo={txKey:n.txKey});var c=T(T({id:`${this.networkId}_${a}_${this.accountId}`,isLocalCreated:Boolean(i)},r),{},{decodedTx:t});return c=yield this.fixHistoryTx(c),Promise.resolve(c)}));return function(r){return e.apply(this,arguments)}}(),n.checkIsScamHistoryTx=function(){var e=(0,c.default)((function*(e){return!1}));return function(r){return e.apply(this,arguments)}}(),n.fetchOnChainHistory=function(){var e=(0,c.default)((function*(e){throw new E.NotImplemented}));return function(r){return e.apply(this,arguments)}}(),n.fixAddressCase=function(e){return Promise.resolve(e)},n.buildTxActionDirection=function(){var e=(0,c.default)((function*(e){var r=e.from,t=e.to,n=e.address;return r=yield this.fixAddressCase(r||""),t=yield this.fixAddressCase(t),n=yield this.fixAddressCase(n),r===t&&r===n?O.IDecodedTxDirection.SELF:r&&r===n?O.IDecodedTxDirection.OUT:t&&t===n?O.IDecodedTxDirection.IN:O.IDecodedTxDirection.OTHER}));return function(r){return e.apply(this,arguments)}}(),n.getNextNonce=function(){var e=(0,c.default)((function*(e,r){var t,n=null==(t=(yield this.engine.providerManager.getAddresses(e,[r.address]))[0])?void 0:t.nonce;if(u()(n))throw new E.OneKeyError("Get on-chain nonce failed.");yield this.engine.getHistory(e,r.id,void 0,!1);var o=yield m.default.history.getMaxPendingNonce({accountId:this.accountId,networkId:e}),i=yield m.default.history.getPendingNonceList({accountId:this.accountId,networkId:e}),a=Math.max(u()(o)?0:o+1,n);if(Number.isNaN(a)&&(a=n),a>n)for(var c=n;c<a;c+=1)if(!i.includes(c)){a=c;break}if(a<n&&(a=n),a-n>=v.HISTORY_CONSTS.PENDING_QUEUE_MAX_LENGTH)throw new E.PendingQueueTooLong(v.HISTORY_CONSTS.PENDING_QUEUE_MAX_LENGTH);return a}));return function(r,t){return e.apply(this,arguments)}}(),n.validateSendAmount=function(e,r,t){return Promise.resolve(!0)},n.notifyChainChanged=function(e,r){},n.getFetchBalanceAddress=function(e){return Promise.resolve(e.address)},n.getPrivateKeyByCredential=function(e){return Promise.resolve(b.from(e.startsWith("0x")?e.slice(2):e,"hex"))},n.getMinDepositAmount=function(){var e=(0,c.default)((function*(){return"0"}));return function(){return e.apply(this,arguments)}}(),n.specialCheckEncodedTx=function(){var e=(0,c.default)((function*(e){return{success:!0}}));return function(r){return e.apply(this,arguments)}}(),n.getAllUsedAddress=function(){var e=(0,c.default)((function*(){return Promise.resolve([])}));return function(){return e.apply(this,arguments)}}(),(0,d.default)(t)}(N)},859074:(e,r,t)=>{t.r(r),t.d(r,{default:()=>N});var n=t(887371),o=t(545754),i=t(411987),a=t(695058),u=t(786141),c=t(256666),d=t(634795),s=t(153546),l=t(613549),f=t(292147),p=t(940915),h=t(398145),y=t(82406),v=t(121801);function w(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function g(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?w(Object(t),!0).forEach((function(r){(0,c.default)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):w(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function m(e){var r=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,n=(0,a.default)(e);if(r){var o=(0,a.default)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,i.default)(this,t)}}var E=function(e){(0,o.default)(t,e);var r=m(t);function t(){return r.apply(this,arguments)}var i=t.prototype;return i.prepareAccounts=function(){var e=(0,d.default)((function*(e){var r,t=e.indexes,n=t.map((function(e){return`${(0,v.getNostrPath)(e)}/${v.NOSTR_ADDRESS_INDEX}`})),o=yield this.getHardwareSDKInstance(),i=yield this.getHardwareInfo(),a=i.connectId,u=i.deviceId,c=yield this.getWalletPassphraseState();try{r=yield o.nostrGetPublicKey(a,u,g({bundle:n.map((function(e){return{path:e,showOnOneKey:!1}}))},c))}catch(O){throw f.default.hardwareSDK.error(O),new p.OneKeyHardwareError(O)}if(!r.success)throw f.default.hardwareSDK.error(r.payload),(0,s.convertDeviceError)(r.payload);var d=[],y=0;for(var w of r.payload){var m=w.publickey,E=w.path,I=w.npub;if(m&&I){var A=`Nostr #${t[y]+1}`;d.push({id:`${this.walletId}--${E}`,name:A,type:h.AccountType.VARIANT,path:E,coinType:l.COINTYPE_NOSTR,address:I,pub:null!=m?m:"",addresses:{}}),y+=1}}return d}));return function(r){return e.apply(this,arguments)}}(),i.signTransaction=function(){var e=(0,d.default)((function*(e){var r;f.default.common.info("signTransaction",e);var t=e.encodedTx.event;if(!(0,v.validateEvent)(t))throw new Error("Invalid event");var n,o=yield this.getDbAccount(),i=yield this.getHardwareSDKInstance(),a=yield this.getHardwareInfo(),u=a.connectId,c=a.deviceId,d=yield this.getWalletPassphraseState();try{n=yield i.nostrSignEvent(u,c,g(g({},d),{},{path:o.path,event:t}))}catch(h){throw f.default.hardwareSDK.error(h),new p.OneKeyHardwareError(h)}if(!n.success)throw f.default.hardwareSDK.error(n.payload),(0,s.convertDeviceError)(n.payload);var l=n.payload.event;return t.sig=l.sig,{txid:null!=(r=l.id)?r:"",rawTx:JSON.stringify(t)}}));return function(r){return e.apply(this,arguments)}}(),i.encrypt=function(){var e=(0,d.default)((function*(e){var r,t=e.pubkey,n=e.plaintext,o=yield this.getDbAccount(),i=yield this.getHardwareSDKInstance(),a=yield this.getHardwareInfo(),u=a.connectId,c=a.deviceId,d=yield this.getWalletPassphraseState();try{r=yield i.nostrEncryptMessage(u,c,g(g({},d),{},{path:o.path,pubkey:t,plaintext:n,showOnOneKey:!1}))}catch(l){throw f.default.hardwareSDK.error(l),new p.OneKeyHardwareError(l)}if(!r.success)throw f.default.hardwareSDK.error(r.payload),(0,s.convertDeviceError)(r.payload);return r.payload.encryptedMessage}));return function(r){return e.apply(this,arguments)}}(),i.decrypt=function(){var e=(0,d.default)((function*(e){var r,t=e.pubkey,n=e.ciphertext,o=yield this.getDbAccount(),i=yield this.getHardwareSDKInstance(),a=yield this.getHardwareInfo(),u=a.connectId,c=a.deviceId,d=yield this.getWalletPassphraseState();try{r=yield i.nostrDecryptMessage(u,c,g(g({},d),{},{path:o.path,pubkey:t,ciphertext:n,showOnOneKey:!1}))}catch(l){throw f.default.hardwareSDK.error(l),new p.OneKeyHardwareError(l)}if(!r.success)throw f.default.hardwareSDK.error(r.payload),(0,s.convertDeviceError)(r.payload);return r.payload.decryptedMessage}));return function(r){return e.apply(this,arguments)}}(),i.signMessage=function(){var e=(0,d.default)((function*(e){f.default.common.info("Nostr signSchnorr",e);var r=yield this.getDbAccount(),t=yield this.getHardwareSDKInstance(),n=yield this.getHardwareInfo(),o=n.connectId,i=n.deviceId,a=yield this.getWalletPassphraseState(),u=yield Promise.all(e.map(function(){var e=(0,d.default)((function*(e){var n=e.message,u=yield t.nostrSignSchnorr(o,i,g(g({},a),{},{path:r.path,hash:n}));if(!u.success)throw(0,s.convertDeviceError)(u.payload);return u.payload.signature}));return function(r){return e.apply(this,arguments)}}()));return u}));return function(r){return e.apply(this,arguments)}}(),i.getAddress=function(){var e=(0,d.default)((function*(e){var r=yield this.getHardwareSDKInstance(),t=yield this.getHardwareInfo(),n=t.connectId,o=t.deviceId,i=yield this.getWalletPassphraseState(),a=yield r.nostrGetPublicKey(n,o,g({path:e.path,showOnOneKey:e.showOnOneKey},i));if(a.success&&a.payload.npub)return a.payload.npub;throw(0,s.convertDeviceError)(a.payload)}));return function(r){return e.apply(this,arguments)}}(),i.batchGetAddress=function(){throw new Error("Method not implemented.")},(0,n.default)(t)}(y.KeyringHardwareBase);function I(e){var r=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,n=(0,a.default)(e);if(r){var o=(0,a.default)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,i.default)(this,t)}}var A=function(e){(0,o.default)(t,e);var r=I(t);function t(){return r.apply(this,arguments)}var i=t.prototype;return i.prepareAccounts=function(){var e=(0,d.default)((function*(e){var r=e.password,t=e.indexes,n=(yield this.engine.dbApi.getCredential(this.walletId,r)).seed;if(1!==t.length)throw new Error("Nostr: only one account is supported");var o=t[0],i=new v.Nostr(this.walletId,o,r,n),a=i.getPublicKeyHex(),u=i.getPubkeyEncodedByNip19(),c=`${(0,v.getNostrPath)(o)}/${v.NOSTR_ADDRESS_INDEX}`;return[{id:`${this.walletId}--${c}`,name:`Nostr #${o+1}`,type:h.AccountType.VARIANT,path:c,coinType:l.COINTYPE_NOSTR,address:u,pub:a,addresses:{}}]}));return function(r){return e.apply(this,arguments)}}(),i.getAccountIndex=function(e){var r,t=e.path.split("/"),n=null==(r=e.template)?void 0:r.split("/");if(Array.isArray(n))for(var o=0;o<n.length;o+=1)if(n[o]===`${l.INDEX_PLACEHOLDER}'`){var i=Number(t[o].replace("'",""));if(!Number.isNaN(i))return i}return-1},i.signTransaction=function(){var e=(0,d.default)((function*(e,r){var t,n=r.password,o=e.encodedTx.event;if(!(0,v.validateEvent)(o))throw new Error("Invalid event");var i=(yield this.engine.dbApi.getCredential(this.walletId,null!=n?n:"")).seed,a=yield this.getDbAccount(),u=this.getAccountIndex(a);if(u<0)throw new Error("Invalid account index");var c=new v.Nostr(this.walletId,u,null!=n?n:"",i),d=yield c.signEvent(o);return{txid:null!=(t=d.id)?t:"",rawTx:JSON.stringify(d)}}));return function(r,t){return e.apply(this,arguments)}}(),i.encrypt=function(){var e=(0,d.default)((function*(e,r){var t=e.pubkey,n=e.plaintext,o=r.password,i=(yield this.engine.dbApi.getCredential(this.walletId,null!=o?o:"")).seed,a=yield this.getDbAccount(),u=this.getAccountIndex(a);if(u<0)throw new Error("Invalid account index");return new v.Nostr(this.walletId,u,null!=o?o:"",i).encrypt(t,n)}));return function(r,t){return e.apply(this,arguments)}}(),i.decrypt=function(){var e=(0,d.default)((function*(e,r){var t=e.pubkey,n=e.ciphertext,o=r.password,i=(yield this.engine.dbApi.getCredential(this.walletId,null!=o?o:"")).seed,a=yield this.getDbAccount(),u=this.getAccountIndex(a);if(u<0)throw new Error("Invalid account index");return new v.Nostr(this.walletId,u,null!=o?o:"",i).decrypt(t,n)}));return function(r,t){return e.apply(this,arguments)}}(),i.signMessage=function(){var e=(0,d.default)((function*(e,r){f.default.common.info("Nostr signSchnorr",e);var t=r.password,n=(yield this.engine.dbApi.getCredential(this.walletId,null!=t?t:"")).seed,o=yield this.getDbAccount(),i=this.getAccountIndex(o);if(i<0)throw new Error("Invalid account index");var a=new v.Nostr(this.walletId,i,null!=t?t:"",n);return e.map((function(e){var r=e.message;return a.signSchnorr(r)}))}));return function(r,t){return e.apply(this,arguments)}}(),(0,n.default)(t)}(t(810887).KeyringHdBase);function O(e){var r=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,n=(0,a.default)(e);if(r){var o=(0,a.default)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,i.default)(this,t)}}var x=function(e){(0,o.default)(t,e);var r=O(t);function t(){return r.apply(this,arguments)}return(0,n.default)(t)}(t(255942).KeyringImportedBase);function b(e){var r=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,n=(0,a.default)(e);if(r){var o=(0,a.default)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,i.default)(this,t)}}var P=function(e){(0,o.default)(t,e);var r=b(t);function t(){return r.apply(this,arguments)}return(0,n.default)(t)}(t(701625).KeyringWatchingBase),T=t(647815);function D(e){var r=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,n=(0,a.default)(e);if(r){var o=(0,a.default)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,i.default)(this,t)}}var N=function(e){(0,o.default)(t,e);var r=D(t);function t(){for(var e,t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return(e=r.call.apply(r,[this].concat(n))).keyringMap={hd:A,hw:E,imported:x,watching:P,external:P},e.settings=T.default,e}var i=t.prototype;return i.addressFromBase=function(e){return Promise.resolve(e.address)},i.encrypt=function(e,r){return this.keyring.encrypt(e,r)},i.decrypt=function(e,r){return this.keyring.decrypt(e,r)},(0,n.default)(t)}(u.VaultBase)},565147:(e,r,t)=>{t.r(r),t.d(r,{KeyringBase:()=>d,KeyringBaseMock:()=>s});var n=t(634795),o=t(887371),i=t(545754),a=t(411987),u=t(695058);function c(e){var r=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,n=(0,u.default)(e);if(r){var o=(0,u.default)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,a.default)(this,t)}}var d=function(e){(0,i.default)(t,e);var r=c(t);function t(e){var t;return(t=r.call(this,e.options)).vault=e,t}return t.prototype.addressFromBase=function(){var e=(0,n.default)((function*(e){return this.vault.addressFromBase(e)}));return function(r){return e.apply(this,arguments)}}(),(0,o.default)(t)}(t(114540).VaultContext),s=function(e){(0,i.default)(t,e);var r=c(t);function t(){return r.apply(this,arguments)}return(0,o.default)(t)}(d)},82406:(e,r,t)=>{t.r(r),t.d(r,{KeyringHardwareBase:()=>l});var n=t(634795),o=t(887371),i=t(545754),a=t(411987),u=t(695058),c=t(799075),d=t(814817);function s(e){var r=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,n=(0,u.default)(e);if(r){var o=(0,u.default)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,a.default)(this,t)}}var l=function(e){(0,i.default)(a,e);var r=s(a);function a(){return r.apply(this,arguments)}var u=a.prototype;return u.getHardwareInfo=function(){var e=(0,n.default)((function*(){var e,r,t,n=yield this.engine.getHWDeviceByWalletId(this.vault.walletId);return{connectId:null!=(e=null==n?void 0:n.mac)?e:"",deviceId:null!=(r=null==n?void 0:n.deviceId)?r:"",deviceType:null!=(t=null==n?void 0:n.deviceType)?t:""}}));return function(){return e.apply(this,arguments)}}(),u.getWalletPassphraseState=function(){var e=(0,n.default)((function*(){var e=yield this.engine.getWallet(this.vault.walletId);return{passphraseState:null==e?void 0:e.passphraseState,useEmptyPassphrase:!(0,d.isPassphraseWallet)(e)}}));return function(){return e.apply(this,arguments)}}(),u.getHardwareSDKInstance=function(){var e=(0,n.default)((function*(){var e,r,n,o,i;return null!=(i=yield null==(e=t.g)||null==(r=e.$backgroundApiProxy)||null==(n=r.backgroundApi)||null==(o=n.serviceHardware)||null==o.getSDKInstance?void 0:o.getSDKInstance())?i:c.HardwareSDK}));return function(){return e.apply(this,arguments)}}(),u.prepareAccountByAddressIndex=function(e){throw new Error("Method not implemented.")},(0,o.default)(a)}(t(565147).KeyringBase)},810887:(e,r,t)=>{t.r(r),t.d(r,{KeyringHdBase:()=>h});var n=t(256666),o=t(634795),i=t(887371),a=t(545754),u=t(411987),c=t(695058),d=t(605851),s=t(940915);function l(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function f(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?l(Object(t),!0).forEach((function(r){(0,n.default)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function p(e){var r=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,n=(0,c.default)(e);if(r){var o=(0,c.default)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,u.default)(this,t)}}var h=function(e){(0,a.default)(t,e);var r=p(t);function t(){return r.apply(this,arguments)}var n=t.prototype;return n.getPrivateKeys=function(){var e=(0,o.default)((function*(e,r){var t=(yield this.getDbAccount()).path.split("/"),n=r||[t.pop()],o=t.join("/"),i=(yield this.engine.dbApi.getCredential(this.walletId,e)).seed;if("undefined"===typeof i)throw new s.OneKeyInternalError("Unable to get credential.");var a=(yield this.engine.providerManager.getChainInfoByNetworkId(this.networkId)).curve;return(0,d.batchGetPrivateKeys)(a,i,e,o,n).reduce((function(e,r){var t;return f(f({},e),{},((t={})[r.path]=r.extendedKey.key,t))}),{})}));return function(r,t){return e.apply(this,arguments)}}(),n.getAddress=function(){throw new Error("Method not implemented.")},n.batchGetAddress=function(){throw new Error("Method not implemented.")},n.prepareAccountByAddressIndex=function(e){throw new Error("Method not implemented.")},(0,i.default)(t)}(t(280306).KeyringSoftwareBase)},255942:(e,r,t)=>{t.r(r),t.d(r,{KeyringImportedBase:()=>s});var n=t(634795),o=t(887371),i=t(545754),a=t(411987),u=t(695058),c=t(940915);function d(e){var r=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,n=(0,u.default)(e);if(r){var o=(0,u.default)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,a.default)(this,t)}}var s=function(e){(0,i.default)(t,e);var r=d(t);function t(){return r.apply(this,arguments)}var a=t.prototype;return a.getPrivateKeys=function(){var e=(0,n.default)((function*(e,r){if("undefined"!==typeof r)throw new c.NotImplemented("Getting private keys from extended private key");var t=(yield this.engine.dbApi.getCredential(this.accountId,e)).privateKey;if("undefined"===typeof t)throw new c.OneKeyInternalError("Unable to get credential.");return{"":t}}));return function(r,t){return e.apply(this,arguments)}}(),a.getAddress=function(){throw new Error("Method not implemented.")},a.batchGetAddress=function(){throw new Error("Method not implemented.")},a.prepareAccountByAddressIndex=function(){throw new Error("Method not implemented.")},(0,o.default)(t)}(t(280306).KeyringSoftwareBase)},280306:(e,r,t)=>{t.r(r),t.d(r,{KeyringSoftwareBase:()=>y});var n=t(196234),o=t(256666),i=t(634795),a=t(887371),u=t(545754),c=t(411987),d=t(695058),s=t(292147),l=t(940915);function f(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function p(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?f(Object(t),!0).forEach((function(r){(0,o.default)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):f(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function h(e){var r=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,n=(0,d.default)(e);if(r){var o=(0,d.default)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,c.default)(this,t)}}var y=function(e){(0,u.default)(t,e);var r=h(t);function t(){return r.apply(this,arguments)}var o=t.prototype;return o.signTransaction=function(){var e=(0,i.default)((function*(e,r){var t=r.password;if("undefined"===typeof t)throw new l.OneKeyInternalError("Software signing requires a password.");var n=yield this.getSigners(t,e.inputs.map((function(e){return e.address})));return s.default.engine.info("signTransaction",this.networkId,e),p(p({},yield this.engine.providerManager.signTransaction(this.networkId,e,n)),{},{encodedTx:e.encodedTx})}));return function(r,t){return e.apply(this,arguments)}}(),o.signMessage=function(){var e=(0,i.default)((function*(e,r){var t=this,o=r.password;if("undefined"===typeof o)throw new l.OneKeyInternalError("Software signing requires a password.");var i=yield this.getDbAccount(),a=Object.values(yield this.getSigners(o,[i.address])),u=(0,n.default)(a,1)[0];return s.default.engine.info("signMessage",this.networkId,e),Promise.all(e.map((function(e){return t.engine.providerManager.signMessage(t.networkId,e,u)})))}));return function(r,t){return e.apply(this,arguments)}}(),o.getAddress=function(){throw new Error("Method not implemented.")},o.batchGetAddress=function(){throw new Error("Method not implemented.")},o.prepareAccountByAddressIndex=function(e){throw new Error("Method not implemented.")},(0,a.default)(t)}(t(565147).KeyringBase)},701625:(e,r,t)=>{t.r(r),t.d(r,{KeyringWatchingBase:()=>s});var n=t(634795),o=t(887371),i=t(545754),a=t(411987),u=t(695058),c=t(940915);function d(e){var r=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var t,n=(0,u.default)(e);if(r){var o=(0,u.default)(this).constructor;t=Reflect.construct(n,arguments,o)}else t=n.apply(this,arguments);return(0,a.default)(this,t)}}var s=function(e){(0,i.default)(t,e);var r=d(t);function t(){return r.apply(this,arguments)}var a=t.prototype;return a.signTransaction=function(){var e=(0,n.default)((function*(e,r){throw new c.OneKeyInternalError("signTransaction is not supported for watching accounts")}));return function(r,t){return e.apply(this,arguments)}}(),a.signMessage=function(){var e=(0,n.default)((function*(e,r){throw new c.OneKeyInternalError("signMessage is not supported for watching accounts")}));return function(r,t){return e.apply(this,arguments)}}(),a.getAddress=function(){throw new Error("Method not implemented.")},a.batchGetAddress=function(){throw new Error("Method not implemented.")},a.prepareAccountByAddressIndex=function(){throw new Error("Method not implemented.")},(0,o.default)(t)}(t(565147).KeyringBase)},153546:(e,r,t)=>{t.r(r),t.d(r,{convertDeviceError:()=>u});var n=t(703599),o=t(302478),i=t(292147);t(213208);function a(e,r){return"string"!==typeof r?null:e===n.HardwareErrorCode.DeviceInitializeFailed&&r.includes("ECONNABORTED")?new o.ConnectTimeoutError({message:r}):r.includes("Bridge network error")?new o.BridgeNetworkError({message:r}):null}function u(e){var r,t=e||{},u=t.code,c=t.error,d=t.message,s=null!=(r=null!=c?c:d)?r:"Unknown error";if(a(u,s))return a(u,s);switch(i.default.hardwareSDK.info("Device Utils Convert Device Error:",u,s),u){case n.HardwareErrorCode.UnknownError:return new o.UnknownHardwareError(e);case n.HardwareErrorCode.DeviceFwException:return new o.FirmwareVersionTooLow(e);case n.HardwareErrorCode.DeviceUnexpectedMode:return"string"===typeof s&&-1!==s.indexOf("ui-device_bootloader_mode")?new o.NotInBootLoaderMode(e):new o.UnknownHardwareError(e);case n.HardwareErrorCode.DeviceCheckDeviceIdError:return new o.DeviceNotSame(e);case n.HardwareErrorCode.DeviceNotFound:return new o.DeviceNotFind(e);case n.HardwareErrorCode.DeviceUnexpectedBootloaderMode:return new o.NotInBootLoaderMode(e);case n.HardwareErrorCode.DeviceInterruptedFromOutside:case n.HardwareErrorCode.DeviceInterruptedFromUser:return new o.UserCancelFromOutside(e);case n.HardwareErrorCode.DeviceNotSupportPassphrase:return new o.NotSupportPassphraseError(e);case n.HardwareErrorCode.IFrameLoadFail:return new o.InitIframeLoadFail(e);case n.HardwareErrorCode.IframeTimeout:return new o.InitIframeTimeout(e);case n.HardwareErrorCode.FirmwareUpdateDownloadFailed:return new o.FirmwareDownloadFailed(e);case n.HardwareErrorCode.FirmwareUpdateManuallyEnterBoot:return new o.FirmwareUpdateManuallyEnterBoot(e);case n.HardwareErrorCode.FirmwareUpdateAutoEnterBootFailure:return new o.FirmwareUpdateAutoEnterBootFailure(e);case n.HardwareErrorCode.FirmwareUpdateLimitOneDevice:return new o.FirmwareUpdateLimitOneDevice(e);case n.HardwareErrorCode.CallMethodNeedUpgradeFirmware:return new o.FirmwareVersionTooLow(e);case n.HardwareErrorCode.NewFirmwareUnRelease:return new o.NewFirmwareUnRelease(e);case n.HardwareErrorCode.NewFirmwareForceUpdate:return new o.NewFirmwareForceUpdate(e);case n.HardwareErrorCode.NetworkError:return new o.NetworkError(e);case n.HardwareErrorCode.BlePermissionError:return new o.NeedBluetoothTurnedOn(e);case n.HardwareErrorCode.BleLocationError:return new o.NeedBluetoothPermissions({message:s});case n.HardwareErrorCode.BleLocationServicesDisabled:return new o.BleLocationServiceError({message:s});case n.HardwareErrorCode.BleDeviceNotBonded:return new o.DeviceNotBonded(e);case n.HardwareErrorCode.BleDeviceBondError:return new o.DeviceBondError(e);case n.HardwareErrorCode.BleWriteCharacteristicError:return new o.BleWriteCharacteristicError(e);case n.HardwareErrorCode.BleScanError:return new o.BleScanError({message:s});case n.HardwareErrorCode.BleAlreadyConnected:return new o.BleAlreadyConnectedError(e);case n.HardwareErrorCode.RuntimeError:return-1!==s.indexOf("EIP712 blind sign is disabled")?new o.OpenBlindSign(e):-1!==s.indexOf("Unknown message")||-1!==s.indexOf("Failure_UnexpectedMessage")?new o.UnknownMethod(e):new o.UnknownHardwareError(e);case n.HardwareErrorCode.PinInvalid:return new o.InvalidPIN(e);case n.HardwareErrorCode.DeviceCheckPassphraseStateError:return new o.InvalidPassphrase(e);case n.HardwareErrorCode.DeviceOpenedPassphrase:return new o.DeviceOpenedPassphrase(e);case n.HardwareErrorCode.DeviceNotOpenedPassphrase:return new o.DeviceNotOpenedPassphrase(e);case n.HardwareErrorCode.PinCancelled:case n.HardwareErrorCode.ActionCancelled:return new o.UserCancel(e);case n.HardwareErrorCode.BridgeNotInstalled:case o.CustomOneKeyHardwareError.NeedOneKeyBridge:return new o.NeedOneKeyBridge(e);case n.HardwareErrorCode.BridgeNetworkError:return new o.BridgeNetworkError(e);case n.HardwareErrorCode.BridgeTimeoutError:return new o.BridgeTimeoutError(e);case n.HardwareErrorCode.PollingTimeout:return new o.ConnectTimeoutError(e);case n.HardwareErrorCode.PollingStop:return new o.ConnectPollingStopError(e);case n.HardwareErrorCode.BlindSignDisabled:return new o.OpenBlindSign(e);case n.HardwareErrorCode.FileAlreadyExists:return new o.FileAlreadyExistError(e);case n.HardwareErrorCode.CheckDownloadFileError:return new o.IncompleteFileError(e);case n.HardwareErrorCode.NotInSigningMode:return new o.NotInSigningModeError(e);case n.HardwareErrorCode.DataOverload:return new o.DeviceDataOverload(e);default:return new o.UnknownHardwareError(e)}}}}]);