"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[99352],{899352:(e,t,n)=>{n.r(t),n.d(t,{default:()=>fe});var r=n(539144),o=n(877531),i=n(795116),s=n(719392),l=n(470310),a=n(307061),c=n(634795),u=n(196234),d=n(202784),f=n(472719),p=n(783112),b=n(942013),g=n(945821),y=n(859071),m=n(380845),w=n(821919),h=n(427309),v=n(18861),k=n(712978),j=n(361301),O=n(256666),x=n(459740),P=n(866904),I=n(206391),S=n.n(I),N=n(253557),E=n(349658),_=n(588594),M=n(552322),C=["selectedNetworkId","gasInfo","isEIP1559Enabled"];function T(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function D(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?T(Object(n),!0).forEach((function(t){(0,O.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):T(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var B={marginTop:4,paddingLeft:"0px",paddingRight:"0px",paddingTop:"4px",paddingBottom:"4px",alignItems:"center",height:"48px",bgColor:"transparent"},F=["decorative-icon-three","text-warning","text-success"];function G(e){var t=e.index,n=e.price,r=e.feeInfo,o=(0,d.useMemo)((function(){var e,t;return r.isBtcForkChain?`${new(S())(n).shiftedBy(null!=(t=null==r?void 0:r.feeDecimals)?t:8).toFixed()}`:"string"===typeof n?n:null!=(e=n.gasPrice)?e:n.price}),[null==r?void 0:r.feeDecimals,r.isBtcForkChain,n]),i=(0,d.useMemo)((function(){return r.isBtcForkChain?"sat/vB":r.feeSymbol}),[r.feeSymbol,r.isBtcForkChain]);return(0,M.jsx)(P.default,{typography:"Body1Strong",color:F[t],children:`${null!=o?o:""} ${null!=i?i:""}`})}function L(e,t){return t?e:"object"===typeof e?null!=(n=e.gasPrice)?n:e.price:e;var n}function A(e){var t=e.selectedNetworkId,n=e.gasInfo,r=e.isEIP1559Enabled,o=(0,x.default)(e,C),a=(n||{}).prices,f=g.default.serviceGas,p=(0,d.useState)([]),m=(0,u.default)(p,2),w=m[0],O=m[1],P=(0,y.useNetworkSimple)(t),I=(null==P?void 0:P.settings.isFeeRateMode)||(null==P?void 0:P.settings.isBtcForkChain),T=(0,d.useMemo)((function(){var e;if(!a||!P)return[];var n=String(null!=(e=null==P?void 0:P.settings.minGasLimit)?e:21e3);n=I?h.btcMockLimit:n;var o={prices:a,defaultPresetIndex:"1",eip1559:r&&!I,limit:n,feeSymbol:P.feeSymbol,feeDecimals:P.feeDecimals,nativeDecimals:P.decimals,isBtcForkChain:I,feeList:I?a.map((function(e){return new(S())(e).times(n).shiftedBy(P.decimals).toNumber()})).filter(Boolean):[]};return a.map((function(e,i){return D({value:i.toString(),title:(0,M.jsx)(N.FeeSpeedLabel,{index:i,iconSize:28,space:3,prices:a,waitingSeconds:w[i],withSpeedTime:!0}),describe:(0,M.jsxs)(l.default,{space:"10px",alignItems:"center",children:[(0,M.jsxs)(j.default,{children:[(0,M.jsx)(G,{price:e,index:i,feeInfo:o}),(0,M.jsx)(_.SendEditFeeOverview,{accountId:"",networkId:t,price:L(e,r&&!I),feeInfo:o,limit:n,currencyProps:{typography:"Body2",textAlign:"right",color:"text-subdued"},formatOptions:{fixed:t===b.OnekeyNetwork.polygon?4:2},onlyCurrency:!0})]}),(0,M.jsx)(E.FeeSpeedTip,{index:i,isEIP1559:r&&!I,price:L(e,r&&!I),limit:n,feeInfo:o})]})},B)}))}),[I,r,P,a,t,w]);return(0,d.useEffect)((function(){var e=function(){var e=(0,c.default)((function*(){var e=yield f.getTxWaitingSeconds({networkId:t});O(e)}));return function(){return e.apply(this,arguments)}}();e()}),[t,f]),(0,M.jsx)(v.default,D(D({},o),{},{children:n?(0,M.jsx)(k.default,{mt:2,padding:"0px",items:T,name:"standard fee group"}):(0,M.jsx)(i.default,{w:"full",py:16,children:(0,M.jsx)(s.default,{size:"lg"})})}))}var R,z=n(879425),$=["gasInfo","selectedNetworkId","isEIP1559Enabled"];function U(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function V(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?U(Object(n),!0).forEach((function(t){(0,O.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):U(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}!function(e){e.low="low",e.stable="stable",e.busy="busy"}(R||(R={}));var W=["\ud83c\udf43","\u2615\ufe0f","\ud83d\udd25"];function q(e){return e<z.NetworkCongestionThresholds.stable?R.low:e>=z.NetworkCongestionThresholds.stable&&e<z.NetworkCongestionThresholds.busy?R.stable:R.busy}function H(e){var t,n,r=e.gasInfo,o=e.selectedNetworkId,i=e.isEIP1559Enabled,s=(0,x.default)(e,$),a=r||{},c=a.estimatedTransactionCount,u=a.networkCongestion,d=a.prices,f=(0,p.default)(),b=(0,y.useNetworkSimple)(o);if(!r)return null;if(void 0===u&&void 0===c)return null;var g=null==d?void 0:d[0],m=R.stable;u?m=q(u):c&&(m=function(e){var t=e.estimatedTransactionCount,n=e.networkId;return t<h.networkPendingTransactionThresholds[n].stable?R.low:t>=h.networkPendingTransactionThresholds[n].stable&&t<h.networkPendingTransactionThresholds[n].busy?R.stable:R.busy}({estimatedTransactionCount:c,networkId:o}));var w=function(e){switch(e){case R.low:return{label:W[0]};case R.stable:return{label:W[1]};case R.busy:return{label:W[2]};default:return{label:W[1]}}}(m);return(0,M.jsxs)(v.default,V(V({},s),{},{children:[(0,M.jsx)(P.default,{fontSize:56,textAlign:"center",children:w.label}),(0,M.jsx)(P.default,{typography:"DisplayMedium",textAlign:"center",children:f.formatMessage({id:"title__current_gas_fee"})}),i?(0,M.jsx)(l.default,{alignItems:"center",mt:1,justifyContent:"center",children:(0,M.jsx)(P.default,{color:"text-subdued",children:`${f.formatMessage({id:"form__base_fee"})}: ${new(S())(null!=(t=null==g?void 0:g.baseFee)?t:0).toFixed(2)} ${null!=(n=null==b?void 0:b.feeSymbol)?n:""}`})}):(0,M.jsx)(P.default,{typography:"Body2",mt:1,color:"text-subdued",textAlign:"center",children:f.formatMessage({id:"title__current_gas_fee_desc"},{0:(null==b?void 0:b.symbol)||""})})]}))}var J=n(785192),K=["leftSeconds","setLeftSeconds","fetchGasInfo"];function Q(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function X(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Q(Object(n),!0).forEach((function(t){(0,O.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Q(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Y=null,Z=function(e){return(0,M.jsx)(P.default,{color:"text-success",children:e})};function ee(e){var t=e.leftSeconds,n=e.setLeftSeconds,r=e.fetchGasInfo,o=(0,x.default)(e,K),i=(0,p.default)();return(0,d.useEffect)((function(){return 6===t&&Y&&clearTimeout(Y),Y=setInterval((function(){var e=t-1;e<0&&(e=0,r()),n(e)}),1e3),function(){Y&&clearTimeout(Y)}}),[r,t,n]),(0,M.jsxs)(v.default,X(X({},o),{},{children:[(0,M.jsx)(J.default,{}),(0,M.jsx)(P.default,{color:"text-subdued",textAlign:"center",mt:4,children:i.formatMessage({id:"content__gas_fee_will_automatically_update_after_str"},{0:i.formatMessage({id:"content__str_seconds_plural"},{0:t}),a:Z})})]}))}var te=n(284405),ne=n(561220),re=n(435581),oe=n(737790);function ie(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function se(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ie(Object(n),!0).forEach((function(t){(0,O.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ie(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function le(e){var t=e.selectedNetworkId,n=e.setSelectedNetworkId,r=(0,y.useManageNetworks)(void 0).allNetworks,o=(0,d.useMemo)((function(){return r.filter((function(e){return h.supportedNetworks.includes(e.id)}))}),[r]),i=(0,y.useNetworkSimple)(t),s=(0,d.useMemo)((function(){return{label:null==i?void 0:i.name,value:null==i?void 0:i.id,tokenProps:{token:{logoURI:null==i?void 0:i.logoURI,name:null==i?void 0:i.shortName}},badge:"evm"===(null==i?void 0:i.impl)?"EVM":void 0}}),[null==i?void 0:i.id,null==i?void 0:i.impl,null==i?void 0:i.logoURI,null==i?void 0:i.name,null==i?void 0:i.shortName]);return(0,M.jsx)(te.default,{w:"190",trigger:function(e){return(0,M.jsx)(ne.default,se(se({accessibilityLabel:"More options menu"},e),{},{children:(0,M.jsxs)(l.default,{alignItems:"center",space:3,children:[(0,M.jsx)(oe.default,se({size:6},s.tokenProps)),(0,M.jsx)(P.default,{typography:"Body1",children:null==i?void 0:i.name}),(0,M.jsx)(re.default,{size:20,name:"ChevronDownMini",color:"icon-subdued"})]})}))},children:o.map((function(e){return(0,M.jsx)(te.default.Item,{onPress:function(){return n(e.id)},children:(0,M.jsxs)(l.default,{space:4,alignItems:"center",children:[(0,M.jsx)(v.default,{width:"20px",children:t===e.id&&(0,M.jsx)(re.default,{name:"CheckMini",size:20,color:"interactive-default"})}),(0,M.jsx)(P.default,{typography:"Body1",children:e.name})]})},e.id)}))})}var ae=b.OnekeyNetwork.eth;var ce=n(733456),ue=(0,n(324665).default)(),de=[{name:ce.GasPanelRoutes.GasPanelModal,component:function(){var e,t=(0,p.default)(),n=(0,f.useRoute)(),r=(0,d.useRef)(""),b=n.params.networkId,v=void 0===b?"":b,k=(0,m.appSelector)((function(e){return e.settings})).selectedFiatMoneySymbol,j=(0,d.useState)(h.supportedNetworks.includes(v)?v:ae),O=(0,u.default)(j,2),x=O[0],P=O[1],I=(0,d.useState)(!1),S=(0,u.default)(I,2),N=S[0],E=S[1],_=(0,d.useState)(null),C=(0,u.default)(_,2),T=C[0],D=C[1],B=(0,d.useState)(6),F=(0,u.default)(B,2),G=F[0],L=F[1],R=(0,y.useSettings)(),z=(0,y.useNativeToken)(x),$=g.default.serviceGas,U=(0,d.useMemo)((function(){return!(!T||!T.prices[0])&&("object"===typeof T.prices[0]&&"maxFeePerGas"in T.prices[0]&&"maxPriorityFeePerGas"in T.prices[0])}),[T]),V=null==(e=null==R?void 0:R.gasPanelEIP1559Enabled)||e,W=(0,d.useCallback)((function(e){g.default.dispatch((0,w.setGasPanelEIP1559Enabled)(e))}),[]),q=(0,d.useCallback)((0,c.default)((function*(){var e=Math.random().toString();r.current=e;var t=yield $.getGasInfo({networkId:x});5===t.prices.length&&(t.prices=[t.prices[0],t.prices[2],t.prices[4]]),e===r.current&&(D(t),E(!0),L(6))})),[x,$]);return(0,d.useEffect)((function(){D(null),q()}),[q,x,$]),(0,d.useEffect)((function(){v&&h.supportedNetworks.includes(v)&&P(v)}),[v]),(0,d.useEffect)((function(){var e;g.default.servicePrice.fetchSimpleTokenPrice({networkId:x,tokenIds:[null!=(e=null==z?void 0:z.tokenIdOnNetwork)?e:""],vsCurrency:k})}),[v,k,x,null==z?void 0:z.tokenIdOnNetwork]),(0,M.jsx)(o.default,{header:t.formatMessage({id:"content__gas_fee"}),height:"560px",hideSecondaryAction:!0,onPrimaryActionPress:function(e){return(0,e.close)()},primaryActionProps:{type:"primary"},primaryActionTranslationId:"action__i_got_it",scrollViewProps:{children:N?(0,M.jsxs)(M.Fragment,{children:[(0,M.jsxs)(l.default,{justifyContent:"space-between",alignItems:"center",children:[(0,M.jsx)(le,{selectedNetworkId:x,setSelectedNetworkId:P}),U&&h.supportedNetworksSettings[x].EIP1559Enabled?(0,M.jsx)(a.default,{onToggle:function(){W(!V)},isChecked:V,label:"EIP 1559",size:"mini"}):null]}),h.supportedNetworksSettings[x].supportOverview?(0,M.jsx)(H,{mt:8,gasInfo:T,isEIP1559Enabled:V,selectedNetworkId:x}):null,(0,M.jsx)(A,{mt:6,gasInfo:T,isEIP1559Enabled:V,selectedNetworkId:x}),T?(0,M.jsx)(ee,{mt:12,leftSeconds:G,setLeftSeconds:L,fetchGasInfo:q}):null]}):(0,M.jsx)(i.default,{w:"full",py:10,children:(0,M.jsx)(s.default,{size:"lg"})})}})}}];const fe=function(){var e=(0,r.default)();return(0,M.jsx)(ue.Navigator,{screenOptions:{headerShown:!1,animationEnabled:!!e},children:de.map((function(e){return(0,M.jsx)(ue.Screen,{name:e.name,component:e.component},e.name)}))})}},427309:(e,t,n)=>{n.r(t),n.d(t,{btcMockLimit:()=>d,networkPendingTransactionThresholds:()=>u,priceUnit:()=>a,supportedNetworks:()=>l,supportedNetworksSettings:()=>c});var r,o,i,s=n(942013),l=[s.OnekeyNetwork.btc,s.OnekeyNetwork.eth,s.OnekeyNetwork.polygon],a=((r={})[s.OnekeyNetwork.btc]="sat/vB",r[s.OnekeyNetwork.eth]="Gwei",r[s.OnekeyNetwork.polygon]="Gwei",r),c=((o={})[s.OnekeyNetwork.btc]={supportOverview:!1,EIP1559Enabled:!1},o[s.OnekeyNetwork.eth]={supportOverview:!0,EIP1559Enabled:!0},o[s.OnekeyNetwork.polygon]={supportOverview:!0,EIP1559Enabled:!0},o),u=((i={})[s.OnekeyNetwork.eth]={low:0,stable:100,busy:200},i[s.OnekeyNetwork.polygon]={low:0,stable:200,busy:300},i),d="340"},733456:(e,t,n)=>{var r;n.r(t),n.d(t,{GasPanelRoutes:()=>r}),function(e){e.GasPanelModal="GasPanelModal"}(r||(r={}))}}]);