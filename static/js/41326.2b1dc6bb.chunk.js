"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[41326],{741326:(e,t,a)=>{a.r(t),a.d(t,{default:()=>Z});var n=a(539144),r=a(669083),s=a(202784),d=a(472719),o=a(783112),i=a(945821),u=a(747225),l=a(984495),c=a(256666),f=a(877531),m=a(18861),p=a(566147),h=a(634795),g=a(921311),v=a(459740),b=a(79722),_=a(942013),x=a(265999),y=a(324639),w=a(859071),j=a(552322),k=["defaultValues","header","showAlert","onSubmit","editing"];function C(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}const A=function(e){var t=e.defaultValues,a=e.header,r=(e.showAlert,e.onSubmit),d=e.editing,u=(0,v.default)(e,k),l=(0,o.default)(),A=(0,s.useRef)(),S=(0,w.useAppSelector)((function(e){return e.contacts.contacts})),M=(0,s.useMemo)((function(){return new Map(Object.values(S).map((function(e){return[e.address.toLowerCase(),e]})))}),[S]),P=(0,g.default)({defaultValues:t,mode:"onChange"}),I=P.control,O=P.handleSubmit,R=P.setValue,B=P.watch,N=P.trigger,T=P.formState.isValid,E=B("name"),D=B("address"),V=B("networkId"),L=(0,n.default)(),q=(0,b.useNameServiceStatus)(),U=q.onChange,H=q.disableSubmitBtn,F=q.address,z=q.name,W=(0,w.useDebounce)(D,300),$=F||W;(0,s.useEffect)((function(){function e(){return(e=(0,h.default)((function*(){if($&&V)try{yield i.default.validator.validateAddress(V,$.trim()),A.current=!1,N("address")}catch(e){A.current=!0,N("address")}}))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[$,V,N,l]),(0,s.useEffect)((function(){E.length>24&&R("name",E.slice(0,24)),z&&!E&&R("name",z)}),[E,R,z]),(0,s.useEffect)((function(){D.length>103&&R("address",D.slice(0,103))}),[D,R]);var G=(0,s.useCallback)((function(e){U(e),N("address")}),[N,U]),J=(0,s.useCallback)((function(e){return(0,j.jsx)(b.default,{name:e,onChange:G,disableBTC:!1,networkId:V})}),[G,V]);return(0,j.jsx)(f.default,function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?C(Object(a),!0).forEach((function(t){(0,c.default)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):C(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({header:a,hideSecondaryAction:!0,primaryActionProps:{isDisabled:!T||H,onPress:function(){return O((function(e){return!H&&F&&(e.address=F),r(e)}))()}},scrollViewProps:{children:(0,j.jsx)(m.default,{w:"full",h:"full",children:(0,j.jsxs)(p.default,{children:[(0,j.jsx)(y.default,{hideHelpText:!0,control:I,name:"networkId",disabledNetworkIds:[_.OnekeyNetwork.lightning]}),(0,j.jsx)(p.default.Item,{control:I,name:"name",label:l.formatMessage({id:"form__contact_name"}),rules:{required:{value:!0,message:l.formatMessage({id:"form__field_is_required"})}},children:(0,j.jsx)(p.default.Input,{size:L?"xl":"default"})}),(0,j.jsx)(p.default.Item,{control:I,name:"address",label:l.formatMessage({id:"form__address"}),helpText:J,rules:{required:{value:!0,message:l.formatMessage({id:"form__field_is_required"})},validate:function(e){var a=(null==F?void 0:F.toLowerCase())||(null==e?void 0:e.toLowerCase()),n=t.address.toLowerCase();if(a)return!d&&M.get(a)||d&&M.get(a)&&a!==n?l.formatMessage({id:"msg__this_address_already_exists"}):A.current?l.formatMessage({id:"form__address_invalid"}):void 0}},children:(0,j.jsx)(x.default,{})})]})})}},u))};const S=function(){var e=(0,o.default)(),t=(0,d.useNavigation)(),a=(0,d.useRoute)(),n=(0,u.useNetworks)(),c=a.params,f=c.defaultValues,m=c.uuid,p=(0,s.useCallback)((function(a){var s=n.find((function(e){return e.id===a.networkId}));s&&(i.default.dispatch((0,l.update)({uuid:m,contact:{name:a.name,address:a.address,badge:s.impl,networkId:s.id}})),i.default.serviceCloudBackup.requestBackup(),r.default.show({title:e.formatMessage({id:"msg__address_changed"})}),t.goBack())}),[n,t,m,e]);return(0,j.jsx)(A,{defaultValues:{address:f.address,name:f.name,networkId:f.networkId},onSubmit:p,header:e.formatMessage({id:"title__edit_address"}),primaryActionTranslationId:"action__save",editing:!0})};const M=function(){var e,t=(0,o.default)(),a=(0,d.useNavigation)(),n=null!=(e=(0,d.useRoute)().params)?e:{},u=n.onSelected,l=n.networkId,c=n.defaultAddress,m=(0,g.default)({defaultValues:{address:null!=c?c:""},mode:"onChange"}),v=m.control,b=m.watch,_=m.trigger,y=m.setError,k=m.setValue,C=m.handleSubmit,A=m.formState.isValid,S=(0,w.useDebounce)(b("address"),300);(0,s.useEffect)((function(){function e(){return(e=(0,h.default)((function*(){if(S&&l)try{yield i.default.validator.validateAddress(l,S.trim()),_("address")}catch(e){y("address",{message:t.formatMessage({id:"form__address_invalid"})})}}))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[S,l,_,y,t]);var M=(0,s.useCallback)(function(){var e=(0,h.default)((function*(e){if(l)try{yield i.default.validator.validateAddress(l,e.address.trim())}catch(n){return void r.default.show({title:t.formatMessage({id:"form__address_invalid"})})}null==u||u({address:e.address.trim(),name:e.name}),a.goBack()}));return function(t){return e.apply(this,arguments)}}(),[a,u,t,l]);return(0,j.jsx)(f.default,{header:t.formatMessage({id:"form__enter_address"}),hideSecondaryAction:!0,primaryActionTranslationId:"action__confirm",primaryActionProps:{isDisabled:!A,onPress:function(){return C(M)()}},children:(0,j.jsx)(p.default.Item,{control:v,name:"address",rules:{required:{value:!0,message:t.formatMessage({id:"form__field_is_required"})}},children:(0,j.jsx)(x.default,{networkId:l,onChangeAddressName:function(e){return k("name",e)},plugins:["contact","paste","scan"]})})})};var P=a(816829);const I=function(){var e=(0,o.default)(),t=(0,d.useNavigation)(),a=((0,d.useRoute)().params||{}).address,n=void 0===a?"":a,c=(0,u.useNetworks)(),f=(0,s.useCallback)(function(){var a=(0,h.default)((function*(a){var n=c.find((function(e){return e.id===a.networkId}));if(a.networkId)try{yield i.default.validator.validateAddress(a.networkId,a.address)}catch(s){return void r.default.show({title:e.formatMessage({id:"form__address_invalid"})})}n&&(i.default.dispatch((0,l.create)({name:a.name,address:a.address,badge:n.impl,networkId:n.id})),i.default.serviceCloudBackup.requestBackup(),r.default.show({title:e.formatMessage({id:"msg__address_added"})},{}),t.goBack())}));return function(e){return a.apply(this,arguments)}}(),[c,t,e]);return(0,j.jsx)(A,{defaultValues:{address:n,name:""},onSubmit:f,header:e.formatMessage({id:"action__add_new_address"}),showAlert:!0,primaryActionTranslationId:"action__add"})};var O=a(231846),R=a(465022),B=a(968079),N=a(25655),T=a(795116),E=a(510374),D=a(561220),V=a(854787),L=a(10918),q=a(196234),U=a(785192),H=a(626015),F=a(432986),z=a(814817),W=a(559656),$=a(903730),G=function(){return(0,j.jsx)(m.default,{mx:{base:4,md:6},children:(0,j.jsx)(U.default,{})})},J=function(e){var t,a=e.addressFilter,n=(0,o.default)(),r=(0,d.useNavigation)(),i=null!=(t=(0,d.useRoute)().params)?t:{},u=i.networkId,l=i.onSelected,c=(0,w.useAppSelector)((function(e){return e.contacts.contacts})),f=(0,s.useState)([]),p=(0,q.default)(f,2),g=p[0],v=p[1],b=(0,s.useCallback)(function(){var e=(0,h.default)((function*(e){if(a){var t=e.map(function(){var e=(0,h.default)((function*(e){return{value:e,isVaild:yield a(e.address)}}));return function(t){return e.apply(this,arguments)}}());return(yield Promise.all(t)).filter((function(e){return e.isVaild})).map((function(e){return e.value}))}return Promise.resolve(e)}));return function(t){return e.apply(this,arguments)}}(),[a]);(0,s.useEffect)((function(){function e(){return(e=(0,h.default)((function*(){var e=Object.values(c);if(e=e.sort((function(e,t){return e.createAt,t.createAt,-1})),u){var t=u.split("--")[0];e=e.filter((function(e){return e.badge.toUpperCase()===t.toUpperCase()}))}(e=yield b(e))&&e.length>0&&v(e)}))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[c,b,u]);var _=(0,s.useCallback)((function(e){null==l||l({address:e.address,name:e.name}),r.goBack()}),[l,r]),x=(0,s.useCallback)((function(e){var t=e.item,a=e.index;return(0,j.jsxs)(D.default,{py:"4",px:"4",mx:{base:4,md:6},flexDirection:"row",alignItems:"center",bg:"surface-default",borderTopRadius:0===a?"12":void 0,borderBottomRadius:a===g.length-1?"12":void 0,onPress:function(){return _(t)},children:[(0,j.jsx)(m.default,{w:"8",h:"8",borderRadius:"full",bg:"decorative-surface-one",justifyContent:"center",alignItems:"center",children:(0,j.jsx)(L.default.DisplaySmall,{color:"decorative-icon-one",children:t.name.toUpperCase()[0]})}),(0,j.jsxs)(m.default,{flex:"1",ml:"4",children:[(0,j.jsxs)(m.default,{flexDirection:"row",children:[(0,j.jsx)(L.default.Body1Strong,{mr:"2",numberOfLines:1,maxWidth:"80%",children:t.name}),(0,j.jsx)(V.default,{size:"sm",title:t.badge.toUpperCase()})]}),(0,j.jsx)(m.default,{children:(0,j.jsx)(L.default.Body2,{color:"text-subdued",numberOfLines:2,children:t.address})})]})]})}),[g,_]),y=(0,s.useMemo)((function(){return(0,j.jsx)(T.default,{w:"full",h:"full",children:(0,j.jsx)(E.default,{title:n.formatMessage({id:"title__no_cantact"}),subTitle:n.formatMessage({id:"title__no_cantact_desc"}),emoji:"\ud83d\udcc7"})})}),[n]);return(0,j.jsx)(N.default,{ListEmptyComponent:y,data:g,ItemSeparatorComponent:G,renderItem:x,keyExtractor:function(e){return e.address}})},K=function(e){var t,a=e.addressFilter,n=e.walletsToHide,r=(0,o.default)(),l=(0,u.useRuntime)().wallets,c=(0,d.useNavigation)(),f=null!=(t=(0,d.useRoute)().params)?t:{},p=f.networkId,g=f.onSelected,v=(0,s.useState)([]),b=(0,q.default)(v,2),_=b[0],x=b[1],y=(0,s.useCallback)(function(){var e=(0,h.default)((function*(e){if(a){var t=e.map(function(){var e=(0,h.default)((function*(e){return{value:e,isVaild:yield a(e.address)}}));return function(t){return e.apply(this,arguments)}}());return(yield Promise.all(t)).filter((function(e){return e.isVaild})).map((function(e){return e.value}))}return Promise.resolve(e)}));return function(t){return e.apply(this,arguments)}}(),[a]);(0,s.useEffect)((function(){function e(){return(e=(0,h.default)((function*(){for(var e=function*(){var e=l[t];if(null==n||!n.includes(e.type)){var a=yield i.default.engine.getAccounts(e.accounts,p);(a=yield y(a))&&a.length>0&&x((function(t){return[].concat((0,B.default)(t),[{wallet:e,data:a,key:e.id}])}))}},t=0;t<l.length;t+=1)yield*e()}))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[y]);var w=(0,s.useCallback)((function(e){null==g||g({address:e.address,name:e.name}),c.goBack()}),[g,c]),k=(0,s.useCallback)((function(e){return"external"===e.type?r.formatMessage({id:"content__external_account"}):"imported"===e.type?r.formatMessage({id:"wallet__imported_accounts"}):"watching"===e.type?r.formatMessage({id:"wallet__watched_accounts"}):e.name}),[r]);return(0,j.jsx)(R.SectionList,{stickySectionHeadersEnabled:!1,sections:_,contentContainerStyle:{flexGrow:1},keyExtractor:function(e,t){return`${e.address}${t}`},renderItem:function(e){var t=e.item,a=e.section,n=e.index;return(0,j.jsxs)(D.default,{flexDirection:"row",p:"4",bg:"surface-default",mx:{base:4,md:6},borderTopLeftRadius:0===n?"12":void 0,borderTopRightRadius:0===n?"12":void 0,borderBottomLeftRadius:n===a.data.length-1?"12":void 0,borderBottomRightRadius:n===a.data.length-1?"12":void 0,onPress:function(){return w({address:t.address,name:t.name})},alignItems:"center",children:[(0,j.jsx)(m.default,{mr:"3",children:(0,j.jsx)(W.default,{avatar:a.wallet.avatar,walletImage:a.wallet.type,hwWalletType:a.wallet.deviceType||(0,F.getDeviceTypeByDeviceId)(a.wallet.associatedDevice),isPassphrase:(0,z.isPassphraseWallet)(a.wallet),size:"sm"})},t.address),(0,j.jsxs)(m.default,{flex:"1",children:[(0,j.jsx)(L.default.Body1Strong,{color:"text-default",numberOfLines:1,children:t.name}),(0,j.jsx)(L.default.Body2,{color:"text-subdued",children:(0,H.shortenAddress)(t.address)})]})]})},ItemSeparatorComponent:G,renderSectionHeader:function(e){var t=e.section;return(0,j.jsx)(L.default.Subheading,{my:"2",mx:{base:4,md:6},children:k(t.wallet)})}})};const Q=function(){var e,t=(0,o.default)(),a=null!=(e=(0,d.useRoute)().params)?e:{},n=a.addressFilter,r=a.contactExcludeWalletAccount,i=a.walletsToHide,u=(0,s.useState)(0),l=(0,q.default)(u,2),c=l[0],p=l[1],h=(0,d.useNavigation)(),g=(0,s.useCallback)((function(){h.navigate($.AddressBookRoutes.NewAddressRoute)}),[h]),v=(0,s.useMemo)((function(){return(0,j.jsx)(K,{addressFilter:n,walletsToHide:i})}),[n,i]),b=(0,s.useMemo)((function(){return(0,j.jsx)(J,{addressFilter:n})}),[n]);return(0,j.jsxs)(f.default,{header:t.formatMessage({id:"title__select_contact"}),hideSecondaryAction:!0,footer:0===c?void 0:null,primaryActionTranslationId:"action__add_new_address",primaryActionProps:{leftIconName:"PlusMini",type:"basic",onPress:g},maxHeight:"560px",hidePrimaryAction:0!==c,staticChildrenProps:{flex:1,py:6},children:[(0,j.jsx)(m.default,{mb:"6",px:{base:4,md:6},children:r?null:(0,j.jsx)(O.default,{values:[t.formatMessage({id:"title__address_book"}),t.formatMessage({id:"form__my_wallet"})],selectedIndex:c,onChange:p})}),(0,j.jsx)(m.default,{flex:"1",children:0===c?b:v})]})};var X=(0,a(324665).default)(),Y=[{name:$.AddressBookRoutes.NewAddressRoute,component:I},{name:$.AddressBookRoutes.PickAddressRoute,component:Q},{name:$.AddressBookRoutes.EditAddressRoute,component:S},{name:$.AddressBookRoutes.EnterAddressRoute,component:M},{name:$.AddressBookRoutes.NewPickAddressRoute,component:P.default}];const Z=function(){var e=(0,n.default)();return(0,j.jsx)(X.Navigator,{screenOptions:{headerShown:!1,animationEnabled:!!e},children:Y.map((function(e){return(0,j.jsx)(X.Screen,{name:e.name,component:e.component},e.name)}))})}},816829:(e,t,a)=>{a.r(t),a.d(t,{default:()=>B,useAddressBook:()=>R});var n=a(877531),r=a(505240),s=a(795116),d=a(510374),o=a(433996),i=a(854787),u=a(107867),l=a(18861),c=a(10918),f=a(669083),m=a(311631),p=a(202784),h=a(472719),g=a(783112),v=a(119804),b=a(292147),_=a(859071),x=a(481047),y=a(903730),w=a(256666),j=a(459740),k=a(945821),C=a(984495),A=a(331639),S=a(552322),M=["contact"];function P(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}const I=function(e){var t=e.contact,a=(0,j.default)(e,M),n=(0,g.default)(),r=t.name,s=t.address,d=t.networkId,o=t.id,i=(0,h.useNavigation)(),u=(0,p.useCallback)((function(){i.navigate(x.RootRoutes.Modal,{screen:x.ModalRoutes.AddressBook,params:{screen:y.AddressBookRoutes.EditAddressRoute,params:{uuid:o,defaultValues:{name:r,address:s,networkId:d}}}})}),[i,r,s,d,o]),l=(0,p.useCallback)((function(){setTimeout((function(){(0,v.copyToClipboard)(s),f.default.show({title:n.formatMessage({id:"msg__address_copied"})})}),200)}),[n,s]),c=(0,p.useCallback)((function(){k.default.dispatch((0,C.remove)({uuid:o})),f.default.show({title:n.formatMessage({id:"msg__address_deleted"})})}),[o,n]),m=(0,p.useMemo)((function(){return[{id:"action__edit",onPress:u,icon:"PencilMini"},{id:"action__copy_address",onPress:l,icon:"Square2StackOutline"},{id:"action__delete",onPress:c,icon:"TrashMini",variant:"desctructive"}]}),[l,c,u]);return(0,S.jsx)(A.default,function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?P(Object(a),!0).forEach((function(t){(0,w.default)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):P(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({w:190,options:m},a))};var O=function(e){var t=e.networkId,a=e.onNew,n=e.onSelected,x=(0,g.default)(),y=(0,_.useAppSelector)((function(e){return e.contacts.contacts})),w=(0,m.useSafeAreaInsets)().bottom,j=(0,p.useMemo)((function(){var e=Object.values(y);if(e=e.sort((function(e,t){return e.createAt,t.createAt,-1})),b.default.common.info("contacts length is ",Object.keys(e).length),t){b.default.common.info("address list filter by networkId",t);var a=t.split("--")[0];a&&(e=e.filter((function(e){return e.badge.toUpperCase()===a.toUpperCase()})))}return e}),[y,t]),k=(0,p.useCallback)((function(e){(0,v.copyToClipboard)(e),f.default.show({title:x.formatMessage({id:"msg__address_copied"})})}),[x]),C=(0,h.useNavigation)(),A=(0,p.useCallback)((function(e){n&&(null==n||n({address:e.address,name:e.name}),C.goBack())}),[n,C]),M=(0,p.useCallback)((function(e){var t=e.item,a=t.name,n=t.badge,r=t.address;return(0,S.jsxs)(u.default,{onLongPress:function(){k(r)},onPress:function(){return A(t)},children:[(0,S.jsx)(u.default.Column,{children:(0,S.jsx)(l.default,{w:"40px",h:"40px",borderRadius:"full",bg:"decorative-surface-one",justifyContent:"center",alignItems:"center",children:(0,S.jsx)(c.default.Body2,{color:"decorative-icon-one",children:a.toUpperCase()[0]})})}),(0,S.jsx)(u.default.Column,{flex:1,text:{label:(0,S.jsxs)(l.default,{flexDirection:"row",alignItems:"center",children:[(0,S.jsx)(c.default.Body1Strong,{mr:"8px",isTruncated:!0,children:a}),(0,S.jsx)(i.default,{size:"sm",title:n.toUpperCase()})]}),description:(0,S.jsx)(c.default.Body2,{color:"text-subdued",children:r})}}),(0,S.jsx)(u.default.Column,{children:(0,S.jsx)(I,{contact:t,children:(0,S.jsx)(o.default,{name:"EllipsisVerticalMini",circle:!0,type:"plain"})})})]})}),[k,A]);return 0===j.length?(0,S.jsx)(s.default,{w:"full",h:"full",children:(0,S.jsx)(d.default,{title:x.formatMessage({id:"title__no_cantact"}),subTitle:x.formatMessage({id:"title__no_cantact_desc"}),actionTitle:x.formatMessage({id:"action__add_new_address"}),actionProps:{leftIconName:"PlusMini"},handleAction:a,emoji:"\ud83d\udcc7"})}):(0,S.jsx)(r.default,{data:j,renderItem:M,keyExtractor:function(e){return String(e.id)},ListFooterComponent:w>0?(0,S.jsx)(l.default,{h:`${w}px`}):null})};function R(){var e=(0,h.useNavigation)();return{showAddressBookModal:(0,p.useCallback)((function(t){e.navigate(x.RootRoutes.Modal,{screen:x.ModalRoutes.AddressBook,params:{screen:y.AddressBookRoutes.NewPickAddressRoute,params:t}})}),[e])}}const B=function(){var e,t=(0,g.default)(),a=null!=(e=(0,h.useRoute)().params)?e:{},r=a.networkId,s=a.onSelected,d=(0,h.useNavigation)(),i=(0,p.useCallback)((function(){d.navigate(y.AddressBookRoutes.NewAddressRoute)}),[d]);return(0,S.jsx)(n.default,{rightContent:(0,S.jsx)(o.default,{onPress:i,name:"PlusCircleOutline",type:"plain",size:"lg",circle:!0}),header:t.formatMessage({id:"title__contacts"}),hideSecondaryAction:!0,footer:null,height:"480px",children:(0,S.jsx)(O,{networkId:r,onSelected:s,onNew:i})})}}}]);