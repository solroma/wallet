"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[11121],{786141:(e,t,r)=>{r.r(t),r.d(t,{VaultBase:()=>k,VaultBaseChainOnly:()=>C});var n=r(72579),o=r.n(n),i=r(256666),a=r(301842),u=r.n(a),s=r(634795),c=r(887371),d=r(545754),l=r(411987),f=r(695058),p=r(206391),y=r.n(p),h=r(636393),v=r(613549),w=r(292147),g=r(213208),m=r(992431),I=r(940915),T=r(278489),x=r(969618),b=r(398514),A=r(114540),E=r(348834).Buffer;function O(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function P(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?O(Object(r),!0).forEach((function(t){(0,i.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):O(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function S(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,f.default)(e);if(t){var o=(0,f.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,l.default)(this,r)}}if(g.default.isExtensionUi)throw new Error("engine/VaultBase is not allowed imported from ui");var C=function(e){(0,d.default)(r,e);var t=S(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.initProvider=function(){var e=(0,s.default)((function*(){var e=(yield this.getNetwork()).impl;u()(x.IMPL_MAPPINGS[e])||(this.engineProvider=yield this.engine.providerManager.getProvider(this.networkId))}));return function(){return e.apply(this,arguments)}}(),n.proxyJsonRPCCall=function(){var e=(0,s.default)((function*(e){throw new I.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.createClientFromURL=function(e){throw new I.NotImplemented},n.getEthersProvider=function(){var e=(0,s.default)((function*(){throw new I.NotImplemented}));return function(){return e.apply(this,arguments)}}(),n.getClientEndpointStatus=function(){var e=(0,s.default)((function*(e){var t=this.createClientFromURL(e),r=performance.now(),n=(yield t.getInfo()).bestBlockNumber;return{responseTime:Math.floor(performance.now()-r),latestBlock:n}}));return function(t){return e.apply(this,arguments)}}(),n.checkRpcBatchSupport=function(){var e=(0,s.default)((function*(e){throw new I.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.getDisplayAddress=function(){var e=(0,s.default)((function*(e){return Promise.resolve(e)}));return function(t){return e.apply(this,arguments)}}(),n.validateAddress=function(){var e=(0,s.default)((function*(e){var t=yield this.engineProvider.verifyAddress(e),r=t.normalizedAddress;if(!t.isValid||!r)throw new I.InvalidAddress;return Promise.resolve(r)}));return function(t){return e.apply(this,arguments)}}(),n.validateImportedCredential=function(e){return Promise.resolve(this.settings.importedAccountEnabled&&/^(0x)?[0-9a-zA-Z]{64}$/.test(e))},n.validateWatchingCredential=function(){var e=(0,s.default)((function*(e){return Promise.resolve(this.settings.watchingAccountEnabled&&(yield this.engineProvider.verifyAddress(e)).isValid)}));return function(t){return e.apply(this,arguments)}}(),n.validateTokenAddress=function(){var e=(0,s.default)((function*(e){var t=yield this.engineProvider.verifyTokenAddress(e),r=t.normalizedAddress;if(!t.isValid||"undefined"===typeof r)throw new I.InvalidTokenAddress;return Promise.resolve(r)}));return function(t){return e.apply(this,arguments)}}(),n.validateCanCreateNextAccount=function(){var e=(0,s.default)((function*(e,t){return Promise.resolve(!0)}));return function(t,r){return e.apply(this,arguments)}}(),n.checkAccountExistence=function(){var e=(0,s.default)((function*(e,t){return Promise.resolve(!0)}));return function(t,r){return e.apply(this,arguments)}}(),n.getBalances=function(){var e=(0,s.default)((function*(e,t,r){return(yield this.engine.providerManager.getClient(this.networkId)).getBalances(e.map((function(e){var t=e.address,r=e.tokenAddress;return{address:t,coin:P({},"string"===typeof r?{tokenAddress:r}:{})}})))}));return function(t,r,n){return e.apply(this,arguments)}}(),n.getFrozenBalance=function(){var e=(0,s.default)((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.password,e.useRecycleBalance,e.ignoreInscriptions,e.useCustomAddressesBalance;return 0}));return function(){return e.apply(this,arguments)}}(),n.fetchBalanceDetails=function(){var e=(0,s.default)((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.password,e.useRecycleBalance,e.ignoreInscriptions,e.useCustomAddressesBalance;return Promise.resolve(void 0)}));return function(){return e.apply(this,arguments)}}(),n.getTransactionStatuses=function(e){return this.engine.providerManager.getTransactionStatuses(this.networkId,e)},n.getTransactionFeeInNative=function(e){return Promise.resolve("")},n.isContractAddress=function(){var e=(0,s.default)((function*(e){return!1}));return function(t){return e.apply(this,arguments)}}(),n.getAccountNameInfoMap=function(){var e=(0,s.default)((function*(){var e=yield this.getNetwork();return(0,T.getAccountNameInfoByImpl)(e.impl)}));return function(){return e.apply(this,arguments)}}(),n.canAutoCreateNextAccount=function(){var e=(0,s.default)((function*(e){return Promise.resolve(!1)}));return function(t){return e.apply(this,arguments)}}(),n.filterAccounts=function(){var e=(0,s.default)((function*(e){var t=e.accounts;e.networkId;return Promise.resolve(t)}));return function(t){return e.apply(this,arguments)}}(),n.shouldChangeAccountWhenNetworkChanged=function(){var e=(0,s.default)((function*(e){e.previousNetwork,e.newNetwork,e.activeAccountId;return Promise.resolve({shouldReloadAccountList:!1,shouldChangeActiveAccount:!1})}));return function(t){return e.apply(this,arguments)}}(),n.getAccountNameInfosByImportedOrWatchingCredential=function(){var e=(0,s.default)((function*(e){return Promise.resolve([])}));return function(t){return e.apply(this,arguments)}}(),n.checkIsUnlimitedAllowance=function(){var e=(0,s.default)((function*(e){throw new I.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.checkIsApprovedForAll=function(){var e=(0,s.default)((function*(e){throw new I.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.checkIsBatchTransfer=function(){var e=(0,s.default)((function*(e){throw new I.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.getFeePricePerUnit=function(){var e=(0,s.default)((function*(){throw new I.NotImplemented}));return function(){return e.apply(this,arguments)}}(),n.fetchRpcChainId=function(){var e=(0,s.default)((function*(e){return null}));return function(t){return e.apply(this,arguments)}}(),n.getTxWaitingSeconds=function(){var e=(0,s.default)((function*(){return[]}));return function(){return e.apply(this,arguments)}}(),n.getUserNFTAssets=function(){var e=(0,s.default)((function*(e){e.serviceData;return Promise.resolve(void 0)}));return function(t){return e.apply(this,arguments)}}(),n.getTransactionDetail=function(){var e=(0,s.default)((function*(e){return Promise.resolve(void 0)}));return function(t){return e.apply(this,arguments)}}(),(0,c.default)(r)}(A.VaultContext),k=function(e){(0,d.default)(r,e);var t=S(r);function r(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))).uuid=h.default.v4().toString(),e}var n=r.prototype;return n.init=function(){var e=(0,s.default)((function*(e){yield this.initProvider(),yield this.initKeyring(e)}));return function(t){return e.apply(this,arguments)}}(),n.initKeyring=function(){var e=(0,s.default)((function*(e){this.keyring=yield e.keyringCreator(this)}));return function(t){return e.apply(this,arguments)}}(),n.signTransaction=function(){var e=(0,s.default)((function*(e,t){return this.keyring.signTransaction(e,t)}));return function(t,r){return e.apply(this,arguments)}}(),n.signAndSendTransaction=function(){var e=(0,s.default)((function*(e,t,r){var n=yield this.signTransaction(e,t);return r?P(P({},n),{},{encodedTx:e.encodedTx}):this.broadcastTransaction(P(P({},n),{},{encodedTx:e.encodedTx}))}));return function(t,r,n){return e.apply(this,arguments)}}(),n.broadcastTransaction=function(){var e=(0,s.default)((function*(e,t){w.default.engine.info("broadcastTransaction START:",{rawTx:e.rawTx});var r=yield this.engine.providerManager.broadcastTransaction(this.networkId,e.rawTx,t);return w.default.engine.info("broadcastTransaction END:",{txid:r,rawTx:e.rawTx}),P(P({},e),{},{txid:r,encodedTx:e.encodedTx})}));return function(t,r){return e.apply(this,arguments)}}(),n.buildEncodedTxFromBatchTransfer=function(){var e=(0,s.default)((function*(e){throw new I.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.buildEncodedTxsFromSetApproveForAll=function(){var e=(0,s.default)((function*(e,t){throw new I.NotImplemented}));return function(t,r){return e.apply(this,arguments)}}(),n.activateAccount=function(){var e=(0,s.default)((function*(){throw new I.NotImplemented}));return function(){return e.apply(this,arguments)}}(),n.activateToken=function(){var e=(0,s.default)((function*(e,t){throw new I.NotImplemented}));return function(t,r){return e.apply(this,arguments)}}(),n.getTokenAllowance=function(){var e=(0,s.default)((function*(e,t){throw new I.NotImplemented}));return function(t,r){return e.apply(this,arguments)}}(),n.batchTokensAllowance=function(){var e=(0,s.default)((function*(e,t){throw new I.NotImplemented}));return function(t,r){return e.apply(this,arguments)}}(),n.getOutputAccount=function(){var e=(0,s.default)((function*(){var e=yield this.getDbAccount({noCache:!0});return{id:e.id,name:e.name,type:e.type,path:e.path,coinType:e.coinType,tokens:[],address:e.address,template:e.template,pubKey:o()(e,"pub","")}}));return function(){return e.apply(this,arguments)}}(),n.getAccountBalance=function(){var e=(0,s.default)((function*(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,o=(yield this.getDbAccount()).address;return this.getBalances((t?[{address:o}]:[]).concat(e.map((function(e){return{address:o,tokenAddress:e}}))),r,n)}));return function(t){return e.apply(this,arguments)}}(),n.updatePendingTxs=function(){var e=(0,s.default)((function*(e){throw new I.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.getAccountNonce=function(){var e=(0,s.default)((function*(){return Promise.resolve(null)}));return function(){return e.apply(this,arguments)}}(),n.fixActionDirection=function(){var e=(0,s.default)((function*(e){var t,r,n,o,i=e.action,a=e.accountAddress;(i.direction=b.IDecodedTxDirection.OTHER,i.type===b.IDecodedTxActionType.NATIVE_TRANSFER)&&(i.direction=yield this.buildTxActionDirection({from:(null==(t=i.nativeTransfer)?void 0:t.from)||"",to:(null==(r=i.nativeTransfer)?void 0:r.to)||"",address:a}));i.type===b.IDecodedTxActionType.TOKEN_TRANSFER&&(i.direction=yield this.buildTxActionDirection({from:(null==(n=i.tokenTransfer)?void 0:n.from)||"",to:(null==(o=i.tokenTransfer)?void 0:o.to)||"",address:a}));return i}));return function(t){return e.apply(this,arguments)}}(),n.fixDecodedTx=function(){var e=(0,s.default)((function*(e){var t,r;e.createdAt=null!=(t=e.createdAt)?t:Date.now();var n=null==(r=e.encodedTx)?void 0:r.nonce;e.nonce=u()(n)?e.nonce:new(y())(n).toNumber();for(var o=e.owner,i=0;i<e.actions.length;i+=1){var a=e.actions[i];yield this.fixActionDirection({action:a,accountAddress:o})}if(e.outputActions)for(var s=0;s<e.outputActions.length;s+=1){var c=e.outputActions[s];yield this.fixActionDirection({action:c,accountAddress:o})}return Promise.resolve(e)}));return function(t){return e.apply(this,arguments)}}(),n.fixHistoryTx=function(){var e=(0,s.default)((function*(e){return e.decodedTx=yield this.fixDecodedTx(e.decodedTx),Promise.resolve(e)}));return function(t){return e.apply(this,arguments)}}(),n.buildHistoryTx=function(){var e=(0,s.default)((function*(e){var t=e.historyTxToMerge,r=(e.encodedTx,e.decodedTx),n=e.signedTx,o=e.isSigner,i=e.isLocalCreated,a=(null==n?void 0:n.txid)||(null==r?void 0:r.txid)||"";if(!a)throw new Error("buildHistoryTx txid not found");var u=yield this.getAccountAddress();r.txid=a||r.txid,r.owner=u,o&&(r.signer=u),null!=n&&n.txKey&&(r.extraInfo?r.extraInfo.txKey=n.txKey:r.extraInfo={txKey:n.txKey});var s=P(P({id:`${this.networkId}_${a}_${this.accountId}`,isLocalCreated:Boolean(i)},t),{},{decodedTx:r});return s=yield this.fixHistoryTx(s),Promise.resolve(s)}));return function(t){return e.apply(this,arguments)}}(),n.checkIsScamHistoryTx=function(){var e=(0,s.default)((function*(e){return!1}));return function(t){return e.apply(this,arguments)}}(),n.fetchOnChainHistory=function(){var e=(0,s.default)((function*(e){throw new I.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.fixAddressCase=function(e){return Promise.resolve(e)},n.buildTxActionDirection=function(){var e=(0,s.default)((function*(e){var t=e.from,r=e.to,n=e.address;return t=yield this.fixAddressCase(t||""),r=yield this.fixAddressCase(r),n=yield this.fixAddressCase(n),t===r&&t===n?b.IDecodedTxDirection.SELF:t&&t===n?b.IDecodedTxDirection.OUT:r&&r===n?b.IDecodedTxDirection.IN:b.IDecodedTxDirection.OTHER}));return function(t){return e.apply(this,arguments)}}(),n.getNextNonce=function(){var e=(0,s.default)((function*(e,t){var r,n=null==(r=(yield this.engine.providerManager.getAddresses(e,[t.address]))[0])?void 0:r.nonce;if(u()(n))throw new I.OneKeyError("Get on-chain nonce failed.");yield this.engine.getHistory(e,t.id,void 0,!1);var o=yield m.default.history.getMaxPendingNonce({accountId:this.accountId,networkId:e}),i=yield m.default.history.getPendingNonceList({accountId:this.accountId,networkId:e}),a=Math.max(u()(o)?0:o+1,n);if(Number.isNaN(a)&&(a=n),a>n)for(var s=n;s<a;s+=1)if(!i.includes(s)){a=s;break}if(a<n&&(a=n),a-n>=v.HISTORY_CONSTS.PENDING_QUEUE_MAX_LENGTH)throw new I.PendingQueueTooLong(v.HISTORY_CONSTS.PENDING_QUEUE_MAX_LENGTH);return a}));return function(t,r){return e.apply(this,arguments)}}(),n.validateSendAmount=function(e,t,r){return Promise.resolve(!0)},n.notifyChainChanged=function(e,t){},n.getFetchBalanceAddress=function(e){return Promise.resolve(e.address)},n.getPrivateKeyByCredential=function(e){return Promise.resolve(E.from(e.startsWith("0x")?e.slice(2):e,"hex"))},n.getMinDepositAmount=function(){var e=(0,s.default)((function*(){return"0"}));return function(){return e.apply(this,arguments)}}(),n.specialCheckEncodedTx=function(){var e=(0,s.default)((function*(e){return{success:!0}}));return function(t){return e.apply(this,arguments)}}(),n.getAllUsedAddress=function(){var e=(0,s.default)((function*(){return Promise.resolve([])}));return function(){return e.apply(this,arguments)}}(),(0,c.default)(r)}(C)},111121:(e,t,r)=>{r.r(t),r.d(t,{default:()=>re});var n=r(256666),o=r(196234),i=r(703440),a=r.n(i),u=r(634795),s=r(887371),c=r(545754),d=r(411987),l=r(695058),f=r(84658),p=r(206391),y=r.n(p),h=r(940915),v=r(901187),w=r(740727),g=r(398514),m=r(392853),I=r(786141),T=r(776553),x=r(396564),b=r(305366),A=r(997293),E=r(278489),O=r(398145),P=r(82406),S=r(153546),C=r(613549),k=r(292147),B=r(501251),N=r(522028),D=r(348834).Buffer;function _(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function K(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?_(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function F(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,l.default)(e);if(t){var o=(0,l.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,d.default)(this,r)}}var R=function(e){(0,c.default)(r,e);var t=F(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.prepareAccounts=function(){var e=(0,u.default)((function*(e){var t,r=e.indexes,n=e.names,o=e.template,i=(0,A.slicePathTemplate)(o).pathPrefix,a=r.map((function(e){return`${i}/${e}`})),u=yield this.getHardwareSDKInstance(),s=yield this.getHardwareInfo(),c=s.connectId,d=s.deviceId,l=yield this.getWalletPassphraseState(),f=(0,E.getAccountNameInfoByImpl)(C.IMPL_KASPA).default.prefix,p=yield this.getNetworkChainId();try{t=yield u.kaspaGetAddress(c,d,K({bundle:a.map((function(e){return{path:e,showOnOneKey:false,prefix:p,scheme:B.SignType.Schnorr}}))},l))}catch(T){throw k.default.common.error(T),new h.OneKeyHardwareError(T)}if(!t.success)throw k.default.common.error(t.payload),(0,S.convertDeviceError)(t.payload);var y=[],v=0;for(var w of t.payload){var g=w.address,m=w.path,I=(n||[])[v]||`${f} #${r[v]+1}`;y.push({id:`${this.walletId}--${m}`,name:I,type:O.AccountType.SIMPLE,path:m,coinType:C.COINTYPE_KASPA,pub:"",address:g}),v+=1}return y}));return function(t){return e.apply(this,arguments)}}(),n.getAddress=function(){var e=(0,u.default)((function*(e){var t,r,n=yield this.getHardwareSDKInstance(),o=yield this.getHardwareInfo(),i=o.connectId,a=o.deviceId,u=yield this.getWalletPassphraseState(),s=yield this.getNetworkChainId(),c=yield n.kaspaGetAddress(i,a,K({path:e.path,showOnOneKey:e.showOnOneKey,prefix:s,scheme:B.SignType.Schnorr},u));if(c.success&&null!=(t=c.payload)&&t.address)return null==(r=c.payload)?void 0:r.address;throw(0,S.convertDeviceError)(c.payload)}));return function(t){return e.apply(this,arguments)}}(),n.batchGetAddress=function(){var e=(0,u.default)((function*(e){var t=yield this.getHardwareSDKInstance(),r=yield this.getHardwareInfo(),n=r.connectId,o=r.deviceId,i=yield this.getWalletPassphraseState(),a=yield this.getNetworkChainId(),u=yield t.kaspaGetAddress(n,o,K(K({},i),{},{bundle:e.map((function(e){return{path:e.path,showOnOneKey:!!e.showOnOneKey,prefix:a,scheme:B.SignType.Schnorr}}))}));if(!u.success)throw(0,S.convertDeviceError)(u.payload);return u.payload.map((function(e){var t,r;return{path:null!=(t=e.path)?t:"",address:null!=(r=e.address)?r:""}}))}));return function(t){return e.apply(this,arguments)}}(),n.signTransaction=function(){var e=(0,u.default)((function*(e){k.default.common.info("signTransaction",e);var t=yield this.getDbAccount(),r=yield this.getNetworkChainId(),n=(0,N.toTransaction)(e.payload.encodedTx),o={version:n.version,inputs:n.inputs.map((function(e){var r,n,o,i,a,u,s,c;return{path:t.path,prevTxId:e.prevTxId.toString("hex"),outputIndex:e.outputIndex,sequenceNumber:e.sequenceNumber.toString(),output:{satoshis:null!=(r=null==e||null==(n=e.output)?void 0:n.satoshis.toString())?r:"",script:(0,f.bytesToHex)(null!=(o=null==e||null==(i=e.output)||null==(a=i.script)?void 0:a.toBuffer())?o:D.alloc(0))},sigOpCount:null!=(u=null==e||null==(s=e.output)||null==(c=s.script)?void 0:c.getSignatureOperationsCount())?u:1}})),outputs:n.outputs.map((function(e){return{satoshis:e.satoshis.toString(),script:(0,f.bytesToHex)(e.script.toBuffer()),scriptVersion:0}})),lockTime:n.nLockTime.toString(),sigHashType:N.SignatureType.SIGHASH_ALL,sigOpCount:1,scheme:B.SignType.Schnorr,prefix:r},i=yield this.getHardwareInfo(),a=i.connectId,u=i.deviceId,s=yield this.getWalletPassphraseState(),c=yield this.getHardwareSDKInstance(),d=yield c.kaspaSignTransaction(a,u,K(K({},o),s));if(d.success){var l=d.payload;for(var p of l){var y,h,v=n.inputs[p.index],w=null==v||null==(y=v.output)||null==(h=y.script)?void 0:h.getPublicKey(),g=(0,B.publicKeyFromX)(!0,(0,f.bytesToHex)(w));n.inputs[p.index].addSignature(n,new b.Transaction.Signature({publicKey:g,prevTxId:v.prevTxId,outputIndex:v.outputIndex,inputIndex:p.index,signature:p.signature,sigtype:N.SignatureType.SIGHASH_ALL}),N.SigningMethodType.Schnorr)}return{txid:"",rawTx:(0,f.bytesToHex)(n.toBuffer())}}throw(0,S.convertDeviceError)(d.payload)}));return function(t){return e.apply(this,arguments)}}(),(0,s.default)(r)}(P.KeyringHardwareBase),H=r(794292),M=r(605851),U=r(810887),j=r(348834).Buffer;function L(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,l.default)(e);if(t){var o=(0,l.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,d.default)(this,r)}}var W=function(e){(0,c.default)(r,e);var t=L(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.getSigners=function(){var e=(0,u.default)((function*(e,t){var r,n=yield this.getDbAccount();if(1!==t.length)throw new h.OneKeyInternalError("Kaspa signers number should be 1.");if(t[0]!==n.address)throw new h.OneKeyInternalError("Wrong address required for signing.");var o=(yield this.getPrivateKeys(e))[n.path];if("undefined"===typeof o)throw new h.OneKeyInternalError("Unable to get signer.");return(r={})[n.address]=new H.Signer(o,e,"secp256k1"),r}));return function(t,r){return e.apply(this,arguments)}}(),n.prepareAccounts=function(){var e=(0,u.default)((function*(e){var t=e.password,r=e.indexes,n=e.names,o=e.template,i=(yield this.engine.dbApi.getCredential(this.walletId,t)).seed,a=(0,A.slicePathTemplate)(o).pathPrefix,u=(0,M.batchGetPublicKeys)("secp256k1",i,t,a,r.map((function(e){return`${e.toString()}`})));if(u.length!==r.length)throw new h.OneKeyInternalError("Unable to get publick key.");var s=(0,E.getAccountNameInfoByImpl)(C.IMPL_KASPA).default.prefix,c=yield this.getNetworkChainId(),d=[],l=0;for(var p of u){var y=p.path,v=p.extendedKey.key,w=(0,f.bytesToHex)(v),g=(0,B.publicKeyFromOriginPubkey)(v),m=(0,B.addressFromPublicKey)(g,c),I=(n||[])[l]||`${s} #${r[l]+1}`;d.push({id:`${this.walletId}--${y}`,name:I,type:O.AccountType.SIMPLE,path:y,coinType:C.COINTYPE_KASPA,pub:w,address:m}),l+=1}return d}));return function(t){return e.apply(this,arguments)}}(),n.signTransaction=function(){var e=(0,u.default)((function*(e,t){k.default.common.info("signTransaction result",e);var r=yield this.getDbAccount(),n=r.address,o=(yield this.getSigners(t.password||"",[n]))[n],i=yield this.getNetworkChainId(),a=e.payload.encodedTx,s=(0,N.toTransaction)(a),c=yield(0,N.signTransaction)(s,{getPublicKey:function(){return(0,B.publicKeyFromOriginPubkey)(j.from((0,f.hexToBytes)(r.pub)))},getPrivateKey:function(){var e=(0,u.default)((function*(){var e=yield o.getPrvkey(),t=yield o.getPubkey(!0);return(0,B.privateKeyFromOriginPrivateKey)(e,t,i)}));return function(){return e.apply(this,arguments)}}()});return{txid:"",rawTx:c}}));return function(t,r){return e.apply(this,arguments)}}(),(0,s.default)(r)}(U.KeyringHdBase),V=r(478557),G=r(255942),$=r(348834).Buffer;function z(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,l.default)(e);if(t){var o=(0,l.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,d.default)(this,r)}}var X=function(e){(0,c.default)(r,e);var t=z(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.getSigners=function(){var e=(0,u.default)((function*(e,t){var r,n=yield this.getDbAccount();if(1!==t.length)throw new h.OneKeyInternalError("Kaspa signers number should be 1.");if(t[0]!==n.address)throw new h.OneKeyInternalError("Wrong address required for signing.");var o=(yield this.getPrivateKeys(e))[n.path];if("undefined"===typeof o)throw new h.OneKeyInternalError("Unable to get signer.");return(r={})[n.address]=new H.Signer(o,e,"secp256k1"),r}));return function(t,r){return e.apply(this,arguments)}}(),n.prepareAccounts=function(){var e=(0,u.default)((function*(e){var t=e.privateKey,r=e.name;if(32!==t.length)throw new h.OneKeyInternalError("Invalid private key.");var n=yield this.getNetworkChainId(),o=V.secp256k1.publicFromPrivate(t),i=(0,f.bytesToHex)(o),a=(0,B.publicKeyFromOriginPubkey)(o),u=(0,B.addressFromPublicKey)(a,n);return[{id:`imported--${C.COINTYPE_KASPA}--${i}`,name:r,type:O.AccountType.SIMPLE,path:"",coinType:C.COINTYPE_KASPA,pub:i,address:u}]}));return function(t){return e.apply(this,arguments)}}(),n.signTransaction=function(){var e=(0,u.default)((function*(e,t){k.default.common.info("signTransaction result",e);var r=yield this.getDbAccount(),n=r.address,o=(yield this.getSigners(t.password||"",[n]))[n],i=yield this.getNetworkChainId(),a=e.payload.encodedTx,s=(0,N.toTransaction)(a),c=yield(0,N.signTransaction)(s,{getPublicKey:function(){return(0,B.publicKeyFromOriginPubkey)($.from((0,f.hexToBytes)(r.pub)))},getPrivateKey:function(){var e=(0,u.default)((function*(){var e=yield o.getPrvkey(),t=yield o.getPubkey(!0);return(0,B.privateKeyFromOriginPrivateKey)(e,t,i)}));return function(){return e.apply(this,arguments)}}()});return{txid:"",rawTx:c}}));return function(t,r){return e.apply(this,arguments)}}(),(0,s.default)(r)}(G.KeyringImportedBase);function q(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,l.default)(e);if(t){var o=(0,l.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,d.default)(this,r)}}var Y=function(e){(0,c.default)(r,e);var t=q(r);function r(){return t.apply(this,arguments)}return r.prototype.prepareAccounts=function(){var e=(0,u.default)((function*(e){var t=e.name,r=e.target,n=e.accountIdPrefix,o=yield this.vault.validateAddress(r);if("undefined"===typeof o)throw new h.InvalidAddress;return Promise.resolve([{id:`${n}--${C.COINTYPE_KASPA}--${r}`,name:t||"",type:O.AccountType.SIMPLE,path:"",coinType:C.COINTYPE_KASPA,pub:"",address:o}])}));return function(t){return e.apply(this,arguments)}}(),(0,s.default)(r)}(r(701625).KeyringWatchingBase);var Z=r(791429),Q=r(348834).Buffer;function J(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ee(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?J(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):J(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function te(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,l.default)(e);if(t){var o=(0,l.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,d.default)(this,r)}}var re=function(e){(0,c.default)(r,e);var t=te(r);function r(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))).keyringMap={hd:W,hw:R,imported:X,watching:Y,external:Y},e.settings=Z.default,e.getClientCache=(0,x.memoizee)(function(){var t=(0,u.default)((function*(t){return e.getKaspaClient(t)}));return function(e){return t.apply(this,arguments)}}(),{promise:!0,max:1,maxAge:(0,T.getTimeDurationMs)({minute:3})}),e}var n=r.prototype;return n.getClient=function(){var e=(0,u.default)((function*(){var e=yield this.getRpcUrl();return this.getClientCache(e)}));return function(){return e.apply(this,arguments)}}(),n.getKaspaClient=function(e){return new B.RestAPIClient(e)},n.getClientEndpointStatus=function(){var e=(0,u.default)((function*(e){var t=yield this.getClientCache(e),r=performance.now(),n=(yield t.getNetworkInfo()).virtualDaaScore,o=parseInt(n);return{responseTime:Math.floor(performance.now()-r),latestBlock:o}}));return function(t){return e.apply(this,arguments)}}(),n.getBalances=function(){var e=(0,u.default)((function*(e){var t=yield this.getClient(),r=a()(e,(function(e){return e.address})),n=new Map;return yield Promise.all(Object.entries(r).map(function(){var e=(0,u.default)((function*(e){var r=(0,o.default)(e,2),i=r[0];r[1];try{var a=yield t.queryBalance(i);try{n.set(i,new(y())(a.toString()))}catch(u){}}catch(s){}}));return function(t){return e.apply(this,arguments)}}())),e.map((function(e){var t,r=e.address;return null!=(t=n.get(r))?t:new(y())(0)}))}));return function(t){return e.apply(this,arguments)}}(),n.selectUTXOs=function(e){var t=e.confirmUtxos,r=e.amountValue,n=e.prioritys,o=e.specifiedFeeLimit,i=(0,B.selectUTXOs)(t,parseInt(r),n),a=i.utxoIds,u=i.utxos,s=i.mass,c=null!=o?o:s.toString(),d=!1;if(u.length===t.length&&(d=u.reduce((function(e,t){var r=t.satoshis;return e.plus(r)}),new(y())("0")).lte(r)),!d&&u.reduce((function(e,t){var r=t.satoshis;return e.plus(r)}),new(y())("0")).lte(r)){var l=(0,B.selectUTXOs)(t,parseInt(r)+s);a=l.utxoIds,u=l.utxos,s=l.mass}return{utxoIds:a,utxos:u,mass:s,limit:c,hasMaxSend:d}},n.prepareAndBuildTx=function(){var e=(0,u.default)((function*(e){var t=e.network,r=e.confirmUtxos,n=e.transferInfo,o=e.specifiedFeeLimit,i=e.prioritys,a=n.to,u=n.amount,s=new(y())(u).shiftedBy(t.decimals).toFixed();if(new(y())(s).isLessThan(B.DUST_AMOUNT))throw new h.OneKeyInternalError("Amount is too small","msg__amount_too_small");var c=this.selectUTXOs({confirmUtxos:r,amountValue:s,specifiedFeeLimit:o,prioritys:i}),d=c.utxoIds,l=c.utxos,f=c.limit,p=c.hasMaxSend;return{utxoIds:d,inputs:l,outputs:[{address:a,value:s}],feeInfo:{price:(0,m.convertFeeValueToGwei)({value:"1",network:t}),limit:f},hasMaxSend:p,mass:parseInt(f)}}));return function(t){return e.apply(this,arguments)}}(),n.buildEncodedTxFromTransfer=function(){var e=(0,u.default)((function*(e,t){if(!e.to)throw new Error("Invalid transferInfo.to params");if(e.token)throw new h.OneKeyInternalError("Kaspa does not support token transfer");var r=yield this.getClient(),n=(yield this.getDbAccount()).address,o=yield this.getNetwork(),i=yield(0,B.queryConfirmUTXOs)(r,n),a=yield this.prepareAndBuildTx({network:o,confirmUtxos:i,transferInfo:e,specifiedFeeLimit:t}),u=(0,N.toTransaction)(a),s=u.getMassAndSize(),c=s.mass,d=s.txSize;if(c>B.MAX_ORPHAN_TX_MASS||d>B.MAX_BLOCK_SIZE){a=yield this.prepareAndBuildTx({network:o,confirmUtxos:i,transferInfo:e,specifiedFeeLimit:t,prioritys:{satoshis:!0}});var l=(u=(0,N.toTransaction)(a)).getMassAndSize();if(l.mass>B.MAX_ORPHAN_TX_MASS||l.txSize>B.MAX_BLOCK_SIZE)throw new h.OneKeyInternalError("Transaction size is too large","msg__broadcast_kaspa_tx_max_allowed_size")}return a}));return function(t,r){return e.apply(this,arguments)}}(),n.buildUnsignedTxFromEncodedTx=function(){var e=(0,u.default)((function*(e){var t=e.inputs,r=e.outputs,n=[];for(var o of t){var i=new(y())(o.satoshis);n.push({address:o.address.toString(),value:i,utxo:{txid:o.txid,vout:o.vout,value:i}})}var a=r.map((function(e){var t=e.address,r=e.value;return{address:t,value:new(y())(r),payload:{}}})),u={inputs:n,outputs:a,payload:{},encodedTx:e};return Promise.resolve(u)}));return function(t){return e.apply(this,arguments)}}(),n.decodedTxToLegacy=function(e){return Promise.resolve({})},n.decodeTx=function(){var e=(0,u.default)((function*(e,t){var r,n,o,i=e.inputs,a=e.outputs,u=e.feeInfo,s=yield this.engine.getNetwork(this.networkId),c=yield this.getDbAccount(),d={tokenInfo:yield this.engine.getNativeTokenInfo(this.networkId),utxoFrom:i.map((function(e){var t,r;return{address:e.address.toString(),balance:new(y())(e.satoshis.toString()).shiftedBy(-s.decimals).toFixed(),balanceValue:null!=(t=null==(r=e.satoshis)?void 0:r.toString())?t:"0",symbol:s.symbol,isMine:!0}})),utxoTo:a.map((function(e){return{address:e.address,balance:new(y())(e.value).shiftedBy(-s.decimals).toFixed(),balanceValue:e.value.toString(),symbol:s.symbol,isMine:!1}})),from:c.address,to:a[0].address,amount:new(y())(a[0].value).shiftedBy(-s.decimals).toFixed(),amountValue:a[0].value,extraInfo:null};return{txid:"",owner:c.address,signer:c.address,nonce:0,actions:[{type:g.IDecodedTxActionType.NATIVE_TRANSFER,direction:a[0].address===c.address?g.IDecodedTxDirection.OUT:g.IDecodedTxDirection.SELF,nativeTransfer:d}],status:g.IDecodedTxStatus.Pending,networkId:this.networkId,accountId:this.accountId,extraInfo:null,totalFeeInNative:new(y())(null!=(r=null==(n=e.feeInfo)?void 0:n.limit)?r:"0").multipliedBy(null!=(o=null==u?void 0:u.price)?o:"0.00000001").toFixed()}}));return function(t,r){return e.apply(this,arguments)}}(),n.updateEncodedTx=function(){var e=(0,u.default)((function*(e,t,r){var n=e.outputs;if(r.type===g.IEncodedTxUpdateType.transfer&&n.length>0){var o,i,a,u=yield this.getNetwork(),s=new(y())(null!=(o=null==(i=t.feeInfo)?void 0:i.limit)?o:"3000").multipliedBy("1.2"),c=new(y())(null!=(a=t.totalBalance)?a:t.amount).shiftedBy(u.decimals).toFixed(0);return Promise.resolve(ee(ee({},e),{},{hasMaxSend:!0,outputs:[{address:n[0].address,value:c}],mass:parseInt(s.toFixed(0))}))}return Promise.resolve(e)}));return function(t,r,n){return e.apply(this,arguments)}}(),n.minimumRequiredTransactionRelayFee=function(e){var t=e*B.MINIMUM_RELAY_TRANSACTION_FEE/1e3;return 0===t&&B.MINIMUM_RELAY_TRANSACTION_FEE>0&&(t=B.MINIMUM_RELAY_TRANSACTION_FEE),t>B.MAX_SOMPI&&(t=B.MAX_SOMPI),t},n.fetchFeeInfo=function(){var e=(0,u.default)((function*(e){var t=yield this.engine.getNetwork(this.networkId),r=(0,N.toTransaction)(e).getMassAndSize(),n=r.txSize,o=r.mass,i=this.minimumRequiredTransactionRelayFee(o);if(n>B.MAX_BLOCK_SIZE)throw new h.OneKeyInternalError("Transaction size is too large","msg__broadcast_kaspa_tx_max_allowed_size");var a=(0,m.convertFeeValueToGwei)({value:"1",network:t});return{nativeSymbol:t.symbol,nativeDecimals:t.decimals,feeSymbol:t.feeSymbol,feeDecimals:t.feeDecimals,limit:new(y())(null!=i?i:"1").multipliedBy(1.1).toFixed(0),prices:[a],defaultPresetIndex:"0"}}));return function(t){return e.apply(this,arguments)}}(),n.attachFeeInfoToEncodedTx=function(){var e=(0,u.default)((function*(e){var t=e.feeInfoValue,r=t.price,n=t.limit;if("undefined"!==typeof r&&"string"!==typeof r)throw new h.OneKeyInternalError("Invalid gas price.");if("string"!==typeof n)throw new h.OneKeyInternalError("Invalid fee limit");return Promise.resolve(ee(ee({},e.encodedTx),{},{feeInfo:{price:r,limit:n},mass:parseInt(null!=n?n:"1000")}))}));return function(t){return e.apply(this,arguments)}}(),n.broadcastTransaction=function(){var e=(0,u.default)((function*(e){var t=yield this.getClient(),r=e.rawTx,n=yield t.sendRawTransaction(r);return ee(ee({},e),{},{txid:n})}));return function(t){return e.apply(this,arguments)}}(),n.getExportedCredential=function(){var e=(0,u.default)((function*(e){var t=yield this.getDbAccount();if(t.id.startsWith("hd-")||t.id.startsWith("imported")){var r=this.keyring,n=Object.values(yield r.getPrivateKeys(e)),i=(0,o.default)(n,1)[0],a=yield this.getNetworkChainId();return(0,B.privateKeyFromBuffer)((0,v.decrypt)(e,i),a).toWIF()}throw new h.OneKeyInternalError("Only credential of HD or imported accounts can be exported")}));return function(t){return e.apply(this,arguments)}}(),n.getTransactionStatuses=function(){var e=(0,u.default)((function*(e){var t=yield this.getClient(),r=(yield t.getNetworkInfo()).virtualDaaScore,n=yield t.getTransactions(e),o=new Map;for(var i of n){var a=w.TransactionStatus.PENDING;i.accepting_block_blue_score&&new(y())(r).minus(i.accepting_block_blue_score).isGreaterThanOrEqualTo(B.CONFIRMATION_COUNT)&&(a=w.TransactionStatus.CONFIRM_AND_SUCCESS),o.set(i.transaction_id,a)}return e.map((function(e){return o.get(e)}))}));return function(t){return e.apply(this,arguments)}}(),n.fetchOnChainHistory=function(){var e=(0,u.default)((function*(e){var t=this,r=e.localHistory,n=void 0===r?[]:r;if(e.tokenIdOnNetwork)return Promise.resolve([]);var o=yield this.getClient(),i=yield this.getDbAccount(),a=yield this.engine.getNativeTokenInfo(this.networkId),s=(a.decimals,a.symbol,(yield o.getNetworkInfo()).virtualDaaScore),c=yield this.engine.getNativeTokenInfo(this.networkId),d=(yield o.getTransactionsByAddress(i.address)).map(function(){var e=(0,u.default)((function*(e){var r=n.find((function(t){return t.decodedTx.txid===e.transaction_id}));if(r&&r.decodedTx.isFinal)return Promise.resolve(null);var o=i.address;try{var a,u=e.inputs,d=e.outputs,l=[],f=null==u?void 0:u.some((function(e){return e.previous_outpoint_address===o})),p=null==d?void 0:d.some((function(e){return e.script_public_key_address===o})),h=function(e,t,r){return null==e?void 0:e.map((function(e){var n,o;return{address:e.previous_outpoint_address,balance:new(y())(null==(n=e.previous_outpoint_amount)?void 0:n.toString()).shiftedBy(-r.decimals).toFixed(),balanceValue:null==(o=e.previous_outpoint_amount)?void 0:o.toString(),symbol:r.symbol,isMine:e.previous_outpoint_address===t}}))}(u,o,c),v=function(e,t,r){return null==e?void 0:e.map((function(e){var n,o;return{address:e.script_public_key_address,balance:new(y())(null==(n=e.amount)?void 0:n.toString()).shiftedBy(-r.decimals).toFixed(),balanceValue:null==(o=e.amount)?void 0:o.toString(),symbol:r.symbol,isMine:e.script_public_key_address===t}}))}(d,o,c),w=function(e,t,r,n){var o;return!t&&r?(null==n||null==(o=n.find((function(t){return t.previous_outpoint_address!==e})))?void 0:o.previous_outpoint_address)||"kaspa:00000000":e}(o,f,p,u),m=function(e,t,r,n,o){var i=new Set,a=new Set(null==o?void 0:o.map((function(e){return e.previous_outpoint_address})));return null==n||n.forEach((function(e){a.has(e.script_public_key_address)||i.add(e.script_public_key_address)})),t&&0===i.size&&0!==n.length&&i.add(e),Array.from(i)}(o,f,0,d,u);m.forEach((function(e){var t=v.filter((function(t){return t.address===e})).reduce((function(e,t){return e.plus(new(y())(t.balanceValue))}),new(y())(0)),r=t.shiftedBy(-c.decimals).toFixed(),n=t.toString();l.push({type:g.IDecodedTxActionType.NATIVE_TRANSFER,nativeTransfer:{tokenInfo:c,utxoFrom:h,utxoTo:v,from:w,to:e,amount:r,amountValue:n,extraInfo:null}})}));var I=function(e){var t=e.inputs,r=e.outputs,n=e.mass,o=e.decimals,i="";try{var a,u,s=null!=(a=null==t?void 0:t.reduce((function(e,t){return e.plus(t.previous_outpoint_amount.toString())}),new(y())(0)))?a:new(y())(0),c=null!=(u=null==r?void 0:r.reduce((function(e,t){return e.plus(t.amount.toString())}),new(y())(0)))?u:new(y())(0);i=s.isLessThanOrEqualTo(0)?"0":s.minus(c).shiftedBy(-o).toFixed()}catch(d){i=new(y())(null!=n?n:"1").shiftedBy(-o).toFixed()}return i}({mass:e.mass,inputs:u,outputs:d,decimals:c.decimals}),T={txid:e.transaction_id,owner:i.address,signer:i.address,nonce:0,actions:l,status:new(y())(s).minus(e.accepting_block_blue_score).isGreaterThanOrEqualTo(B.CONFIRMATION_COUNT)?g.IDecodedTxStatus.Confirmed:g.IDecodedTxStatus.Pending,networkId:t.networkId,accountId:t.accountId,extraInfo:null,totalFeeInNative:I};return T.updatedAt="undefined"!==typeof e.block_time?e.block_time:Date.now(),T.createdAt=null!=(a=null==r?void 0:r.decodedTx.createdAt)?a:T.updatedAt,T.isFinal=T.status===g.IDecodedTxStatus.Confirmed,yield t.buildHistoryTx({decodedTx:T,historyTxToMerge:r})}catch(x){}}));return function(t){return e.apply(this,arguments)}}());return(yield Promise.all(d)).filter(Boolean)}));return function(t){return e.apply(this,arguments)}}(),n.validateAddress=function(){var e=(0,u.default)((function*(e){var t=yield this.getNetworkChainId();return(0,B.isValidAddress)(e,t)?Promise.resolve(e):Promise.reject(new h.InvalidAddress)}));return function(t){return e.apply(this,arguments)}}(),n.validateWatchingCredential=function(){var e=(0,u.default)((function*(e){var t=this;return this.validateAddress(e).then((function(e){return t.settings.watchingAccountEnabled&&!!e})).catch((function(){return!1}))}));return function(t){return e.apply(this,arguments)}}(),n.validateImportedCredential=function(){var e=(0,u.default)((function*(e){return Promise.resolve(this.settings.importedAccountEnabled&&(this.isHexPrivateKey(e)||this.isWIFPrivateKey(e)))}));return function(t){return e.apply(this,arguments)}}(),n.isHexPrivateKey=function(e){return/^(0x)?[0-9a-zA-Z]{64}$/.test(e)},n.isWIFPrivateKey=function(e){return/^[5KL][1-9A-HJ-NP-Za-km-z]{50,51}$/.test(e)},n.getPrivateKeyByCredential=function(){var e=(0,u.default)((function*(e){if(this.isHexPrivateKey(e))return Promise.resolve(Q.from(e.startsWith("0x")?e.slice(2):e,"hex"));if(this.isWIFPrivateKey(e)){var t=(0,B.privateKeyFromWIF)(e);return Promise.resolve(Q.from((0,f.hexToBytes)(t.toString())))}}));return function(t){return e.apply(this,arguments)}}(),(0,s.default)(r)}(I.VaultBase)},565147:(e,t,r)=>{r.r(t),r.d(t,{KeyringBase:()=>c,KeyringBaseMock:()=>d});var n=r(634795),o=r(887371),i=r(545754),a=r(411987),u=r(695058);function s(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,u.default)(e);if(t){var o=(0,u.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,a.default)(this,r)}}var c=function(e){(0,i.default)(r,e);var t=s(r);function r(e){var r;return(r=t.call(this,e.options)).vault=e,r}return r.prototype.addressFromBase=function(){var e=(0,n.default)((function*(e){return this.vault.addressFromBase(e)}));return function(t){return e.apply(this,arguments)}}(),(0,o.default)(r)}(r(114540).VaultContext),d=function(e){(0,i.default)(r,e);var t=s(r);function r(){return t.apply(this,arguments)}return(0,o.default)(r)}(c)},82406:(e,t,r)=>{r.r(t),r.d(t,{KeyringHardwareBase:()=>l});var n=r(634795),o=r(887371),i=r(545754),a=r(411987),u=r(695058),s=r(799075),c=r(814817);function d(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,u.default)(e);if(t){var o=(0,u.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,a.default)(this,r)}}var l=function(e){(0,i.default)(a,e);var t=d(a);function a(){return t.apply(this,arguments)}var u=a.prototype;return u.getHardwareInfo=function(){var e=(0,n.default)((function*(){var e,t,r,n=yield this.engine.getHWDeviceByWalletId(this.vault.walletId);return{connectId:null!=(e=null==n?void 0:n.mac)?e:"",deviceId:null!=(t=null==n?void 0:n.deviceId)?t:"",deviceType:null!=(r=null==n?void 0:n.deviceType)?r:""}}));return function(){return e.apply(this,arguments)}}(),u.getWalletPassphraseState=function(){var e=(0,n.default)((function*(){var e=yield this.engine.getWallet(this.vault.walletId);return{passphraseState:null==e?void 0:e.passphraseState,useEmptyPassphrase:!(0,c.isPassphraseWallet)(e)}}));return function(){return e.apply(this,arguments)}}(),u.getHardwareSDKInstance=function(){var e=(0,n.default)((function*(){var e,t,n,o,i;return null!=(i=yield null==(e=r.g)||null==(t=e.$backgroundApiProxy)||null==(n=t.backgroundApi)||null==(o=n.serviceHardware)||null==o.getSDKInstance?void 0:o.getSDKInstance())?i:s.HardwareSDK}));return function(){return e.apply(this,arguments)}}(),u.prepareAccountByAddressIndex=function(e){throw new Error("Method not implemented.")},(0,o.default)(a)}(r(565147).KeyringBase)},810887:(e,t,r)=>{r.r(t),r.d(t,{KeyringHdBase:()=>y});var n=r(256666),o=r(634795),i=r(887371),a=r(545754),u=r(411987),s=r(695058),c=r(605851),d=r(940915);function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function f(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function p(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,s.default)(e);if(t){var o=(0,s.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,u.default)(this,r)}}var y=function(e){(0,a.default)(r,e);var t=p(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.getPrivateKeys=function(){var e=(0,o.default)((function*(e,t){var r=(yield this.getDbAccount()).path.split("/"),n=t||[r.pop()],o=r.join("/"),i=(yield this.engine.dbApi.getCredential(this.walletId,e)).seed;if("undefined"===typeof i)throw new d.OneKeyInternalError("Unable to get credential.");var a=(yield this.engine.providerManager.getChainInfoByNetworkId(this.networkId)).curve;return(0,c.batchGetPrivateKeys)(a,i,e,o,n).reduce((function(e,t){var r;return f(f({},e),{},((r={})[t.path]=t.extendedKey.key,r))}),{})}));return function(t,r){return e.apply(this,arguments)}}(),n.getAddress=function(){throw new Error("Method not implemented.")},n.batchGetAddress=function(){throw new Error("Method not implemented.")},n.prepareAccountByAddressIndex=function(e){throw new Error("Method not implemented.")},(0,i.default)(r)}(r(280306).KeyringSoftwareBase)},255942:(e,t,r)=>{r.r(t),r.d(t,{KeyringImportedBase:()=>d});var n=r(634795),o=r(887371),i=r(545754),a=r(411987),u=r(695058),s=r(940915);function c(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,u.default)(e);if(t){var o=(0,u.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,a.default)(this,r)}}var d=function(e){(0,i.default)(r,e);var t=c(r);function r(){return t.apply(this,arguments)}var a=r.prototype;return a.getPrivateKeys=function(){var e=(0,n.default)((function*(e,t){if("undefined"!==typeof t)throw new s.NotImplemented("Getting private keys from extended private key");var r=(yield this.engine.dbApi.getCredential(this.accountId,e)).privateKey;if("undefined"===typeof r)throw new s.OneKeyInternalError("Unable to get credential.");return{"":r}}));return function(t,r){return e.apply(this,arguments)}}(),a.getAddress=function(){throw new Error("Method not implemented.")},a.batchGetAddress=function(){throw new Error("Method not implemented.")},a.prepareAccountByAddressIndex=function(){throw new Error("Method not implemented.")},(0,o.default)(r)}(r(280306).KeyringSoftwareBase)},280306:(e,t,r)=>{r.r(t),r.d(t,{KeyringSoftwareBase:()=>h});var n=r(196234),o=r(256666),i=r(634795),a=r(887371),u=r(545754),s=r(411987),c=r(695058),d=r(292147),l=r(940915);function f(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?f(Object(r),!0).forEach((function(t){(0,o.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):f(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function y(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,c.default)(e);if(t){var o=(0,c.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,s.default)(this,r)}}var h=function(e){(0,u.default)(r,e);var t=y(r);function r(){return t.apply(this,arguments)}var o=r.prototype;return o.signTransaction=function(){var e=(0,i.default)((function*(e,t){var r=t.password;if("undefined"===typeof r)throw new l.OneKeyInternalError("Software signing requires a password.");var n=yield this.getSigners(r,e.inputs.map((function(e){return e.address})));return d.default.engine.info("signTransaction",this.networkId,e),p(p({},yield this.engine.providerManager.signTransaction(this.networkId,e,n)),{},{encodedTx:e.encodedTx})}));return function(t,r){return e.apply(this,arguments)}}(),o.signMessage=function(){var e=(0,i.default)((function*(e,t){var r=this,o=t.password;if("undefined"===typeof o)throw new l.OneKeyInternalError("Software signing requires a password.");var i=yield this.getDbAccount(),a=Object.values(yield this.getSigners(o,[i.address])),u=(0,n.default)(a,1)[0];return d.default.engine.info("signMessage",this.networkId,e),Promise.all(e.map((function(e){return r.engine.providerManager.signMessage(r.networkId,e,u)})))}));return function(t,r){return e.apply(this,arguments)}}(),o.getAddress=function(){throw new Error("Method not implemented.")},o.batchGetAddress=function(){throw new Error("Method not implemented.")},o.prepareAccountByAddressIndex=function(e){throw new Error("Method not implemented.")},(0,a.default)(r)}(r(565147).KeyringBase)},701625:(e,t,r)=>{r.r(t),r.d(t,{KeyringWatchingBase:()=>d});var n=r(634795),o=r(887371),i=r(545754),a=r(411987),u=r(695058),s=r(940915);function c(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,u.default)(e);if(t){var o=(0,u.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,a.default)(this,r)}}var d=function(e){(0,i.default)(r,e);var t=c(r);function r(){return t.apply(this,arguments)}var a=r.prototype;return a.signTransaction=function(){var e=(0,n.default)((function*(e,t){throw new s.OneKeyInternalError("signTransaction is not supported for watching accounts")}));return function(t,r){return e.apply(this,arguments)}}(),a.signMessage=function(){var e=(0,n.default)((function*(e,t){throw new s.OneKeyInternalError("signMessage is not supported for watching accounts")}));return function(t,r){return e.apply(this,arguments)}}(),a.getAddress=function(){throw new Error("Method not implemented.")},a.batchGetAddress=function(){throw new Error("Method not implemented.")},a.prepareAccountByAddressIndex=function(){throw new Error("Method not implemented.")},(0,o.default)(r)}(r(565147).KeyringBase)},153546:(e,t,r)=>{r.r(t),r.d(t,{convertDeviceError:()=>u});var n=r(703599),o=r(302478),i=r(292147);r(213208);function a(e,t){return"string"!==typeof t?null:e===n.HardwareErrorCode.DeviceInitializeFailed&&t.includes("ECONNABORTED")?new o.ConnectTimeoutError({message:t}):t.includes("Bridge network error")?new o.BridgeNetworkError({message:t}):null}function u(e){var t,r=e||{},u=r.code,s=r.error,c=r.message,d=null!=(t=null!=s?s:c)?t:"Unknown error";if(a(u,d))return a(u,d);switch(i.default.hardwareSDK.info("Device Utils Convert Device Error:",u,d),u){case n.HardwareErrorCode.UnknownError:return new o.UnknownHardwareError(e);case n.HardwareErrorCode.DeviceFwException:return new o.FirmwareVersionTooLow(e);case n.HardwareErrorCode.DeviceUnexpectedMode:return"string"===typeof d&&-1!==d.indexOf("ui-device_bootloader_mode")?new o.NotInBootLoaderMode(e):new o.UnknownHardwareError(e);case n.HardwareErrorCode.DeviceCheckDeviceIdError:return new o.DeviceNotSame(e);case n.HardwareErrorCode.DeviceNotFound:return new o.DeviceNotFind(e);case n.HardwareErrorCode.DeviceUnexpectedBootloaderMode:return new o.NotInBootLoaderMode(e);case n.HardwareErrorCode.DeviceInterruptedFromOutside:case n.HardwareErrorCode.DeviceInterruptedFromUser:return new o.UserCancelFromOutside(e);case n.HardwareErrorCode.DeviceNotSupportPassphrase:return new o.NotSupportPassphraseError(e);case n.HardwareErrorCode.IFrameLoadFail:return new o.InitIframeLoadFail(e);case n.HardwareErrorCode.IframeTimeout:return new o.InitIframeTimeout(e);case n.HardwareErrorCode.FirmwareUpdateDownloadFailed:return new o.FirmwareDownloadFailed(e);case n.HardwareErrorCode.FirmwareUpdateManuallyEnterBoot:return new o.FirmwareUpdateManuallyEnterBoot(e);case n.HardwareErrorCode.FirmwareUpdateAutoEnterBootFailure:return new o.FirmwareUpdateAutoEnterBootFailure(e);case n.HardwareErrorCode.FirmwareUpdateLimitOneDevice:return new o.FirmwareUpdateLimitOneDevice(e);case n.HardwareErrorCode.CallMethodNeedUpgradeFirmware:return new o.FirmwareVersionTooLow(e);case n.HardwareErrorCode.NewFirmwareUnRelease:return new o.NewFirmwareUnRelease(e);case n.HardwareErrorCode.NewFirmwareForceUpdate:return new o.NewFirmwareForceUpdate(e);case n.HardwareErrorCode.NetworkError:return new o.NetworkError(e);case n.HardwareErrorCode.BlePermissionError:return new o.NeedBluetoothTurnedOn(e);case n.HardwareErrorCode.BleLocationError:return new o.NeedBluetoothPermissions({message:d});case n.HardwareErrorCode.BleLocationServicesDisabled:return new o.BleLocationServiceError({message:d});case n.HardwareErrorCode.BleDeviceNotBonded:return new o.DeviceNotBonded(e);case n.HardwareErrorCode.BleDeviceBondError:return new o.DeviceBondError(e);case n.HardwareErrorCode.BleWriteCharacteristicError:return new o.BleWriteCharacteristicError(e);case n.HardwareErrorCode.BleScanError:return new o.BleScanError({message:d});case n.HardwareErrorCode.BleAlreadyConnected:return new o.BleAlreadyConnectedError(e);case n.HardwareErrorCode.RuntimeError:return-1!==d.indexOf("EIP712 blind sign is disabled")?new o.OpenBlindSign(e):-1!==d.indexOf("Unknown message")||-1!==d.indexOf("Failure_UnexpectedMessage")?new o.UnknownMethod(e):new o.UnknownHardwareError(e);case n.HardwareErrorCode.PinInvalid:return new o.InvalidPIN(e);case n.HardwareErrorCode.DeviceCheckPassphraseStateError:return new o.InvalidPassphrase(e);case n.HardwareErrorCode.DeviceOpenedPassphrase:return new o.DeviceOpenedPassphrase(e);case n.HardwareErrorCode.DeviceNotOpenedPassphrase:return new o.DeviceNotOpenedPassphrase(e);case n.HardwareErrorCode.PinCancelled:case n.HardwareErrorCode.ActionCancelled:return new o.UserCancel(e);case n.HardwareErrorCode.BridgeNotInstalled:case o.CustomOneKeyHardwareError.NeedOneKeyBridge:return new o.NeedOneKeyBridge(e);case n.HardwareErrorCode.BridgeNetworkError:return new o.BridgeNetworkError(e);case n.HardwareErrorCode.BridgeTimeoutError:return new o.BridgeTimeoutError(e);case n.HardwareErrorCode.PollingTimeout:return new o.ConnectTimeoutError(e);case n.HardwareErrorCode.PollingStop:return new o.ConnectPollingStopError(e);case n.HardwareErrorCode.BlindSignDisabled:return new o.OpenBlindSign(e);case n.HardwareErrorCode.FileAlreadyExists:return new o.FileAlreadyExistError(e);case n.HardwareErrorCode.CheckDownloadFileError:return new o.IncompleteFileError(e);case n.HardwareErrorCode.NotInSigningMode:return new o.NotInSigningModeError(e);case n.HardwareErrorCode.DataOverload:return new o.DeviceDataOverload(e);default:return new o.UnknownHardwareError(e)}}}}]);