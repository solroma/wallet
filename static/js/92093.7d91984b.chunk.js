(self.webpackChunkweb=self.webpackChunkweb||[]).push([[92093],{786141:(e,t,r)=>{"use strict";r.r(t),r.d(t,{VaultBase:()=>C,VaultBaseChainOnly:()=>D});var n=r(72579),i=r.n(n),o=r(256666),a=r(301842),u=r.n(a),s=r(634795),d=r(887371),c=r(545754),l=r(411987),f=r(695058),p=r(206391),y=r.n(p),h=r(636393),v=r(613549),g=r(292147),w=r(213208),m=r(992431),T=r(940915),A=r(278489),I=r(969618),x=r(398514),b=r(114540),E=r(348834).Buffer;function O(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function P(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?O(Object(r),!0).forEach((function(t){(0,o.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):O(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function k(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,f.default)(e);if(t){var i=(0,f.default)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,l.default)(this,r)}}if(w.default.isExtensionUi)throw new Error("engine/VaultBase is not allowed imported from ui");var D=function(e){(0,c.default)(r,e);var t=k(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.initProvider=function(){var e=(0,s.default)((function*(){var e=(yield this.getNetwork()).impl;u()(I.IMPL_MAPPINGS[e])||(this.engineProvider=yield this.engine.providerManager.getProvider(this.networkId))}));return function(){return e.apply(this,arguments)}}(),n.proxyJsonRPCCall=function(){var e=(0,s.default)((function*(e){throw new T.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.createClientFromURL=function(e){throw new T.NotImplemented},n.getEthersProvider=function(){var e=(0,s.default)((function*(){throw new T.NotImplemented}));return function(){return e.apply(this,arguments)}}(),n.getClientEndpointStatus=function(){var e=(0,s.default)((function*(e){var t=this.createClientFromURL(e),r=performance.now(),n=(yield t.getInfo()).bestBlockNumber;return{responseTime:Math.floor(performance.now()-r),latestBlock:n}}));return function(t){return e.apply(this,arguments)}}(),n.checkRpcBatchSupport=function(){var e=(0,s.default)((function*(e){throw new T.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.getDisplayAddress=function(){var e=(0,s.default)((function*(e){return Promise.resolve(e)}));return function(t){return e.apply(this,arguments)}}(),n.validateAddress=function(){var e=(0,s.default)((function*(e){var t=yield this.engineProvider.verifyAddress(e),r=t.normalizedAddress;if(!t.isValid||!r)throw new T.InvalidAddress;return Promise.resolve(r)}));return function(t){return e.apply(this,arguments)}}(),n.validateImportedCredential=function(e){return Promise.resolve(this.settings.importedAccountEnabled&&/^(0x)?[0-9a-zA-Z]{64}$/.test(e))},n.validateWatchingCredential=function(){var e=(0,s.default)((function*(e){return Promise.resolve(this.settings.watchingAccountEnabled&&(yield this.engineProvider.verifyAddress(e)).isValid)}));return function(t){return e.apply(this,arguments)}}(),n.validateTokenAddress=function(){var e=(0,s.default)((function*(e){var t=yield this.engineProvider.verifyTokenAddress(e),r=t.normalizedAddress;if(!t.isValid||"undefined"===typeof r)throw new T.InvalidTokenAddress;return Promise.resolve(r)}));return function(t){return e.apply(this,arguments)}}(),n.validateCanCreateNextAccount=function(){var e=(0,s.default)((function*(e,t){return Promise.resolve(!0)}));return function(t,r){return e.apply(this,arguments)}}(),n.checkAccountExistence=function(){var e=(0,s.default)((function*(e,t){return Promise.resolve(!0)}));return function(t,r){return e.apply(this,arguments)}}(),n.getBalances=function(){var e=(0,s.default)((function*(e,t,r){return(yield this.engine.providerManager.getClient(this.networkId)).getBalances(e.map((function(e){var t=e.address,r=e.tokenAddress;return{address:t,coin:P({},"string"===typeof r?{tokenAddress:r}:{})}})))}));return function(t,r,n){return e.apply(this,arguments)}}(),n.getFrozenBalance=function(){var e=(0,s.default)((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.password,e.useRecycleBalance,e.ignoreInscriptions,e.useCustomAddressesBalance;return 0}));return function(){return e.apply(this,arguments)}}(),n.fetchBalanceDetails=function(){var e=(0,s.default)((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.password,e.useRecycleBalance,e.ignoreInscriptions,e.useCustomAddressesBalance;return Promise.resolve(void 0)}));return function(){return e.apply(this,arguments)}}(),n.getTransactionStatuses=function(e){return this.engine.providerManager.getTransactionStatuses(this.networkId,e)},n.getTransactionFeeInNative=function(e){return Promise.resolve("")},n.isContractAddress=function(){var e=(0,s.default)((function*(e){return!1}));return function(t){return e.apply(this,arguments)}}(),n.getAccountNameInfoMap=function(){var e=(0,s.default)((function*(){var e=yield this.getNetwork();return(0,A.getAccountNameInfoByImpl)(e.impl)}));return function(){return e.apply(this,arguments)}}(),n.canAutoCreateNextAccount=function(){var e=(0,s.default)((function*(e){return Promise.resolve(!1)}));return function(t){return e.apply(this,arguments)}}(),n.filterAccounts=function(){var e=(0,s.default)((function*(e){var t=e.accounts;e.networkId;return Promise.resolve(t)}));return function(t){return e.apply(this,arguments)}}(),n.shouldChangeAccountWhenNetworkChanged=function(){var e=(0,s.default)((function*(e){e.previousNetwork,e.newNetwork,e.activeAccountId;return Promise.resolve({shouldReloadAccountList:!1,shouldChangeActiveAccount:!1})}));return function(t){return e.apply(this,arguments)}}(),n.getAccountNameInfosByImportedOrWatchingCredential=function(){var e=(0,s.default)((function*(e){return Promise.resolve([])}));return function(t){return e.apply(this,arguments)}}(),n.checkIsUnlimitedAllowance=function(){var e=(0,s.default)((function*(e){throw new T.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.checkIsApprovedForAll=function(){var e=(0,s.default)((function*(e){throw new T.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.checkIsBatchTransfer=function(){var e=(0,s.default)((function*(e){throw new T.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.getFeePricePerUnit=function(){var e=(0,s.default)((function*(){throw new T.NotImplemented}));return function(){return e.apply(this,arguments)}}(),n.fetchRpcChainId=function(){var e=(0,s.default)((function*(e){return null}));return function(t){return e.apply(this,arguments)}}(),n.getTxWaitingSeconds=function(){var e=(0,s.default)((function*(){return[]}));return function(){return e.apply(this,arguments)}}(),n.getUserNFTAssets=function(){var e=(0,s.default)((function*(e){e.serviceData;return Promise.resolve(void 0)}));return function(t){return e.apply(this,arguments)}}(),n.getTransactionDetail=function(){var e=(0,s.default)((function*(e){return Promise.resolve(void 0)}));return function(t){return e.apply(this,arguments)}}(),(0,d.default)(r)}(b.VaultContext),C=function(e){(0,c.default)(r,e);var t=k(r);function r(){for(var e,r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return(e=t.call.apply(t,[this].concat(n))).uuid=h.default.v4().toString(),e}var n=r.prototype;return n.init=function(){var e=(0,s.default)((function*(e){yield this.initProvider(),yield this.initKeyring(e)}));return function(t){return e.apply(this,arguments)}}(),n.initKeyring=function(){var e=(0,s.default)((function*(e){this.keyring=yield e.keyringCreator(this)}));return function(t){return e.apply(this,arguments)}}(),n.signTransaction=function(){var e=(0,s.default)((function*(e,t){return this.keyring.signTransaction(e,t)}));return function(t,r){return e.apply(this,arguments)}}(),n.signAndSendTransaction=function(){var e=(0,s.default)((function*(e,t,r){var n=yield this.signTransaction(e,t);return r?P(P({},n),{},{encodedTx:e.encodedTx}):this.broadcastTransaction(P(P({},n),{},{encodedTx:e.encodedTx}))}));return function(t,r,n){return e.apply(this,arguments)}}(),n.broadcastTransaction=function(){var e=(0,s.default)((function*(e,t){g.default.engine.info("broadcastTransaction START:",{rawTx:e.rawTx});var r=yield this.engine.providerManager.broadcastTransaction(this.networkId,e.rawTx,t);return g.default.engine.info("broadcastTransaction END:",{txid:r,rawTx:e.rawTx}),P(P({},e),{},{txid:r,encodedTx:e.encodedTx})}));return function(t,r){return e.apply(this,arguments)}}(),n.buildEncodedTxFromBatchTransfer=function(){var e=(0,s.default)((function*(e){throw new T.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.buildEncodedTxsFromSetApproveForAll=function(){var e=(0,s.default)((function*(e,t){throw new T.NotImplemented}));return function(t,r){return e.apply(this,arguments)}}(),n.activateAccount=function(){var e=(0,s.default)((function*(){throw new T.NotImplemented}));return function(){return e.apply(this,arguments)}}(),n.activateToken=function(){var e=(0,s.default)((function*(e,t){throw new T.NotImplemented}));return function(t,r){return e.apply(this,arguments)}}(),n.getTokenAllowance=function(){var e=(0,s.default)((function*(e,t){throw new T.NotImplemented}));return function(t,r){return e.apply(this,arguments)}}(),n.batchTokensAllowance=function(){var e=(0,s.default)((function*(e,t){throw new T.NotImplemented}));return function(t,r){return e.apply(this,arguments)}}(),n.getOutputAccount=function(){var e=(0,s.default)((function*(){var e=yield this.getDbAccount({noCache:!0});return{id:e.id,name:e.name,type:e.type,path:e.path,coinType:e.coinType,tokens:[],address:e.address,template:e.template,pubKey:i()(e,"pub","")}}));return function(){return e.apply(this,arguments)}}(),n.getAccountBalance=function(){var e=(0,s.default)((function*(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,i=(yield this.getDbAccount()).address;return this.getBalances((t?[{address:i}]:[]).concat(e.map((function(e){return{address:i,tokenAddress:e}}))),r,n)}));return function(t){return e.apply(this,arguments)}}(),n.updatePendingTxs=function(){var e=(0,s.default)((function*(e){throw new T.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.getAccountNonce=function(){var e=(0,s.default)((function*(){return Promise.resolve(null)}));return function(){return e.apply(this,arguments)}}(),n.fixActionDirection=function(){var e=(0,s.default)((function*(e){var t,r,n,i,o=e.action,a=e.accountAddress;(o.direction=x.IDecodedTxDirection.OTHER,o.type===x.IDecodedTxActionType.NATIVE_TRANSFER)&&(o.direction=yield this.buildTxActionDirection({from:(null==(t=o.nativeTransfer)?void 0:t.from)||"",to:(null==(r=o.nativeTransfer)?void 0:r.to)||"",address:a}));o.type===x.IDecodedTxActionType.TOKEN_TRANSFER&&(o.direction=yield this.buildTxActionDirection({from:(null==(n=o.tokenTransfer)?void 0:n.from)||"",to:(null==(i=o.tokenTransfer)?void 0:i.to)||"",address:a}));return o}));return function(t){return e.apply(this,arguments)}}(),n.fixDecodedTx=function(){var e=(0,s.default)((function*(e){var t,r;e.createdAt=null!=(t=e.createdAt)?t:Date.now();var n=null==(r=e.encodedTx)?void 0:r.nonce;e.nonce=u()(n)?e.nonce:new(y())(n).toNumber();for(var i=e.owner,o=0;o<e.actions.length;o+=1){var a=e.actions[o];yield this.fixActionDirection({action:a,accountAddress:i})}if(e.outputActions)for(var s=0;s<e.outputActions.length;s+=1){var d=e.outputActions[s];yield this.fixActionDirection({action:d,accountAddress:i})}return Promise.resolve(e)}));return function(t){return e.apply(this,arguments)}}(),n.fixHistoryTx=function(){var e=(0,s.default)((function*(e){return e.decodedTx=yield this.fixDecodedTx(e.decodedTx),Promise.resolve(e)}));return function(t){return e.apply(this,arguments)}}(),n.buildHistoryTx=function(){var e=(0,s.default)((function*(e){var t=e.historyTxToMerge,r=(e.encodedTx,e.decodedTx),n=e.signedTx,i=e.isSigner,o=e.isLocalCreated,a=(null==n?void 0:n.txid)||(null==r?void 0:r.txid)||"";if(!a)throw new Error("buildHistoryTx txid not found");var u=yield this.getAccountAddress();r.txid=a||r.txid,r.owner=u,i&&(r.signer=u),null!=n&&n.txKey&&(r.extraInfo?r.extraInfo.txKey=n.txKey:r.extraInfo={txKey:n.txKey});var s=P(P({id:`${this.networkId}_${a}_${this.accountId}`,isLocalCreated:Boolean(o)},t),{},{decodedTx:r});return s=yield this.fixHistoryTx(s),Promise.resolve(s)}));return function(t){return e.apply(this,arguments)}}(),n.checkIsScamHistoryTx=function(){var e=(0,s.default)((function*(e){return!1}));return function(t){return e.apply(this,arguments)}}(),n.fetchOnChainHistory=function(){var e=(0,s.default)((function*(e){throw new T.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.fixAddressCase=function(e){return Promise.resolve(e)},n.buildTxActionDirection=function(){var e=(0,s.default)((function*(e){var t=e.from,r=e.to,n=e.address;return t=yield this.fixAddressCase(t||""),r=yield this.fixAddressCase(r),n=yield this.fixAddressCase(n),t===r&&t===n?x.IDecodedTxDirection.SELF:t&&t===n?x.IDecodedTxDirection.OUT:r&&r===n?x.IDecodedTxDirection.IN:x.IDecodedTxDirection.OTHER}));return function(t){return e.apply(this,arguments)}}(),n.getNextNonce=function(){var e=(0,s.default)((function*(e,t){var r,n=null==(r=(yield this.engine.providerManager.getAddresses(e,[t.address]))[0])?void 0:r.nonce;if(u()(n))throw new T.OneKeyError("Get on-chain nonce failed.");yield this.engine.getHistory(e,t.id,void 0,!1);var i=yield m.default.history.getMaxPendingNonce({accountId:this.accountId,networkId:e}),o=yield m.default.history.getPendingNonceList({accountId:this.accountId,networkId:e}),a=Math.max(u()(i)?0:i+1,n);if(Number.isNaN(a)&&(a=n),a>n)for(var s=n;s<a;s+=1)if(!o.includes(s)){a=s;break}if(a<n&&(a=n),a-n>=v.HISTORY_CONSTS.PENDING_QUEUE_MAX_LENGTH)throw new T.PendingQueueTooLong(v.HISTORY_CONSTS.PENDING_QUEUE_MAX_LENGTH);return a}));return function(t,r){return e.apply(this,arguments)}}(),n.validateSendAmount=function(e,t,r){return Promise.resolve(!0)},n.notifyChainChanged=function(e,t){},n.getFetchBalanceAddress=function(e){return Promise.resolve(e.address)},n.getPrivateKeyByCredential=function(e){return Promise.resolve(E.from(e.startsWith("0x")?e.slice(2):e,"hex"))},n.getMinDepositAmount=function(){var e=(0,s.default)((function*(){return"0"}));return function(){return e.apply(this,arguments)}}(),n.specialCheckEncodedTx=function(){var e=(0,s.default)((function*(e){return{success:!0}}));return function(t){return e.apply(this,arguments)}}(),n.getAllUsedAddress=function(){var e=(0,s.default)((function*(){return Promise.resolve([])}));return function(){return e.apply(this,arguments)}}(),(0,d.default)(r)}(D)},607885:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>je});var n=r(968079),i=r(746840),o=r(256666),a=r(684336),u=r.n(a),s=r(196234),d=r(634795),c=r(887371),l=r(545754),f=r(411987),p=r(695058),y=r(206391),h=r.n(y),v=r(740727),g=r(776553),w=r(613549),m=r(814817),T=r(292147),A=r(396564),I=r(940915),x=r(997293),b=r(278489),E=r(398145),O=r(398514),P=r(786141),k=r(174826),D=r(809965),C=2147483648,N=2,S=function(e){var t,r=(0,k.getAddressType)(e);if(r===k.AddressTypes.BOOTSTRAP)return k.base58.encode(e);var n=((t={})[k.AddressTypes.BASE]="addr",t[k.AddressTypes.POINTER]="addr",t[k.AddressTypes.ENTERPRISE]="addr",t[k.AddressTypes.REWARD]="stake",t),i=(0,k.getShelleyAddressNetworkId)(e)===D.NetworkId.TESTNET_OR_PREPROD,o=`${n[r]}${i?"_test":""}`;return k.bech32.encode(o,e)},B=function(e){return(0,k.getPubKeyBlake2b224Hash)(function(e){return e.slice(0,32)}(e))},R=function(e,t){var r=(0,k.packRewardAddress)(B(e),t);return S(r)},F=function(e,t,r){var n=(0,k.packBaseAddress)(B(e),B(t),r);return S(n)},H=function(e){return(e.startsWith("addr1")||e.startsWith("addr_test1"))&&(0,k.isValidShelleyAddress)(e)},K=r(605851),j=r(901187),U=r(348834).Buffer;function M(e){return e.split("/").slice(3,4)[0].slice(0,-1)}function _(e,t){return $.apply(this,arguments)}function $(){return($=(0,d.default)((function*(e,t){var r=(0,K.mnemonicFromEntropy)(t,e);return yield(0,k.mnemonicToRootKeypair)(r,N)}))).apply(this,arguments)}function W(e,t){return L.apply(this,arguments)}function L(){return(L=(0,d.default)((function*(e,t){var r="string"===typeof e?yield _(e,t):e;return k.bech32.encode("xprv",U.concat([r.slice(0,64),r.slice(96)]))}))).apply(this,arguments)}function V(){return(V=(0,d.default)((function*(e,t,r){var n=M(r),i=yield _(e,t);return k.bech32.encode("xprv",U.concat([i.slice(0,64),i.slice(96,128),U.from(n,"utf8")]))}))).apply(this,arguments)}function q(){return(q=(0,d.default)((function*(e,t){var r=G((0,j.decrypt)(e,t)),n=r.rootKey,i=r.index,o=k.bech32.encode("xprv",U.concat([n.slice(0,64),n.slice(96,128),U.from(i,"utf8")]));return Promise.resolve(o)}))).apply(this,arguments)}function G(e){return{rootKey:e.slice(0,128),index:U.from(e.slice(128)).toString("utf8")}}var Y=function(e){return{address:e.address,addressParameters:{path:e.path,addressType:0,stakingPath:`${e.path.slice(0,-3)}2/0`}}},z=r(789644),X=r.n(z),J=r(112889),Q=r(348834).Buffer;function Z(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ee(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Z(Object(r),!0).forEach((function(t){(0,o.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Z(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}const te=function(){function e(e){var t=this;this.getAssociatedAddresses=(0,A.memoizee)(function(){var e=(0,d.default)((function*(e){return(yield t.request.get(`/accounts/${e}/addresses`).then((function(e){return e.data}))).map((function(e){return e.address}))}));return function(t){return e.apply(this,arguments)}}(),{promise:!0,maxAge:(0,g.getTimeDurationMs)({minute:3})}),this.getUTXOs=(0,A.memoizee)(function(){var e=(0,d.default)((function*(e,r,n){var i=n["2/0"],o=(yield t.backendRequest.get(`/utxos?stakeAddress=${i}&xpub=${e}`)).data,a=r.split("/")[3];return o.map((function(e){var t=e.path;if(t&&t.length>0){var r=t.split("/");r.splice(3,1,a),t=r.join("/")}return ee(ee({},e),{},{path:t,output_index:e.tx_index})}))}));return function(t,r,n){return e.apply(this,arguments)}}(),{promise:!0,maxAge:(0,g.getTimeDurationMs)({minute:1})}),this.getHistory=(0,A.memoizee)(function(){var e=(0,d.default)((function*(e,r){return t.backendRequest.get("/history",{params:{stakeAddress:e,address:r}}).then((function(e){return e.data}))}));return function(t,r){return e.apply(this,arguments)}}(),{promise:!0,maxAge:(0,g.getTimeDurationMs)({seconds:30})}),this.getAssetDetail=(0,A.memoizee)(function(){var e=(0,d.default)((function*(e){var r,n,i,o=e.asset,a=e.networkId,s=e.dangerouseFallbackDecimals,d=(yield t.request.get(`/assets/${o}`)).data,c=d.asset_name,l=d.metadata,f=Q.from(c,"hex").toString("utf8"),p=!!/^[\x00-\x7F]+$/.test(f)?f:c;if(u()(null==l?void 0:l.decimals)&&u()(s))throw new I.OneKeyInternalError(`Invalid token address: ${o}`);return{id:`${a}--${o}`,address:o,decimals:null!=(r=null==l?void 0:l.decimals)?r:s,impl:"ada",isNative:!1,networkId:a,symbol:null!=(n=null==l?void 0:l.ticker)?n:p,name:null!=(i=null==l?void 0:l.name)?i:p,tokenIdOnNetwork:o,logoURI:""}}));return function(t){return e.apply(this,arguments)}}(),{promise:!0,maxAge:(0,g.getTimeDurationMs)({minute:1})}),this.request=X().create({baseURL:e,timeout:2e4}),this.backendRequest=X().create({baseURL:`${(0,J.getFiatEndpoint)()}/cardano`,timeout:2e4})}var t=e.prototype;return t.latestBlock=function(){var e=(0,d.default)((function*(){var e,t=yield this.request.get("/blocks/latest").then((function(e){return e.data}));return{height:Number(null!=(e=t.height)?e:0)}}));return function(){return e.apply(this,arguments)}}(),t.getAddress=function(){var e=(0,d.default)((function*(e){return this.request.get(`/addresses/${e}`).then((function(e){return e.data}))}));return function(t){return e.apply(this,arguments)}}(),t.getAddressDetails=function(){var e=(0,d.default)((function*(e){try{return(yield this.request.get(`/addresses/${e}/total`)).data}catch(t){return{address:e,tx_count:0}}}));return function(t){return e.apply(this,arguments)}}(),t.getAccount=function(){var e=(0,d.default)((function*(e){return this.request.get(`/accounts/${e}`).then((function(e){return e.data}))}));return function(t){return e.apply(this,arguments)}}(),t.getBalance=function(){var e=(0,d.default)((function*(e){var t,r=yield this.request.get(`/accounts/${e}`).then((function(e){return e.data}));return null!=(t=new(h())(r.controlled_amount))?t:0}));return function(t){return e.apply(this,arguments)}}(),t.getBalanceWithLovelace=function(){var e=(0,d.default)((function*(e){var t;return{unit:"lovelace",quantity:null!=(t=(yield this.request.get(`/accounts/${e}`).then((function(e){return e.data}))).controlled_amount)?t:"0"}}));return function(t){return e.apply(this,arguments)}}(),t.getRawTransaction=function(){var e=(0,d.default)((function*(e){return this.request.get(`/txs/${e}`).then((function(e){return e.data}))}));return function(t){return e.apply(this,arguments)}}(),t.submitTx=function(){var e=(0,d.default)((function*(e){var t=null;return t="string"===typeof e?Q.from(e,"hex"):Q.from(e),this.request.post("/tx/submit",t,{headers:{"Content-Type":"application/cbor"}}).then((function(e){return e.data}))}));return function(t){return e.apply(this,arguments)}}(),t.getAssetsBalances=function(){var e=(0,d.default)((function*(e){return this.request.get(`/accounts/${e}/addresses/assets`).then((function(e){return e.data}))}));return function(t){return e.apply(this,arguments)}}(),(0,c.default)(e)}();const re={getCardanoApi:{getCardanoApi:function(){var e=(0,d.default)((function*(){var e=yield Promise.all([r.e(20991),r.e(92666),r.e(60482),r.e(73037)]).then(r.bind(r,392666));return{composeTxPlan:e.onekeyUtils.composeTxPlan,signTransaction:e.onekeyUtils.signTransaction,hwSignTransaction:e.trezorUtils.signTransaction,txToOneKey:e.onekeyUtils.txToOneKey,dAppGetBalance:e.dAppUtils.getBalance,dAppGetAddresses:e.dAppUtils.getAddresses,dAppGetUtxos:e.dAppUtils.getUtxos,dAppConvertCborTxToEncodeTx:e.dAppUtils.convertCborTxToEncodeTx,dAppSignData:e.dAppUtils.signData}}));return function(){return e.apply(this,arguments)}}()}.getCardanoApi,ensureSDKReady:function(){var e=(0,d.default)((function*(){return Promise.resolve(!0)}));return function(){return e.apply(this,arguments)}}()};var ne,ie=r(153546),oe=r(799075),ae=r(82406);function ue(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function se(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ue(Object(r),!0).forEach((function(t){(0,o.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ue(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}!function(e){e[e.BASE=0]="BASE",e[e.BASE_SCRIPT_KEY=1]="BASE_SCRIPT_KEY",e[e.BASE_KEY_SCRIPT=2]="BASE_KEY_SCRIPT",e[e.BASE_SCRIPT_SCRIPT=3]="BASE_SCRIPT_SCRIPT",e[e.POINTER=4]="POINTER",e[e.POINTER_SCRIPT=5]="POINTER_SCRIPT",e[e.ENTERPRISE=6]="ENTERPRISE",e[e.ENTERPRISE_SCRIPT=7]="ENTERPRISE_SCRIPT",e[e.BYRON=8]="BYRON",e[e.REWARD=14]="REWARD",e[e.REWARD_SCRIPT=15]="REWARD_SCRIPT"}(ne||(ne={}));var de=function(e,t){return e.map((function(e){var r=t.find((function(t){return t.tx_hash===e.txHash&&+t.output_index===e.outputIndex}));if(!r)throw Error(`Cannot transform utxo ${e.txHash}:${e.outputIndex}`);return{path:r.path,prev_hash:e.txHash,prev_index:e.outputIndex}}))},ce=function(e){return{policyId:e.slice(0,56),assetNameInHex:e.slice(56)}},le=function(e){if(0!==e.length){var t=[];e.forEach((function(e){var r=ce(e.unit).policyId;t.includes(r)||t.push(r)}));var r=[];return t.forEach((function(t){var n=[];e.forEach((function(e){var r=ce(e.unit);r.policyId===t&&n.push({assetNameBytes:r.assetNameInHex,amount:e.quantity})})),r.push({policyId:t,tokenAmounts:n})})),r}},fe=function(e,t){return e.map((function(e){return se(se({},e.isChange?{addressParameters:t}:{address:e.address}),{},{amount:e.amount,tokenBundle:le(e.assets)})}))};function pe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ye(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?pe(Object(r),!0).forEach((function(t){(0,o.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):pe(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function he(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,p.default)(e);if(t){var i=(0,p.default)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,f.default)(this,r)}}var ve=`m/1852'/${w.COINTYPE_ADA}'`,ge=function(){var e=(0,d.default)((function*(){var e=(yield(0,oe.CoreSDKLoader)()).PROTO;return{addressType:e.CardanoAddressType.BASE,derivationType:e.CardanoDerivationType.ICARUS,protocolMagic:764824073,networkId:D.NetworkId.MAINNET}}));return function(){return e.apply(this,arguments)}}(),we=function(e){(0,l.default)(r,e);var t=he(r);function r(){return t.apply(this,arguments)}var i=r.prototype;return i.prepareAccounts=function(){var e=(0,d.default)((function*(e){var t,r=e.indexes,i=e.names,o=0!==r[0],a=[].concat((0,n.default)(o?[r[0]-1]:[]),(0,n.default)(r)),u=a.map((function(e){return`${ve}/${e}'/0/0`})),s=a.map((function(e){return`${ve}/${e}'/2/0`})),d=yield this.getHardwareSDKInstance(),c=yield this.getHardwareInfo(),l=c.connectId,f=c.deviceId,p=yield this.getWalletPassphraseState(),y=yield ge(),h=y.derivationType,v=y.addressType,g=y.networkId,m=y.protocolMagic,A=u.map((function(e,t){return{addressParameters:{addressType:v,path:e,stakingPath:s[t]},networkId:g,protocolMagic:m,derivationType:h,showOnOneKey:false}}));try{t=yield d.cardanoGetAddress(l,f,ye(ye({},p),{},{bundle:A}))}catch(H){throw T.default.common.error(H),new I.OneKeyHardwareError(H)}if(!t.success||!t.payload)throw console.error(t.payload),(0,ie.convertDeviceError)(t.payload);if(t.payload.length!==a.length)throw new I.OneKeyInternalError("Unable to get publick key.");var x=yield this.vault.getClient(),b=[],O=0;for(var P of t.payload){var k=P.address,D=P.xpub,C=P.serializedPath,N=P.stakeAddress;if(k){var S,B=(i||[])[O]||`CARDANO #${a[O]+1}`,R=((S={})["0/0"]=k,S);N&&(R["2/0"]=N);var F=C.slice(0,-4);if((!o||O>0)&&b.push({id:`${this.walletId}--${F}`,name:B,type:E.AccountType.UTXO,path:C,coinType:w.COINTYPE_ADA,xpub:null!=D?D:"",address:k,addresses:R}),1===a.length)break;if(!((yield x.getAddressDetails(k)).tx_count>0))break;O+=1,yield new Promise((function(e){return setTimeout(e,200)}))}}return b}));return function(t){return e.apply(this,arguments)}}(),i.getAddress=function(){var e=(0,d.default)((function*(e){var t,r=yield this.getHardwareSDKInstance(),n=yield this.getHardwareInfo(),i=n.connectId,o=n.deviceId,a=yield this.getWalletPassphraseState(),u=e.path,s=`${u.split("/").slice(0,4).join("/")}/2/0`,d=yield ge(),c=d.derivationType,l=d.addressType,f=d.networkId,p=d.protocolMagic,y=yield r.cardanoGetAddress(i,o,ye(ye({},a),{},{addressParameters:{addressType:l,path:u,stakingPath:s},networkId:f,protocolMagic:p,derivationType:c,isCheck:!0,showOnOneKey:!0}));if(y.success&&null!=(t=y.payload)&&t.address)return y.payload.address;throw(0,ie.convertDeviceError)(y.payload)}));return function(t){return e.apply(this,arguments)}}(),i.batchGetAddress=function(){var e=(0,d.default)((function*(e){var t=yield this.getHardwareSDKInstance(),r=yield this.getHardwareInfo(),n=r.connectId,i=r.deviceId,o=yield this.getWalletPassphraseState(),a=yield ge(),u=a.derivationType,s=a.addressType,d=a.networkId,c=a.protocolMagic,l=yield t.cardanoGetAddress(n,i,ye(ye({},o),{},{bundle:e.map((function(e){var t=e.path,r=e.showOnOneKey,n=`${t.split("/").slice(0,4).join("/")}/2/0`;return{addressParameters:{addressType:s,path:t,stakingPath:n},networkId:d,protocolMagic:c,derivationType:u,isCheck:!0,showOnOneKey:!!r}}))}));if(!l.success)throw(0,ie.convertDeviceError)(l.payload);return l.payload.map((function(e){return{path:e.serializedPath,address:e.address}}))}));return function(t){return e.apply(this,arguments)}}(),i.signTransaction=function(){var e=(0,d.default)((function*(e){var t,r=(yield(0,oe.CoreSDKLoader)()).PROTO,n=yield this.getHardwareSDKInstance(),i=yield this.getHardwareInfo(),o=i.connectId,a=i.deviceId,u=yield this.getWalletPassphraseState(),s=e.payload.encodedTx,d=yield this.getDbAccount(),c=Y(d),l=yield ge(),f=l.derivationType,p=l.networkId,y=l.protocolMagic,h=yield(yield this.vault.getClient()).getUTXOs(d.xpub,d.path,d.addresses),v=s.inputs,g=s.outputs,w=s.fee,m=s.tx,A=!!s.signOnly,I=m.rawTxHex,x=yield re.getCardanoApi();if(A&&I){var b=`${d.path.split("/").slice(0,4).join("/")}/2/0`,E={payment:{hash:null,path:d.path},stake:{hash:null,path:b}};t=yield x.txToOneKey(I,p,E,d.xpub,c)}else t={signingMode:r.CardanoTxSigningMode.ORDINARY_TRANSACTION,outputs:fe(g,c.addressParameters),fee:w,protocolMagic:y,networkId:p};T.default.hardwareSDK.info("cardano signTx params: ",t);var O=yield n.cardanoSignTransaction(o,a,ye(ye({},u),{},{inputs:de(v,h),derivationType:f},t));if(!O.success)throw(0,ie.convertDeviceError)(O.payload);return{rawTx:yield x.hwSignTransaction(m.body,O.payload.witnesses,{signOnly:!!s.signOnly}),txid:m.hash}}));return function(t){return e.apply(this,arguments)}}(),i.signMessage=function(){var e=(0,d.default)((function*(e){T.default.common.info("signMessage",e);var t=yield this.getDbAccount(),r=yield this.getHardwareInfo(),n=r.connectId,i=r.deviceId,o=yield this.getWalletPassphraseState(),a=yield this.getHardwareSDKInstance(),u=yield ge(),s=u.derivationType,c=u.networkId,l=yield Promise.all(e.map(function(){var e=(0,d.default)((function*(e){var r=e.payload,u=yield a.cardanoSignMessage(n,i,ye(ye({},o),{},{path:t.path,networkId:c,derivationType:s,message:r.payload}));if(!u.success)throw(0,ie.convertDeviceError)(u.payload);return u.payload}));return function(t){return e.apply(this,arguments)}}()));return l.map((function(e){return JSON.stringify(e)}))}));return function(t){return e.apply(this,arguments)}}(),(0,c.default)(r)}(ae.KeyringHardwareBase),me=r(794292),Te=r(810887),Ae=function(e){return[2147485500,2147485463,C+e,2,0]},Ie=function(e,t){return e.reduce((function(e,t){return(0,k.derivePrivate)(e,t,N)}),t)},xe=function(e,t){var r=Ie(e,t);return(0,k.toPublic)(r.slice(0,64))},be=function(e,t,r){var n=Ae(e),i=xe(n,t);return{path:n,address:R(i,r)}},Ee=function(e,t,r){var n,i=[2147485500,2147485463,C+e,0,0],o=xe(i,t),a=Ae(e),u=xe(a,t),s=function(e,t){return Ie(e,t).slice(64).toString("hex")}(i.slice(0,3),t);return{path:(n=i,`m/${n.map((function(e){return e%C+(e>=C?"'":"")})).join("/")}`),address:F(o,u,r),xpub:s}},Oe=function(e,t,r){return t.map((function(t){return{baseAddress:Ee(t,e,r),stakingAddress:be(t,e,r)}}))},Pe=function(){var e=(0,d.default)((function*(e,t,r,n){var i=yield _(t,e);return Oe(i,r,n)}));return function(t,r,n,i){return e.apply(this,arguments)}}();function ke(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,p.default)(e);if(t){var i=(0,p.default)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,f.default)(this,r)}}var De=function(e){(0,l.default)(r,e);var t=ke(r);function r(){return t.apply(this,arguments)}var i=r.prototype;return i.getSigners=function(){var e=(0,d.default)((function*(e,t){var r,n=yield this.getDbAccount();if(1!==t.length)throw new I.OneKeyInternalError("Starcoin signers number should be 1.");if(t[0]!==n.address)throw new I.OneKeyInternalError("Wrong address required for signing.");var i=(yield this.getPrivateKeys(e))[n.path];if("undefined"===typeof i)throw new I.OneKeyInternalError("Unable to get signer.");return(r={})[n.address]=new me.Signer(i,e,"ed25519"),r}));return function(t,r){return e.apply(this,arguments)}}(),i.prepareAccounts=function(){var e=(0,d.default)((function*(e){var t=e.password,r=e.indexes,i=e.names,o=e.skipCheckAccountExist,a=0!==r[0],u=[].concat((0,n.default)(a?[r[0]-1]:[]),(0,n.default)(r)),s=(yield this.engine.dbApi.getCredential(this.walletId,t)).entropy,d=yield Pe(s,t,u,D.NetworkId.MAINNET);if(d.length!==u.length)throw new I.OneKeyInternalError("Unable to get address");var c=yield this.vault.getClient(),l=[],f=0;for(var p of d){var y,h=p.baseAddress,v=p.stakingAddress,g=h.address,m=h.path,T=h.xpub,A=(i||[])[f]||`CARDANO #${u[f]+1}`,x=m.slice(0,-4);if(!a||f>0)l.push({id:`${this.walletId}--${x}`,name:A,type:E.AccountType.UTXO,path:m,coinType:w.COINTYPE_ADA,xpub:T,address:g,addresses:(y={},y["0/0"]=g,y["2/0"]=v.address,y)});if(1===u.length)break;if(o)f+=1;else{if(!((yield c.getAddressDetails(g)).tx_count>0))break;f+=1,yield new Promise((function(e){return setTimeout(e,200)}))}}return l}));return function(t){return e.apply(this,arguments)}}(),i.signTransaction=function(){var e=(0,d.default)((function*(e,t){T.default.sendTx.info("signTransaction result",e);var r=e.payload.encodedTx,n=yield this.getDbAccount(),i=t.password,o=void 0===i?"":i,a=(yield this.engine.dbApi.getCredential(this.walletId,o)).entropy,u=yield W(o,a),s=M(n.path),d=yield re.getCardanoApi(),c=yield d.signTransaction(r.tx.body,n.address,Number(s),r.inputs,u,!!r.signOnly,!1);return{rawTx:c.signedTx,txid:c.txid,encodedTx:e.encodedTx}}));return function(t,r){return e.apply(this,arguments)}}(),i.signMessage=function(){var e=(0,d.default)((function*(e,t){var r=yield this.getDbAccount(),n=t.password,i=void 0===n?"":n,o=(yield this.engine.dbApi.getCredential(this.walletId,i)).entropy,a=yield W(i,o),u=M(r.path),s=yield re.getCardanoApi();return(yield Promise.all(e.map((function(e){var t=e.payload;return s.dAppSignData(t.addr,t.payload,a,Number(u))})))).map((function(e){return JSON.stringify(e)}))}));return function(t,r){return e.apply(this,arguments)}}(),(0,c.default)(r)}(Te.KeyringHdBase);function Ce(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,p.default)(e);if(t){var i=(0,p.default)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,f.default)(this,r)}}var Ne=function(e){(0,l.default)(r,e);var t=Ce(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.getPrivateKeys=function(){var e=(0,d.default)((function*(e,t){var r;if("undefined"!==typeof t)throw new I.NotImplemented("Getting private keys from extended private key");var n=yield this.getDbAccount(),i=(yield this.engine.dbApi.getCredential(this.accountId,e)).privateKey;if("undefined"===typeof i)throw new I.OneKeyInternalError("Unable to get credential.");return(r={})[n.path]=i,r}));return function(t,r){return e.apply(this,arguments)}}(),n.getSigners=function(){var e=(0,d.default)((function*(e,t){var r,n=yield this.getDbAccount();if(1!==t.length)throw new I.OneKeyInternalError("Starcoin signers number should be 1.");if(t[0]!==n.address)throw new I.OneKeyInternalError("Wrong address required for signing.");var i=(yield this.getPrivateKeys(e))[n.path];if("undefined"===typeof i)throw new I.OneKeyInternalError("Unable to get signer.");return(r={})[n.address]=new me.Signer(i,e,"ed25519"),r}));return function(t,r){return e.apply(this,arguments)}}(),n.prepareAccounts=function(e){var t,r=e.privateKey,n=e.name,i=G(r),o=parseInt(i.index),a=Oe(i.rootKey,[o],D.NetworkId.MAINNET)[0],u=a.baseAddress,s=a.stakingAddress,d=u.address,c=u.path,l=u.xpub;return Promise.resolve([{id:`imported--${w.COINTYPE_ADA}--${l}`,name:n||"",type:E.AccountType.UTXO,path:c,coinType:w.COINTYPE_ADA,xpub:l,address:d,addresses:(t={},t["0/0"]=d,t["2/0"]=s.address,t)}])},n.signTransaction=function(){var e=(0,d.default)((function*(e,t){T.default.sendTx.info("signTransaction result",e);var r=e.payload.encodedTx,n=yield this.getDbAccount(),i=(yield this.getSigners(t.password||"",[n.address]))[n.address],o=G(yield i.getPrvkey()),a=yield W(o.rootKey),u=M(n.path),s=yield re.getCardanoApi(),d=yield s.signTransaction(r.tx.body,n.address,Number(u),r.inputs,a,!!r.signOnly,!1);return{rawTx:d.signedTx,txid:d.txid,encodedTx:e.encodedTx}}));return function(t,r){return e.apply(this,arguments)}}(),n.signMessage=function(){var e=(0,d.default)((function*(e,t){var r=yield this.getDbAccount(),n=(yield this.getSigners(t.password||"",[r.address]))[r.address],i=G(yield n.getPrvkey()),o=yield W(i.rootKey),a=M(r.path),u=yield re.getCardanoApi();return(yield Promise.all(e.map((function(e){var t=e.payload;return u.dAppSignData(t.addr,t.payload,o,Number(a))})))).map((function(e){return JSON.stringify(e)}))}));return function(t,r){return e.apply(this,arguments)}}(),(0,c.default)(r)}(r(255942).KeyringImportedBase);function Se(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,p.default)(e);if(t){var i=(0,p.default)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,f.default)(this,r)}}var Be=function(e){(0,l.default)(r,e);var t=Se(r);function r(){return t.apply(this,arguments)}return r.prototype.prepareAccounts=function(){var e=(0,d.default)((function*(e){var t,r=e.target,n=e.name,i=e.accountIdPrefix,o=yield this.vault.validateAddress(r);if("undefined"===typeof o)throw new I.InvalidAddress;var a,u=yield this.vault.getClient();try{a=yield u.getAddress(o)}catch(d){throw new I.InvalidAccount}var s=((t={})["0/0"]=o,t["2/0"]=a.stake_address,t);return Promise.resolve([{id:`${i}--${w.COINTYPE_ADA}--${r}`,name:n||"",type:E.AccountType.UTXO,path:"",coinType:w.COINTYPE_ADA,xpub:"",address:o,addresses:s}])}));return function(t){return e.apply(this,arguments)}}(),(0,c.default)(r)}(r(701625).KeyringWatchingBase),Re=r(945585);function Fe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function He(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Fe(Object(r),!0).forEach((function(t){(0,o.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Fe(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Ke(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,p.default)(e);if(t){var i=(0,p.default)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,f.default)(this,r)}}var je=function(e){(0,l.default)(r,e);var t=Ke(r);function r(){for(var e,r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return(e=t.call.apply(t,[this].concat(n))).keyringMap={hd:De,hw:we,imported:Ne,watching:Be,external:Be},e.settings=Re.default,e.getClientCache=(0,A.memoizee)((function(e){return new te(e)}),{maxAge:(0,g.getTimeDurationMs)({minute:3})}),e.getInputOrOutputBalance=function(e,t){var r,n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"lovelace",o=e.filter((function(e){return e.unit===i}));if(!o||o.length<=0)return{balance:"0",balanceValue:"0"};var a=null!=(r=null==(n=o[0])?void 0:n.quantity)?r:"0";return{balance:new(h())(a).shiftedBy(-t).toFixed(),balanceValue:a}},e.getOutputAmount=function(e,t){var r,n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"lovelace",o=e.find((function(e){return!e.isChange}));if(!o)return{amount:new(h())(0).shiftedBy(-t).toFixed(),amountValue:"0"};if("lovelace"===i)return{amount:new(h())(o.amount).shiftedBy(-t).toFixed(),amountValue:o.amount};var a=o.assets.find((function(e){return e.unit===i}));return{amount:new(h())(null!=(r=null==a?void 0:a.quantity)?r:0).shiftedBy(-t).toFixed(),amountValue:null!=(n=null==a?void 0:a.quantity)?n:"0"}},e.getStakeAddress=(0,A.memoizee)(function(){var t=(0,d.default)((function*(t){return H(t)&&t.startsWith("stake")?t:(yield e.engine.dbApi.getAccountByAddress({address:t,coinType:w.COINTYPE_ADA})).addresses["2/0"]}));return function(e){return t.apply(this,arguments)}}(),{maxAge:(0,g.getTimeDurationMs)({minute:3}),promise:!0}),e}var o=r.prototype;return o.getClient=function(){var e=(0,d.default)((function*(){var e=yield this.getRpcUrl();return this.getClientCache(e)}));return function(){return e.apply(this,arguments)}}(),o.getOutputAccount=function(){var e=(0,d.default)((function*(){var e=yield this.getDbAccount({noCache:!0});return{id:e.id,name:e.name,type:e.type,path:e.path,coinType:e.coinType,tokens:[],address:e.address,addresses:JSON.stringify(e.addresses),template:e.template}}));return function(){return e.apply(this,arguments)}}(),o.getFetchBalanceAddress=function(e){if(e.type===E.AccountType.UTXO&&"object"===typeof e.addresses)return Promise.resolve(e.addresses["2/0"]);if("string"===typeof e.addresses)try{var t=JSON.parse(e.addresses);return Promise.resolve(t["2/0"])}catch(r){return Promise.resolve(e.address)}return Promise.resolve(e.address)},o.getClientEndpointStatus=function(){var e=(0,d.default)((function*(){var e=performance.now(),t=yield this.getClient(),r=yield t.latestBlock();return{responseTime:Math.floor(performance.now()-e),latestBlock:r.height}}));return function(){return e.apply(this,arguments)}}(),o.validateCanCreateNextAccount=function(){var e=(0,d.default)((function*(e,t){var r=yield Promise.all([this.engine.getWallet(e),this.engine.getNetwork(this.networkId)]),n=(0,s.default)(r,2),i=n[0],o=n[1],a=(0,x.getLastAccountId)(i,o.impl,t);if(!a)return!0;var u=yield this.engine.dbApi.getAccounts([a]),d=(0,s.default)(u,1)[0];if("undefined"!==typeof d&&!(yield this.checkAccountExistence(d.address))){var c=(0,b.getAccountNameInfoByTemplate)(o.impl,t).label;throw new I.PreviousAccountIsEmpty(c)}return!0}));return function(t,r){return e.apply(this,arguments)}}(),o.checkAccountExistence=function(){var e=(0,d.default)((function*(e){var t=!1;try{var r=yield this.getClient();t=(yield r.getAddressDetails(e)).tx_count>0}catch(n){console.error(n)}return Promise.resolve(t)}));return function(t){return e.apply(this,arguments)}}(),o.validateAddress=function(){var e=(0,d.default)((function*(e){return e.length<35?Promise.reject(new I.InvalidAddress):H(e)||function(e){return(e.startsWith("Ae2")||e.startsWith("DdzFF"))&&(0,k.isValidBootstrapAddress)(e)}(e)?Promise.resolve(e):Promise.reject(new I.InvalidAddress)}));return function(t){return e.apply(this,arguments)}}(),o.validateWatchingCredential=function(e){var t=!1;try{this.settings.watchingAccountEnabled&&H(e)&&(t=!0)}catch(r){}return Promise.resolve(t)},o.validateImportedCredential=function(e){return Promise.resolve(this.settings.importedAccountEnabled&&/^xprv/.test(e)&&e.length>=165)},o.getExportedCredential=function(){var e=(0,d.default)((function*(e){if((0,m.isHdWallet)({walletId:this.walletId}))return function(e,t,r){return V.apply(this,arguments)}(e,(yield this.engine.dbApi.getCredential(this.walletId,e)).entropy,(yield this.getDbAccount()).path);if((0,m.isImportedWallet)({walletId:this.walletId})){var t=yield this.getDbAccount(),r=this.keyring;return function(e,t){return q.apply(this,arguments)}(e,(yield r.getPrivateKeys(e))[t.path])}throw new Error("Not implemented")}));return function(t){return e.apply(this,arguments)}}(),o.attachFeeInfoToEncodedTx=function(e){return Promise.resolve(e.encodedTx)},o.decodedTxToLegacy=function(e){return Promise.resolve({})},o.decodeTx=function(){var e=(0,d.default)((function*(e,t){var r,n=this,i=e.inputs,o=e.outputs,a=e.transferInfo,u=yield this.engine.getNetwork(this.networkId),s=yield this.getDbAccount(),d=yield this.getClient(),c=yield this.engine.getNativeTokenInfo(this.networkId),l=[],f=yield this.engine.getNativeTokenInfo(this.networkId);if(!(null==a||null==(r=a.token)||!r.length)){var p,y,v;if(!(f=yield this.engine.ensureTokenInDB(this.networkId,null!=(p=a.token)?p:"")))f=yield d.getAssetDetail({asset:null!=(v=a.token)?v:"",networkId:this.networkId,dangerouseFallbackDecimals:e.signOnly?0:void 0});var g=this.getOutputAmount(o,null!=(y=f.decimals)?y:u.decimals,a.token),w={tokenInfo:f,from:s.address,to:a.to,amount:g.amount,amountValue:g.amountValue,extraInfo:null};l.push({type:O.IDecodedTxActionType.TOKEN_TRANSFER,direction:o[0].address===s.address?O.IDecodedTxDirection.OUT:O.IDecodedTxDirection.SELF,tokenTransfer:w})}var m=this.getOutputAmount(o,u.decimals),T={tokenInfo:c,utxoFrom:i.map((function(e){var t=n.getInputOrOutputBalance(e.amount,u.decimals),r=t.balance,i=t.balanceValue;return{address:e.address,balance:r,balanceValue:i,symbol:u.symbol,isMine:!0}})),utxoTo:o.map((function(e){return{address:e.address,balance:new(h())(e.amount).shiftedBy(u.decimals).toFixed(),balanceValue:e.amount,symbol:u.symbol,isMine:e.address===s.address}})),from:s.address,to:a.to,amount:m.amount,amountValue:m.amountValue,extraInfo:null};return l.push({type:O.IDecodedTxActionType.NATIVE_TRANSFER,direction:o[0].address===s.address?O.IDecodedTxDirection.OUT:O.IDecodedTxDirection.SELF,nativeTransfer:T}),{txid:"",owner:s.address,signer:s.address,nonce:0,actions:l,status:O.IDecodedTxStatus.Pending,networkId:this.networkId,accountId:this.accountId,extraInfo:null,totalFeeInNative:e.totalFeeInNative}}));return function(t,r){return e.apply(this,arguments)}}(),o.buildEncodedTxFromTransfer=function(){var e=(0,d.default)((function*(e){if(!e.to)throw new Error("Invalid transferInfo.to params");var t=e.to,r=e.amount,n=e.token,i=yield this.getDbAccount(),o=yield this.engine.getNetwork(this.networkId),a=o.decimals,d=o.feeDecimals,c=yield this.engine.ensureTokenInDB(this.networkId,null!=n?n:"");if(!c||u()(c.decimals))throw new I.OneKeyInternalError(`Token not found: ${n||"main"}`);var l,f=yield this.getClient(),p=i.xpub,y=i.path,v=i.addresses,g=yield Promise.all([f.getUTXOs(p,y,v),re.ensureSDKReady()]),w=(0,s.default)(g,1)[0],m=new(h())(r);l=n?{address:t,amount:void 0,assets:[{quantity:m.shiftedBy(c.decimals).toFixed(),unit:n}]}:{address:t,amount:m.shiftedBy(a).toFixed(),assets:[]};var T,A=yield re.getCardanoApi();try{T=yield A.composeTxPlan(e,i.xpub,w,i.address,[l])}catch(S){var x="UTXO_VALUE_TOO_SMALL",b="UTXO_BALANCE_INSUFFICIENT";if([x,b].includes(S.code)||[x,b].includes(S.message))throw new I.InsufficientBalance;throw S}var E=Y(i),O=T,P=O.fee,k=O.inputs,D=O.outputs,C=O.totalSpent,N=O.tx;return{inputs:k,outputs:D,fee:P,totalSpent:C,totalFeeInNative:new(h())(P).shiftedBy(-1*d).toFixed(),transferInfo:e,tx:N,changeAddress:E,signOnly:!1}}));return function(t){return e.apply(this,arguments)}}(),o.buildEncodedTxFromApprove=function(e){throw new I.NotImplemented},o.updateEncodedTxTokenApprove=function(e,t){throw new I.NotImplemented},o.updateEncodedTx=function(e){return Promise.resolve(e)},o.buildUnsignedTxFromEncodedTx=function(){var e=(0,d.default)((function*(e){var t={inputs:e.inputs,outputs:e.outputs,payload:{},encodedTx:e};return Promise.resolve(t)}));return function(t){return e.apply(this,arguments)}}(),o.fetchOnChainHistory=function(){var e=(0,d.default)((function*(e){var t=this,r=e.localHistory,n=void 0===r?[]:r,i=yield this.getClient(),o=yield this.getDbAccount(),a=yield this.getStakeAddress(o.address),u=(yield this.engine.getNetwork(this.networkId)).decimals,s=yield this.engine.getNativeTokenInfo(this.networkId),c=[];try{var l;c=null!=(l=yield i.getHistory(a,o.address))?l:[]}catch(p){console.error(p)}var f=c.map(function(){var e=(0,d.default)((function*(e){try{var r,i=n.find((function(t){return t.decodedTx.txid===e.tx_hash}));if(i&&i.decodedTx.isFinal)return null;var a=e.tx,c=a.fee,l=a.actions,f=a.block_hash,y=a.tx_timestamp,v=l.map(function(){var e=(0,d.default)((function*(e){var r=e.from,n=e.to,i=e.amount,o=(e.type,e.direction);if("NATIVE_TRANSFER"===e.type)return{type:O.IDecodedTxActionType.NATIVE_TRANSFER,direction:o,nativeTransfer:{tokenInfo:s,utxoFrom:e.utxoFrom,utxoTo:e.utxoTo,from:r,to:n,amount:i,amountValue:e.amountValue,extraInfo:null}};if("TOKEN_TRANSFER"===e.type){var a,d=yield t.engine.ensureTokenInDB(t.networkId,e.token.tokenIdOnNetwork);return!(!d||"undefined"===typeof d.decimals)&&{type:O.IDecodedTxActionType.TOKEN_TRANSFER,direction:o,tokenTransfer:{tokenInfo:null!=d?d:e.token,from:r,to:n,amount:new(h())(e.amount).shiftedBy(-(null!=(a=null==d?void 0:d.decimals)?a:u)).toFixed(),amountValue:e.amount,extraInfo:null}}}}));return function(t){return e.apply(this,arguments)}}()),g=(yield Promise.all(v)).filter(Boolean),w={txid:e.tx_hash,owner:o.address,signer:o.address,nonce:0,actions:g,status:f?O.IDecodedTxStatus.Confirmed:O.IDecodedTxStatus.Pending,networkId:t.networkId,accountId:t.accountId,extraInfo:null,totalFeeInNative:new(h())(c).shiftedBy(-u).toFixed()};return w.updatedAt="undefined"!==typeof y?1e3*y:Date.now(),w.createdAt=null!=(r=null==i?void 0:i.decodedTx.createdAt)?r:w.updatedAt,w.isFinal=w.status===O.IDecodedTxStatus.Confirmed,yield t.buildHistoryTx({decodedTx:w,historyTxToMerge:i})}catch(p){return console.error(p),Promise.resolve(null)}}));return function(t){return e.apply(this,arguments)}}());return(yield Promise.all(f)).filter(Boolean)}));return function(t){return e.apply(this,arguments)}}(),o.broadcastTransaction=function(){var e=(0,d.default)((function*(e){T.default.engine.info("broadcastTransaction START:",{rawTx:e.rawTx});var t=yield this.getClient();try{yield t.submitTx(e.rawTx)}catch(r){throw T.default.sendTx.info("broadcastTransaction ERROR:",r),r}return T.default.engine.info("broadcastTransaction END:",{txid:e.txid,rawTx:e.rawTx}),He(He({},e),{},{encodedTx:e.encodedTx})}));return function(t){return e.apply(this,arguments)}}(),o.fetchFeeInfo=function(){var e=(0,d.default)((function*(e){var t=yield this.engine.getNetwork(this.networkId);return{customDisabled:!0,limit:e.totalFeeInNative,prices:["1"],defaultPresetIndex:"0",feeSymbol:t.symbol,feeDecimals:t.feeDecimals,nativeSymbol:t.symbol,nativeDecimals:t.decimals,tx:null}}));return function(t){return e.apply(this,arguments)}}(),o.getTransactionStatuses=function(){var e=(0,d.default)((function*(e){var t=yield this.getClient();return Promise.all(e.map(function(){var e=(0,d.default)((function*(e){try{var r=yield t.getRawTransaction(e);return r.index||r.block_height?v.TransactionStatus.CONFIRM_AND_SUCCESS:v.TransactionStatus.PENDING}catch(n){return console.error(n),v.TransactionStatus.PENDING}}));return function(t){return e.apply(this,arguments)}}()))}));return function(t){return e.apply(this,arguments)}}(),o.getBalances=function(){var e=(0,d.default)((function*(e){var t,r=yield this.getClient();if(e.every((function(e){return e.address.startsWith("stake")}))){var n=yield Promise.all(e.map(function(){var e=(0,d.default)((function*(e){try{return yield r.getBalance(e.address)}catch(t){return new(h())(0)}}));return function(t){return e.apply(this,arguments)}}()));return n}var o=yield this.getStakeAddress(null==(t=e[0])?void 0:t.address),a=[r.getBalance(o)];e.some((function(e){return e.tokenAddress}))&&a.push(r.getAssetsBalances(o));try{var u=yield Promise.all(a),s=(0,i.default)(u),c=s[0],l=s.slice(1);return e.map((function(e){e.address;var t=e.tokenAddress;if(!t)return c;if(Array.isArray(l)&&l.length){var r,n,i=null!=(r=null==(n=l[0].find((function(e){return e.unit===t})))?void 0:n.quantity)?r:0;return new(h())(i)}return new(h())(0)}))}catch(f){return e.map((function(){return new(h())(0)}))}}));return function(t){return e.apply(this,arguments)}}(),o.validateTokenAddress=function(){var e=(0,d.default)((function*(e){var t=yield this.getClient();try{var r,n=yield t.getAssetDetail({asset:e,networkId:this.networkId});return null!=(r=n.address)?r:n.tokenIdOnNetwork}catch(i){throw console.error(i),i}}));return function(t){return e.apply(this,arguments)}}(),o.fetchTokenInfos=function(){var e=(0,d.default)((function*(e){var t=this,r=yield this.getClient();return Promise.all(e.map(function(){var e=(0,d.default)((function*(e){var n=yield r.getAssetDetail({asset:e,networkId:t.networkId});return{decimals:n.decimals,name:n.name,symbol:n.symbol}}));return function(t){return e.apply(this,arguments)}}()))}));return function(t){return e.apply(this,arguments)}}(),o.getPrivateKeyByCredential=function(){var e=(0,d.default)((function*(e){return Promise.resolve(function(e){var t=k.bech32.decode(e),r=t.data.slice(96),n=(0,k.toPublic)(t.data.slice(0,64));return U.concat([t.data.slice(0,64),n,t.data.slice(64,96),r])}(e))}));return function(t){return e.apply(this,arguments)}}(),o.getBalanceForDapp=function(){var e=(0,d.default)((function*(e){var t=yield this.getClient(),r=yield this.getStakeAddress(e),i=[t.getBalanceWithLovelace(r),t.getAssetsBalances(r)],o=yield Promise.all(i),a=(0,s.default)(o,2),u=a[0],d=a[1],c=[u].concat((0,n.default)(d));return(yield re.getCardanoApi()).dAppGetBalance(c)}));return function(t){return e.apply(this,arguments)}}(),o.getUtxosForDapp=function(){var e=(0,d.default)((function*(e){var t=yield this.getDbAccount(),r=yield this.getClient(),n=t.xpub,i=t.path,o=t.addresses,a=yield r.getUTXOs(n,i,o);return(yield re.getCardanoApi()).dAppGetUtxos(t.address,a,e)}));return function(t){return e.apply(this,arguments)}}(),o.getAccountAddressForDapp=function(){var e=(0,d.default)((function*(){var e=yield this.getDbAccount();return(yield re.getCardanoApi()).dAppGetAddresses([e.address])}));return function(){return e.apply(this,arguments)}}(),o.getStakeAddressForDapp=function(){var e=(0,d.default)((function*(){var e=yield this.getDbAccount(),t=yield this.getStakeAddress(e.address);return(yield re.getCardanoApi()).dAppGetAddresses([t])}));return function(){return e.apply(this,arguments)}}(),o.buildTxCborToEncodeTx=function(){var e=(0,d.default)((function*(e){var t=yield this.getDbAccount(),r=Y(t),n=yield this.getClient(),i=yield this.getStakeAddress(t.address),o=yield n.getAssociatedAddresses(i),a=t.xpub,u=t.path,s=t.addresses,d=yield n.getUTXOs(a,u,s),c=yield re.getCardanoApi();return He(He({},yield c.dAppConvertCborTxToEncodeTx(e,d,o,r)),{},{changeAddress:r})}));return function(t){return e.apply(this,arguments)}}(),(0,c.default)(r)}(P.VaultBase)},565147:(e,t,r)=>{"use strict";r.r(t),r.d(t,{KeyringBase:()=>d,KeyringBaseMock:()=>c});var n=r(634795),i=r(887371),o=r(545754),a=r(411987),u=r(695058);function s(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,u.default)(e);if(t){var i=(0,u.default)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,a.default)(this,r)}}var d=function(e){(0,o.default)(r,e);var t=s(r);function r(e){var r;return(r=t.call(this,e.options)).vault=e,r}return r.prototype.addressFromBase=function(){var e=(0,n.default)((function*(e){return this.vault.addressFromBase(e)}));return function(t){return e.apply(this,arguments)}}(),(0,i.default)(r)}(r(114540).VaultContext),c=function(e){(0,o.default)(r,e);var t=s(r);function r(){return t.apply(this,arguments)}return(0,i.default)(r)}(d)},82406:(e,t,r)=>{"use strict";r.r(t),r.d(t,{KeyringHardwareBase:()=>l});var n=r(634795),i=r(887371),o=r(545754),a=r(411987),u=r(695058),s=r(799075),d=r(814817);function c(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,u.default)(e);if(t){var i=(0,u.default)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,a.default)(this,r)}}var l=function(e){(0,o.default)(a,e);var t=c(a);function a(){return t.apply(this,arguments)}var u=a.prototype;return u.getHardwareInfo=function(){var e=(0,n.default)((function*(){var e,t,r,n=yield this.engine.getHWDeviceByWalletId(this.vault.walletId);return{connectId:null!=(e=null==n?void 0:n.mac)?e:"",deviceId:null!=(t=null==n?void 0:n.deviceId)?t:"",deviceType:null!=(r=null==n?void 0:n.deviceType)?r:""}}));return function(){return e.apply(this,arguments)}}(),u.getWalletPassphraseState=function(){var e=(0,n.default)((function*(){var e=yield this.engine.getWallet(this.vault.walletId);return{passphraseState:null==e?void 0:e.passphraseState,useEmptyPassphrase:!(0,d.isPassphraseWallet)(e)}}));return function(){return e.apply(this,arguments)}}(),u.getHardwareSDKInstance=function(){var e=(0,n.default)((function*(){var e,t,n,i,o;return null!=(o=yield null==(e=r.g)||null==(t=e.$backgroundApiProxy)||null==(n=t.backgroundApi)||null==(i=n.serviceHardware)||null==i.getSDKInstance?void 0:i.getSDKInstance())?o:s.HardwareSDK}));return function(){return e.apply(this,arguments)}}(),u.prepareAccountByAddressIndex=function(e){throw new Error("Method not implemented.")},(0,i.default)(a)}(r(565147).KeyringBase)},810887:(e,t,r)=>{"use strict";r.r(t),r.d(t,{KeyringHdBase:()=>y});var n=r(256666),i=r(634795),o=r(887371),a=r(545754),u=r(411987),s=r(695058),d=r(605851),c=r(940915);function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function f(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function p(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,s.default)(e);if(t){var i=(0,s.default)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,u.default)(this,r)}}var y=function(e){(0,a.default)(r,e);var t=p(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.getPrivateKeys=function(){var e=(0,i.default)((function*(e,t){var r=(yield this.getDbAccount()).path.split("/"),n=t||[r.pop()],i=r.join("/"),o=(yield this.engine.dbApi.getCredential(this.walletId,e)).seed;if("undefined"===typeof o)throw new c.OneKeyInternalError("Unable to get credential.");var a=(yield this.engine.providerManager.getChainInfoByNetworkId(this.networkId)).curve;return(0,d.batchGetPrivateKeys)(a,o,e,i,n).reduce((function(e,t){var r;return f(f({},e),{},((r={})[t.path]=t.extendedKey.key,r))}),{})}));return function(t,r){return e.apply(this,arguments)}}(),n.getAddress=function(){throw new Error("Method not implemented.")},n.batchGetAddress=function(){throw new Error("Method not implemented.")},n.prepareAccountByAddressIndex=function(e){throw new Error("Method not implemented.")},(0,o.default)(r)}(r(280306).KeyringSoftwareBase)},255942:(e,t,r)=>{"use strict";r.r(t),r.d(t,{KeyringImportedBase:()=>c});var n=r(634795),i=r(887371),o=r(545754),a=r(411987),u=r(695058),s=r(940915);function d(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,u.default)(e);if(t){var i=(0,u.default)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,a.default)(this,r)}}var c=function(e){(0,o.default)(r,e);var t=d(r);function r(){return t.apply(this,arguments)}var a=r.prototype;return a.getPrivateKeys=function(){var e=(0,n.default)((function*(e,t){if("undefined"!==typeof t)throw new s.NotImplemented("Getting private keys from extended private key");var r=(yield this.engine.dbApi.getCredential(this.accountId,e)).privateKey;if("undefined"===typeof r)throw new s.OneKeyInternalError("Unable to get credential.");return{"":r}}));return function(t,r){return e.apply(this,arguments)}}(),a.getAddress=function(){throw new Error("Method not implemented.")},a.batchGetAddress=function(){throw new Error("Method not implemented.")},a.prepareAccountByAddressIndex=function(){throw new Error("Method not implemented.")},(0,i.default)(r)}(r(280306).KeyringSoftwareBase)},280306:(e,t,r)=>{"use strict";r.r(t),r.d(t,{KeyringSoftwareBase:()=>h});var n=r(196234),i=r(256666),o=r(634795),a=r(887371),u=r(545754),s=r(411987),d=r(695058),c=r(292147),l=r(940915);function f(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?f(Object(r),!0).forEach((function(t){(0,i.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):f(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function y(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,d.default)(e);if(t){var i=(0,d.default)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,s.default)(this,r)}}var h=function(e){(0,u.default)(r,e);var t=y(r);function r(){return t.apply(this,arguments)}var i=r.prototype;return i.signTransaction=function(){var e=(0,o.default)((function*(e,t){var r=t.password;if("undefined"===typeof r)throw new l.OneKeyInternalError("Software signing requires a password.");var n=yield this.getSigners(r,e.inputs.map((function(e){return e.address})));return c.default.engine.info("signTransaction",this.networkId,e),p(p({},yield this.engine.providerManager.signTransaction(this.networkId,e,n)),{},{encodedTx:e.encodedTx})}));return function(t,r){return e.apply(this,arguments)}}(),i.signMessage=function(){var e=(0,o.default)((function*(e,t){var r=this,i=t.password;if("undefined"===typeof i)throw new l.OneKeyInternalError("Software signing requires a password.");var o=yield this.getDbAccount(),a=Object.values(yield this.getSigners(i,[o.address])),u=(0,n.default)(a,1)[0];return c.default.engine.info("signMessage",this.networkId,e),Promise.all(e.map((function(e){return r.engine.providerManager.signMessage(r.networkId,e,u)})))}));return function(t,r){return e.apply(this,arguments)}}(),i.getAddress=function(){throw new Error("Method not implemented.")},i.batchGetAddress=function(){throw new Error("Method not implemented.")},i.prepareAccountByAddressIndex=function(e){throw new Error("Method not implemented.")},(0,a.default)(r)}(r(565147).KeyringBase)},701625:(e,t,r)=>{"use strict";r.r(t),r.d(t,{KeyringWatchingBase:()=>c});var n=r(634795),i=r(887371),o=r(545754),a=r(411987),u=r(695058),s=r(940915);function d(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,u.default)(e);if(t){var i=(0,u.default)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,a.default)(this,r)}}var c=function(e){(0,o.default)(r,e);var t=d(r);function r(){return t.apply(this,arguments)}var a=r.prototype;return a.signTransaction=function(){var e=(0,n.default)((function*(e,t){throw new s.OneKeyInternalError("signTransaction is not supported for watching accounts")}));return function(t,r){return e.apply(this,arguments)}}(),a.signMessage=function(){var e=(0,n.default)((function*(e,t){throw new s.OneKeyInternalError("signMessage is not supported for watching accounts")}));return function(t,r){return e.apply(this,arguments)}}(),a.getAddress=function(){throw new Error("Method not implemented.")},a.batchGetAddress=function(){throw new Error("Method not implemented.")},a.prepareAccountByAddressIndex=function(){throw new Error("Method not implemented.")},(0,i.default)(r)}(r(565147).KeyringBase)},153546:(e,t,r)=>{"use strict";r.r(t),r.d(t,{convertDeviceError:()=>u});var n=r(703599),i=r(302478),o=r(292147);r(213208);function a(e,t){return"string"!==typeof t?null:e===n.HardwareErrorCode.DeviceInitializeFailed&&t.includes("ECONNABORTED")?new i.ConnectTimeoutError({message:t}):t.includes("Bridge network error")?new i.BridgeNetworkError({message:t}):null}function u(e){var t,r=e||{},u=r.code,s=r.error,d=r.message,c=null!=(t=null!=s?s:d)?t:"Unknown error";if(a(u,c))return a(u,c);switch(o.default.hardwareSDK.info("Device Utils Convert Device Error:",u,c),u){case n.HardwareErrorCode.UnknownError:return new i.UnknownHardwareError(e);case n.HardwareErrorCode.DeviceFwException:return new i.FirmwareVersionTooLow(e);case n.HardwareErrorCode.DeviceUnexpectedMode:return"string"===typeof c&&-1!==c.indexOf("ui-device_bootloader_mode")?new i.NotInBootLoaderMode(e):new i.UnknownHardwareError(e);case n.HardwareErrorCode.DeviceCheckDeviceIdError:return new i.DeviceNotSame(e);case n.HardwareErrorCode.DeviceNotFound:return new i.DeviceNotFind(e);case n.HardwareErrorCode.DeviceUnexpectedBootloaderMode:return new i.NotInBootLoaderMode(e);case n.HardwareErrorCode.DeviceInterruptedFromOutside:case n.HardwareErrorCode.DeviceInterruptedFromUser:return new i.UserCancelFromOutside(e);case n.HardwareErrorCode.DeviceNotSupportPassphrase:return new i.NotSupportPassphraseError(e);case n.HardwareErrorCode.IFrameLoadFail:return new i.InitIframeLoadFail(e);case n.HardwareErrorCode.IframeTimeout:return new i.InitIframeTimeout(e);case n.HardwareErrorCode.FirmwareUpdateDownloadFailed:return new i.FirmwareDownloadFailed(e);case n.HardwareErrorCode.FirmwareUpdateManuallyEnterBoot:return new i.FirmwareUpdateManuallyEnterBoot(e);case n.HardwareErrorCode.FirmwareUpdateAutoEnterBootFailure:return new i.FirmwareUpdateAutoEnterBootFailure(e);case n.HardwareErrorCode.FirmwareUpdateLimitOneDevice:return new i.FirmwareUpdateLimitOneDevice(e);case n.HardwareErrorCode.CallMethodNeedUpgradeFirmware:return new i.FirmwareVersionTooLow(e);case n.HardwareErrorCode.NewFirmwareUnRelease:return new i.NewFirmwareUnRelease(e);case n.HardwareErrorCode.NewFirmwareForceUpdate:return new i.NewFirmwareForceUpdate(e);case n.HardwareErrorCode.NetworkError:return new i.NetworkError(e);case n.HardwareErrorCode.BlePermissionError:return new i.NeedBluetoothTurnedOn(e);case n.HardwareErrorCode.BleLocationError:return new i.NeedBluetoothPermissions({message:c});case n.HardwareErrorCode.BleLocationServicesDisabled:return new i.BleLocationServiceError({message:c});case n.HardwareErrorCode.BleDeviceNotBonded:return new i.DeviceNotBonded(e);case n.HardwareErrorCode.BleDeviceBondError:return new i.DeviceBondError(e);case n.HardwareErrorCode.BleWriteCharacteristicError:return new i.BleWriteCharacteristicError(e);case n.HardwareErrorCode.BleScanError:return new i.BleScanError({message:c});case n.HardwareErrorCode.BleAlreadyConnected:return new i.BleAlreadyConnectedError(e);case n.HardwareErrorCode.RuntimeError:return-1!==c.indexOf("EIP712 blind sign is disabled")?new i.OpenBlindSign(e):-1!==c.indexOf("Unknown message")||-1!==c.indexOf("Failure_UnexpectedMessage")?new i.UnknownMethod(e):new i.UnknownHardwareError(e);case n.HardwareErrorCode.PinInvalid:return new i.InvalidPIN(e);case n.HardwareErrorCode.DeviceCheckPassphraseStateError:return new i.InvalidPassphrase(e);case n.HardwareErrorCode.DeviceOpenedPassphrase:return new i.DeviceOpenedPassphrase(e);case n.HardwareErrorCode.DeviceNotOpenedPassphrase:return new i.DeviceNotOpenedPassphrase(e);case n.HardwareErrorCode.PinCancelled:case n.HardwareErrorCode.ActionCancelled:return new i.UserCancel(e);case n.HardwareErrorCode.BridgeNotInstalled:case i.CustomOneKeyHardwareError.NeedOneKeyBridge:return new i.NeedOneKeyBridge(e);case n.HardwareErrorCode.BridgeNetworkError:return new i.BridgeNetworkError(e);case n.HardwareErrorCode.BridgeTimeoutError:return new i.BridgeTimeoutError(e);case n.HardwareErrorCode.PollingTimeout:return new i.ConnectTimeoutError(e);case n.HardwareErrorCode.PollingStop:return new i.ConnectPollingStopError(e);case n.HardwareErrorCode.BlindSignDisabled:return new i.OpenBlindSign(e);case n.HardwareErrorCode.FileAlreadyExists:return new i.FileAlreadyExistError(e);case n.HardwareErrorCode.CheckDownloadFileError:return new i.IncompleteFileError(e);case n.HardwareErrorCode.NotInSigningMode:return new i.NotInSigningModeError(e);case n.HardwareErrorCode.DataOverload:return new i.DeviceDataOverload(e);default:return new i.UnknownHardwareError(e)}}},209788:()=>{}}]);