"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[82919],{786141:(e,t,r)=>{r.r(t),r.d(t,{VaultBase:()=>_,VaultBaseChainOnly:()=>C});var n=r(72579),i=r.n(n),o=r(256666),a=r(301842),u=r.n(a),c=r(634795),s=r(887371),d=r(545754),l=r(411987),f=r(695058),p=r(206391),y=r.n(p),h=r(636393),v=r(613549),g=r(292147),w=r(213208),m=r(992431),T=r(940915),A=r(278489),E=r(969618),b=r(398514),I=r(114540),x=r(348834).Buffer;function O(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function N(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?O(Object(r),!0).forEach((function(t){(0,o.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):O(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function P(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,f.default)(e);if(t){var i=(0,f.default)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,l.default)(this,r)}}if(w.default.isExtensionUi)throw new Error("engine/VaultBase is not allowed imported from ui");var C=function(e){(0,d.default)(r,e);var t=P(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.initProvider=function(){var e=(0,c.default)((function*(){var e=(yield this.getNetwork()).impl;u()(E.IMPL_MAPPINGS[e])||(this.engineProvider=yield this.engine.providerManager.getProvider(this.networkId))}));return function(){return e.apply(this,arguments)}}(),n.proxyJsonRPCCall=function(){var e=(0,c.default)((function*(e){throw new T.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.createClientFromURL=function(e){throw new T.NotImplemented},n.getEthersProvider=function(){var e=(0,c.default)((function*(){throw new T.NotImplemented}));return function(){return e.apply(this,arguments)}}(),n.getClientEndpointStatus=function(){var e=(0,c.default)((function*(e){var t=this.createClientFromURL(e),r=performance.now(),n=(yield t.getInfo()).bestBlockNumber;return{responseTime:Math.floor(performance.now()-r),latestBlock:n}}));return function(t){return e.apply(this,arguments)}}(),n.checkRpcBatchSupport=function(){var e=(0,c.default)((function*(e){throw new T.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.getDisplayAddress=function(){var e=(0,c.default)((function*(e){return Promise.resolve(e)}));return function(t){return e.apply(this,arguments)}}(),n.validateAddress=function(){var e=(0,c.default)((function*(e){var t=yield this.engineProvider.verifyAddress(e),r=t.normalizedAddress;if(!t.isValid||!r)throw new T.InvalidAddress;return Promise.resolve(r)}));return function(t){return e.apply(this,arguments)}}(),n.validateImportedCredential=function(e){return Promise.resolve(this.settings.importedAccountEnabled&&/^(0x)?[0-9a-zA-Z]{64}$/.test(e))},n.validateWatchingCredential=function(){var e=(0,c.default)((function*(e){return Promise.resolve(this.settings.watchingAccountEnabled&&(yield this.engineProvider.verifyAddress(e)).isValid)}));return function(t){return e.apply(this,arguments)}}(),n.validateTokenAddress=function(){var e=(0,c.default)((function*(e){var t=yield this.engineProvider.verifyTokenAddress(e),r=t.normalizedAddress;if(!t.isValid||"undefined"===typeof r)throw new T.InvalidTokenAddress;return Promise.resolve(r)}));return function(t){return e.apply(this,arguments)}}(),n.validateCanCreateNextAccount=function(){var e=(0,c.default)((function*(e,t){return Promise.resolve(!0)}));return function(t,r){return e.apply(this,arguments)}}(),n.checkAccountExistence=function(){var e=(0,c.default)((function*(e,t){return Promise.resolve(!0)}));return function(t,r){return e.apply(this,arguments)}}(),n.getBalances=function(){var e=(0,c.default)((function*(e,t,r){return(yield this.engine.providerManager.getClient(this.networkId)).getBalances(e.map((function(e){var t=e.address,r=e.tokenAddress;return{address:t,coin:N({},"string"===typeof r?{tokenAddress:r}:{})}})))}));return function(t,r,n){return e.apply(this,arguments)}}(),n.getFrozenBalance=function(){var e=(0,c.default)((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.password,e.useRecycleBalance,e.ignoreInscriptions,e.useCustomAddressesBalance;return 0}));return function(){return e.apply(this,arguments)}}(),n.fetchBalanceDetails=function(){var e=(0,c.default)((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.password,e.useRecycleBalance,e.ignoreInscriptions,e.useCustomAddressesBalance;return Promise.resolve(void 0)}));return function(){return e.apply(this,arguments)}}(),n.getTransactionStatuses=function(e){return this.engine.providerManager.getTransactionStatuses(this.networkId,e)},n.getTransactionFeeInNative=function(e){return Promise.resolve("")},n.isContractAddress=function(){var e=(0,c.default)((function*(e){return!1}));return function(t){return e.apply(this,arguments)}}(),n.getAccountNameInfoMap=function(){var e=(0,c.default)((function*(){var e=yield this.getNetwork();return(0,A.getAccountNameInfoByImpl)(e.impl)}));return function(){return e.apply(this,arguments)}}(),n.canAutoCreateNextAccount=function(){var e=(0,c.default)((function*(e){return Promise.resolve(!1)}));return function(t){return e.apply(this,arguments)}}(),n.filterAccounts=function(){var e=(0,c.default)((function*(e){var t=e.accounts;e.networkId;return Promise.resolve(t)}));return function(t){return e.apply(this,arguments)}}(),n.shouldChangeAccountWhenNetworkChanged=function(){var e=(0,c.default)((function*(e){e.previousNetwork,e.newNetwork,e.activeAccountId;return Promise.resolve({shouldReloadAccountList:!1,shouldChangeActiveAccount:!1})}));return function(t){return e.apply(this,arguments)}}(),n.getAccountNameInfosByImportedOrWatchingCredential=function(){var e=(0,c.default)((function*(e){return Promise.resolve([])}));return function(t){return e.apply(this,arguments)}}(),n.checkIsUnlimitedAllowance=function(){var e=(0,c.default)((function*(e){throw new T.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.checkIsApprovedForAll=function(){var e=(0,c.default)((function*(e){throw new T.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.checkIsBatchTransfer=function(){var e=(0,c.default)((function*(e){throw new T.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.getFeePricePerUnit=function(){var e=(0,c.default)((function*(){throw new T.NotImplemented}));return function(){return e.apply(this,arguments)}}(),n.fetchRpcChainId=function(){var e=(0,c.default)((function*(e){return null}));return function(t){return e.apply(this,arguments)}}(),n.getTxWaitingSeconds=function(){var e=(0,c.default)((function*(){return[]}));return function(){return e.apply(this,arguments)}}(),n.getUserNFTAssets=function(){var e=(0,c.default)((function*(e){e.serviceData;return Promise.resolve(void 0)}));return function(t){return e.apply(this,arguments)}}(),n.getTransactionDetail=function(){var e=(0,c.default)((function*(e){return Promise.resolve(void 0)}));return function(t){return e.apply(this,arguments)}}(),(0,s.default)(r)}(I.VaultContext),_=function(e){(0,d.default)(r,e);var t=P(r);function r(){for(var e,r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return(e=t.call.apply(t,[this].concat(n))).uuid=h.default.v4().toString(),e}var n=r.prototype;return n.init=function(){var e=(0,c.default)((function*(e){yield this.initProvider(),yield this.initKeyring(e)}));return function(t){return e.apply(this,arguments)}}(),n.initKeyring=function(){var e=(0,c.default)((function*(e){this.keyring=yield e.keyringCreator(this)}));return function(t){return e.apply(this,arguments)}}(),n.signTransaction=function(){var e=(0,c.default)((function*(e,t){return this.keyring.signTransaction(e,t)}));return function(t,r){return e.apply(this,arguments)}}(),n.signAndSendTransaction=function(){var e=(0,c.default)((function*(e,t,r){var n=yield this.signTransaction(e,t);return r?N(N({},n),{},{encodedTx:e.encodedTx}):this.broadcastTransaction(N(N({},n),{},{encodedTx:e.encodedTx}))}));return function(t,r,n){return e.apply(this,arguments)}}(),n.broadcastTransaction=function(){var e=(0,c.default)((function*(e,t){g.default.engine.info("broadcastTransaction START:",{rawTx:e.rawTx});var r=yield this.engine.providerManager.broadcastTransaction(this.networkId,e.rawTx,t);return g.default.engine.info("broadcastTransaction END:",{txid:r,rawTx:e.rawTx}),N(N({},e),{},{txid:r,encodedTx:e.encodedTx})}));return function(t,r){return e.apply(this,arguments)}}(),n.buildEncodedTxFromBatchTransfer=function(){var e=(0,c.default)((function*(e){throw new T.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.buildEncodedTxsFromSetApproveForAll=function(){var e=(0,c.default)((function*(e,t){throw new T.NotImplemented}));return function(t,r){return e.apply(this,arguments)}}(),n.activateAccount=function(){var e=(0,c.default)((function*(){throw new T.NotImplemented}));return function(){return e.apply(this,arguments)}}(),n.activateToken=function(){var e=(0,c.default)((function*(e,t){throw new T.NotImplemented}));return function(t,r){return e.apply(this,arguments)}}(),n.getTokenAllowance=function(){var e=(0,c.default)((function*(e,t){throw new T.NotImplemented}));return function(t,r){return e.apply(this,arguments)}}(),n.batchTokensAllowance=function(){var e=(0,c.default)((function*(e,t){throw new T.NotImplemented}));return function(t,r){return e.apply(this,arguments)}}(),n.getOutputAccount=function(){var e=(0,c.default)((function*(){var e=yield this.getDbAccount({noCache:!0});return{id:e.id,name:e.name,type:e.type,path:e.path,coinType:e.coinType,tokens:[],address:e.address,template:e.template,pubKey:i()(e,"pub","")}}));return function(){return e.apply(this,arguments)}}(),n.getAccountBalance=function(){var e=(0,c.default)((function*(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,i=(yield this.getDbAccount()).address;return this.getBalances((t?[{address:i}]:[]).concat(e.map((function(e){return{address:i,tokenAddress:e}}))),r,n)}));return function(t){return e.apply(this,arguments)}}(),n.updatePendingTxs=function(){var e=(0,c.default)((function*(e){throw new T.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.getAccountNonce=function(){var e=(0,c.default)((function*(){return Promise.resolve(null)}));return function(){return e.apply(this,arguments)}}(),n.fixActionDirection=function(){var e=(0,c.default)((function*(e){var t,r,n,i,o=e.action,a=e.accountAddress;(o.direction=b.IDecodedTxDirection.OTHER,o.type===b.IDecodedTxActionType.NATIVE_TRANSFER)&&(o.direction=yield this.buildTxActionDirection({from:(null==(t=o.nativeTransfer)?void 0:t.from)||"",to:(null==(r=o.nativeTransfer)?void 0:r.to)||"",address:a}));o.type===b.IDecodedTxActionType.TOKEN_TRANSFER&&(o.direction=yield this.buildTxActionDirection({from:(null==(n=o.tokenTransfer)?void 0:n.from)||"",to:(null==(i=o.tokenTransfer)?void 0:i.to)||"",address:a}));return o}));return function(t){return e.apply(this,arguments)}}(),n.fixDecodedTx=function(){var e=(0,c.default)((function*(e){var t,r;e.createdAt=null!=(t=e.createdAt)?t:Date.now();var n=null==(r=e.encodedTx)?void 0:r.nonce;e.nonce=u()(n)?e.nonce:new(y())(n).toNumber();for(var i=e.owner,o=0;o<e.actions.length;o+=1){var a=e.actions[o];yield this.fixActionDirection({action:a,accountAddress:i})}if(e.outputActions)for(var c=0;c<e.outputActions.length;c+=1){var s=e.outputActions[c];yield this.fixActionDirection({action:s,accountAddress:i})}return Promise.resolve(e)}));return function(t){return e.apply(this,arguments)}}(),n.fixHistoryTx=function(){var e=(0,c.default)((function*(e){return e.decodedTx=yield this.fixDecodedTx(e.decodedTx),Promise.resolve(e)}));return function(t){return e.apply(this,arguments)}}(),n.buildHistoryTx=function(){var e=(0,c.default)((function*(e){var t=e.historyTxToMerge,r=(e.encodedTx,e.decodedTx),n=e.signedTx,i=e.isSigner,o=e.isLocalCreated,a=(null==n?void 0:n.txid)||(null==r?void 0:r.txid)||"";if(!a)throw new Error("buildHistoryTx txid not found");var u=yield this.getAccountAddress();r.txid=a||r.txid,r.owner=u,i&&(r.signer=u),null!=n&&n.txKey&&(r.extraInfo?r.extraInfo.txKey=n.txKey:r.extraInfo={txKey:n.txKey});var c=N(N({id:`${this.networkId}_${a}_${this.accountId}`,isLocalCreated:Boolean(o)},t),{},{decodedTx:r});return c=yield this.fixHistoryTx(c),Promise.resolve(c)}));return function(t){return e.apply(this,arguments)}}(),n.checkIsScamHistoryTx=function(){var e=(0,c.default)((function*(e){return!1}));return function(t){return e.apply(this,arguments)}}(),n.fetchOnChainHistory=function(){var e=(0,c.default)((function*(e){throw new T.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.fixAddressCase=function(e){return Promise.resolve(e)},n.buildTxActionDirection=function(){var e=(0,c.default)((function*(e){var t=e.from,r=e.to,n=e.address;return t=yield this.fixAddressCase(t||""),r=yield this.fixAddressCase(r),n=yield this.fixAddressCase(n),t===r&&t===n?b.IDecodedTxDirection.SELF:t&&t===n?b.IDecodedTxDirection.OUT:r&&r===n?b.IDecodedTxDirection.IN:b.IDecodedTxDirection.OTHER}));return function(t){return e.apply(this,arguments)}}(),n.getNextNonce=function(){var e=(0,c.default)((function*(e,t){var r,n=null==(r=(yield this.engine.providerManager.getAddresses(e,[t.address]))[0])?void 0:r.nonce;if(u()(n))throw new T.OneKeyError("Get on-chain nonce failed.");yield this.engine.getHistory(e,t.id,void 0,!1);var i=yield m.default.history.getMaxPendingNonce({accountId:this.accountId,networkId:e}),o=yield m.default.history.getPendingNonceList({accountId:this.accountId,networkId:e}),a=Math.max(u()(i)?0:i+1,n);if(Number.isNaN(a)&&(a=n),a>n)for(var c=n;c<a;c+=1)if(!o.includes(c)){a=c;break}if(a<n&&(a=n),a-n>=v.HISTORY_CONSTS.PENDING_QUEUE_MAX_LENGTH)throw new T.PendingQueueTooLong(v.HISTORY_CONSTS.PENDING_QUEUE_MAX_LENGTH);return a}));return function(t,r){return e.apply(this,arguments)}}(),n.validateSendAmount=function(e,t,r){return Promise.resolve(!0)},n.notifyChainChanged=function(e,t){},n.getFetchBalanceAddress=function(e){return Promise.resolve(e.address)},n.getPrivateKeyByCredential=function(e){return Promise.resolve(x.from(e.startsWith("0x")?e.slice(2):e,"hex"))},n.getMinDepositAmount=function(){var e=(0,c.default)((function*(){return"0"}));return function(){return e.apply(this,arguments)}}(),n.specialCheckEncodedTx=function(){var e=(0,c.default)((function*(e){return{success:!0}}));return function(t){return e.apply(this,arguments)}}(),n.getAllUsedAddress=function(){var e=(0,c.default)((function*(){return Promise.resolve([])}));return function(){return e.apply(this,arguments)}}(),(0,s.default)(r)}(C)},382919:(e,t,r)=>{r.r(t),r.d(t,{default:()=>ue});var n=r(256666),i=r(196234),o=r(856974),a=r.n(o),u=r(634795),c=r(887371),s=r(545754),d=r(411987),l=r(695058),f=r(789644),p=r.n(f),y=r(206391),h=r.n(y),v=r(478557),g=r(901187),w=r(740727),m=r(292147),T=r(396564),A=r(940915),E=r(794292),b=r(398514),I=r(786141),x=r(122754),O=r(153546),N=r(613549),P=r(398145),C=r(82406),_=r(882705),k=r(348834).Buffer;function B(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function S(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?B(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):B(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function D(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,l.default)(e);if(t){var i=(0,l.default)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,d.default)(this,r)}}var R=`m/44'/${N.COINTYPE_NEAR}'`;function F(e){return e.slice(e.startsWith("0x")?2:0)}var K=function(e){(0,s.default)(r,e);var t=D(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.signTransaction=function(){var e=(0,u.default)((function*(e,t){var r=yield this.getDbAccount(),n=yield this.getHardwareSDKInstance(),i=yield this.getHardwareInfo(),o=i.connectId,a=i.deviceId,u=yield this.getWalletPassphraseState(),c=e.payload.nativeTx,s=yield n.nearSignTransaction(o,a,S({path:r.path,rawTx:k.from((0,_.serializeTransaction)(c),"base64").toString("hex")},u));if(s.success&&s.payload.signature)return{txid:(0,_.serializeTransaction)(c,{encoding:"sha256_bs58"}),rawTx:(0,_.serializeTransaction)(new x.transactions.SignedTransaction({transaction:c,signature:new x.transactions.Signature({keyType:c.publicKey.keyType,data:k.from(s.payload.signature,"hex")})}))};throw(0,O.convertDeviceError)(s.payload)}));return function(t,r){return e.apply(this,arguments)}}(),n.signMessage=function(e,t){throw new A.NotImplemented("Signing near message with hardware is not supported yet.")},n.prepareAccounts=function(){var e=(0,u.default)((function*(e){var t,r=this,n=e.indexes,i=e.names,o=n.map((function(e){return`${R}/${e}'`})),a=yield this.getHardwareSDKInstance(),u=yield this.getHardwareInfo(),c=u.connectId,s=u.deviceId,d=yield this.getWalletPassphraseState();try{t=yield a.nearGetAddress(c,s,S({bundle:o.map((function(e){return{path:e,showOnOneKey:false}}))},d))}catch(l){throw m.default.common.error(l),new A.OneKeyHardwareError(l)}if(!t.success)throw m.default.common.error(t.payload),(0,O.convertDeviceError)(t.payload);return t.payload.map((function(e,t){var o=e.address,a=e.path;return{id:`${r.walletId}--${a}`,name:(i||[])[t]||`NEAR #${n[t]+1}`,type:P.AccountType.SIMPLE,path:a,coinType:N.COINTYPE_NEAR,pub:`ed25519:${(0,_.baseEncode)(k.from(F(null!=o?o:""),"hex"))}`,address:F(null!=o?o:"")}})).filter((function(e){return!!e.address}))}));return function(t){return e.apply(this,arguments)}}(),n.getAddress=function(){var e=(0,u.default)((function*(e){var t,r=yield this.getHardwareSDKInstance(),n=yield this.getHardwareInfo(),i=n.connectId,o=n.deviceId,a=yield this.getWalletPassphraseState(),u=yield r.nearGetAddress(i,o,S({path:e.path,showOnOneKey:e.showOnOneKey},a));if(u.success&&null!=(t=u.payload)&&t.address)return F(u.payload.address);throw(0,O.convertDeviceError)(u.payload)}));return function(t){return e.apply(this,arguments)}}(),n.batchGetAddress=function(){var e=(0,u.default)((function*(e){var t=yield this.getHardwareSDKInstance(),r=yield this.getHardwareInfo(),n=r.connectId,i=r.deviceId,o=yield this.getWalletPassphraseState(),a=yield t.nearGetAddress(n,i,S(S({},o),{},{bundle:e.map((function(e){return{path:e.path,showOnOneKey:!!e.showOnOneKey}}))}));if(!a.success)throw(0,O.convertDeviceError)(a.payload);return a.payload.map((function(e){var t,r;return{path:null!=(t=e.path)?t:"",address:null!=(r=e.address)?r:""}}))}));return function(t){return e.apply(this,arguments)}}(),(0,c.default)(r)}(C.KeyringHardwareBase),H=r(605851),M=r(810887);function j(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,l.default)(e);if(t){var i=(0,l.default)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,d.default)(this,r)}}var U=`m/44'/${N.COINTYPE_NEAR}'`,L=function(e){(0,s.default)(r,e);var t=j(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.prepareAccounts=function(){var e=(0,u.default)((function*(e){var t=e.password,r=e.indexes,n=e.names,i=(yield this.engine.dbApi.getCredential(this.walletId,t)).seed,o=(0,H.batchGetPublicKeys)("ed25519",i,t,U,r.map((function(e){return`${e}'`})));if(o.length!==r.length)throw new A.OneKeyInternalError("Unable to get publick key.");var a=[],u=0;for(var c of o){var s=c.path,d=c.extendedKey.key,l=d.toString("hex"),f=(n||[])[u]||`NEAR #${r[u]+1}`;a.push({id:`${this.walletId}--${s}`,name:f,type:P.AccountType.SIMPLE,path:s,coinType:N.COINTYPE_NEAR,pub:`ed25519:${(0,_.baseEncode)(d)}`,address:l}),u+=1}return a}));return function(t){return e.apply(this,arguments)}}(),n.getSigners=function(){var e=(0,u.default)((function*(e,t){var r,n=yield this.getDbAccount();if(1!==t.length)throw new A.OneKeyInternalError("NEAR signers number should be 1.");if(t[0]!==n.address)throw new A.OneKeyInternalError("Wrong address required for signing.");var i=(yield this.getPrivateKeys(e))[n.path];if("undefined"===typeof i)throw new A.OneKeyInternalError("Unable to get signer.");return(r={})[n.address]=new E.Signer(i,e,"ed25519"),r}));return function(t,r){return e.apply(this,arguments)}}(),n.getSigner=function(){var e=(0,u.default)((function*(e,t){var r=t.address;return(yield this.getSigners((null==e?void 0:e.password)||"",[r]))[r]}));return function(t,r){return e.apply(this,arguments)}}(),n.signTransaction=function(){var e=(0,u.default)((function*(e,t){var r=yield this.getDbAccount(),n=yield this.getSigner(t,{address:r.address});return(0,_.signTransaction)(e,n)}));return function(t,r){return e.apply(this,arguments)}}(),n.signMessage=function(e,t){console.log(e,t)},(0,c.default)(r)}(M.KeyringHdBase);function W(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,l.default)(e);if(t){var i=(0,l.default)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,d.default)(this,r)}}var $=function(e){(0,s.default)(r,e);var t=W(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.prepareAccounts=function(){var e=(0,u.default)((function*(e){var t=e.name,r=e.privateKey;if(32!==r.length)throw new A.OneKeyInternalError("Invalid private key.");var n=v.ed25519.publicFromPrivate(r),i=n.toString("hex");return Promise.resolve([{id:`imported--${N.COINTYPE_NEAR}--${i}`,name:t||"",type:P.AccountType.SIMPLE,path:"",coinType:N.COINTYPE_NEAR,pub:`ed25519:${(0,_.baseEncode)(n)}`,address:i}])}));return function(t){return e.apply(this,arguments)}}(),n.getSigners=function(){var e=(0,u.default)((function*(e,t){var r,n=yield this.getDbAccount();if(1!==t.length)throw new A.OneKeyInternalError("NEAR signers number should be 1.");if(t[0]!==n.address)throw new A.OneKeyInternalError("Wrong address required for signing.");var i=(yield this.getPrivateKeys(e))[n.path];if("undefined"===typeof i)throw new A.OneKeyInternalError("Unable to get signer.");return(r={})[n.address]=new E.Signer(i,e,"ed25519"),r}));return function(t,r){return e.apply(this,arguments)}}(),n.getSigner=function(){var e=(0,u.default)((function*(e,t){var r=t.address;return(yield this.getSigners(e.password||"",[r]))[r]}));return function(t,r){return e.apply(this,arguments)}}(),n.signTransaction=function(){var e=(0,u.default)((function*(e,t){var r=yield this.getDbAccount(),n=yield this.getSigner(t,r);return(0,_.signTransaction)(e,n)}));return function(t,r){return e.apply(this,arguments)}}(),n.signMessage=function(e,t){console.log(e,t)},(0,c.default)(r)}(r(255942).KeyringImportedBase);function G(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,l.default)(e);if(t){var i=(0,l.default)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,d.default)(this,r)}}var V=function(e){(0,s.default)(r,e);var t=G(r);function r(){return t.apply(this,arguments)}return r.prototype.prepareAccounts=function(){var e=(0,u.default)((function*(e){var t=e.name,r=e.target,n=e.accountIdPrefix,i=(0,_.verifyNearAddress)(r),o=i.normalizedAddress;if(!i.isValid||"undefined"===typeof o)throw new A.InvalidAddress;return Promise.resolve([{id:`${n}--${N.COINTYPE_NEAR}--${r}`,name:t||"",type:P.AccountType.SIMPLE,path:"",coinType:N.COINTYPE_NEAR,pub:"",address:o}])}));return function(t){return e.apply(this,arguments)}}(),(0,c.default)(r)}(r(701625).KeyringWatchingBase),q=r(983871),z=r(764550),J=r(942349),Y=r(85397),Q=r(348834).Buffer;function X(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,l.default)(e);if(t){var i=(0,l.default)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,d.default)(this,r)}}function Z(e){return JSON.parse(Q.from(e).toString())}function ee(e){return Q.from(JSON.stringify(e))}var te=function(e){(0,s.default)(r,e);var t=X(r);function r(e){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"optimistic";return(r=t.call(this)).defaultFinality=n,r.getBalance=function(){var e=(0,u.default)((function*(e,t){if(null!=t&&t.tokenAddress){var n=yield r.callContract(t.tokenAddress,"ft_balance_of",{account_id:e});return new(h())(n)}var i=yield r.rpc.call("query",{request_type:"view_account",account_id:e,finality:r.defaultFinality});return new(h())(i.amount)}));return function(t,r){return e.apply(this,arguments)}}(),r.rpc=new Y.JsonRPCRequest(e),r}var n=r.prototype;return n.getInfo=function(){var e=(0,u.default)((function*(){var e=(yield this.getBestBlock()).blockNumber;return{bestBlockNumber:e,isReady:Number.isFinite(e)&&e>0}}));return function(){return e.apply(this,arguments)}}(),n.getTxCostConfig=function(){var e=(0,u.default)((function*(){var e=(yield this.rpc.call("EXPERIMENTAL_protocol_config",{finality:this.defaultFinality})).runtime_config.transaction_costs;return{action_receipt_creation_config:e.action_receipt_creation_config,transfer_cost:e.action_creation_config.transfer_cost}}));return function(){return e.apply(this,arguments)}}(),n.getBestBlock=function(){var e=(0,u.default)((function*(){var e=yield this.rpc.call("status",[]);return{blockNumber:Number(e.sync_info.latest_block_height),blockHash:e.sync_info.latest_block_hash}}));return function(){return e.apply(this,arguments)}}(),n.getAddress=function(){var e=(0,u.default)((function*(e){try{var t=yield this.rpc.call("query",{request_type:"view_account",account_id:e,finality:this.defaultFinality}),r=new(h())(t.amount),n=yield this.getAccessKeys(e),o=n.filter((function(e){return"FullAccess"===e.type})),a=o.length>0?o:n,u=(0,i.default)(a,1)[0].nonce;return{existing:!0,balance:r,nonce:Number.isFinite(u)&&u>0?u:void 0}}catch(d){if(d instanceof J.JsonPRCResponseError&&d.response)try{var c,s=yield d.response.json();if("UNKNOWN_ACCOUNT"===(null==s||null==(c=s.cause)?void 0:c.name))return{existing:!1,balance:new(h())(0)}}catch(d){}throw d}}));return function(t){return e.apply(this,arguments)}}(),n.getAccessKeys=function(){var e=(0,u.default)((function*(e){return(yield this.rpc.call("query",{request_type:"view_access_key_list",account_id:e,finality:this.defaultFinality})).keys.map((function(e){var t=e.access_key.permission,r="FullAccess"===t;return{type:r?"FullAccess":"FunctionCall",pubkey:e.public_key,pubkeyHex:q.baseDecode(e.public_key.split(":")[1]||"").toString("hex"),nonce:e.access_key.nonce+1,functionCall:r?void 0:{allowance:t.FunctionCall.allowance,receiverId:t.FunctionCall.receiver_id,methodNames:t.FunctionCall.method_names}}}))}));return function(t){return e.apply(this,arguments)}}(),n.getFeePricePerUnit=function(){var e=(0,u.default)((function*(){var e=yield this.rpc.call("gas_price",[null]);return{normal:{price:new(h())(e.gas_price)}}}));return function(){return e.apply(this,arguments)}}(),n.getTransactionStatus=function(){var e=(0,u.default)((function*(e){try{var t=yield this.rpc.call("tx",[e,"dontcare"]);return"object"===typeof t.status&&"SuccessValue"in t.status?w.TransactionStatus.CONFIRM_AND_SUCCESS:w.TransactionStatus.CONFIRM_BUT_FAILED}catch(i){if(i instanceof J.JsonPRCResponseError&&i.response)try{var r,n=yield i.response.json();if("UNKNOWN_TRANSACTION"===(null==n||null==(r=n.cause)?void 0:r.name))return w.TransactionStatus.NOT_FOUND}catch(i){}throw i}}));return function(t){return e.apply(this,arguments)}}(),n.callContract=function(){var e=(0,u.default)((function*(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=n.parse,o=void 0===i?Z:i,a=n.stringify,u=(void 0===a?ee:a)(r).toString("base64"),c=yield this.rpc.call("query",{request_type:"call_function",finality:this.defaultFinality,method_name:t,account_id:e,args_base64:u});return c.result&&c.result.length>0&&o(Q.from(c.result))}));return function(t,r){return e.apply(this,arguments)}}(),n.broadcastTransaction=function(){var e=(0,u.default)((function*(e){return(yield this.rpc.call("broadcast_tx_commit",[e])).transaction.hash}));return function(t){return e.apply(this,arguments)}}(),(0,c.default)(r)}(z.SimpleClient),re=r(97555),ne=r(348834).Buffer;function ie(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function oe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ie(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ie(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function ae(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,l.default)(e);if(t){var i=(0,l.default)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,d.default)(this,r)}}var ue=function(e){(0,s.default)(r,e);var t=ae(r);function r(){for(var e,r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return(e=t.call.apply(t,[this].concat(n))).keyringMap={hd:L,hw:K,imported:$,watching:V,external:V},e.settings=re.default,e.helperApi=p().create({baseURL:"https://helper.mainnet.near.org",headers:{"X-Custom-Header":"foobar","Content-Encoding":"gzip","Content-Type":"application/json"}}),e._createNearCli=(0,T.memoizee)(function(){var t=(0,u.default)((function*(t,r){var n=new te(`${t}`),i=yield e.engine.providerManager.getChainInfoByNetworkId(r);return n.setChainInfo(i),n}));return function(e,r){return t.apply(this,arguments)}}(),{promise:!0,primitive:!0,normalizer:function(e){return`${e[0]}:${e[1]}`},max:1,maxAge:9e5}),e.isStorageBalanceAvailable=(0,T.memoizee)(function(){var t=(0,u.default)((function*(t){var r=t.address,n=t.tokenAddress,i=yield e.fetchAccountStorageBalance({address:r,tokenAddress:n});return void 0!==(null==i?void 0:i.total)}));return function(e){return t.apply(this,arguments)}}(),{promise:!0,primitive:!0,max:1,maxAge:3e4}),e.getStorageAmountPerByte=(0,T.memoizee)((0,u.default)((function*(){var t=yield e._getNearCli(),r=(yield t.rpc.call("EXPERIMENTAL_protocol_config",{finality:t.defaultFinality})).runtime_config.storage_amount_per_byte;return new(h())(r)})),{promise:!0,primitive:!0,maxAge:18e5}),e}var n=r.prototype;return n._getNearCli=function(){var e=(0,u.default)((function*(){var e=(yield this.getNetwork()).rpcURL;return yield this._createNearCli(e,this.networkId)}));return function(){return e.apply(this,arguments)}}(),n._getPublicKey=function(){var e=(0,u.default)((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.encoding,r=void 0===t?"base58":t,n=e.prefix,i=void 0===n||n,o=yield this.getDbAccount(),a=o.pub.startsWith("ed25519:")?(0,_.baseDecode)(o.pub.split(":")[1]).toString("hex"):o.pub,u=this.engine.providerManager.getVerifier(this.networkId,a),c=yield u.getPubkey(!0);return"base58"===r?(i?"ed25519:":"")+(0,_.baseEncode)(c):"hex"===r?c.toString("hex"):""}));return function(){return e.apply(this,arguments)}}(),n.proxyJsonRPCCall=function(){var e=(0,u.default)((function*(e){var t=yield this._getNearCli();try{return yield t.rpc.call(e.method,e.params)}catch(r){throw(0,E.extractResponseError)(r)}}));return function(t){return e.apply(this,arguments)}}(),n.attachFeeInfoToEncodedTx=function(e){return Promise.resolve(e.encodedTx)},n.nativeTxActionToEncodedTxAction=function(){var e=(0,u.default)((function*(e){var t=this,r=(yield this.getAccountAddress(),yield this.engine.getNativeTokenInfo(this.networkId)),n=yield Promise.all(e.actions.map(function(){var n=(0,u.default)((function*(n){var i,o={type:b.IDecodedTxActionType.UNKNOWN,direction:b.IDecodedTxDirection.SELF,unknownAction:{extraInfo:null}};if("transfer"===n.enum){o.type=b.IDecodedTxActionType.NATIVE_TRANSFER;var a=n.transfer.deposit.toString(),u=new(h())(a).shiftedBy(-1*r.decimals).toFixed();o.nativeTransfer={tokenInfo:r,from:e.signerId,to:e.receiverId,amount:u,amountValue:a,extraInfo:null}}if("functionCall"===n.enum&&"ft_transfer"===(null==n||null==(i=n.functionCall)?void 0:i.methodName)){o.type=b.IDecodedTxActionType.TOKEN_TRANSFER;var c=yield t.engine.ensureTokenInDB(t.networkId,e.receiverId);if(c){var s,d=(0,_.parseJsonFromRawResponse)(null==(s=n.functionCall)?void 0:s.args),l=d.amount,f=new(h())(l).shiftedBy(-1*c.decimals).toFixed();o.tokenTransfer={tokenInfo:c,from:d.sender_id||e.signerId,to:d.receiver_id,amount:f,amountValue:l,extraInfo:null}}}return o}));return function(e){return n.apply(this,arguments)}}()));return n}));return function(t){return e.apply(this,arguments)}}(),n.decodedTxToLegacy=function(e){return Promise.resolve((0,_.decodedTxToLegacy)(e))},n.decodeTx=function(){var e=(0,u.default)((function*(e,t){var r=yield this.helper.parseToNativeTx(e);return{txid:"",owner:yield this.getAccountAddress(),signer:r.signerId,nonce:parseFloat(r.nonce.toString()),actions:yield this.nativeTxActionToEncodedTxAction(r),status:b.IDecodedTxStatus.Pending,networkId:this.networkId,accountId:this.accountId,extraInfo:null}}));return function(t,r){return e.apply(this,arguments)}}(),n._buildStorageDepositAction=function(){var e=(0,u.default)((function*(e){var t=e.amount,r=e.address;return _.nearApiJs.transactions.functionCall("storage_deposit",{account_id:r,registration_only:!0},new _.BN(null!=_.FT_STORAGE_DEPOSIT_GAS?_.FT_STORAGE_DEPOSIT_GAS:"0"),t)}));return function(t){return e.apply(this,arguments)}}(),n._buildNativeTokenTransferAction=function(){var e=(0,u.default)((function*(e){var t=e.amount,r=yield this.getNetwork(),n=new(h())(t||0),i=new _.BN(n.shiftedBy(r.decimals).toFixed());return _.nearApiJs.transactions.transfer(i)}));return function(t){return e.apply(this,arguments)}}(),n._buildTokenTransferAction=function(){var e=(0,u.default)((function*(e){var t=e.transferInfo,r=e.token,n=new(h())(t.amount||0).shiftedBy(r.decimals).toFixed();return _.nearApiJs.transactions.functionCall("ft_transfer",{amount:n,receiver_id:t.to},new _.BN(_.FT_TRANSFER_GAS),new _.BN(_.FT_TRANSFER_DEPOSIT))}));return function(t){return e.apply(this,arguments)}}(),n.buildEncodedTxFromTransfer=function(){var e=(0,u.default)((function*(e){if(!e.to)throw new Error("Invalid transferInfo.to params");var t=yield this.getDbAccount();if(!t.pub&&t.id.startsWith("watching--"))throw new A.WatchedAccountTradeError;var r=[];if(e.token){var n,i=yield this.engine.ensureTokenInDB(this.networkId,null!=(n=e.token)?n:"");if(i)(yield this.isStorageBalanceAvailable({address:e.to,tokenAddress:e.token}))||r.push(yield this._buildStorageDepositAction({amount:new _.BN(null!=_.FT_MINIMUM_STORAGE_BALANCE_LARGE?_.FT_MINIMUM_STORAGE_BALANCE_LARGE:"0"),address:e.to})),r.push(yield this._buildTokenTransferAction({transferInfo:e,token:i}))}else r.push(yield this._buildNativeTokenTransferAction({amount:e.amount}));var o=yield this._getPublicKey({prefix:!1}),a=_.nearApiJs.utils.key_pair.PublicKey.from(o),u=_.nearApiJs.transactions.createTransaction(e.from,a,e.token||e.to,0,r,(0,_.baseDecode)("91737S76o1EfWfjxUQ4k3dyD3qmxDQ7hqgKUKxgxsSUW")),c=(0,_.serializeTransaction)(u);return Promise.resolve(c)}));return function(t){return e.apply(this,arguments)}}(),n.buildUnsignedTxFromEncodedTx=function(){var e=(0,u.default)((function*(e){var t,r=yield this.helper.parseToNativeTx(e),n=yield this._getNearCli(),i=yield this.fetchAccountAccessKey(),o=(yield n.getBestBlock()).blockHash;return r.nonce=null!=(t=null==i?void 0:i.nonce)?t:0,r.blockHash=(0,_.baseDecode)(o),{inputs:[],outputs:[],payload:{nativeTx:r},encodedTx:e}}));return function(t){return e.apply(this,arguments)}}(),n.fetchFeeInfo=function(){var e=(0,u.default)((function*(e){var t=yield this._getNearCli(),r=yield t.getTxCostConfig(),n=yield t.getFeePricePerUnit(),i=yield this.getNetwork(),o=n.normal.price.shiftedBy(-i.decimals).toFixed(),u=r.transfer_cost,c=r.action_receipt_creation_config,s="0";s=new(h())(_.FT_TRANSFER_GAS).toFixed();var d=yield this.decodeTx(e),l=a()(null==d?void 0:d.actions);if(l&&l.type===b.IDecodedTxActionType.TOKEN_TRANSFER){var f=l.tokenTransfer;if(f)(yield this.isStorageBalanceAvailable({address:f.to,tokenAddress:f.tokenInfo.tokenIdOnNetwork}))||(s=new(h())(u.execution).plus(c.execution).multipliedBy(2).toFixed())}return{nativeSymbol:i.symbol,nativeDecimals:i.decimals,feeSymbol:i.feeSymbol,feeDecimals:i.feeDecimals,limit:s,prices:[o],defaultPresetIndex:"0",tx:null}}));return function(t){return e.apply(this,arguments)}}(),n.updateEncodedTx=function(){var e=(0,u.default)((function*(e,t,r){var n,i,o=(0,_.deserializeTransaction)(e);if("transfer"===r.type&&(1===(null==o||null==(n=o.actions)?void 0:n.length)&&"transfer"===(null==o||null==(i=o.actions[0])?void 0:i.enum))){var a=t,u=yield this._buildNativeTokenTransferAction(a);return o.actions=[u],(0,_.serializeTransaction)(o)}return Promise.resolve(e)}));return function(t,r,n){return e.apply(this,arguments)}}(),n.buildEncodedTxFromApprove=function(e){throw new Error("Method not implemented: buildEncodedTxFromApprove")},n.updateEncodedTxTokenApprove=function(e,t){throw new Error("Method not implemented: updateEncodedTxTokenApprove")},n.getExportedCredential=function(){var e=(0,u.default)((function*(e){var t=yield this.getDbAccount();if(t.id.startsWith("hd-")||t.id.startsWith("imported")){var r=this.keyring,n=Object.values(yield r.getPrivateKeys(e)),o=(0,i.default)(n,1)[0],a=(0,g.decrypt)(e,o),u=v.ed25519.publicFromPrivate(a);return`ed25519:${(0,_.baseEncode)(ne.concat([a,u]))}`}throw new A.OneKeyInternalError("Only credential of HD or imported accounts can be exported")}));return function(t){return e.apply(this,arguments)}}(),n.fetchAccountStorageBalance=function(){var e=(0,u.default)((function*(e){var t=e.address,r=e.tokenAddress,n=yield this._getNearCli();return yield n.callContract(r,"storage_balance_of",{account_id:t})}));return function(t){return e.apply(this,arguments)}}(),n.fetchDomainAccountsFromPublicKey=function(){var e=(0,u.default)((function*(e){var t=e.publicKey;return(yield this.helperApi.get(`/publicKey/${t}/accounts`)).data}));return function(t){return e.apply(this,arguments)}}(),n.fetchDomainAccounts=function(){var e=(0,u.default)((function*(){try{var e=yield this._getPublicKey({encoding:"base58",prefix:!0}),t=yield this.fetchDomainAccountsFromPublicKey({publicKey:e});if(t.length)return t.map((function(e){return{address:e,isDomainAccount:!0}}))}catch(r){console.error(r)}return[]}));return function(){return e.apply(this,arguments)}}(),n.fetchAccountAccessKey=function(){var e=(0,u.default)((function*(){var e=yield this._getNearCli(),t=yield this.getDbAccount(),r=(yield e.getAccessKeys(t.address))||[],n=yield this._getPublicKey();return r.find((function(e){return e.pubkey===n}))}));return function(){return e.apply(this,arguments)}}(),n.validateImportedCredential=function(e){var t=!1;if(this.settings.importedAccountEnabled){var r=e.split(":"),n=(0,i.default)(r,2),o=n[0],a=n[1];try{t="ed25519"===o&&64===ne.from((0,_.baseDecode)(a)).length}catch(u){}}return Promise.resolve(t)},n.fetchTokenInfos=function(){var e=(0,u.default)((function*(e){var t=yield this._getNearCli(),r=yield Promise.all(e.map(function(){var e=(0,u.default)((function*(e){return t.callContract(e,"ft_metadata",{})}));return function(t){return e.apply(this,arguments)}}()));return r}));return function(t){return e.apply(this,arguments)}}(),n.getBalances=function(){var e=(0,u.default)((function*(e){var t=yield this._getNearCli();return t.batchCall2SingleCall(e,function(){var e=(0,u.default)((function*(e){var r=e.address,n=e.tokenAddress;if("undefined"!==typeof n){var i=yield t.callContract(n,"ft_balance_of",{account_id:r});return new(h())(i)}var o=yield t.rpc.call("query",{request_type:"view_account",account_id:r,finality:t.defaultFinality}),a=o.amount;o.storage_usage;return new(h())(a)}));return function(t){return e.apply(this,arguments)}}())}));return function(t){return e.apply(this,arguments)}}(),n.getFrozenBalance=function(){var e=(0,u.default)((function*(){var e=yield this._getNearCli(),t=yield this.getAccountAddress(),r=(yield this.engine.getNativeTokenInfo(this.networkId)).decimals;try{var n=(yield e.rpc.call("query",{request_type:"view_account",account_id:t,finality:e.defaultFinality})).storage_usage;return{main:new(h())(yield this.getStorageAmountPerByte()).times(n).shiftedBy(-r).toNumber()}}catch(i){return 0}}));return function(){return e.apply(this,arguments)}}(),n.getClientEndpointStatus=function(){var e=(0,u.default)((function*(e){var t=yield this._createNearCli(e,this.networkId),r=performance.now(),n=(yield t.getBestBlock()).blockNumber;return{responseTime:Math.floor(performance.now()-r),latestBlock:n}}));return function(t){return e.apply(this,arguments)}}(),n.getPrivateKeyByCredential=function(){var e=(0,u.default)((function*(e){var t,r=e.split(":"),n=(0,i.default)(r,2),o=n[0],a=n[1],u=ne.from((0,_.baseDecode)(a));return"ed25519"===o&&64===u.length&&(t=u.slice(0,32)),Promise.resolve(t)}));return function(t){return e.apply(this,arguments)}}(),n.getTransactionStatuses=function(){var e=(0,u.default)((function*(e){var t=yield this._getNearCli();return yield Promise.all(e.map((function(e){return t.getTransactionStatus(e).then((function(e){return e})).catch((function(){return w.TransactionStatus.PENDING}))})))}));return function(t){return e.apply(this,arguments)}}(),n.validateWatchingCredential=function(e){return Promise.resolve(this.settings.watchingAccountEnabled&&(0,_.verifyNearAddress)(e).isValid)},n.validateAddress=function(){var e=(0,u.default)((function*(e){var t=(0,_.verifyNearAddress)(e);return t.isValid?Promise.resolve(t.normalizedAddress||e):Promise.reject(new A.InvalidAddress)}));return function(t){return e.apply(this,arguments)}}(),n.validateTokenAddress=function(){var e=(0,u.default)((function*(e){return this.validateAddress(e)}));return function(t){return e.apply(this,arguments)}}(),n.broadcastTransaction=function(){var e=(0,u.default)((function*(e,t){m.default.engine.info("broadcastTransaction START:",{rawTx:e.rawTx});var r=yield this._getNearCli(),n=yield r.broadcastTransaction(e.rawTx);return m.default.engine.info("broadcastTransaction END:",{txid:n,rawTx:e.rawTx}),oe(oe({},e),{},{txid:n,encodedTx:e.encodedTx})}));return function(t,r){return e.apply(this,arguments)}}(),(0,c.default)(r)}(I.VaultBase)},565147:(e,t,r)=>{r.r(t),r.d(t,{KeyringBase:()=>s,KeyringBaseMock:()=>d});var n=r(634795),i=r(887371),o=r(545754),a=r(411987),u=r(695058);function c(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,u.default)(e);if(t){var i=(0,u.default)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,a.default)(this,r)}}var s=function(e){(0,o.default)(r,e);var t=c(r);function r(e){var r;return(r=t.call(this,e.options)).vault=e,r}return r.prototype.addressFromBase=function(){var e=(0,n.default)((function*(e){return this.vault.addressFromBase(e)}));return function(t){return e.apply(this,arguments)}}(),(0,i.default)(r)}(r(114540).VaultContext),d=function(e){(0,o.default)(r,e);var t=c(r);function r(){return t.apply(this,arguments)}return(0,i.default)(r)}(s)},82406:(e,t,r)=>{r.r(t),r.d(t,{KeyringHardwareBase:()=>l});var n=r(634795),i=r(887371),o=r(545754),a=r(411987),u=r(695058),c=r(799075),s=r(814817);function d(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,u.default)(e);if(t){var i=(0,u.default)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,a.default)(this,r)}}var l=function(e){(0,o.default)(a,e);var t=d(a);function a(){return t.apply(this,arguments)}var u=a.prototype;return u.getHardwareInfo=function(){var e=(0,n.default)((function*(){var e,t,r,n=yield this.engine.getHWDeviceByWalletId(this.vault.walletId);return{connectId:null!=(e=null==n?void 0:n.mac)?e:"",deviceId:null!=(t=null==n?void 0:n.deviceId)?t:"",deviceType:null!=(r=null==n?void 0:n.deviceType)?r:""}}));return function(){return e.apply(this,arguments)}}(),u.getWalletPassphraseState=function(){var e=(0,n.default)((function*(){var e=yield this.engine.getWallet(this.vault.walletId);return{passphraseState:null==e?void 0:e.passphraseState,useEmptyPassphrase:!(0,s.isPassphraseWallet)(e)}}));return function(){return e.apply(this,arguments)}}(),u.getHardwareSDKInstance=function(){var e=(0,n.default)((function*(){var e,t,n,i,o;return null!=(o=yield null==(e=r.g)||null==(t=e.$backgroundApiProxy)||null==(n=t.backgroundApi)||null==(i=n.serviceHardware)||null==i.getSDKInstance?void 0:i.getSDKInstance())?o:c.HardwareSDK}));return function(){return e.apply(this,arguments)}}(),u.prepareAccountByAddressIndex=function(e){throw new Error("Method not implemented.")},(0,i.default)(a)}(r(565147).KeyringBase)},810887:(e,t,r)=>{r.r(t),r.d(t,{KeyringHdBase:()=>y});var n=r(256666),i=r(634795),o=r(887371),a=r(545754),u=r(411987),c=r(695058),s=r(605851),d=r(940915);function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function f(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function p(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,c.default)(e);if(t){var i=(0,c.default)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,u.default)(this,r)}}var y=function(e){(0,a.default)(r,e);var t=p(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.getPrivateKeys=function(){var e=(0,i.default)((function*(e,t){var r=(yield this.getDbAccount()).path.split("/"),n=t||[r.pop()],i=r.join("/"),o=(yield this.engine.dbApi.getCredential(this.walletId,e)).seed;if("undefined"===typeof o)throw new d.OneKeyInternalError("Unable to get credential.");var a=(yield this.engine.providerManager.getChainInfoByNetworkId(this.networkId)).curve;return(0,s.batchGetPrivateKeys)(a,o,e,i,n).reduce((function(e,t){var r;return f(f({},e),{},((r={})[t.path]=t.extendedKey.key,r))}),{})}));return function(t,r){return e.apply(this,arguments)}}(),n.getAddress=function(){throw new Error("Method not implemented.")},n.batchGetAddress=function(){throw new Error("Method not implemented.")},n.prepareAccountByAddressIndex=function(e){throw new Error("Method not implemented.")},(0,o.default)(r)}(r(280306).KeyringSoftwareBase)},255942:(e,t,r)=>{r.r(t),r.d(t,{KeyringImportedBase:()=>d});var n=r(634795),i=r(887371),o=r(545754),a=r(411987),u=r(695058),c=r(940915);function s(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,u.default)(e);if(t){var i=(0,u.default)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,a.default)(this,r)}}var d=function(e){(0,o.default)(r,e);var t=s(r);function r(){return t.apply(this,arguments)}var a=r.prototype;return a.getPrivateKeys=function(){var e=(0,n.default)((function*(e,t){if("undefined"!==typeof t)throw new c.NotImplemented("Getting private keys from extended private key");var r=(yield this.engine.dbApi.getCredential(this.accountId,e)).privateKey;if("undefined"===typeof r)throw new c.OneKeyInternalError("Unable to get credential.");return{"":r}}));return function(t,r){return e.apply(this,arguments)}}(),a.getAddress=function(){throw new Error("Method not implemented.")},a.batchGetAddress=function(){throw new Error("Method not implemented.")},a.prepareAccountByAddressIndex=function(){throw new Error("Method not implemented.")},(0,i.default)(r)}(r(280306).KeyringSoftwareBase)},280306:(e,t,r)=>{r.r(t),r.d(t,{KeyringSoftwareBase:()=>h});var n=r(196234),i=r(256666),o=r(634795),a=r(887371),u=r(545754),c=r(411987),s=r(695058),d=r(292147),l=r(940915);function f(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?f(Object(r),!0).forEach((function(t){(0,i.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):f(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function y(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,s.default)(e);if(t){var i=(0,s.default)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,c.default)(this,r)}}var h=function(e){(0,u.default)(r,e);var t=y(r);function r(){return t.apply(this,arguments)}var i=r.prototype;return i.signTransaction=function(){var e=(0,o.default)((function*(e,t){var r=t.password;if("undefined"===typeof r)throw new l.OneKeyInternalError("Software signing requires a password.");var n=yield this.getSigners(r,e.inputs.map((function(e){return e.address})));return d.default.engine.info("signTransaction",this.networkId,e),p(p({},yield this.engine.providerManager.signTransaction(this.networkId,e,n)),{},{encodedTx:e.encodedTx})}));return function(t,r){return e.apply(this,arguments)}}(),i.signMessage=function(){var e=(0,o.default)((function*(e,t){var r=this,i=t.password;if("undefined"===typeof i)throw new l.OneKeyInternalError("Software signing requires a password.");var o=yield this.getDbAccount(),a=Object.values(yield this.getSigners(i,[o.address])),u=(0,n.default)(a,1)[0];return d.default.engine.info("signMessage",this.networkId,e),Promise.all(e.map((function(e){return r.engine.providerManager.signMessage(r.networkId,e,u)})))}));return function(t,r){return e.apply(this,arguments)}}(),i.getAddress=function(){throw new Error("Method not implemented.")},i.batchGetAddress=function(){throw new Error("Method not implemented.")},i.prepareAccountByAddressIndex=function(e){throw new Error("Method not implemented.")},(0,a.default)(r)}(r(565147).KeyringBase)},701625:(e,t,r)=>{r.r(t),r.d(t,{KeyringWatchingBase:()=>d});var n=r(634795),i=r(887371),o=r(545754),a=r(411987),u=r(695058),c=r(940915);function s(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,u.default)(e);if(t){var i=(0,u.default)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,a.default)(this,r)}}var d=function(e){(0,o.default)(r,e);var t=s(r);function r(){return t.apply(this,arguments)}var a=r.prototype;return a.signTransaction=function(){var e=(0,n.default)((function*(e,t){throw new c.OneKeyInternalError("signTransaction is not supported for watching accounts")}));return function(t,r){return e.apply(this,arguments)}}(),a.signMessage=function(){var e=(0,n.default)((function*(e,t){throw new c.OneKeyInternalError("signMessage is not supported for watching accounts")}));return function(t,r){return e.apply(this,arguments)}}(),a.getAddress=function(){throw new Error("Method not implemented.")},a.batchGetAddress=function(){throw new Error("Method not implemented.")},a.prepareAccountByAddressIndex=function(){throw new Error("Method not implemented.")},(0,i.default)(r)}(r(565147).KeyringBase)},153546:(e,t,r)=>{r.r(t),r.d(t,{convertDeviceError:()=>u});var n=r(703599),i=r(302478),o=r(292147);r(213208);function a(e,t){return"string"!==typeof t?null:e===n.HardwareErrorCode.DeviceInitializeFailed&&t.includes("ECONNABORTED")?new i.ConnectTimeoutError({message:t}):t.includes("Bridge network error")?new i.BridgeNetworkError({message:t}):null}function u(e){var t,r=e||{},u=r.code,c=r.error,s=r.message,d=null!=(t=null!=c?c:s)?t:"Unknown error";if(a(u,d))return a(u,d);switch(o.default.hardwareSDK.info("Device Utils Convert Device Error:",u,d),u){case n.HardwareErrorCode.UnknownError:return new i.UnknownHardwareError(e);case n.HardwareErrorCode.DeviceFwException:return new i.FirmwareVersionTooLow(e);case n.HardwareErrorCode.DeviceUnexpectedMode:return"string"===typeof d&&-1!==d.indexOf("ui-device_bootloader_mode")?new i.NotInBootLoaderMode(e):new i.UnknownHardwareError(e);case n.HardwareErrorCode.DeviceCheckDeviceIdError:return new i.DeviceNotSame(e);case n.HardwareErrorCode.DeviceNotFound:return new i.DeviceNotFind(e);case n.HardwareErrorCode.DeviceUnexpectedBootloaderMode:return new i.NotInBootLoaderMode(e);case n.HardwareErrorCode.DeviceInterruptedFromOutside:case n.HardwareErrorCode.DeviceInterruptedFromUser:return new i.UserCancelFromOutside(e);case n.HardwareErrorCode.DeviceNotSupportPassphrase:return new i.NotSupportPassphraseError(e);case n.HardwareErrorCode.IFrameLoadFail:return new i.InitIframeLoadFail(e);case n.HardwareErrorCode.IframeTimeout:return new i.InitIframeTimeout(e);case n.HardwareErrorCode.FirmwareUpdateDownloadFailed:return new i.FirmwareDownloadFailed(e);case n.HardwareErrorCode.FirmwareUpdateManuallyEnterBoot:return new i.FirmwareUpdateManuallyEnterBoot(e);case n.HardwareErrorCode.FirmwareUpdateAutoEnterBootFailure:return new i.FirmwareUpdateAutoEnterBootFailure(e);case n.HardwareErrorCode.FirmwareUpdateLimitOneDevice:return new i.FirmwareUpdateLimitOneDevice(e);case n.HardwareErrorCode.CallMethodNeedUpgradeFirmware:return new i.FirmwareVersionTooLow(e);case n.HardwareErrorCode.NewFirmwareUnRelease:return new i.NewFirmwareUnRelease(e);case n.HardwareErrorCode.NewFirmwareForceUpdate:return new i.NewFirmwareForceUpdate(e);case n.HardwareErrorCode.NetworkError:return new i.NetworkError(e);case n.HardwareErrorCode.BlePermissionError:return new i.NeedBluetoothTurnedOn(e);case n.HardwareErrorCode.BleLocationError:return new i.NeedBluetoothPermissions({message:d});case n.HardwareErrorCode.BleLocationServicesDisabled:return new i.BleLocationServiceError({message:d});case n.HardwareErrorCode.BleDeviceNotBonded:return new i.DeviceNotBonded(e);case n.HardwareErrorCode.BleDeviceBondError:return new i.DeviceBondError(e);case n.HardwareErrorCode.BleWriteCharacteristicError:return new i.BleWriteCharacteristicError(e);case n.HardwareErrorCode.BleScanError:return new i.BleScanError({message:d});case n.HardwareErrorCode.BleAlreadyConnected:return new i.BleAlreadyConnectedError(e);case n.HardwareErrorCode.RuntimeError:return-1!==d.indexOf("EIP712 blind sign is disabled")?new i.OpenBlindSign(e):-1!==d.indexOf("Unknown message")||-1!==d.indexOf("Failure_UnexpectedMessage")?new i.UnknownMethod(e):new i.UnknownHardwareError(e);case n.HardwareErrorCode.PinInvalid:return new i.InvalidPIN(e);case n.HardwareErrorCode.DeviceCheckPassphraseStateError:return new i.InvalidPassphrase(e);case n.HardwareErrorCode.DeviceOpenedPassphrase:return new i.DeviceOpenedPassphrase(e);case n.HardwareErrorCode.DeviceNotOpenedPassphrase:return new i.DeviceNotOpenedPassphrase(e);case n.HardwareErrorCode.PinCancelled:case n.HardwareErrorCode.ActionCancelled:return new i.UserCancel(e);case n.HardwareErrorCode.BridgeNotInstalled:case i.CustomOneKeyHardwareError.NeedOneKeyBridge:return new i.NeedOneKeyBridge(e);case n.HardwareErrorCode.BridgeNetworkError:return new i.BridgeNetworkError(e);case n.HardwareErrorCode.BridgeTimeoutError:return new i.BridgeTimeoutError(e);case n.HardwareErrorCode.PollingTimeout:return new i.ConnectTimeoutError(e);case n.HardwareErrorCode.PollingStop:return new i.ConnectPollingStopError(e);case n.HardwareErrorCode.BlindSignDisabled:return new i.OpenBlindSign(e);case n.HardwareErrorCode.FileAlreadyExists:return new i.FileAlreadyExistError(e);case n.HardwareErrorCode.CheckDownloadFileError:return new i.IncompleteFileError(e);case n.HardwareErrorCode.NotInSigningMode:return new i.NotInSigningModeError(e);case n.HardwareErrorCode.DataOverload:return new i.DeviceDataOverload(e);default:return new i.UnknownHardwareError(e)}}}}]);