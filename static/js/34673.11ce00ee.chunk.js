"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[34673],{234673:(e,t,s)=>{s.r(t),s.d(t,{default:()=>I});var a=s(539144),n=s(877531),r=s(795116),o=s(669083),d=s(196234),i=s(783723),u=s(18861),l=s(321668),f=s(566147),c=s(10918),m=s(634795),_=s(921311),g=s(202784),w=s(472719),p=s(783112),h=s(901187),x=(s(213208),s(945821)),v=(s(597476),s(859071)),M=s(747225),b=s(821919),j=s(854341),y=s(552322),P=function(e){var t=e.onNext,s=(0,p.default)(),a=(0,_.default)({defaultValues:{password:""},mode:"onChange"}),n=a.control,r=a.handleSubmit,o=a.setError,d=a.formState.isValid,u=(0,g.useCallback)(function(){var e=(0,m.default)((function*(e){var a=yield x.default.servicePassword.getBgSensitiveTextEncodeKey(),n=(0,h.encodeSensitiveText)({text:e.password,key:a});(yield x.default.engine.verifyMasterPassword(n))?null==t||t(n):o("password",{message:s.formatMessage({id:"msg__wrong_password",defaultMessage:"Wrong password."})})}));return function(t){return e.apply(this,arguments)}}(),[t,s,o]);return(0,y.jsxs)(i.default,{px:{base:4,md:0},children:[(0,y.jsx)(c.default.DisplayLarge,{textAlign:"center",mb:2,children:s.formatMessage({id:"title__enter_password",defaultMessage:"Enter Password"})}),(0,y.jsx)(c.default.Body1,{textAlign:"center",color:"text-subdued",children:s.formatMessage({id:"content__enter_current_password_before_resetting_it",defaultMessage:"Enter the old password before resetting it"})}),(0,y.jsxs)(f.default,{mt:"8",children:[(0,y.jsx)(f.default.Item,{name:"password",control:n,rules:{required:s.formatMessage({id:"form__field_is_required"})},children:(0,y.jsx)(f.default.PasswordInput,{autoFocus:!0,onSubmitEditing:r(u)})}),(0,y.jsx)(l.default,{size:"xl",type:"primary",isDisabled:!d,onPress:r(u),children:s.formatMessage({id:"action__continue",defaultMessage:"Continue"})}),null]})]})},S=function(e){var t,s=e.oldPassword,a=(0,p.default)(),n=(0,g.useState)(!1),u=(0,d.default)(n,2),P=u[0],S=u[1],A=(0,w.useNavigation)(),k=x.default.dispatch,C=(0,g.useRef)({unmount:!1}),E=(0,M.useAppSelector)((function(e){return e.status.authenticationType})),L=(0,M.useAppSelector)((function(e){return e.settings.enableLocalAuthentication})),I=(0,v.useLocalAuthentication)().isOk,B=(null!=(t=(0,w.useRoute)().params)?t:{}).onSuccess,R=(0,_.default)({defaultValues:{password:"",confirmPassword:""},mode:"onChange"}),V=R.control,q=R.handleSubmit,T=R.getValues,D=R.setValue,N=R.watch,O=R.formState.isValid,F=(0,g.useCallback)((function(){setTimeout((function(){C.current.unmount||S(!0)}),2e3)}),[]),z=(0,g.useCallback)(function(){var e=(0,m.default)((function*(e){var t=yield x.default.servicePassword.getBgSensitiveTextEncodeKey(),n=(0,h.encodeSensitiveText)({text:e.password,key:t});try{F(),yield x.default.serviceApp.updatePassword(s,n)}catch(d){var r=d.key;return void o.default.show({title:a.formatMessage({id:r})})}e.withEnableAuthentication&&(k((0,b.setEnableLocalAuthentication)(!0)),(0,j.savePassword)(n)),L&&(0,j.savePassword)(n),s?o.default.show({title:a.formatMessage({id:"msg__password_changed"})}):o.default.show({title:a.formatMessage({id:"msg__password_has_been_set"})}),null==B||B(),A.goBack()}));return function(t){return e.apply(this,arguments)}}(),[L,s,B,A,F,a,k]),K=N(["password","confirmPassword"]);(0,g.useEffect)((function(){var e=K.map((function(e){return e.split("").filter((function(e){return e.charCodeAt(0)>=32&&e.charCodeAt(0)<=126})).join("")})),t=(0,d.default)(e,2),s=t[0],a=t[1];s!==K[0]&&D("password",s),a!==K[1]&&D("confirmPassword",a)}),[K,D]),(0,g.useEffect)((function(){return function(){C.current.unmount=!0}}),[]);var W="FACIAL"===E?a.formatMessage({id:"content__face_id"}):a.formatMessage({id:"content__touch_id"});return(0,y.jsxs)(i.default,{px:{base:4,md:0},children:[(0,y.jsx)(c.default.DisplayLarge,{textAlign:"center",mb:2,children:a.formatMessage({id:"title__set_password",defaultMessage:"Set Password"})}),(0,y.jsx)(c.default.Body1,{textAlign:"center",color:"text-subdued",children:a.formatMessage({id:"Only_you_can_unlock_your_wallet",defaultMessage:"Only you can unlock your wallet"})}),(0,y.jsxs)(f.default,{mt:"8",children:[(0,y.jsx)(f.default.Item,{name:"password",label:a.formatMessage({id:"form__password",defaultMessage:"Password"}),control:V,rules:{required:a.formatMessage({id:"form__field_is_required"}),minLength:{value:8,message:a.formatMessage({id:"msg__password_validation"})},maxLength:{value:128,message:a.formatMessage({id:"msg__password_validation"})},validate:function(e){var t=T("confirmPassword");if(t)return t!==e?a.formatMessage({id:"msg__password_needs_to_be_the_same"}):void 0}},children:(0,y.jsx)(f.default.PasswordInput,{autoFocus:!0})}),(0,y.jsx)(f.default.Item,{name:"confirmPassword",label:a.formatMessage({id:"Confirm_password",defaultMessage:"Confirm Password"}),control:V,rules:{required:a.formatMessage({id:"form__field_is_required"}),minLength:{value:8,message:a.formatMessage({id:"msg__password_validation"})},maxLength:{value:128,message:a.formatMessage({id:"msg__password_validation"})},validate:function(e){var t=T("password");if(t)return t!==e?a.formatMessage({id:"msg__password_needs_to_be_the_same"}):void 0}},children:(0,y.jsx)(f.default.PasswordInput,{onSubmitEditing:q(z)})}),I&&!s?(0,y.jsx)(f.default.Item,{name:"withEnableAuthentication",defaultValue:I,control:V,children:(0,y.jsx)(f.default.CheckBox,{title:a.formatMessage({id:"content__authentication_with"},{0:W})})}):null,(0,y.jsx)(l.default,{size:"xl",type:"primary",isDisabled:!O,onPromise:q(z),children:a.formatMessage({id:"action__continue",defaultMessage:"Continue"})}),P?(0,y.jsx)(r.default,{children:(0,y.jsx)(c.default.Body2,{color:"text-subdued",children:a.formatMessage({id:"content__change_password_attention"})})}):null]})]})},A=function(){var e=(0,g.useState)(""),t=(0,d.default)(e,2),s=t[0],a=t[1];return s?(0,y.jsx)(S,{oldPassword:s}):(0,y.jsx)(P,{onNext:a})},k=function(){var e=(0,M.useData)().isPasswordSet,t=(0,g.useState)(e),s=(0,d.default)(t,1)[0];return(0,y.jsx)(n.default,{footer:null,children:(0,y.jsx)(u.default,{children:s?(0,y.jsx)(A,{}):(0,y.jsx)(S,{oldPassword:""})})})};var C=s(733198),E=(0,s(324665).default)(),L=[{name:C.PasswordRoutes.PasswordRoutes,component:k}];const I=function(){var e=(0,a.default)();return(0,y.jsx)(E.Navigator,{screenOptions:{headerShown:!1,animationEnabled:!!e},children:L.map((function(e){return(0,y.jsx)(E.Screen,{name:e.name,component:e.component},e.name)}))})}},733198:(e,t,s)=>{var a;s.r(t),s.d(t,{PasswordRoutes:()=>a}),function(e){e.PasswordRoutes="PasswordRoutes"}(a||(a={}))}}]);