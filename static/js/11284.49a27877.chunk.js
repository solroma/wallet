"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[11284],{786141:(e,t,r)=>{r.r(t),r.d(t,{VaultBase:()=>P,VaultBaseChainOnly:()=>C});var n=r(72579),a=r.n(n),o=r(256666),i=r(301842),u=r.n(i),c=r(634795),s=r(887371),d=r(545754),l=r(411987),f=r(695058),p=r(206391),h=r.n(p),y=r(636393),v=r(613549),w=r(292147),m=r(213208),g=r(992431),T=r(940915),x=r(278489),I=r(969618),E=r(398514),b=r(114540),A=r(348834).Buffer;function O(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function k(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?O(Object(r),!0).forEach((function(t){(0,o.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):O(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function B(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,f.default)(e);if(t){var a=(0,f.default)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,l.default)(this,r)}}if(m.default.isExtensionUi)throw new Error("engine/VaultBase is not allowed imported from ui");var C=function(e){(0,d.default)(r,e);var t=B(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.initProvider=function(){var e=(0,c.default)((function*(){var e=(yield this.getNetwork()).impl;u()(I.IMPL_MAPPINGS[e])||(this.engineProvider=yield this.engine.providerManager.getProvider(this.networkId))}));return function(){return e.apply(this,arguments)}}(),n.proxyJsonRPCCall=function(){var e=(0,c.default)((function*(e){throw new T.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.createClientFromURL=function(e){throw new T.NotImplemented},n.getEthersProvider=function(){var e=(0,c.default)((function*(){throw new T.NotImplemented}));return function(){return e.apply(this,arguments)}}(),n.getClientEndpointStatus=function(){var e=(0,c.default)((function*(e){var t=this.createClientFromURL(e),r=performance.now(),n=(yield t.getInfo()).bestBlockNumber;return{responseTime:Math.floor(performance.now()-r),latestBlock:n}}));return function(t){return e.apply(this,arguments)}}(),n.checkRpcBatchSupport=function(){var e=(0,c.default)((function*(e){throw new T.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.getDisplayAddress=function(){var e=(0,c.default)((function*(e){return Promise.resolve(e)}));return function(t){return e.apply(this,arguments)}}(),n.validateAddress=function(){var e=(0,c.default)((function*(e){var t=yield this.engineProvider.verifyAddress(e),r=t.normalizedAddress;if(!t.isValid||!r)throw new T.InvalidAddress;return Promise.resolve(r)}));return function(t){return e.apply(this,arguments)}}(),n.validateImportedCredential=function(e){return Promise.resolve(this.settings.importedAccountEnabled&&/^(0x)?[0-9a-zA-Z]{64}$/.test(e))},n.validateWatchingCredential=function(){var e=(0,c.default)((function*(e){return Promise.resolve(this.settings.watchingAccountEnabled&&(yield this.engineProvider.verifyAddress(e)).isValid)}));return function(t){return e.apply(this,arguments)}}(),n.validateTokenAddress=function(){var e=(0,c.default)((function*(e){var t=yield this.engineProvider.verifyTokenAddress(e),r=t.normalizedAddress;if(!t.isValid||"undefined"===typeof r)throw new T.InvalidTokenAddress;return Promise.resolve(r)}));return function(t){return e.apply(this,arguments)}}(),n.validateCanCreateNextAccount=function(){var e=(0,c.default)((function*(e,t){return Promise.resolve(!0)}));return function(t,r){return e.apply(this,arguments)}}(),n.checkAccountExistence=function(){var e=(0,c.default)((function*(e,t){return Promise.resolve(!0)}));return function(t,r){return e.apply(this,arguments)}}(),n.getBalances=function(){var e=(0,c.default)((function*(e,t,r){return(yield this.engine.providerManager.getClient(this.networkId)).getBalances(e.map((function(e){var t=e.address,r=e.tokenAddress;return{address:t,coin:k({},"string"===typeof r?{tokenAddress:r}:{})}})))}));return function(t,r,n){return e.apply(this,arguments)}}(),n.getFrozenBalance=function(){var e=(0,c.default)((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.password,e.useRecycleBalance,e.ignoreInscriptions,e.useCustomAddressesBalance;return 0}));return function(){return e.apply(this,arguments)}}(),n.fetchBalanceDetails=function(){var e=(0,c.default)((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.password,e.useRecycleBalance,e.ignoreInscriptions,e.useCustomAddressesBalance;return Promise.resolve(void 0)}));return function(){return e.apply(this,arguments)}}(),n.getTransactionStatuses=function(e){return this.engine.providerManager.getTransactionStatuses(this.networkId,e)},n.getTransactionFeeInNative=function(e){return Promise.resolve("")},n.isContractAddress=function(){var e=(0,c.default)((function*(e){return!1}));return function(t){return e.apply(this,arguments)}}(),n.getAccountNameInfoMap=function(){var e=(0,c.default)((function*(){var e=yield this.getNetwork();return(0,x.getAccountNameInfoByImpl)(e.impl)}));return function(){return e.apply(this,arguments)}}(),n.canAutoCreateNextAccount=function(){var e=(0,c.default)((function*(e){return Promise.resolve(!1)}));return function(t){return e.apply(this,arguments)}}(),n.filterAccounts=function(){var e=(0,c.default)((function*(e){var t=e.accounts;e.networkId;return Promise.resolve(t)}));return function(t){return e.apply(this,arguments)}}(),n.shouldChangeAccountWhenNetworkChanged=function(){var e=(0,c.default)((function*(e){e.previousNetwork,e.newNetwork,e.activeAccountId;return Promise.resolve({shouldReloadAccountList:!1,shouldChangeActiveAccount:!1})}));return function(t){return e.apply(this,arguments)}}(),n.getAccountNameInfosByImportedOrWatchingCredential=function(){var e=(0,c.default)((function*(e){return Promise.resolve([])}));return function(t){return e.apply(this,arguments)}}(),n.checkIsUnlimitedAllowance=function(){var e=(0,c.default)((function*(e){throw new T.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.checkIsApprovedForAll=function(){var e=(0,c.default)((function*(e){throw new T.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.checkIsBatchTransfer=function(){var e=(0,c.default)((function*(e){throw new T.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.getFeePricePerUnit=function(){var e=(0,c.default)((function*(){throw new T.NotImplemented}));return function(){return e.apply(this,arguments)}}(),n.fetchRpcChainId=function(){var e=(0,c.default)((function*(e){return null}));return function(t){return e.apply(this,arguments)}}(),n.getTxWaitingSeconds=function(){var e=(0,c.default)((function*(){return[]}));return function(){return e.apply(this,arguments)}}(),n.getUserNFTAssets=function(){var e=(0,c.default)((function*(e){e.serviceData;return Promise.resolve(void 0)}));return function(t){return e.apply(this,arguments)}}(),n.getTransactionDetail=function(){var e=(0,c.default)((function*(e){return Promise.resolve(void 0)}));return function(t){return e.apply(this,arguments)}}(),(0,s.default)(r)}(b.VaultContext),P=function(e){(0,d.default)(r,e);var t=B(r);function r(){for(var e,r=arguments.length,n=new Array(r),a=0;a<r;a++)n[a]=arguments[a];return(e=t.call.apply(t,[this].concat(n))).uuid=y.default.v4().toString(),e}var n=r.prototype;return n.init=function(){var e=(0,c.default)((function*(e){yield this.initProvider(),yield this.initKeyring(e)}));return function(t){return e.apply(this,arguments)}}(),n.initKeyring=function(){var e=(0,c.default)((function*(e){this.keyring=yield e.keyringCreator(this)}));return function(t){return e.apply(this,arguments)}}(),n.signTransaction=function(){var e=(0,c.default)((function*(e,t){return this.keyring.signTransaction(e,t)}));return function(t,r){return e.apply(this,arguments)}}(),n.signAndSendTransaction=function(){var e=(0,c.default)((function*(e,t,r){var n=yield this.signTransaction(e,t);return r?k(k({},n),{},{encodedTx:e.encodedTx}):this.broadcastTransaction(k(k({},n),{},{encodedTx:e.encodedTx}))}));return function(t,r,n){return e.apply(this,arguments)}}(),n.broadcastTransaction=function(){var e=(0,c.default)((function*(e,t){w.default.engine.info("broadcastTransaction START:",{rawTx:e.rawTx});var r=yield this.engine.providerManager.broadcastTransaction(this.networkId,e.rawTx,t);return w.default.engine.info("broadcastTransaction END:",{txid:r,rawTx:e.rawTx}),k(k({},e),{},{txid:r,encodedTx:e.encodedTx})}));return function(t,r){return e.apply(this,arguments)}}(),n.buildEncodedTxFromBatchTransfer=function(){var e=(0,c.default)((function*(e){throw new T.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.buildEncodedTxsFromSetApproveForAll=function(){var e=(0,c.default)((function*(e,t){throw new T.NotImplemented}));return function(t,r){return e.apply(this,arguments)}}(),n.activateAccount=function(){var e=(0,c.default)((function*(){throw new T.NotImplemented}));return function(){return e.apply(this,arguments)}}(),n.activateToken=function(){var e=(0,c.default)((function*(e,t){throw new T.NotImplemented}));return function(t,r){return e.apply(this,arguments)}}(),n.getTokenAllowance=function(){var e=(0,c.default)((function*(e,t){throw new T.NotImplemented}));return function(t,r){return e.apply(this,arguments)}}(),n.batchTokensAllowance=function(){var e=(0,c.default)((function*(e,t){throw new T.NotImplemented}));return function(t,r){return e.apply(this,arguments)}}(),n.getOutputAccount=function(){var e=(0,c.default)((function*(){var e=yield this.getDbAccount({noCache:!0});return{id:e.id,name:e.name,type:e.type,path:e.path,coinType:e.coinType,tokens:[],address:e.address,template:e.template,pubKey:a()(e,"pub","")}}));return function(){return e.apply(this,arguments)}}(),n.getAccountBalance=function(){var e=(0,c.default)((function*(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,a=(yield this.getDbAccount()).address;return this.getBalances((t?[{address:a}]:[]).concat(e.map((function(e){return{address:a,tokenAddress:e}}))),r,n)}));return function(t){return e.apply(this,arguments)}}(),n.updatePendingTxs=function(){var e=(0,c.default)((function*(e){throw new T.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.getAccountNonce=function(){var e=(0,c.default)((function*(){return Promise.resolve(null)}));return function(){return e.apply(this,arguments)}}(),n.fixActionDirection=function(){var e=(0,c.default)((function*(e){var t,r,n,a,o=e.action,i=e.accountAddress;(o.direction=E.IDecodedTxDirection.OTHER,o.type===E.IDecodedTxActionType.NATIVE_TRANSFER)&&(o.direction=yield this.buildTxActionDirection({from:(null==(t=o.nativeTransfer)?void 0:t.from)||"",to:(null==(r=o.nativeTransfer)?void 0:r.to)||"",address:i}));o.type===E.IDecodedTxActionType.TOKEN_TRANSFER&&(o.direction=yield this.buildTxActionDirection({from:(null==(n=o.tokenTransfer)?void 0:n.from)||"",to:(null==(a=o.tokenTransfer)?void 0:a.to)||"",address:i}));return o}));return function(t){return e.apply(this,arguments)}}(),n.fixDecodedTx=function(){var e=(0,c.default)((function*(e){var t,r;e.createdAt=null!=(t=e.createdAt)?t:Date.now();var n=null==(r=e.encodedTx)?void 0:r.nonce;e.nonce=u()(n)?e.nonce:new(h())(n).toNumber();for(var a=e.owner,o=0;o<e.actions.length;o+=1){var i=e.actions[o];yield this.fixActionDirection({action:i,accountAddress:a})}if(e.outputActions)for(var c=0;c<e.outputActions.length;c+=1){var s=e.outputActions[c];yield this.fixActionDirection({action:s,accountAddress:a})}return Promise.resolve(e)}));return function(t){return e.apply(this,arguments)}}(),n.fixHistoryTx=function(){var e=(0,c.default)((function*(e){return e.decodedTx=yield this.fixDecodedTx(e.decodedTx),Promise.resolve(e)}));return function(t){return e.apply(this,arguments)}}(),n.buildHistoryTx=function(){var e=(0,c.default)((function*(e){var t=e.historyTxToMerge,r=(e.encodedTx,e.decodedTx),n=e.signedTx,a=e.isSigner,o=e.isLocalCreated,i=(null==n?void 0:n.txid)||(null==r?void 0:r.txid)||"";if(!i)throw new Error("buildHistoryTx txid not found");var u=yield this.getAccountAddress();r.txid=i||r.txid,r.owner=u,a&&(r.signer=u),null!=n&&n.txKey&&(r.extraInfo?r.extraInfo.txKey=n.txKey:r.extraInfo={txKey:n.txKey});var c=k(k({id:`${this.networkId}_${i}_${this.accountId}`,isLocalCreated:Boolean(o)},t),{},{decodedTx:r});return c=yield this.fixHistoryTx(c),Promise.resolve(c)}));return function(t){return e.apply(this,arguments)}}(),n.checkIsScamHistoryTx=function(){var e=(0,c.default)((function*(e){return!1}));return function(t){return e.apply(this,arguments)}}(),n.fetchOnChainHistory=function(){var e=(0,c.default)((function*(e){throw new T.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.fixAddressCase=function(e){return Promise.resolve(e)},n.buildTxActionDirection=function(){var e=(0,c.default)((function*(e){var t=e.from,r=e.to,n=e.address;return t=yield this.fixAddressCase(t||""),r=yield this.fixAddressCase(r),n=yield this.fixAddressCase(n),t===r&&t===n?E.IDecodedTxDirection.SELF:t&&t===n?E.IDecodedTxDirection.OUT:r&&r===n?E.IDecodedTxDirection.IN:E.IDecodedTxDirection.OTHER}));return function(t){return e.apply(this,arguments)}}(),n.getNextNonce=function(){var e=(0,c.default)((function*(e,t){var r,n=null==(r=(yield this.engine.providerManager.getAddresses(e,[t.address]))[0])?void 0:r.nonce;if(u()(n))throw new T.OneKeyError("Get on-chain nonce failed.");yield this.engine.getHistory(e,t.id,void 0,!1);var a=yield g.default.history.getMaxPendingNonce({accountId:this.accountId,networkId:e}),o=yield g.default.history.getPendingNonceList({accountId:this.accountId,networkId:e}),i=Math.max(u()(a)?0:a+1,n);if(Number.isNaN(i)&&(i=n),i>n)for(var c=n;c<i;c+=1)if(!o.includes(c)){i=c;break}if(i<n&&(i=n),i-n>=v.HISTORY_CONSTS.PENDING_QUEUE_MAX_LENGTH)throw new T.PendingQueueTooLong(v.HISTORY_CONSTS.PENDING_QUEUE_MAX_LENGTH);return i}));return function(t,r){return e.apply(this,arguments)}}(),n.validateSendAmount=function(e,t,r){return Promise.resolve(!0)},n.notifyChainChanged=function(e,t){},n.getFetchBalanceAddress=function(e){return Promise.resolve(e.address)},n.getPrivateKeyByCredential=function(e){return Promise.resolve(A.from(e.startsWith("0x")?e.slice(2):e,"hex"))},n.getMinDepositAmount=function(){var e=(0,c.default)((function*(){return"0"}));return function(){return e.apply(this,arguments)}}(),n.specialCheckEncodedTx=function(){var e=(0,c.default)((function*(e){return{success:!0}}));return function(t){return e.apply(this,arguments)}}(),n.getAllUsedAddress=function(){var e=(0,c.default)((function*(){return Promise.resolve([])}));return function(){return e.apply(this,arguments)}}(),(0,s.default)(r)}(C)},611284:(e,t,r)=>{r.r(t),r.d(t,{default:()=>ge});var n=r(256666),a=r(158215),o=r.n(a),i=r(968079),u=r(196234),c=r(255281),s=r.n(c),d=r(516760),l=r.n(d),f=r(475652),p=r.n(f),h=r(634795),y=r(887371),v=r(545754),w=r(411987),m=r(695058),g=r(299780),T=r(789644),x=r.n(T),I=r(206391),E=r.n(I),b=r(266105),A=r.n(b),O=r(901187),k=r(740727),B=r(776553),C=r(814817),P=r(292147),D=r(396564),N=r(665417),S=r(940915),H=r(683094),R=r(794292),_=r(655697),F=r(398514),K=r(786141),j=r(389342),M=r(153546),U=r(613549),W=r(398145),$=r(82406);function L(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function V(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?L(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):L(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function z(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,m.default)(e);if(t){var a=(0,m.default)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,w.default)(this,r)}}var G=`m/44'/${U.COINTYPE_TRON}'/0'/0`,q=function(e){(0,v.default)(r,e);var t=z(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.signTransaction=function(){var e=(0,h.default)((function*(e,t){var r,n=e.payload.encodedTx,a=n.raw_data,o=a.ref_block_bytes,i=a.ref_block_hash,u=a.expiration,c=a.timestamp,s=a.fee_limit;switch(n.raw_data.contract[0].type){case"TransferContract":var d=n.raw_data.contract[0].parameter.value,l=d.amount,f=d.to_address;r={transferContract:{amount:l,toAddress:A().address.fromHex(f)}};break;case"TriggerSmartContract":var p=n.raw_data.contract[0].parameter.value,h=p.contract_address,y=p.call_value,v=p.data;r={triggerSmartContract:{contractAddress:A().address.fromHex(h),data:v,callValue:y}};break;case"FreezeBalanceV2Contract":var w=n.raw_data.contract[0].parameter.value,m=w.frozen_balance,g=w.resource;r={freezeBalanceV2Contract:V({frozenBalance:m},"BANDWIDTH"===(void 0===g?"BANDWIDTH":g)?null:{resource:1})};break;case"UnfreezeBalanceV2Contract":var T=n.raw_data.contract[0].parameter.value,x=T.unfreeze_balance,I=T.resource;r={unfreezeBalanceV2Contract:V({unfreezeBalance:x},"BANDWIDTH"===(void 0===I?"BANDWIDTH":I)?null:{resource:1})};break;case"DelegateResourceContract":var E=n.raw_data.contract[0].parameter.value,b=E.receiver_address,O=E.resource,k=void 0===O?"BANDWIDTH":O,B=E.balance,C=E.lock;r={delegateResourceContract:V(V({balance:B,receiverAddress:A().address.fromHex(b)},C?{lock:C}:null),"BANDWIDTH"===k?null:{resource:1})};break;case"UnDelegateResourceContract":var P=n.raw_data.contract[0].parameter.value,D=P.receiver_address,N=P.resource,H=void 0===N?"BANDWIDTH":N;r={unDelegateResourceContract:V({balance:P.balance,receiverAddress:A().address.fromHex(D)},"BANDWIDTH"===H?null:{resource:1})};break;case"WithdrawBalanceContract":var R=n.raw_data.contract[0].parameter.value.owner_address;r={withdrawBalanceContract:{ownerAddress:A().address.fromHex(R)}};break;case"WithdrawExpireUnfreezeContract":r={withdrawExpireUnfreezeContract:{}}}if("undefined"===typeof r)throw new S.NotImplemented;var _=yield this.getDbAccount(),F=yield this.getHardwareSDKInstance(),K=yield this.getHardwareInfo(),j=K.connectId,U=K.deviceId,W=yield this.getWalletPassphraseState(),$=yield F.tronSignTransaction(j,U,V({path:_.path,transaction:{refBlockBytes:o,refBlockHash:i,expiration:u,timestamp:c,feeLimit:s,contract:r}},W));if($.success&&$.payload.signature){var L=$.payload,z=L.signature,G=L.serialized_tx;return Promise.resolve({txid:n.txID,rawTx:JSON.stringify(V(V({},n),{},{raw_data_hex:G||n.raw_data_hex,signature:[z]}))})}throw(0,M.convertDeviceError)($.payload)}));return function(t,r){return e.apply(this,arguments)}}(),n.signMessage=function(e,t){throw new S.NotImplemented("Signing tron message is not supported yet.")},n.prepareAccounts=function(){var e=(0,h.default)((function*(e){var t,r=this,n=e.indexes,a=e.names,o=n.map((function(e){return`${G}/${e}`})),i=yield this.getHardwareSDKInstance(),u=yield this.getHardwareInfo(),c=u.connectId,s=u.deviceId,d=yield this.getWalletPassphraseState();try{t=yield i.tronGetAddress(c,s,V({bundle:o.map((function(e){return{path:e,showOnOneKey:false}}))},d))}catch(l){throw P.default.common.error(l),new S.OneKeyHardwareError(l)}if(!t.success)throw P.default.common.error(t.payload),(0,M.convertDeviceError)(t.payload);return t.payload.map((function(e,t){var o=e.address,i=e.path;return{id:`${r.walletId}--${i}`,name:(a||[])[t]||`TRON #${n[t]+1}`,type:W.AccountType.SIMPLE,path:i,coinType:U.COINTYPE_TRON,pub:"",address:null!=o?o:""}})).filter((function(e){return!!e.address}))}));return function(t){return e.apply(this,arguments)}}(),n.getAddress=function(){var e=(0,h.default)((function*(e){var t,r=yield this.getHardwareSDKInstance(),n=yield this.getHardwareInfo(),a=n.connectId,o=n.deviceId,i=yield this.getWalletPassphraseState(),u=yield r.tronGetAddress(a,o,V({path:e.path,showOnOneKey:e.showOnOneKey},i));if(u.success&&null!=(t=u.payload)&&t.address)return u.payload.address;throw(0,M.convertDeviceError)(u.payload)}));return function(t){return e.apply(this,arguments)}}(),n.batchGetAddress=function(){var e=(0,h.default)((function*(e){var t=yield this.getHardwareSDKInstance(),r=yield this.getHardwareInfo(),n=r.connectId,a=r.deviceId,o=yield this.getWalletPassphraseState(),i=yield t.tronGetAddress(n,a,V(V({},o),{},{bundle:e.map((function(e){return{path:e.path,showOnOneKey:!!e.showOnOneKey}}))}));if(!i.success)throw(0,M.convertDeviceError)(i.payload);return i.payload.map((function(e){var t,r;return{path:null!=(t=e.path)?t:"",address:null!=(r=e.address)?r:""}}))}));return function(t){return e.apply(this,arguments)}}(),(0,y.default)(r)}($.KeyringHardwareBase),Y=r(605851),J=r(810887),X=r(59256),Q=r(348834).Buffer;function Z(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ee(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Z(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Z(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function te(e){var t=(0,Y.uncompressPublicKey)("secp256k1",Q.from(e,"hex"));return A().address.fromHex(`41${(0,X.keccak256)(t.slice(-64)).slice(-40)}`)}function re(e,t){return ne.apply(this,arguments)}function ne(){return(ne=(0,h.default)((function*(e,t){var r=e.payload.encodedTx,n=yield t.sign(Q.from(r.txID,"hex")),a=(0,u.default)(n,2),o=a[0],i=a[1];return Promise.resolve({txid:r.txID,rawTx:JSON.stringify(ee(ee({},r),{},{signature:[Q.concat([o,Q.from([i])]).toString("hex")]}))})}))).apply(this,arguments)}function ae(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,m.default)(e);if(t){var a=(0,m.default)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,w.default)(this,r)}}var oe=`m/44'/${U.COINTYPE_TRON}'/0'/0`,ie=function(e){(0,v.default)(r,e);var t=ae(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.getSigners=function(){var e=(0,h.default)((function*(e,t){var r,n=yield this.getDbAccount();if(1!==t.length)throw new S.OneKeyInternalError("TRON signers number should be 1.");if(t[0]!==n.address)throw new S.OneKeyInternalError("Wrong address required for signing.");var a=(yield this.getPrivateKeys(e))[n.path];if("undefined"===typeof a)throw new S.OneKeyInternalError("Unable to get signer.");return(r={})[n.address]=new R.Signer(a,e,"secp256k1"),r}));return function(t,r){return e.apply(this,arguments)}}(),n.prepareAccounts=function(){var e=(0,h.default)((function*(e){var t=e.password,r=e.indexes,n=e.names,a=(yield this.engine.dbApi.getCredential(this.walletId,t)).seed,o=(0,Y.batchGetPublicKeys)("secp256k1",a,t,oe,r.map((function(e){return e.toString()})));if(o.length!==r.length)throw new S.OneKeyInternalError("Unable to get publick key.");var i=[],u=0;for(var c of o){var s=c.path,d=c.extendedKey.key.toString("hex"),l=te(d),f=(n||[])[u]||`TRON #${r[u]+1}`;i.push({id:`${this.walletId}--${s}`,name:f,type:W.AccountType.SIMPLE,path:s,coinType:U.COINTYPE_TRON,pub:d,address:l}),u+=1}return i}));return function(t){return e.apply(this,arguments)}}(),n.signTransaction=function(){var e=(0,h.default)((function*(e,t){var r=yield this.getDbAccount();return re(e,(yield this.getSigners(t.password||"",[r.address]))[r.address])}));return function(t,r){return e.apply(this,arguments)}}(),(0,y.default)(r)}(J.KeyringHdBase),ue=r(478557);function ce(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,m.default)(e);if(t){var a=(0,m.default)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,w.default)(this,r)}}var se=function(e){(0,v.default)(r,e);var t=ce(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.getSigners=function(){var e=(0,h.default)((function*(e,t){var r,n=yield this.getDbAccount();if(1!==t.length)throw new S.OneKeyInternalError("TRON signers number should be 1.");if(t[0]!==n.address)throw new S.OneKeyInternalError("Wrong address required for signing.");var a=Object.values(yield this.getPrivateKeys(e)),o=(0,u.default)(a,1)[0];return(r={})[n.address]=new R.Signer(o,e,"secp256k1"),r}));return function(t,r){return e.apply(this,arguments)}}(),n.signTransaction=function(){var e=(0,h.default)((function*(e,t){var r=yield this.getDbAccount();return re(e,(yield this.getSigners(t.password||"",[r.address]))[r.address])}));return function(t,r){return e.apply(this,arguments)}}(),n.prepareAccounts=function(){var e=(0,h.default)((function*(e){var t=e.name,r=e.privateKey;if(32!==r.length)throw new S.OneKeyInternalError("Invalid private key.");var n=ue.secp256k1.publicFromPrivate(r).toString("hex"),a=te(n);return Promise.resolve([{id:`imported--${U.COINTYPE_TRON}--${n}`,name:t||"",type:W.AccountType.SIMPLE,path:"",coinType:U.COINTYPE_TRON,pub:n,address:a}])}));return function(t){return e.apply(this,arguments)}}(),(0,y.default)(r)}(r(255942).KeyringImportedBase);function de(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,m.default)(e);if(t){var a=(0,m.default)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,w.default)(this,r)}}var le=function(e){(0,v.default)(r,e);var t=de(r);function r(){return t.apply(this,arguments)}return r.prototype.prepareAccounts=function(){var e=(0,h.default)((function*(e){var t=e.name,r=e.target,n=e.accountIdPrefix,a=yield this.vault.validateAddress(r);return Promise.resolve([{id:`${n}--${U.COINTYPE_TRON}--${a}`,name:t||"",type:W.AccountType.SIMPLE,path:"",coinType:U.COINTYPE_TRON,pub:"",address:a}])}));return function(t){return e.apply(this,arguments)}}(),(0,y.default)(r)}(r(701625).KeyringWatchingBase),fe=r(483903),pe=r(348834).Buffer;function he(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ye(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?he(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):he(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function ve(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,m.default)(e);if(t){var a=(0,m.default)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,w.default)(this,r)}}var we="0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff",me=/\(([^)]+)\)/,ge=function(e){(0,v.default)(r,e);var t=ve(r);function r(){for(var e,r=arguments.length,n=new Array(r),a=0;a<r;a++)n[a]=arguments[a];return(e=t.call.apply(t,[this].concat(n))).keyringMap={hd:ie,hw:q,imported:se,watching:le,external:le},e.settings=fe.default,e.getTronWeb=(0,D.memoizee)((function(e){var t=new(A())({fullHost:e});return t.setAddress("T9yD14Nj9j7xAB4dbGeiX9h8unkKHxuWwb"),t}),{promise:!0,max:3,maxAge:(0,B.getTimeDurationMs)({minute:3})}),e.getApiExplorerCache=(0,D.memoizee)(function(){var e=(0,h.default)((function*(e){return x().create({baseURL:e})}));return function(t){return e.apply(this,arguments)}}(),{primitive:!0,promise:!0,max:1,maxAge:(0,B.getTimeDurationMs)({minute:3})}),e.getTokenInfo=(0,D.memoizee)(function(){var t=(0,h.default)((function*(t){var r=yield e.getApiExplorer(),n=new(E())(t).isInteger(),a=n?"api/token":"api/token_trc20",o=n?{id:t}:{contract:t};try{var i,u=yield r.get(a,{params:o});if(n){var c,s=null==(c=u.data.data)?void 0:c[0],d=u.data.total;if(s&&1===d)return{name:s.name,symbol:s.abbr,decimals:s.precision,logoURI:s.imgUrl}}var l=null==(i=u.data.trc20_tokens)?void 0:i[0];if(l)return{name:l.name,symbol:l.symbol,decimals:l.decimals,logoURI:l.icon_url}}catch(f){}}));return function(e){return t.apply(this,arguments)}}(),{promise:!0,max:100,maxAge:(0,B.getTimeDurationMs)({minute:3})}),e.getParameters=(0,D.memoizee)((0,h.default)((function*(){var t=yield e.getClient();return Object.fromEntries((yield t.trx.getChainParameters()).map((function(e){return[e.key,e.value]})))})),{promise:!0,maxAge:(0,B.getTimeDurationMs)({minute:3})}),e}var n=r.prototype;return n.getApiExplorer=function(){var e=(0,h.default)((function*(){var e=yield this.getClientApi();return this.getApiExplorerCache(e.tronscan)}));return function(){return e.apply(this,arguments)}}(),n.getClient=function(){var e=(0,h.default)((function*(){var e=(yield this.engine.getNetwork(this.networkId)).rpcURL;return this.getTronWeb(e)}));return function(){return e.apply(this,arguments)}}(),n.getAccountTokens=function(){var e=(0,h.default)((function*(e){try{var t,r=yield this.getApiExplorer(),n=yield r.get("api/account/tokens",{params:{address:e}});return(null==n||null==(t=n.data)?void 0:t.data)||[]}catch(a){}}));return function(t){return e.apply(this,arguments)}}(),n.getConsumableResource=function(){var e=(0,h.default)((function*(e){var t=yield this.getClient(),r=yield t.trx.getAccountResources(e),n=r.freeNetUsed,a=void 0===n?0:n,o=r.freeNetLimit,i=void 0===o?0:o,u=r.NetUsed,c=void 0===u?0:u,s=r.NetLimit,d=void 0===s?0:s,l=r.EnergyUsed,f=void 0===l?0:l,p=r.EnergyLimit;return{freeBandwidth:i-a,stakedBandwidth:d-c,stakedEnergy:(void 0===p?0:p)-f}}));return function(t){return e.apply(this,arguments)}}(),n.getClientEndpointStatus=function(){var e=(0,h.default)((function*(e){var t=this.getTronWeb(e),r=performance.now(),n=(yield t.fullNode.request("jsonrpc",{jsonrpc:"2.0",id:1,method:"eth_getBlockByNumber",params:["latest",!1]},"post")).result.number,a=parseInt(n);return{responseTime:Math.floor(performance.now()-r),latestBlock:a}}));return function(t){return e.apply(this,arguments)}}(),n.fetchTokenInfos=function(){var e=(0,h.default)((function*(e){var t=this;return Promise.all(e.map(function(){var e=(0,h.default)((function*(e){try{return yield t.getTokenInfo(e)}catch(r){}}));return function(t){return e.apply(this,arguments)}}()))}));return function(t){return e.apply(this,arguments)}}(),n.validateAddress=function(){var e=(0,h.default)((function*(e){return new(E())(e).isInteger()?(yield this.getTokenInfo(e))?e:Promise.reject(new S.InvalidAddress):A().isAddress(e)?Promise.resolve(A().address.fromHex(e)):Promise.reject(new S.InvalidAddress)}));return function(t){return e.apply(this,arguments)}}(),n.validateWatchingCredential=function(e){return Promise.resolve(this.settings.watchingAccountEnabled&&A().isAddress(e))},n.validateTokenAddress=function(e){return this.validateAddress(e)},n.checkAccountExistence=function(){var e=(0,h.default)((function*(e){var t=yield this.getClient();return"undefined"!==typeof(yield t.trx.getAccount(e)).address}));return function(t){return e.apply(this,arguments)}}(),n.getBalances=function(){var e=(0,h.default)((function*(e){var t=this,r=p()(l()(e,"address")),n=yield Promise.all(r.map(function(){var e=(0,h.default)((function*(e){try{var r=yield t.getAccountTokens(e);return r?{address:e,tokens:r}:null}catch(n){return null}}));return function(t){return e.apply(this,arguments)}}()));return e.map((function(e){var t,r,a=e.address,o=e.tokenAddress,i=(null==(t=s()(n,{address:a}))?void 0:t.tokens)||[],u=s()(i,{tokenId:null!=o?o:"_"});return u?new(E())(null!=(r=u.balance)?r:0):new(E())(0)}))}));return function(t){return e.apply(this,arguments)}}(),n.getTransactionStatuses=function(){var e=(0,h.default)((function*(e){var t=yield this.getClient();return Promise.all(e.map((function(e){return t.trx.getConfirmedTransaction(e).then((function(e){var t=(0,u.default)(e.ret,1)[0].contractRet;return"SUCCESS"===(void 0===t?"":t)?k.TransactionStatus.CONFIRM_AND_SUCCESS:k.TransactionStatus.CONFIRM_BUT_FAILED}),(function(r){return"Transaction not found"===r?t.trx.getTransaction(e).then((function(){return k.TransactionStatus.PENDING}),(function(e){return"Transaction not found"===e?k.TransactionStatus.NOT_FOUND:void 0})):void 0}))})))}));return function(t){return e.apply(this,arguments)}}(),n.attachFeeInfoToEncodedTx=function(e){return Promise.resolve(e.encodedTx)},n.decodeTx=function(){var e=(0,h.default)((function*(e,t){var r=e,n={type:F.IDecodedTxActionType.UNKNOWN};if("TransferContract"===r.raw_data.contract[0].type){var a=r.raw_data.contract[0].parameter.value,o=a.amount,i=a.owner_address,c=a.to_address,s=yield this.engine.getNativeTokenInfo(this.networkId);n={type:F.IDecodedTxActionType.NATIVE_TRANSFER,nativeTransfer:{tokenInfo:s,from:A().address.fromHex(i),to:A().address.fromHex(c),amount:new(E())(o).shiftedBy(-s.decimals).toFixed(),amountValue:o.toString(),extraInfo:null}}}else if("TriggerSmartContract"===r.raw_data.contract[0].type){var d=r.raw_data.contract[0].parameter.value,l=d.contract_address,f=d.data,p=d.owner_address;try{var h=A().address.fromHex(p),y=A().address.fromHex(l);if(y===H.batchTransferContractAddress[this.networkId]){var v=yield this.decodeBatchTransferTx(r);if(v)return v}var w=yield this.fetchTokenInfos([y]),m=(0,u.default)(w,1)[0],T=yield this.engine.ensureTokenInDB(this.networkId,y),x=`0x${f.slice(0,8)}`;if(m&&T)if(x===j.Erc20MethodSelectors.tokenTransfer){var I=g.defaultAbiCoder.decode(["address","uint256"],`0x${f.slice(8)}`),b=(0,u.default)(I,2),O=b[0],k=b[1],B=new(E())(k._hex);"undefined"!==typeof T&&(n={type:F.IDecodedTxActionType.TOKEN_TRANSFER,tokenTransfer:{tokenInfo:T,from:h,to:A().address.fromHex(O),amount:B.shiftedBy(-T.decimals).toFixed(),amountValue:B.toFixed(),extraInfo:null}})}else if(x===j.Erc20MethodSelectors.tokenApprove){var P=g.defaultAbiCoder.decode(["address","uint256"],`0x${f.slice(8)}`),D=(0,u.default)(P,2),N=D[0],S=D[1],R=new(E())(S._hex);n={type:F.IDecodedTxActionType.TOKEN_APPROVE,tokenApprove:{tokenInfo:T,owner:h,spender:A().address.fromHex(N),isMax:(0,C.toBigIntHex)(R)===we,amount:R.shiftedBy(-T.decimals).toFixed(),amountValue:R.toFixed(),extraInfo:null}}}}catch(K){}}var _=yield this.getAccountAddress();return{txid:r.txID,owner:_,signer:_,nonce:0,actions:[n],status:F.IDecodedTxStatus.Pending,networkId:this.networkId,accountId:this.accountId,extraInfo:null,encodedTx:r}}));return function(t,r){return e.apply(this,arguments)}}(),n.decodeBatchTransferTx=function(){var e=(0,h.default)((function*(e){var t=yield this.getAccountAddress(),r=e.raw_data.contract[0].parameter.value,n=r.data,a=r.owner_address,o=A().address.fromHex(a),i=`0x${n.slice(0,8)}`,c=[],s=yield this.getAccountAddress();switch(i){case _.BatchTransferSelectors.disperseEtherSameValue:case _.BatchTransferSelectors.disperseEther:var d=i===_.BatchTransferSelectors.disperseEtherSameValue,l=yield this.engine.getNativeTokenInfo(this.networkId),f=[],p=[];if(d){var h=g.defaultAbiCoder.decode(["address[]","uint256"],`0x${n.slice(8)}`);f=(0,u.default)(h,1)[0],p=[h[1]]}else{var y=g.defaultAbiCoder.decode(["address[]","uint256[]"],`0x${n.slice(8)}`),v=(0,u.default)(y,2);f=v[0],p=v[1]}for(var w=0;w<f.length;w+=1){var m=A().address.fromHex(f[w]),T=new(E())(d?p[0]._hex:p[w]._hex);o!==t&&m!==t||c.push({type:F.IDecodedTxActionType.NATIVE_TRANSFER,direction:yield this.buildTxActionDirection({from:o,to:f[w],address:s}),nativeTransfer:{tokenInfo:l,from:o,to:m,amount:T.shiftedBy(-l.decimals).toFixed(),amountValue:T.toFixed(),extraInfo:null}})}break;case _.BatchTransferSelectors.disperseTokenSameValue:case _.BatchTransferSelectors.disperseTokenSimple:var x=i===_.BatchTransferSelectors.disperseTokenSameValue,I="",b=[],O=[];if(x){var k=g.defaultAbiCoder.decode(["address","address[]","uint256"],`0x${n.slice(8)}`),B=(0,u.default)(k,2);I=B[0],b=B[1],O=[k[2]]}else{var C=g.defaultAbiCoder.decode(["address","address[]","uint256[]"],`0x${n.slice(8)}`),P=(0,u.default)(C,3);I=P[0],b=P[1],O=P[2]}var D=yield this.engine.ensureTokenInDB(this.networkId,A().address.fromHex(I));if(!D)break;for(var N=0;N<b.length;N+=1){var S=A().address.fromHex(b[N]),H=new(E())(x?O[0]._hex:O[N]._hex);c.push({type:F.IDecodedTxActionType.TOKEN_TRANSFER,direction:yield this.buildTxActionDirection({from:o,to:S,address:s}),tokenTransfer:{tokenInfo:D,from:o,to:S,amount:H.shiftedBy(-D.decimals).toFixed(),amountValue:H.toFixed(),extraInfo:null}})}break;default:return null}return{txid:e.txID,owner:t,signer:o||t,nonce:0,actions:[].concat(c),status:F.IDecodedTxStatus.Pending,networkId:this.networkId,accountId:this.accountId,extraInfo:null,encodedTx:e}}));return function(t){return e.apply(this,arguments)}}(),n.decodedTxToLegacy=function(e){return Promise.resolve({})},n.buildEncodedTxFromTransfer=function(){var e=(0,h.default)((function*(e){if(!e.to)throw new Error("Invalid transferInfo.to params");var t=e.from,r=e.to,n=e.amount,a=e.token,o=yield this.getClient(),i=yield this.engine.ensureTokenInDB(this.networkId,a||"");if(!i)throw new S.OneKeyInternalError(`Token not found: ${a||"TRX"}`);if(a){if(!new(E())(a).isInteger()){var u=yield o.transactionBuilder.triggerSmartContract(a,"transfer(address,uint256)",{},[{type:"address",value:r},{type:"uint256",value:new(E())(n).shiftedBy(i.decimals).toFixed(0)}],t),c=u.result.result,s=u.transaction;if(!c)throw new S.OneKeyInternalError("Unable to build token transfer transaction");return s}try{return yield o.transactionBuilder.sendToken(r,parseInt(new(E())(n).shiftedBy(i.decimals).toFixed()),a,t)}catch(d){throw"string"===typeof d&&d.endsWith("is not sufficient.")?new S.InsufficientBalance:"string"===typeof d?new Error(d):d}}try{return yield o.transactionBuilder.sendTrx(r,parseInt(new(E())(n).shiftedBy(i.decimals).toFixed()),t)}catch(d){throw"string"===typeof d&&d.endsWith("balance is not sufficient.")?new S.InsufficientBalance:"string"===typeof d?new Error(d):d}}));return function(t){return e.apply(this,arguments)}}(),n.buildEncodedTxFromBatchTransfer=function(){var e=(0,h.default)((function*(e){var t,r,n,a=e.transferInfos,u=yield this.getClient(),c=yield this.getNetwork(),s=yield this.getDbAccount(),d=a[0],l=Boolean(d.token),f=H.batchTransferContractAddress[c.id];if(!f)throw new Error(`${c.name} has not deployed a batch transfer contract`);var p=new(E())(0),h=a.every((function(e){return new(E())(e.amount).isEqualTo(d.amount)}));if(l){var y,v=yield this.engine.ensureTokenInDB(this.networkId,null!=(y=d.token)?y:"");if(!v)throw new Error(`Token not found: ${d.token}`);r=(t=h?_.BatchTransferMethods.disperseTokenSameValue:_.BatchTransferMethods.disperseTokenSimple).match(me)[1].split(","),n=[v.tokenIdOnNetwork].concat((0,i.default)(o()(a,(function(e,t){var r=new(E())(t.amount);return e[0].push(t.to),e[1].push(r.shiftedBy(v.decimals).toNumber()),e}),[[],[]]))),h&&(n=[n[0],n[1],n[2][0]])}else r=(t=h?_.BatchTransferMethods.disperseEtherSameValue:_.BatchTransferMethods.disperseEther).match(me)[1].split(","),n=o()(a,(function(e,t){var r=new(E())(t.amount).shiftedBy(c.decimals);return p=p.plus(r),e[0].push(t.to),e[1].push(r.toNumber()),e}),[[],[]]),h&&(n=[n[0],n[1][0]]);var w=r.map((function(e,t){return{type:e,value:n[t]}})),m=yield u.transactionBuilder.triggerSmartContract(u.address.toHex(f),t,{callValue:l?0:p.toNumber(),feeLimit:15e9},w,u.address.toHex(s.address)),g=m.result.result,T=m.transaction;if(!g)throw new S.OneKeyInternalError("Unable to build batch transfer token transaction");return T}));return function(t){return e.apply(this,arguments)}}(),n.getBatchTransferBaseEnergy=function(){var e=(0,h.default)((function*(){var e=yield this.getNetwork(),t=yield this.getDbAccount(),r=H.batchTransferContractAddress[e.id],n=yield this.getClient(),a=_.BatchTransferMethods.disperseEther,o=new(E())(1).shiftedBy(e.decimals).toNumber(),i=[[t.address],[o]],u=["address[]","uint256[]"].map((function(e,t){return{type:e,value:i[t]}}));try{var c=yield n.transactionBuilder.estimateEnergy(n.address.toHex(r),a,{callValue:o},u,n.address.toHex(t.address)),s=c.result.result,d=c.energy_required;if(s)return d}catch(l){return 0}return 0}));return function(){return e.apply(this,arguments)}}(),n.checkIsUnlimitedAllowance=function(){var e=(0,h.default)((function*(e){var t=e.owner,r=e.spender,n=e.token;try{var a,o=yield this.getClient(),i=yield o.contract().at(n),u=yield i.allowance(t,r).call(),c=null!=(a=u.remaining)?a:u,s=new(E())(c._hex),d=(yield i.totalSupply().call())._hex;return{isUnlimited:s.gt(d),allowance:s.toFixed()}}catch(l){return{isUnlimited:!1,allowance:"0"}}}));return function(t){return e.apply(this,arguments)}}(),n.checkIsBatchTransfer=function(){var e=(0,h.default)((function*(e){var t=yield this.getClient();if("TriggerSmartContract"===e.raw_data.contract[0].type){var r=e.raw_data.contract[0].parameter.value.contract_address;return t.address.toHex(H.batchTransferContractAddress[this.networkId])===r}return!1}));return function(t){return e.apply(this,arguments)}}(),n.buildEncodedTxFromApprove=function(){var e=(0,h.default)((function*(e){var t=yield this.getClient(),r=yield this.engine.ensureTokenInDB(this.networkId,e.token);if("undefined"===typeof r)throw new Error(`Token not found: ${e.token}`);var n=[{type:"address",value:e.spender},{type:"uint256",value:"Infinite"===e.amount?we:new(E())(e.amount).shiftedBy(r.decimals).toFixed()}],a=yield t.transactionBuilder.triggerSmartContract(e.token,"approve(address,uint256)",{call_value:0},n,e.from),o=a.result.result,i=a.transaction;if(!o)throw new S.OneKeyInternalError("Unable to build token approve transaction");return i}));return function(t){return e.apply(this,arguments)}}(),n.getTokenAllowance=function(){var e=(0,h.default)((function*(e,t){var r=yield Promise.all([this.getDbAccount(),this.engine.ensureTokenInDB(this.networkId,e)]),n=(0,u.default)(r,2),a=n[0],o=n[1];if("undefined"===typeof o)throw console.error(`Token not found: ${e}`),new Error;var i=yield this.getClient(),c=yield i.contract([{constant:!0,inputs:[{name:"_owner",type:"address"},{name:"_spender",type:"address"}],name:"allowance",outputs:[{name:"remaining",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"}],e),s=yield c.allowance(a.address,t).call(),d=(0,u.default)(s,1)[0];return d?new(E())(d.toHexString()).shiftedBy(-o.decimals):new(E())(0)}));return function(t,r){return e.apply(this,arguments)}}(),n.updateEncodedTxTokenApprove=function(e,t){throw new S.NotImplemented},n.updateEncodedTx=function(){var e=(0,h.default)((function*(e,t,r){var n=e;if("transfer"===r.type&&"TransferContract"===n.raw_data.contract[0].type){var a=yield this.getClient(),o=(yield this.engine.getNativeTokenInfo(this.networkId)).decimals,i=n.raw_data.contract[0].parameter.value,u=i.owner_address,c=i.to_address,s=t.amount;return a.transactionBuilder.sendTrx(A().address.fromHex(c),parseInt(new(E())(s).shiftedBy(o).toFixed()),A().address.fromHex(u))}return Promise.resolve(n)}));return function(t,r,n){return e.apply(this,arguments)}}(),n.buildUnsignedTxFromEncodedTx=function(e){return Promise.resolve({inputs:[],outputs:[],payload:{encodedTx:e},encodedTx:e})},n.fetchFeeInfo=function(){var e=(0,h.default)((function*(e,t,r,n){var a=0,o=yield this.getNetwork(),i=e,u=yield this.getParameters(),c=yield this.getConsumableResource(yield this.getAccountAddress()),s=c.freeBandwidth,d=c.stakedBandwidth,l=c.stakedEnergy,f=i.raw_data_hex.length/2+65+64+5;if(a+=(f>s&&f>d?f:0)*u.getTransactionFee,"TransferContract"===i.raw_data.contract[0].type){var p=i.raw_data.contract[0].parameter.value.to_address;(yield this.checkAccountExistence(A().address.fromHex(p)))||(a=u.getCreateNewAccountFeeInSystemContract,a+=u.getCreateAccountFee>d?u.getCreateAccountFee:0)}else if("TriggerSmartContract"===i.raw_data.contract[0].type){var h=i.raw_data.contract[0].parameter.value,y=h.contract_address,v=h.data,w=h.call_value,m=h.owner_address,g=0,T=yield this.getClient(),x=yield T.fullNode.request("jsonrpc",{jsonrpc:"2.0",id:1,method:"eth_estimateGas",params:[{from:m,to:y,gas:"0x01",gasPrice:"0x01",value:(0,C.toBigIntHex)(new(E())(null!=w?w:0)),data:v}]},"post");if(x.error&&x.error.message){if(!x.error.message.startsWith("Not enough energy for 'CALL'")||A().address.fromHex(y)!==H.batchTransferContractAddress[this.networkId])throw new Error(x.error.message);g=(yield this.getBatchTransferBaseEnergy())*n}else g=parseInt(x.result);g>l&&(a+=g*u.getEnergyFee)}return{nativeSymbol:o.symbol,nativeDecimals:o.decimals,feeSymbol:o.feeSymbol,feeDecimals:o.feeDecimals,limit:"0",prices:["0"],defaultPresetIndex:"0",tx:null,baseFeeValue:new(E())(a.toString()).shiftedBy(-o.feeDecimals).toFixed()}}));return function(t,r,n,a){return e.apply(this,arguments)}}(),n.broadcastTransaction=function(){var e=(0,h.default)((function*(e){P.default.engine.info("broadcastTransaction START:",{rawTx:e.rawTx});var t=yield this.getClient(),r=yield t.trx.sendRawTransaction(JSON.parse(e.rawTx));if("undefined"!==typeof r.code)throw new S.OneKeyInternalError(`${r.code} ${pe.from(r.message||"","hex").toString()}`);return P.default.engine.info("broadcastTransaction END:",{txid:e.txid,rawTx:e.rawTx}),e}));return function(t){return e.apply(this,arguments)}}(),n.getExportedCredential=function(){var e=(0,h.default)((function*(e){var t=yield this.getDbAccount();if(t.id.startsWith("hd-")||t.id.startsWith("imported")){var r=this.keyring,n=Object.values(yield r.getPrivateKeys(e)),a=(0,u.default)(n,1)[0];return(0,O.decrypt)(e,a).toString("hex")}throw new S.OneKeyInternalError("Only credential of HD or imported accounts can be exported")}));return function(t){return e.apply(this,arguments)}}(),n.fetchOnChainHistory=function(){var e=(0,h.default)((function*(e){var t=this,r=e.localHistory,n=void 0===r?[]:r,a=e.tokenIdOnNetwork,o=[],c=[],s=[],d=yield this.getClient(),l=yield this.getApiExplorer(),f=yield this.getDbAccount(),p=(yield this.engine.getNativeTokenInfo(this.networkId)).decimals;o=(yield d.fullNode.request(`v1/accounts/${f.address}/transactions/trc20?only_confirmed=true${a?`&&contract_address=${a}`:""}`)).data,a||(c=(yield d.fullNode.request(`v1/accounts/${f.address}/transactions/?only_confirmed=true`)).data,s=(yield l.get("api/internal-transaction",{params:{address:f.address,start:0,limit:20}})).data.data);var y=o.map(function(){var e=(0,h.default)((function*(e){var r=n.find((function(t){return t.decodedTx.txid===e.transaction_id}));if(r&&r.decodedTx.isFinal)return Promise.resolve(null);if(e.from===f.address)return Promise.resolve(null);var a=yield t.engine.ensureTokenInDB(t.networkId,e.token_info.address);if(!a)return Promise.resolve(null);var o=yield d.trx.getTransactionInfo(e.transaction_id),i=new(E())(e.value),u={type:F.IDecodedTxActionType.UNKNOWN};"Transfer"===e.type&&(u={type:F.IDecodedTxActionType.TOKEN_TRANSFER,tokenTransfer:{tokenInfo:a,from:e.from,to:e.to,amount:i.shiftedBy(-a.decimals).toFixed(),amountValue:i.toFixed(),extraInfo:null}});try{var c,s,l={txid:e.transaction_id,owner:e.from,signer:e.from,totalFeeInNative:new(E())(null!=(c=o.fee)?c:0).shiftedBy(-p).toFixed(),actions:[u],accountId:t.accountId,networkId:t.networkId,status:F.IDecodedTxStatus.Confirmed,updatedAt:e.block_timestamp,createdAt:null!=(s=null==r?void 0:r.decodedTx.createdAt)?s:e.block_timestamp,isFinal:!0,extraInfo:null,nonce:0};return yield t.buildHistoryTx({decodedTx:l,historyTxToMerge:r})}catch(h){P.default.common.error(h)}return Promise.resolve(null)}));return function(t){return e.apply(this,arguments)}}()),v=c.map(function(){var e=(0,h.default)((function*(e){var r=n.find((function(t){return t.decodedTx.txid===e.txID}));if(r&&r.decodedTx.isFinal)return Promise.resolve(null);try{var a,o=e.block_timestamp,i=(0,u.default)(e.ret,1)[0],c=i.contractRet,s=i.fee,d=ye(ye({},yield t.decodeTx(e)),{},{txid:e.txID,totalFeeInNative:new(E())(s).shiftedBy(-p).toFixed(),status:"SUCCESS"===c?F.IDecodedTxStatus.Confirmed:F.IDecodedTxStatus.Failed,updatedAt:o,createdAt:null!=(a=null==r?void 0:r.decodedTx.createdAt)?a:o,isFinal:!0});return yield t.buildHistoryTx({decodedTx:d,historyTxToMerge:r})}catch(l){P.default.common.error(l)}return Promise.resolve(null)}));return function(t){return e.apply(this,arguments)}}()),w=s.map(function(){var e=(0,h.default)((function*(e){var r=n.find((function(t){return t.decodedTx.txid===e.hash}));if(r&&r.decodedTx.isFinal)return Promise.resolve(null);try{var a,o=yield Promise.all([d.trx.getTransaction(e.hash),d.trx.getTransactionInfo(e.hash)]),i=(0,u.default)(o,2),c=i[0],s=i[1],l=(0,u.default)(c.ret,1)[0].contractRet,f=ye(ye({},yield t.decodeTx(c)),{},{txid:e.hash,totalFeeInNative:new(E())(s.fee).shiftedBy(-p).toFixed(),status:"SUCCESS"===l?F.IDecodedTxStatus.Confirmed:F.IDecodedTxStatus.Failed,updatedAt:e.timestamp,createdAt:null!=(a=null==r?void 0:r.decodedTx.createdAt)?a:e.timestamp,isFinal:!0});return yield t.buildHistoryTx({decodedTx:f,historyTxToMerge:r})}catch(h){P.default.common.error(h)}}));return function(t){return e.apply(this,arguments)}}()),m=(yield Promise.all(y)).filter(Boolean),g=(yield Promise.all(v)).filter(Boolean),T=(yield Promise.all(w)).filter(Boolean);return[].concat((0,i.default)(m),(0,i.default)(g),(0,i.default)(T))}));return function(t){return e.apply(this,arguments)}}(),n.proxyJsonRPCCall=function(){var e=(0,h.default)((function*(e){try{var t=yield this.getClient();return yield t.fullNode.request("jsonrpc",e,"post")}catch(r){throw(0,R.extractResponseError)(r)}}));return function(t){return e.apply(this,arguments)}}(),n.getFeePricePerUnit=function(){var e=(0,h.default)((function*(){var e=(yield this.proxyJsonRPCCall({id:1,jsonrpc:"2.0",method:"eth_gasPrice",params:[]})).result,t=(0,N.fromBigIntHex)(e),r=t.isFinite()&&t.gt(1)?t:new(E())(1),n=r.multipliedBy(1.25).integerValue(E().ROUND_CEIL),a=n.multipliedBy(1.2).integerValue(E().ROUND_CEIL);return{normal:{price:n},others:[{price:r},{price:a}]}}));return function(){return e.apply(this,arguments)}}(),(0,y.default)(r)}(K.VaultBase)},565147:(e,t,r)=>{r.r(t),r.d(t,{KeyringBase:()=>s,KeyringBaseMock:()=>d});var n=r(634795),a=r(887371),o=r(545754),i=r(411987),u=r(695058);function c(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,u.default)(e);if(t){var a=(0,u.default)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,i.default)(this,r)}}var s=function(e){(0,o.default)(r,e);var t=c(r);function r(e){var r;return(r=t.call(this,e.options)).vault=e,r}return r.prototype.addressFromBase=function(){var e=(0,n.default)((function*(e){return this.vault.addressFromBase(e)}));return function(t){return e.apply(this,arguments)}}(),(0,a.default)(r)}(r(114540).VaultContext),d=function(e){(0,o.default)(r,e);var t=c(r);function r(){return t.apply(this,arguments)}return(0,a.default)(r)}(s)},82406:(e,t,r)=>{r.r(t),r.d(t,{KeyringHardwareBase:()=>l});var n=r(634795),a=r(887371),o=r(545754),i=r(411987),u=r(695058),c=r(799075),s=r(814817);function d(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,u.default)(e);if(t){var a=(0,u.default)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,i.default)(this,r)}}var l=function(e){(0,o.default)(i,e);var t=d(i);function i(){return t.apply(this,arguments)}var u=i.prototype;return u.getHardwareInfo=function(){var e=(0,n.default)((function*(){var e,t,r,n=yield this.engine.getHWDeviceByWalletId(this.vault.walletId);return{connectId:null!=(e=null==n?void 0:n.mac)?e:"",deviceId:null!=(t=null==n?void 0:n.deviceId)?t:"",deviceType:null!=(r=null==n?void 0:n.deviceType)?r:""}}));return function(){return e.apply(this,arguments)}}(),u.getWalletPassphraseState=function(){var e=(0,n.default)((function*(){var e=yield this.engine.getWallet(this.vault.walletId);return{passphraseState:null==e?void 0:e.passphraseState,useEmptyPassphrase:!(0,s.isPassphraseWallet)(e)}}));return function(){return e.apply(this,arguments)}}(),u.getHardwareSDKInstance=function(){var e=(0,n.default)((function*(){var e,t,n,a,o;return null!=(o=yield null==(e=r.g)||null==(t=e.$backgroundApiProxy)||null==(n=t.backgroundApi)||null==(a=n.serviceHardware)||null==a.getSDKInstance?void 0:a.getSDKInstance())?o:c.HardwareSDK}));return function(){return e.apply(this,arguments)}}(),u.prepareAccountByAddressIndex=function(e){throw new Error("Method not implemented.")},(0,a.default)(i)}(r(565147).KeyringBase)},810887:(e,t,r)=>{r.r(t),r.d(t,{KeyringHdBase:()=>h});var n=r(256666),a=r(634795),o=r(887371),i=r(545754),u=r(411987),c=r(695058),s=r(605851),d=r(940915);function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function f(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function p(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,c.default)(e);if(t){var a=(0,c.default)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,u.default)(this,r)}}var h=function(e){(0,i.default)(r,e);var t=p(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.getPrivateKeys=function(){var e=(0,a.default)((function*(e,t){var r=(yield this.getDbAccount()).path.split("/"),n=t||[r.pop()],a=r.join("/"),o=(yield this.engine.dbApi.getCredential(this.walletId,e)).seed;if("undefined"===typeof o)throw new d.OneKeyInternalError("Unable to get credential.");var i=(yield this.engine.providerManager.getChainInfoByNetworkId(this.networkId)).curve;return(0,s.batchGetPrivateKeys)(i,o,e,a,n).reduce((function(e,t){var r;return f(f({},e),{},((r={})[t.path]=t.extendedKey.key,r))}),{})}));return function(t,r){return e.apply(this,arguments)}}(),n.getAddress=function(){throw new Error("Method not implemented.")},n.batchGetAddress=function(){throw new Error("Method not implemented.")},n.prepareAccountByAddressIndex=function(e){throw new Error("Method not implemented.")},(0,o.default)(r)}(r(280306).KeyringSoftwareBase)},255942:(e,t,r)=>{r.r(t),r.d(t,{KeyringImportedBase:()=>d});var n=r(634795),a=r(887371),o=r(545754),i=r(411987),u=r(695058),c=r(940915);function s(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,u.default)(e);if(t){var a=(0,u.default)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,i.default)(this,r)}}var d=function(e){(0,o.default)(r,e);var t=s(r);function r(){return t.apply(this,arguments)}var i=r.prototype;return i.getPrivateKeys=function(){var e=(0,n.default)((function*(e,t){if("undefined"!==typeof t)throw new c.NotImplemented("Getting private keys from extended private key");var r=(yield this.engine.dbApi.getCredential(this.accountId,e)).privateKey;if("undefined"===typeof r)throw new c.OneKeyInternalError("Unable to get credential.");return{"":r}}));return function(t,r){return e.apply(this,arguments)}}(),i.getAddress=function(){throw new Error("Method not implemented.")},i.batchGetAddress=function(){throw new Error("Method not implemented.")},i.prepareAccountByAddressIndex=function(){throw new Error("Method not implemented.")},(0,a.default)(r)}(r(280306).KeyringSoftwareBase)},280306:(e,t,r)=>{r.r(t),r.d(t,{KeyringSoftwareBase:()=>y});var n=r(196234),a=r(256666),o=r(634795),i=r(887371),u=r(545754),c=r(411987),s=r(695058),d=r(292147),l=r(940915);function f(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?f(Object(r),!0).forEach((function(t){(0,a.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):f(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function h(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,s.default)(e);if(t){var a=(0,s.default)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,c.default)(this,r)}}var y=function(e){(0,u.default)(r,e);var t=h(r);function r(){return t.apply(this,arguments)}var a=r.prototype;return a.signTransaction=function(){var e=(0,o.default)((function*(e,t){var r=t.password;if("undefined"===typeof r)throw new l.OneKeyInternalError("Software signing requires a password.");var n=yield this.getSigners(r,e.inputs.map((function(e){return e.address})));return d.default.engine.info("signTransaction",this.networkId,e),p(p({},yield this.engine.providerManager.signTransaction(this.networkId,e,n)),{},{encodedTx:e.encodedTx})}));return function(t,r){return e.apply(this,arguments)}}(),a.signMessage=function(){var e=(0,o.default)((function*(e,t){var r=this,a=t.password;if("undefined"===typeof a)throw new l.OneKeyInternalError("Software signing requires a password.");var o=yield this.getDbAccount(),i=Object.values(yield this.getSigners(a,[o.address])),u=(0,n.default)(i,1)[0];return d.default.engine.info("signMessage",this.networkId,e),Promise.all(e.map((function(e){return r.engine.providerManager.signMessage(r.networkId,e,u)})))}));return function(t,r){return e.apply(this,arguments)}}(),a.getAddress=function(){throw new Error("Method not implemented.")},a.batchGetAddress=function(){throw new Error("Method not implemented.")},a.prepareAccountByAddressIndex=function(e){throw new Error("Method not implemented.")},(0,i.default)(r)}(r(565147).KeyringBase)},701625:(e,t,r)=>{r.r(t),r.d(t,{KeyringWatchingBase:()=>d});var n=r(634795),a=r(887371),o=r(545754),i=r(411987),u=r(695058),c=r(940915);function s(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,u.default)(e);if(t){var a=(0,u.default)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return(0,i.default)(this,r)}}var d=function(e){(0,o.default)(r,e);var t=s(r);function r(){return t.apply(this,arguments)}var i=r.prototype;return i.signTransaction=function(){var e=(0,n.default)((function*(e,t){throw new c.OneKeyInternalError("signTransaction is not supported for watching accounts")}));return function(t,r){return e.apply(this,arguments)}}(),i.signMessage=function(){var e=(0,n.default)((function*(e,t){throw new c.OneKeyInternalError("signMessage is not supported for watching accounts")}));return function(t,r){return e.apply(this,arguments)}}(),i.getAddress=function(){throw new Error("Method not implemented.")},i.batchGetAddress=function(){throw new Error("Method not implemented.")},i.prepareAccountByAddressIndex=function(){throw new Error("Method not implemented.")},(0,a.default)(r)}(r(565147).KeyringBase)},153546:(e,t,r)=>{r.r(t),r.d(t,{convertDeviceError:()=>u});var n=r(703599),a=r(302478),o=r(292147);r(213208);function i(e,t){return"string"!==typeof t?null:e===n.HardwareErrorCode.DeviceInitializeFailed&&t.includes("ECONNABORTED")?new a.ConnectTimeoutError({message:t}):t.includes("Bridge network error")?new a.BridgeNetworkError({message:t}):null}function u(e){var t,r=e||{},u=r.code,c=r.error,s=r.message,d=null!=(t=null!=c?c:s)?t:"Unknown error";if(i(u,d))return i(u,d);switch(o.default.hardwareSDK.info("Device Utils Convert Device Error:",u,d),u){case n.HardwareErrorCode.UnknownError:return new a.UnknownHardwareError(e);case n.HardwareErrorCode.DeviceFwException:return new a.FirmwareVersionTooLow(e);case n.HardwareErrorCode.DeviceUnexpectedMode:return"string"===typeof d&&-1!==d.indexOf("ui-device_bootloader_mode")?new a.NotInBootLoaderMode(e):new a.UnknownHardwareError(e);case n.HardwareErrorCode.DeviceCheckDeviceIdError:return new a.DeviceNotSame(e);case n.HardwareErrorCode.DeviceNotFound:return new a.DeviceNotFind(e);case n.HardwareErrorCode.DeviceUnexpectedBootloaderMode:return new a.NotInBootLoaderMode(e);case n.HardwareErrorCode.DeviceInterruptedFromOutside:case n.HardwareErrorCode.DeviceInterruptedFromUser:return new a.UserCancelFromOutside(e);case n.HardwareErrorCode.DeviceNotSupportPassphrase:return new a.NotSupportPassphraseError(e);case n.HardwareErrorCode.IFrameLoadFail:return new a.InitIframeLoadFail(e);case n.HardwareErrorCode.IframeTimeout:return new a.InitIframeTimeout(e);case n.HardwareErrorCode.FirmwareUpdateDownloadFailed:return new a.FirmwareDownloadFailed(e);case n.HardwareErrorCode.FirmwareUpdateManuallyEnterBoot:return new a.FirmwareUpdateManuallyEnterBoot(e);case n.HardwareErrorCode.FirmwareUpdateAutoEnterBootFailure:return new a.FirmwareUpdateAutoEnterBootFailure(e);case n.HardwareErrorCode.FirmwareUpdateLimitOneDevice:return new a.FirmwareUpdateLimitOneDevice(e);case n.HardwareErrorCode.CallMethodNeedUpgradeFirmware:return new a.FirmwareVersionTooLow(e);case n.HardwareErrorCode.NewFirmwareUnRelease:return new a.NewFirmwareUnRelease(e);case n.HardwareErrorCode.NewFirmwareForceUpdate:return new a.NewFirmwareForceUpdate(e);case n.HardwareErrorCode.NetworkError:return new a.NetworkError(e);case n.HardwareErrorCode.BlePermissionError:return new a.NeedBluetoothTurnedOn(e);case n.HardwareErrorCode.BleLocationError:return new a.NeedBluetoothPermissions({message:d});case n.HardwareErrorCode.BleLocationServicesDisabled:return new a.BleLocationServiceError({message:d});case n.HardwareErrorCode.BleDeviceNotBonded:return new a.DeviceNotBonded(e);case n.HardwareErrorCode.BleDeviceBondError:return new a.DeviceBondError(e);case n.HardwareErrorCode.BleWriteCharacteristicError:return new a.BleWriteCharacteristicError(e);case n.HardwareErrorCode.BleScanError:return new a.BleScanError({message:d});case n.HardwareErrorCode.BleAlreadyConnected:return new a.BleAlreadyConnectedError(e);case n.HardwareErrorCode.RuntimeError:return-1!==d.indexOf("EIP712 blind sign is disabled")?new a.OpenBlindSign(e):-1!==d.indexOf("Unknown message")||-1!==d.indexOf("Failure_UnexpectedMessage")?new a.UnknownMethod(e):new a.UnknownHardwareError(e);case n.HardwareErrorCode.PinInvalid:return new a.InvalidPIN(e);case n.HardwareErrorCode.DeviceCheckPassphraseStateError:return new a.InvalidPassphrase(e);case n.HardwareErrorCode.DeviceOpenedPassphrase:return new a.DeviceOpenedPassphrase(e);case n.HardwareErrorCode.DeviceNotOpenedPassphrase:return new a.DeviceNotOpenedPassphrase(e);case n.HardwareErrorCode.PinCancelled:case n.HardwareErrorCode.ActionCancelled:return new a.UserCancel(e);case n.HardwareErrorCode.BridgeNotInstalled:case a.CustomOneKeyHardwareError.NeedOneKeyBridge:return new a.NeedOneKeyBridge(e);case n.HardwareErrorCode.BridgeNetworkError:return new a.BridgeNetworkError(e);case n.HardwareErrorCode.BridgeTimeoutError:return new a.BridgeTimeoutError(e);case n.HardwareErrorCode.PollingTimeout:return new a.ConnectTimeoutError(e);case n.HardwareErrorCode.PollingStop:return new a.ConnectPollingStopError(e);case n.HardwareErrorCode.BlindSignDisabled:return new a.OpenBlindSign(e);case n.HardwareErrorCode.FileAlreadyExists:return new a.FileAlreadyExistError(e);case n.HardwareErrorCode.CheckDownloadFileError:return new a.IncompleteFileError(e);case n.HardwareErrorCode.NotInSigningMode:return new a.NotInSigningModeError(e);case n.HardwareErrorCode.DataOverload:return new a.DeviceDataOverload(e);default:return new a.UnknownHardwareError(e)}}}}]);