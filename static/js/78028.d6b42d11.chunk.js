"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[78028],{786141:(e,t,r)=>{r.r(t),r.d(t,{VaultBase:()=>B,VaultBaseChainOnly:()=>k});var n=r(72579),o=r.n(n),i=r(256666),a=r(301842),u=r.n(a),c=r(634795),d=r(887371),s=r(545754),l=r(411987),f=r(695058),p=r(206391),y=r.n(p),h=r(636393),v=r(613549),g=r(292147),m=r(213208),w=r(992431),T=r(940915),I=r(278489),x=r(969618),A=r(398514),E=r(114540),O=r(348834).Buffer;function b(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function P(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?b(Object(r),!0).forEach((function(t){(0,i.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):b(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function D(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,f.default)(e);if(t){var o=(0,f.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,l.default)(this,r)}}if(m.default.isExtensionUi)throw new Error("engine/VaultBase is not allowed imported from ui");var k=function(e){(0,s.default)(r,e);var t=D(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.initProvider=function(){var e=(0,c.default)((function*(){var e=(yield this.getNetwork()).impl;u()(x.IMPL_MAPPINGS[e])||(this.engineProvider=yield this.engine.providerManager.getProvider(this.networkId))}));return function(){return e.apply(this,arguments)}}(),n.proxyJsonRPCCall=function(){var e=(0,c.default)((function*(e){throw new T.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.createClientFromURL=function(e){throw new T.NotImplemented},n.getEthersProvider=function(){var e=(0,c.default)((function*(){throw new T.NotImplemented}));return function(){return e.apply(this,arguments)}}(),n.getClientEndpointStatus=function(){var e=(0,c.default)((function*(e){var t=this.createClientFromURL(e),r=performance.now(),n=(yield t.getInfo()).bestBlockNumber;return{responseTime:Math.floor(performance.now()-r),latestBlock:n}}));return function(t){return e.apply(this,arguments)}}(),n.checkRpcBatchSupport=function(){var e=(0,c.default)((function*(e){throw new T.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.getDisplayAddress=function(){var e=(0,c.default)((function*(e){return Promise.resolve(e)}));return function(t){return e.apply(this,arguments)}}(),n.validateAddress=function(){var e=(0,c.default)((function*(e){var t=yield this.engineProvider.verifyAddress(e),r=t.normalizedAddress;if(!t.isValid||!r)throw new T.InvalidAddress;return Promise.resolve(r)}));return function(t){return e.apply(this,arguments)}}(),n.validateImportedCredential=function(e){return Promise.resolve(this.settings.importedAccountEnabled&&/^(0x)?[0-9a-zA-Z]{64}$/.test(e))},n.validateWatchingCredential=function(){var e=(0,c.default)((function*(e){return Promise.resolve(this.settings.watchingAccountEnabled&&(yield this.engineProvider.verifyAddress(e)).isValid)}));return function(t){return e.apply(this,arguments)}}(),n.validateTokenAddress=function(){var e=(0,c.default)((function*(e){var t=yield this.engineProvider.verifyTokenAddress(e),r=t.normalizedAddress;if(!t.isValid||"undefined"===typeof r)throw new T.InvalidTokenAddress;return Promise.resolve(r)}));return function(t){return e.apply(this,arguments)}}(),n.validateCanCreateNextAccount=function(){var e=(0,c.default)((function*(e,t){return Promise.resolve(!0)}));return function(t,r){return e.apply(this,arguments)}}(),n.checkAccountExistence=function(){var e=(0,c.default)((function*(e,t){return Promise.resolve(!0)}));return function(t,r){return e.apply(this,arguments)}}(),n.getBalances=function(){var e=(0,c.default)((function*(e,t,r){return(yield this.engine.providerManager.getClient(this.networkId)).getBalances(e.map((function(e){var t=e.address,r=e.tokenAddress;return{address:t,coin:P({},"string"===typeof r?{tokenAddress:r}:{})}})))}));return function(t,r,n){return e.apply(this,arguments)}}(),n.getFrozenBalance=function(){var e=(0,c.default)((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.password,e.useRecycleBalance,e.ignoreInscriptions,e.useCustomAddressesBalance;return 0}));return function(){return e.apply(this,arguments)}}(),n.fetchBalanceDetails=function(){var e=(0,c.default)((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.password,e.useRecycleBalance,e.ignoreInscriptions,e.useCustomAddressesBalance;return Promise.resolve(void 0)}));return function(){return e.apply(this,arguments)}}(),n.getTransactionStatuses=function(e){return this.engine.providerManager.getTransactionStatuses(this.networkId,e)},n.getTransactionFeeInNative=function(e){return Promise.resolve("")},n.isContractAddress=function(){var e=(0,c.default)((function*(e){return!1}));return function(t){return e.apply(this,arguments)}}(),n.getAccountNameInfoMap=function(){var e=(0,c.default)((function*(){var e=yield this.getNetwork();return(0,I.getAccountNameInfoByImpl)(e.impl)}));return function(){return e.apply(this,arguments)}}(),n.canAutoCreateNextAccount=function(){var e=(0,c.default)((function*(e){return Promise.resolve(!1)}));return function(t){return e.apply(this,arguments)}}(),n.filterAccounts=function(){var e=(0,c.default)((function*(e){var t=e.accounts;e.networkId;return Promise.resolve(t)}));return function(t){return e.apply(this,arguments)}}(),n.shouldChangeAccountWhenNetworkChanged=function(){var e=(0,c.default)((function*(e){e.previousNetwork,e.newNetwork,e.activeAccountId;return Promise.resolve({shouldReloadAccountList:!1,shouldChangeActiveAccount:!1})}));return function(t){return e.apply(this,arguments)}}(),n.getAccountNameInfosByImportedOrWatchingCredential=function(){var e=(0,c.default)((function*(e){return Promise.resolve([])}));return function(t){return e.apply(this,arguments)}}(),n.checkIsUnlimitedAllowance=function(){var e=(0,c.default)((function*(e){throw new T.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.checkIsApprovedForAll=function(){var e=(0,c.default)((function*(e){throw new T.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.checkIsBatchTransfer=function(){var e=(0,c.default)((function*(e){throw new T.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.getFeePricePerUnit=function(){var e=(0,c.default)((function*(){throw new T.NotImplemented}));return function(){return e.apply(this,arguments)}}(),n.fetchRpcChainId=function(){var e=(0,c.default)((function*(e){return null}));return function(t){return e.apply(this,arguments)}}(),n.getTxWaitingSeconds=function(){var e=(0,c.default)((function*(){return[]}));return function(){return e.apply(this,arguments)}}(),n.getUserNFTAssets=function(){var e=(0,c.default)((function*(e){e.serviceData;return Promise.resolve(void 0)}));return function(t){return e.apply(this,arguments)}}(),n.getTransactionDetail=function(){var e=(0,c.default)((function*(e){return Promise.resolve(void 0)}));return function(t){return e.apply(this,arguments)}}(),(0,d.default)(r)}(E.VaultContext),B=function(e){(0,s.default)(r,e);var t=D(r);function r(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))).uuid=h.default.v4().toString(),e}var n=r.prototype;return n.init=function(){var e=(0,c.default)((function*(e){yield this.initProvider(),yield this.initKeyring(e)}));return function(t){return e.apply(this,arguments)}}(),n.initKeyring=function(){var e=(0,c.default)((function*(e){this.keyring=yield e.keyringCreator(this)}));return function(t){return e.apply(this,arguments)}}(),n.signTransaction=function(){var e=(0,c.default)((function*(e,t){return this.keyring.signTransaction(e,t)}));return function(t,r){return e.apply(this,arguments)}}(),n.signAndSendTransaction=function(){var e=(0,c.default)((function*(e,t,r){var n=yield this.signTransaction(e,t);return r?P(P({},n),{},{encodedTx:e.encodedTx}):this.broadcastTransaction(P(P({},n),{},{encodedTx:e.encodedTx}))}));return function(t,r,n){return e.apply(this,arguments)}}(),n.broadcastTransaction=function(){var e=(0,c.default)((function*(e,t){g.default.engine.info("broadcastTransaction START:",{rawTx:e.rawTx});var r=yield this.engine.providerManager.broadcastTransaction(this.networkId,e.rawTx,t);return g.default.engine.info("broadcastTransaction END:",{txid:r,rawTx:e.rawTx}),P(P({},e),{},{txid:r,encodedTx:e.encodedTx})}));return function(t,r){return e.apply(this,arguments)}}(),n.buildEncodedTxFromBatchTransfer=function(){var e=(0,c.default)((function*(e){throw new T.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.buildEncodedTxsFromSetApproveForAll=function(){var e=(0,c.default)((function*(e,t){throw new T.NotImplemented}));return function(t,r){return e.apply(this,arguments)}}(),n.activateAccount=function(){var e=(0,c.default)((function*(){throw new T.NotImplemented}));return function(){return e.apply(this,arguments)}}(),n.activateToken=function(){var e=(0,c.default)((function*(e,t){throw new T.NotImplemented}));return function(t,r){return e.apply(this,arguments)}}(),n.getTokenAllowance=function(){var e=(0,c.default)((function*(e,t){throw new T.NotImplemented}));return function(t,r){return e.apply(this,arguments)}}(),n.batchTokensAllowance=function(){var e=(0,c.default)((function*(e,t){throw new T.NotImplemented}));return function(t,r){return e.apply(this,arguments)}}(),n.getOutputAccount=function(){var e=(0,c.default)((function*(){var e=yield this.getDbAccount({noCache:!0});return{id:e.id,name:e.name,type:e.type,path:e.path,coinType:e.coinType,tokens:[],address:e.address,template:e.template,pubKey:o()(e,"pub","")}}));return function(){return e.apply(this,arguments)}}(),n.getAccountBalance=function(){var e=(0,c.default)((function*(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,o=(yield this.getDbAccount()).address;return this.getBalances((t?[{address:o}]:[]).concat(e.map((function(e){return{address:o,tokenAddress:e}}))),r,n)}));return function(t){return e.apply(this,arguments)}}(),n.updatePendingTxs=function(){var e=(0,c.default)((function*(e){throw new T.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.getAccountNonce=function(){var e=(0,c.default)((function*(){return Promise.resolve(null)}));return function(){return e.apply(this,arguments)}}(),n.fixActionDirection=function(){var e=(0,c.default)((function*(e){var t,r,n,o,i=e.action,a=e.accountAddress;(i.direction=A.IDecodedTxDirection.OTHER,i.type===A.IDecodedTxActionType.NATIVE_TRANSFER)&&(i.direction=yield this.buildTxActionDirection({from:(null==(t=i.nativeTransfer)?void 0:t.from)||"",to:(null==(r=i.nativeTransfer)?void 0:r.to)||"",address:a}));i.type===A.IDecodedTxActionType.TOKEN_TRANSFER&&(i.direction=yield this.buildTxActionDirection({from:(null==(n=i.tokenTransfer)?void 0:n.from)||"",to:(null==(o=i.tokenTransfer)?void 0:o.to)||"",address:a}));return i}));return function(t){return e.apply(this,arguments)}}(),n.fixDecodedTx=function(){var e=(0,c.default)((function*(e){var t,r;e.createdAt=null!=(t=e.createdAt)?t:Date.now();var n=null==(r=e.encodedTx)?void 0:r.nonce;e.nonce=u()(n)?e.nonce:new(y())(n).toNumber();for(var o=e.owner,i=0;i<e.actions.length;i+=1){var a=e.actions[i];yield this.fixActionDirection({action:a,accountAddress:o})}if(e.outputActions)for(var c=0;c<e.outputActions.length;c+=1){var d=e.outputActions[c];yield this.fixActionDirection({action:d,accountAddress:o})}return Promise.resolve(e)}));return function(t){return e.apply(this,arguments)}}(),n.fixHistoryTx=function(){var e=(0,c.default)((function*(e){return e.decodedTx=yield this.fixDecodedTx(e.decodedTx),Promise.resolve(e)}));return function(t){return e.apply(this,arguments)}}(),n.buildHistoryTx=function(){var e=(0,c.default)((function*(e){var t=e.historyTxToMerge,r=(e.encodedTx,e.decodedTx),n=e.signedTx,o=e.isSigner,i=e.isLocalCreated,a=(null==n?void 0:n.txid)||(null==r?void 0:r.txid)||"";if(!a)throw new Error("buildHistoryTx txid not found");var u=yield this.getAccountAddress();r.txid=a||r.txid,r.owner=u,o&&(r.signer=u),null!=n&&n.txKey&&(r.extraInfo?r.extraInfo.txKey=n.txKey:r.extraInfo={txKey:n.txKey});var c=P(P({id:`${this.networkId}_${a}_${this.accountId}`,isLocalCreated:Boolean(i)},t),{},{decodedTx:r});return c=yield this.fixHistoryTx(c),Promise.resolve(c)}));return function(t){return e.apply(this,arguments)}}(),n.checkIsScamHistoryTx=function(){var e=(0,c.default)((function*(e){return!1}));return function(t){return e.apply(this,arguments)}}(),n.fetchOnChainHistory=function(){var e=(0,c.default)((function*(e){throw new T.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.fixAddressCase=function(e){return Promise.resolve(e)},n.buildTxActionDirection=function(){var e=(0,c.default)((function*(e){var t=e.from,r=e.to,n=e.address;return t=yield this.fixAddressCase(t||""),r=yield this.fixAddressCase(r),n=yield this.fixAddressCase(n),t===r&&t===n?A.IDecodedTxDirection.SELF:t&&t===n?A.IDecodedTxDirection.OUT:r&&r===n?A.IDecodedTxDirection.IN:A.IDecodedTxDirection.OTHER}));return function(t){return e.apply(this,arguments)}}(),n.getNextNonce=function(){var e=(0,c.default)((function*(e,t){var r,n=null==(r=(yield this.engine.providerManager.getAddresses(e,[t.address]))[0])?void 0:r.nonce;if(u()(n))throw new T.OneKeyError("Get on-chain nonce failed.");yield this.engine.getHistory(e,t.id,void 0,!1);var o=yield w.default.history.getMaxPendingNonce({accountId:this.accountId,networkId:e}),i=yield w.default.history.getPendingNonceList({accountId:this.accountId,networkId:e}),a=Math.max(u()(o)?0:o+1,n);if(Number.isNaN(a)&&(a=n),a>n)for(var c=n;c<a;c+=1)if(!i.includes(c)){a=c;break}if(a<n&&(a=n),a-n>=v.HISTORY_CONSTS.PENDING_QUEUE_MAX_LENGTH)throw new T.PendingQueueTooLong(v.HISTORY_CONSTS.PENDING_QUEUE_MAX_LENGTH);return a}));return function(t,r){return e.apply(this,arguments)}}(),n.validateSendAmount=function(e,t,r){return Promise.resolve(!0)},n.notifyChainChanged=function(e,t){},n.getFetchBalanceAddress=function(e){return Promise.resolve(e.address)},n.getPrivateKeyByCredential=function(e){return Promise.resolve(O.from(e.startsWith("0x")?e.slice(2):e,"hex"))},n.getMinDepositAmount=function(){var e=(0,c.default)((function*(){return"0"}));return function(){return e.apply(this,arguments)}}(),n.specialCheckEncodedTx=function(){var e=(0,c.default)((function*(e){return{success:!0}}));return function(t){return e.apply(this,arguments)}}(),n.getAllUsedAddress=function(){var e=(0,c.default)((function*(){return Promise.resolve([])}));return function(){return e.apply(this,arguments)}}(),(0,d.default)(r)}(k)},378028:(e,t,r)=>{r.r(t),r.d(t,{default:()=>de});var n=r(256666),o=r(905648),i=r.n(o),a=r(986152),u=r.n(a),c=r(196234),d=r(968079),s=r(634795),l=r(887371),f=r(545754),p=r(411987),y=r(695058),h=r(206391),v=r.n(h),g=r(901187),m=r(740727),w=r(776553),T=r(292147),I=r(396564),x=r(112889),A=r(940915),E=r(398514),O=r(786141),b=r(153546),P=r(613549),D=r(398145),k=r(82406);const B=r(354360);var N=r(348834).Buffer;function C(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function S(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?C(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):C(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function F(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,y.default)(e);if(t){var o=(0,y.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,p.default)(this,r)}}var R=`m/44'/${P.COINTYPE_ALGO}'/0'/0'`,j=function(e){(0,f.default)(r,e);var t=F(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n._signTransaction=function(){var e=(0,s.default)((function*(e){var t=yield this.getHardwareSDKInstance(),r=yield this.getAccountPath(),n=yield this.getHardwareInfo(),o=n.connectId,i=n.deviceId,a=yield this.getWalletPassphraseState(),u=B.Transaction.from_obj_for_encoding(B.decodeObj(N.from(e,"base64"))),c=yield t.algoSignTransaction(o,i,S({path:r,rawTx:u.bytesToSign().toString("hex")},a));if(c.success){var d=c.payload.signature;return{txid:u.txID(),rawTx:N.from(B.encodeObj({sig:N.from(d,"hex"),txn:u.get_obj_for_encoding()})).toString("base64")}}throw(0,b.convertDeviceError)(c.payload)}));return function(t){return e.apply(this,arguments)}}(),n.signTransaction=function(){var e=(0,s.default)((function*(e){var t=e.payload.encodedTx;if(u()(t)){for(var r=[],n=0;n<t.length;n+=1){var o=t[n],i=yield this._signTransaction(o);r.push(i)}return{txid:r.map((function(e){return e.txid})).join(","),rawTx:r.map((function(e){return e.rawTx})).join(",")}}return this._signTransaction(t)}));return function(t){return e.apply(this,arguments)}}(),n.signMessage=function(e,t){throw new A.NotImplemented},n.prepareAccounts=function(){var e=(0,s.default)((function*(e){var t,r=this,n=e.indexes,o=e.names,i=n.map((function(e){return`${R}/${e}'`})),a=yield this.getHardwareSDKInstance(),u=yield this.getHardwareInfo(),c=u.connectId,d=u.deviceId,s=yield this.getWalletPassphraseState();try{t=yield a.algoGetAddress(c,d,S({bundle:i.map((function(e){return{path:e,showOnOneKey:false}}))},s))}catch(l){throw T.default.common.error(l),new A.OneKeyHardwareError(l)}if(!t.success)throw T.default.common.error(t.payload),(0,b.convertDeviceError)(t.payload);return t.payload.map((function(e,t){var i=e.address,a=void 0===i?"":i,u=e.path;return{id:`${r.walletId}--${u}`,name:(o||[])[t]||`ALGO #${n[t]+1}`,type:D.AccountType.SIMPLE,path:u,coinType:P.COINTYPE_ALGO,pub:"",address:a}})).filter((function(e){return!!e.address}))}));return function(t){return e.apply(this,arguments)}}(),n.getAddress=function(){var e=(0,s.default)((function*(e){var t,r=yield this.getHardwareSDKInstance(),n=yield this.getHardwareInfo(),o=n.connectId,i=n.deviceId,a=yield this.getWalletPassphraseState(),u=yield r.algoGetAddress(o,i,S({path:e.path,showOnOneKey:e.showOnOneKey},a));if(u.success&&null!=(t=u.payload)&&t.address)return u.payload.address;throw(0,b.convertDeviceError)(u.payload)}));return function(t){return e.apply(this,arguments)}}(),n.batchGetAddress=function(){var e=(0,s.default)((function*(e){var t=yield this.getHardwareSDKInstance(),r=yield this.getHardwareInfo(),n=r.connectId,o=r.deviceId,i=yield this.getWalletPassphraseState(),a=yield t.algoGetAddress(n,o,S(S({},i),{},{bundle:e.map((function(e){return{path:e.path,showOnOneKey:!!e.showOnOneKey}}))}));if(!a.success)throw(0,b.convertDeviceError)(a.payload);return a.payload.map((function(e){var t,r;return{path:null!=(t=e.path)?t:"",address:null!=(r=e.address)?r:""}}))}));return function(t){return e.apply(this,arguments)}}(),(0,l.default)(r)}(k.KeyringHardwareBase),H=r(605851),K=r(794292),M=r(810887),U=r(348834).Buffer;function _(e,t){return L.apply(this,arguments)}function L(){return(L=(0,s.default)((function*(e,t){var r=B.Transaction.from_obj_for_encoding(B.decodeObj(U.from(e,"base64"))),n=yield t.sign(r.bytesToSign()),o=(0,c.default)(n,1)[0];return{txid:r.txID(),rawTx:U.from(B.encodeObj({sig:o,txn:r.get_obj_for_encoding()})).toString("base64")}}))).apply(this,arguments)}function G(e){return U.from(e.toByte()).toString("base64")}function W(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,y.default)(e);if(t){var o=(0,y.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,p.default)(this,r)}}var $=`m/44'/${P.COINTYPE_ALGO}'/0'/0'`,V=function(e){(0,f.default)(r,e);var t=W(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.prepareAccounts=function(){var e=(0,s.default)((function*(e){var t=e.password,r=e.indexes,n=e.names,o=(yield this.engine.dbApi.getCredential(this.walletId,t)).seed,i=(0,H.batchGetPublicKeys)("ed25519",o,t,$,r.map((function(e){return`${e}'`})));if(i.length!==r.length)throw new A.OneKeyInternalError("Unable to get publick key.");var a=[],u=0;for(var c of i){var d=c.path,s=c.extendedKey.key,l=B.encodeAddress(s),f=(n||[])[u]||`ALGO #${r[u]+1}`;a.push({id:`${this.walletId}--${d}`,name:f,type:D.AccountType.SIMPLE,path:d,coinType:P.COINTYPE_ALGO,pub:`${s.toString("hex")}`,address:l}),u+=1}return a}));return function(t){return e.apply(this,arguments)}}(),n.getSigners=function(){var e=(0,s.default)((function*(e,t){var r,n=yield this.getDbAccount();if(1!==t.length)throw new A.OneKeyInternalError("ALGO signers number should be 1.");if(t[0]!==n.address)throw new A.OneKeyInternalError("Wrong address required for signing.");var o=(yield this.getPrivateKeys(e))[n.path];if("undefined"===typeof o)throw new A.OneKeyInternalError("Unable to get signer.");return(r={})[n.address]=new K.Signer(o,e,"ed25519"),r}));return function(t,r){return e.apply(this,arguments)}}(),n.signTransaction=function(){var e=(0,s.default)((function*(e,t){var r=yield this.getDbAccount(),n=(yield this.getSigners(t.password||"",[r.address]))[r.address],o=e.payload.encodedTx;if(u()(o)){var i=yield Promise.all(o.map((function(e){return _(e,n)})));return{txid:i.map((function(e){return e.txid})).join(","),rawTx:i.map((function(e){return e.rawTx})).join(",")}}return _(o,n)}));return function(t,r){return e.apply(this,arguments)}}(),n.signMessage=function(e,t){console.log(e,t)},(0,l.default)(r)}(M.KeyringHdBase),Y=r(478557);function z(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,y.default)(e);if(t){var o=(0,y.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,p.default)(this,r)}}var q=function(e){(0,f.default)(r,e);var t=z(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.prepareAccounts=function(){var e=(0,s.default)((function*(e){var t=e.name,r=e.privateKey;if(32!==r.length)throw new A.OneKeyInternalError("Invalid private key.");var n=Y.ed25519.publicFromPrivate(r),o=B.encodeAddress(n);return Promise.resolve([{id:`imported--${P.COINTYPE_ALGO}--${o}`,name:t||"",type:D.AccountType.SIMPLE,path:"",coinType:P.COINTYPE_ALGO,pub:`${n.toString("hex")}`,address:o}])}));return function(t){return e.apply(this,arguments)}}(),n.getSigners=function(){var e=(0,s.default)((function*(e,t){var r,n=yield this.getDbAccount();if(1!==t.length)throw new A.OneKeyInternalError("ALGO signers number should be 1.");if(t[0]!==n.address)throw new A.OneKeyInternalError("Wrong address required for signing.");var o=(yield this.getPrivateKeys(e))[n.path];if("undefined"===typeof o)throw new A.OneKeyInternalError("Unable to get signer.");return(r={})[n.address]=new K.Signer(o,e,"ed25519"),r}));return function(t,r){return e.apply(this,arguments)}}(),n.signTransaction=function(){var e=(0,s.default)((function*(e,t){var r=yield this.getDbAccount(),n=(yield this.getSigners(t.password||"",[r.address]))[r.address],o=e.payload.encodedTx;if(u()(o)){var i=yield Promise.all(o.map((function(e){return _(e,n)})));return{txid:i.map((function(e){return e.txid})).join(","),rawTx:i.map((function(e){return e.rawTx})).join(",")}}return _(o,n)}));return function(t,r){return e.apply(this,arguments)}}(),n.signMessage=function(e,t){console.log(e,t)},(0,l.default)(r)}(r(255942).KeyringImportedBase),Q=r(701625),X=r(348834).Buffer;function J(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,y.default)(e);if(t){var o=(0,y.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,p.default)(this,r)}}var Z=function(e){(0,f.default)(r,e);var t=J(r);function r(){return t.apply(this,arguments)}return r.prototype.prepareAccounts=function(){var e=(0,s.default)((function*(e){var t=e.name,r=e.target,n=e.accountIdPrefix,o=yield this.vault.validateAddress(r),i=B.decodeAddress(o).publicKey;return Promise.resolve([{id:`${n}--${P.COINTYPE_ALGO}--${r}`,name:t||"",type:D.AccountType.SIMPLE,path:"",coinType:P.COINTYPE_ALGO,pub:`${X.from(i).toString("hex")}`,address:o}])}));return function(t){return e.apply(this,arguments)}}(),(0,l.default)(r)}(Q.KeyringWatchingBase),ee=r(685604),te=r(348834).Buffer;function re(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ne(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?re(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):re(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function oe(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,y.default)(e);if(t){var o=(0,y.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,p.default)(this,r)}}var ie=new(v())("0x10000000000000000"),ae=/^.*account \w+ balance \d+ below min (\d+).*$/,ue=/^.*asset (\d+) missing from \w+$/,ce=B,de=function(e){(0,f.default)(r,e);var t=oe(r);function r(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))).keyringMap={hd:V,hw:j,imported:q,watching:Z,external:Z},e.settings=ee.default,e.getAlgod=(0,I.memoizee)((function(e,t,r){return new ce.Algodv2(e,t,r)}),{primitive:!0,maxAge:(0,w.getTimeDurationMs)({minute:3}),max:3}),e.getIndexer=(0,I.memoizee)((0,s.default)((function*(){var t=(yield e.engine.getNetwork(e.networkId)).isTestnet,r=void 0===t||t?"testnet":"mainnet",n=(0,x.getAlgoSignerEndpoint)({network:r});return new ce.Indexer("",n,443)})),{maxAge:(0,w.getTimeDurationMs)({minute:3}),promise:!0,max:1}),e.getSuggestedParams=(0,I.memoizee)((0,s.default)((function*(){return(yield e.getClient()).getTransactionParams().do()})),{promise:!0,maxAge:(0,w.getTimeDurationMs)({minute:3})}),e}var n=r.prototype;return n.getClient=function(){var e=(0,s.default)((function*(){var e=yield this.getRpcUrl();return this.getAlgod("",e,443)}));return function(){return e.apply(this,arguments)}}(),n.buildAlgoTxFromTransferInfo=function(){var e=(0,s.default)((function*(e){if(!e.to)throw new Error("Invalid transferInfo.to params");var t=e.from,r=e.to,n=e.amount,o=e.token,i=yield this.engine.ensureTokenInDB(this.networkId,o||"");if(!i)throw new A.OneKeyInternalError(`Token not found: ${o||"ALGO"}`);var a=yield this.getSuggestedParams();return o?ce.makeAssetTransferTxnWithSuggestedParamsFromObject({amount:BigInt(new(v())(n).shiftedBy(i.decimals).toFixed()),assetIndex:parseInt(o),from:t,to:r,suggestedParams:a}):ce.makePaymentTxnWithSuggestedParamsFromObject({amount:BigInt(new(v())(n).shiftedBy(i.decimals).toFixed()),from:t,to:r,suggestedParams:a})}));return function(t){return e.apply(this,arguments)}}(),n.getClientEndpointStatus=function(){var e=(0,s.default)((function*(e){var t=this.getAlgod("",e,443),r=performance.now(),n=(yield t.status().do())["last-round"];return{responseTime:Math.floor(performance.now()-r),latestBlock:n}}));return function(t){return e.apply(this,arguments)}}(),n.fetchTokenInfos=function(){var e=(0,s.default)((function*(e){var t=yield this.getClient();return Promise.all(e.map(function(){var e=(0,s.default)((function*(e){try{var r=(yield t.getAssetByID(parseInt(e)).do()).params;return{decimals:r.decimals,name:r.name,symbol:r["unit-name"]}}catch(n){}}));return function(t){return e.apply(this,arguments)}}()))}));return function(t){return e.apply(this,arguments)}}(),n.validateAddress=function(e){return ce.isValidAddress(e)?Promise.resolve(e):Promise.reject(new A.InvalidAddress)},n.validateWatchingCredential=function(e){return Promise.resolve(this.settings.watchingAccountEnabled&&ce.isValidAddress(e))},n.validateTokenAddress=function(e){var t=new(v())(e);return t.isFinite()&&t.gte(0)&&t.lt(ie)?Promise.resolve(e):Promise.reject(new A.InvalidTokenAddress)},n.getBalances=function(){var e=(0,s.default)((function*(e){var t=yield this.getClient(),r=(0,d.default)(new Set(e.map((function(e){return e.address})))),n=(yield Promise.all(r.map(function(){var e=(0,s.default)((function*(e){try{return yield t.accountInformation(e).do()}catch(r){console.error(r)}}));return function(t){return e.apply(this,arguments)}}()))).filter(Boolean),o=Object.fromEntries(n.map((function(e){var t=e.address,r=e.amount,n=e.assets;return[t,Object.fromEntries([["main",new(v())(r)]].concat(n.map((function(e){var t=e.amount;return[e["asset-id"].toString(),new(v())(t)]}))))]})));return e.map((function(e){var t,r=e.address,n=e.tokenAddress;if("undefined"!==typeof o[r])return null!=(t=o[r][n||"main"])?t:new(v())(0)}))}));return function(t){return e.apply(this,arguments)}}(),n.getTransactionStatuses=function(){var e=(0,s.default)((function*(e){var t=yield this.getClient(),r=yield this.getIndexer();return Promise.all(e.map(function(){var e=(0,s.default)((function*(e){try{var n=yield t.pendingTransactionInformation(e).do(),o=n["confirmed-round"];return n["pool-error"]?m.TransactionStatus.CONFIRM_BUT_FAILED:o>0?m.TransactionStatus.CONFIRM_AND_SUCCESS:m.TransactionStatus.PENDING}catch(c){var i=c,a=i.status,u=i.name;if(404===a||"RangeError"===u)try{return yield r.lookupTransactionByID(e).do(),m.TransactionStatus.CONFIRM_AND_SUCCESS}catch(d){if(404===d.status)return m.TransactionStatus.NOT_FOUND;throw d}throw c}}));return function(t){return e.apply(this,arguments)}}()))}));return function(t){return e.apply(this,arguments)}}(),n.activateToken=function(){var e=(0,s.default)((function*(e,t){var r=(yield this.getDbAccount()).address,n=yield this.getClient(),o=(yield n.accountInformation(r).do()).assets;for(var i of o){if(i["asset-id"]===parseInt(e))return Promise.resolve(!0)}var a=yield this.buildEncodedTxFromTransfer({from:r,to:r,amount:"0",token:e}),u=yield this.buildUnsignedTxFromEncodedTx(a);return!!(yield this.signAndSendTransaction(u,{password:t},!1)).txid}));return function(t,r){return e.apply(this,arguments)}}(),n.attachFeeInfoToEncodedTx=function(e){return Promise.resolve(e.encodedTx)},n.decodeAlgoTx=function(){var e=(0,s.default)((function*(e){var t=yield this.getDbAccount(),r=yield this.engine.getNativeTokenInfo(this.networkId),n={type:E.IDecodedTxActionType.UNKNOWN},o=ce.decodeObj(te.from(e,"base64")),i=ce.encodeAddress(o.snd);if(o.type===ce.TransactionType.pay){var a,u=(null==(a=o.amt)?void 0:a.toString())||"0",d=ce.encodeAddress(o.rcv);n={type:E.IDecodedTxActionType.NATIVE_TRANSFER,nativeTransfer:{tokenInfo:r,from:i,to:d,amount:new(v())(u).shiftedBy(-r.decimals).toFixed(),amountValue:u.toString(),extraInfo:null}}}if(o.type===ce.TransactionType.axfer){var s,l,f=ce.encodeAddress(o.arcv),p=yield this.engine.ensureTokenInDB(this.networkId,o.xaid.toString()),y=new(v())(null!=(s=null==(l=o.aamt)?void 0:l.toString())?s:0).toFixed();if("undefined"!==typeof p)if(i===f&&"0"===y)n={type:E.IDecodedTxActionType.TOKEN_ACTIVATE,tokenActivate:{tokenAddress:p.tokenIdOnNetwork,logoURI:"",decimals:p.decimals,name:p.name,symbol:p.symbol,extraInfo:null,networkId:this.networkId}};else{var h=o.asnd&&ce.encodeAddress(o.asnd);if(o.aclose){var g=yield this.getBalances([{address:t.address,tokenAddress:p.tokenIdOnNetwork}]),m=(0,c.default)(g,1)[0];y=new(v())(null!=m?m:0).toFixed()}n={type:E.IDecodedTxActionType.TOKEN_TRANSFER,tokenTransfer:{tokenInfo:p,from:null!=h?h:i,to:f,amount:new(v())(y).shiftedBy(-p.decimals).toFixed(),amountValue:y,extraInfo:null}}}}return{action:n,nativeTx:o}}));return function(t){return e.apply(this,arguments)}}(),n.decodeTx=function(){var e=(0,s.default)((function*(e,t){for(var r=yield this.getDbAccount(),n=yield this.engine.getNativeTokenInfo(this.networkId),o=[],a=[],c="",d="",s=u()(e)?e:[e],l=new(v())(0),f=0,p=s.length;f<p;f+=1){var y,h=yield this.decodeAlgoTx(s[f]),g=h.action,m=h.nativeTx;o.push(g),l=l.plus(null!=(y=m.fee)?y:0),c=m.snd?ce.encodeAddress(m.snd):"",m.grp&&(d=te.from(m.grp).toString("base64")),m.note&&a.push(m.note.toString())}return{txid:"",owner:r.address,signer:c,nonce:0,actions:o,status:E.IDecodedTxStatus.Pending,networkId:this.networkId,accountId:this.accountId,totalFeeInNative:l.shiftedBy(-n.decimals).toFixed(),extraInfo:{note:i()(a.join(" ")),groupId:d},encodedTx:e}}));return function(t,r){return e.apply(this,arguments)}}(),n.decodedTxToLegacy=function(e){return Promise.resolve({})},n.buildEncodedTxFromTransfer=function(){var e=(0,s.default)((function*(e){return G(yield this.buildAlgoTxFromTransferInfo(e))}));return function(t){return e.apply(this,arguments)}}(),n.buildEncodedTxFromBatchTransfer=function(){var e=(0,s.default)((function*(e){var t=this,r=e.transferInfos,n=yield Promise.all(r.map((function(e){return t.buildAlgoTxFromTransferInfo(e)})));return ce.assignGroupID(n).map((function(e){return G(e)}))}));return function(t){return e.apply(this,arguments)}}(),n.buildEncodedTxFromApprove=function(e){throw new A.NotImplemented},n.updateEncodedTxTokenApprove=function(e,t){throw new A.NotImplemented},n.getFrozenBalance=function(){var e=(0,s.default)((function*(){var e=yield this.getClient(),t=(yield this.engine.getNativeTokenInfo(this.networkId)).decimals,r=(yield this.getDbAccount()).address;try{var n=(yield e.accountInformation(r).do())["min-balance"],o=void 0===n?0:n;return{main:new(v())(null!=o?o:0).shiftedBy(-t).toNumber()}}catch(i){return 0}}));return function(){return e.apply(this,arguments)}}(),n.updateEncodedTx=function(){var e=(0,s.default)((function*(e,t,r){if(u()(e))return Promise.resolve(e);var n=ce.decodeObj(te.from(e,"base64"));if(r.type===E.IEncodedTxUpdateType.transfer&&n.type===ce.TransactionType.pay){var o=(yield this.engine.getNativeTokenInfo(this.networkId)).decimals,i=t.amount;return G(ce.Transaction.from_obj_for_encoding(ne(ne({},n),{},{amt:BigInt(new(v())(i).shiftedBy(o).toFixed())})))}return Promise.resolve(e)}));return function(t,r,n){return e.apply(this,arguments)}}(),n.buildUnsignedTxFromEncodedTx=function(e){return Promise.resolve({inputs:[],outputs:[],payload:{encodedTx:e},encodedTx:e})},n.fetchFeeInfo=function(){var e=(0,s.default)((function*(e){var t=yield this.getNetwork(),r=new(v())(0),n=u()(e)?e:[e];for(var o of n){var i=ce.decodeObj(te.from(o,"base64")).fee,a=void 0===i?0:i;r=r.plus(a)}return{nativeSymbol:t.symbol,nativeDecimals:t.decimals,feeSymbol:t.feeSymbol,feeDecimals:t.feeDecimals,limit:"0",prices:["0"],defaultPresetIndex:"0",tx:null,baseFeeValue:r.shiftedBy(-t.feeDecimals).toFixed()}}));return function(t){return e.apply(this,arguments)}}(),n.broadcastTransaction=function(){var e=(0,s.default)((function*(e){T.default.engine.info("broadcastTransaction START:",{rawTx:e.rawTx});var t=yield this.getClient();try{var r=(yield t.sendRawTransaction(te.from(e.rawTx,"base64")).do()).txId;return T.default.engine.info("broadcastTransaction END:",{txid:r,rawTx:e.rawTx}),ne(ne({},e),{},{txid:r})}catch(s){var n=s.message;if(ue.test(n)){var o=n.match(ue)[1],i=yield this.engine.ensureTokenInDB(this.networkId,o.toString());return Promise.reject(new A.RecipientHasNotActived((null==i?void 0:i.name)||o))}if(ae.test(n)){var a=yield this.engine.getNativeTokenInfo(this.networkId),u=a.name,c=a.decimals,d=n.match(ae)[1];return Promise.reject(new A.MimimumBalanceRequired(u,new(v())(d).shiftedBy(-c).toFixed()))}return Promise.reject(s)}}));return function(t){return e.apply(this,arguments)}}(),n.getExportedCredential=function(){var e=(0,s.default)((function*(e){var t=yield this.getDbAccount();if(t.id.startsWith("hd-")||t.id.startsWith("imported")){var r=this.keyring,n=Object.values(yield r.getPrivateKeys(e)),o=(0,c.default)(n,1)[0];return ce.mnemonicFromSeed((0,g.decrypt)(e,o))}throw new A.OneKeyInternalError("Only credential of HD or imported accounts can be exported")}));return function(t){return e.apply(this,arguments)}}(),n.fetchOnChainHistory=function(){var e=(0,s.default)((function*(e){var t=this,r=e.localHistory,n=void 0===r?[]:r;if(e.tokenIdOnNetwork)return Promise.resolve([]);var o=(yield this.getDbAccount()).address,i=yield this.engine.getNativeTokenInfo(this.networkId),a=yield this.getIndexer(),u=(yield a.lookupAccountTransactions(o).limit(50).do()).transactions.map(function(){var e=(0,s.default)((function*(e){var r=n.find((function(t){return t.decodedTx.txid===e.id}));if(r&&r.decodedTx.isFinal)return Promise.resolve(null);try{var a,u={txid:e.id,owner:o,signer:e.sender,nonce:0,actions:[{type:E.IDecodedTxActionType.UNKNOWN}],status:E.IDecodedTxStatus.Confirmed,networkId:t.networkId,accountId:t.accountId,extraInfo:null==r?void 0:r.decodedTx.extraInfo,totalFeeInNative:new(v())(e.fee).shiftedBy(-i.decimals).toFixed(),updatedAt:1e3*e["round-time"],createdAt:null!=(a=null==r?void 0:r.decodedTx.createdAt)?a:1e3*e["round-time"],isFinal:!0};if(e["tx-type"]===ce.TransactionType.pay&&"undefined"!==typeof e["payment-transaction"]){var c=e["payment-transaction"],d=c.receiver,s=c.amount,l=E.IDecodedTxDirection.IN;e.sender===o&&(l=d===o?E.IDecodedTxDirection.SELF:E.IDecodedTxDirection.OUT),u.actions[0]={type:E.IDecodedTxActionType.NATIVE_TRANSFER,direction:l,nativeTransfer:{tokenInfo:i,from:e.sender,to:d,amount:new(v())(s).shiftedBy(-i.decimals).toFixed(),amountValue:s.toString(),extraInfo:null}}}else if(e["tx-type"]===ce.TransactionType.axfer&&"undefined"!==typeof e["asset-transfer-transaction"]){var f=e["asset-transfer-transaction"],p=f.receiver,y=f.amount,h=(f["close-to"],f["close-amount"]),g=f["asset-id"],m=yield t.engine.ensureTokenInDB(t.networkId,g.toString());if("undefined"===typeof m)throw new A.OneKeyInternalError("Failed to get token info.");if(e.sender===o&&p===o&&0===y)u.actions[0]={type:E.IDecodedTxActionType.TOKEN_ACTIVATE,tokenActivate:{tokenAddress:m.tokenIdOnNetwork,logoURI:"",decimals:m.decimals,name:m.name,symbol:m.symbol,networkId:t.networkId,extraInfo:null}};else{var w=E.IDecodedTxDirection.IN;e.sender===o&&(w=p===o?E.IDecodedTxDirection.SELF:E.IDecodedTxDirection.OUT),u.actions[0]={type:E.IDecodedTxActionType.TOKEN_TRANSFER,direction:w,tokenTransfer:{tokenInfo:m,from:e.sender,to:p,amount:new(v())(h>0?h:y).shiftedBy(-m.decimals).toFixed(),amountValue:y.toString(),extraInfo:null}}}}return yield t.buildHistoryTx({decodedTx:u,historyTxToMerge:r})}catch(I){T.default.common.error(I)}}));return function(t){return e.apply(this,arguments)}}());return(yield Promise.all(u)).filter(Boolean)}));return function(t){return e.apply(this,arguments)}}(),n.getPrivateKeyByCredential=function(){var e=(0,s.default)((function*(e){return Promise.resolve(te.from(ce.seedFromMnemonic(e)))}));return function(t){return e.apply(this,arguments)}}(),n.validateImportedCredential=function(e){if(this.settings.importedAccountEnabled)try{if(ce.seedFromMnemonic(e))return Promise.resolve(!0)}catch(t){}return Promise.resolve(!1)},(0,l.default)(r)}(O.VaultBase)},565147:(e,t,r)=>{r.r(t),r.d(t,{KeyringBase:()=>d,KeyringBaseMock:()=>s});var n=r(634795),o=r(887371),i=r(545754),a=r(411987),u=r(695058);function c(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,u.default)(e);if(t){var o=(0,u.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,a.default)(this,r)}}var d=function(e){(0,i.default)(r,e);var t=c(r);function r(e){var r;return(r=t.call(this,e.options)).vault=e,r}return r.prototype.addressFromBase=function(){var e=(0,n.default)((function*(e){return this.vault.addressFromBase(e)}));return function(t){return e.apply(this,arguments)}}(),(0,o.default)(r)}(r(114540).VaultContext),s=function(e){(0,i.default)(r,e);var t=c(r);function r(){return t.apply(this,arguments)}return(0,o.default)(r)}(d)},82406:(e,t,r)=>{r.r(t),r.d(t,{KeyringHardwareBase:()=>l});var n=r(634795),o=r(887371),i=r(545754),a=r(411987),u=r(695058),c=r(799075),d=r(814817);function s(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,u.default)(e);if(t){var o=(0,u.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,a.default)(this,r)}}var l=function(e){(0,i.default)(a,e);var t=s(a);function a(){return t.apply(this,arguments)}var u=a.prototype;return u.getHardwareInfo=function(){var e=(0,n.default)((function*(){var e,t,r,n=yield this.engine.getHWDeviceByWalletId(this.vault.walletId);return{connectId:null!=(e=null==n?void 0:n.mac)?e:"",deviceId:null!=(t=null==n?void 0:n.deviceId)?t:"",deviceType:null!=(r=null==n?void 0:n.deviceType)?r:""}}));return function(){return e.apply(this,arguments)}}(),u.getWalletPassphraseState=function(){var e=(0,n.default)((function*(){var e=yield this.engine.getWallet(this.vault.walletId);return{passphraseState:null==e?void 0:e.passphraseState,useEmptyPassphrase:!(0,d.isPassphraseWallet)(e)}}));return function(){return e.apply(this,arguments)}}(),u.getHardwareSDKInstance=function(){var e=(0,n.default)((function*(){var e,t,n,o,i;return null!=(i=yield null==(e=r.g)||null==(t=e.$backgroundApiProxy)||null==(n=t.backgroundApi)||null==(o=n.serviceHardware)||null==o.getSDKInstance?void 0:o.getSDKInstance())?i:c.HardwareSDK}));return function(){return e.apply(this,arguments)}}(),u.prepareAccountByAddressIndex=function(e){throw new Error("Method not implemented.")},(0,o.default)(a)}(r(565147).KeyringBase)},810887:(e,t,r)=>{r.r(t),r.d(t,{KeyringHdBase:()=>y});var n=r(256666),o=r(634795),i=r(887371),a=r(545754),u=r(411987),c=r(695058),d=r(605851),s=r(940915);function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function f(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function p(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,c.default)(e);if(t){var o=(0,c.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,u.default)(this,r)}}var y=function(e){(0,a.default)(r,e);var t=p(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.getPrivateKeys=function(){var e=(0,o.default)((function*(e,t){var r=(yield this.getDbAccount()).path.split("/"),n=t||[r.pop()],o=r.join("/"),i=(yield this.engine.dbApi.getCredential(this.walletId,e)).seed;if("undefined"===typeof i)throw new s.OneKeyInternalError("Unable to get credential.");var a=(yield this.engine.providerManager.getChainInfoByNetworkId(this.networkId)).curve;return(0,d.batchGetPrivateKeys)(a,i,e,o,n).reduce((function(e,t){var r;return f(f({},e),{},((r={})[t.path]=t.extendedKey.key,r))}),{})}));return function(t,r){return e.apply(this,arguments)}}(),n.getAddress=function(){throw new Error("Method not implemented.")},n.batchGetAddress=function(){throw new Error("Method not implemented.")},n.prepareAccountByAddressIndex=function(e){throw new Error("Method not implemented.")},(0,i.default)(r)}(r(280306).KeyringSoftwareBase)},255942:(e,t,r)=>{r.r(t),r.d(t,{KeyringImportedBase:()=>s});var n=r(634795),o=r(887371),i=r(545754),a=r(411987),u=r(695058),c=r(940915);function d(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,u.default)(e);if(t){var o=(0,u.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,a.default)(this,r)}}var s=function(e){(0,i.default)(r,e);var t=d(r);function r(){return t.apply(this,arguments)}var a=r.prototype;return a.getPrivateKeys=function(){var e=(0,n.default)((function*(e,t){if("undefined"!==typeof t)throw new c.NotImplemented("Getting private keys from extended private key");var r=(yield this.engine.dbApi.getCredential(this.accountId,e)).privateKey;if("undefined"===typeof r)throw new c.OneKeyInternalError("Unable to get credential.");return{"":r}}));return function(t,r){return e.apply(this,arguments)}}(),a.getAddress=function(){throw new Error("Method not implemented.")},a.batchGetAddress=function(){throw new Error("Method not implemented.")},a.prepareAccountByAddressIndex=function(){throw new Error("Method not implemented.")},(0,o.default)(r)}(r(280306).KeyringSoftwareBase)},280306:(e,t,r)=>{r.r(t),r.d(t,{KeyringSoftwareBase:()=>h});var n=r(196234),o=r(256666),i=r(634795),a=r(887371),u=r(545754),c=r(411987),d=r(695058),s=r(292147),l=r(940915);function f(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?f(Object(r),!0).forEach((function(t){(0,o.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):f(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function y(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,d.default)(e);if(t){var o=(0,d.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,c.default)(this,r)}}var h=function(e){(0,u.default)(r,e);var t=y(r);function r(){return t.apply(this,arguments)}var o=r.prototype;return o.signTransaction=function(){var e=(0,i.default)((function*(e,t){var r=t.password;if("undefined"===typeof r)throw new l.OneKeyInternalError("Software signing requires a password.");var n=yield this.getSigners(r,e.inputs.map((function(e){return e.address})));return s.default.engine.info("signTransaction",this.networkId,e),p(p({},yield this.engine.providerManager.signTransaction(this.networkId,e,n)),{},{encodedTx:e.encodedTx})}));return function(t,r){return e.apply(this,arguments)}}(),o.signMessage=function(){var e=(0,i.default)((function*(e,t){var r=this,o=t.password;if("undefined"===typeof o)throw new l.OneKeyInternalError("Software signing requires a password.");var i=yield this.getDbAccount(),a=Object.values(yield this.getSigners(o,[i.address])),u=(0,n.default)(a,1)[0];return s.default.engine.info("signMessage",this.networkId,e),Promise.all(e.map((function(e){return r.engine.providerManager.signMessage(r.networkId,e,u)})))}));return function(t,r){return e.apply(this,arguments)}}(),o.getAddress=function(){throw new Error("Method not implemented.")},o.batchGetAddress=function(){throw new Error("Method not implemented.")},o.prepareAccountByAddressIndex=function(e){throw new Error("Method not implemented.")},(0,a.default)(r)}(r(565147).KeyringBase)},701625:(e,t,r)=>{r.r(t),r.d(t,{KeyringWatchingBase:()=>s});var n=r(634795),o=r(887371),i=r(545754),a=r(411987),u=r(695058),c=r(940915);function d(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,u.default)(e);if(t){var o=(0,u.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,a.default)(this,r)}}var s=function(e){(0,i.default)(r,e);var t=d(r);function r(){return t.apply(this,arguments)}var a=r.prototype;return a.signTransaction=function(){var e=(0,n.default)((function*(e,t){throw new c.OneKeyInternalError("signTransaction is not supported for watching accounts")}));return function(t,r){return e.apply(this,arguments)}}(),a.signMessage=function(){var e=(0,n.default)((function*(e,t){throw new c.OneKeyInternalError("signMessage is not supported for watching accounts")}));return function(t,r){return e.apply(this,arguments)}}(),a.getAddress=function(){throw new Error("Method not implemented.")},a.batchGetAddress=function(){throw new Error("Method not implemented.")},a.prepareAccountByAddressIndex=function(){throw new Error("Method not implemented.")},(0,o.default)(r)}(r(565147).KeyringBase)},153546:(e,t,r)=>{r.r(t),r.d(t,{convertDeviceError:()=>u});var n=r(703599),o=r(302478),i=r(292147);r(213208);function a(e,t){return"string"!==typeof t?null:e===n.HardwareErrorCode.DeviceInitializeFailed&&t.includes("ECONNABORTED")?new o.ConnectTimeoutError({message:t}):t.includes("Bridge network error")?new o.BridgeNetworkError({message:t}):null}function u(e){var t,r=e||{},u=r.code,c=r.error,d=r.message,s=null!=(t=null!=c?c:d)?t:"Unknown error";if(a(u,s))return a(u,s);switch(i.default.hardwareSDK.info("Device Utils Convert Device Error:",u,s),u){case n.HardwareErrorCode.UnknownError:return new o.UnknownHardwareError(e);case n.HardwareErrorCode.DeviceFwException:return new o.FirmwareVersionTooLow(e);case n.HardwareErrorCode.DeviceUnexpectedMode:return"string"===typeof s&&-1!==s.indexOf("ui-device_bootloader_mode")?new o.NotInBootLoaderMode(e):new o.UnknownHardwareError(e);case n.HardwareErrorCode.DeviceCheckDeviceIdError:return new o.DeviceNotSame(e);case n.HardwareErrorCode.DeviceNotFound:return new o.DeviceNotFind(e);case n.HardwareErrorCode.DeviceUnexpectedBootloaderMode:return new o.NotInBootLoaderMode(e);case n.HardwareErrorCode.DeviceInterruptedFromOutside:case n.HardwareErrorCode.DeviceInterruptedFromUser:return new o.UserCancelFromOutside(e);case n.HardwareErrorCode.DeviceNotSupportPassphrase:return new o.NotSupportPassphraseError(e);case n.HardwareErrorCode.IFrameLoadFail:return new o.InitIframeLoadFail(e);case n.HardwareErrorCode.IframeTimeout:return new o.InitIframeTimeout(e);case n.HardwareErrorCode.FirmwareUpdateDownloadFailed:return new o.FirmwareDownloadFailed(e);case n.HardwareErrorCode.FirmwareUpdateManuallyEnterBoot:return new o.FirmwareUpdateManuallyEnterBoot(e);case n.HardwareErrorCode.FirmwareUpdateAutoEnterBootFailure:return new o.FirmwareUpdateAutoEnterBootFailure(e);case n.HardwareErrorCode.FirmwareUpdateLimitOneDevice:return new o.FirmwareUpdateLimitOneDevice(e);case n.HardwareErrorCode.CallMethodNeedUpgradeFirmware:return new o.FirmwareVersionTooLow(e);case n.HardwareErrorCode.NewFirmwareUnRelease:return new o.NewFirmwareUnRelease(e);case n.HardwareErrorCode.NewFirmwareForceUpdate:return new o.NewFirmwareForceUpdate(e);case n.HardwareErrorCode.NetworkError:return new o.NetworkError(e);case n.HardwareErrorCode.BlePermissionError:return new o.NeedBluetoothTurnedOn(e);case n.HardwareErrorCode.BleLocationError:return new o.NeedBluetoothPermissions({message:s});case n.HardwareErrorCode.BleLocationServicesDisabled:return new o.BleLocationServiceError({message:s});case n.HardwareErrorCode.BleDeviceNotBonded:return new o.DeviceNotBonded(e);case n.HardwareErrorCode.BleDeviceBondError:return new o.DeviceBondError(e);case n.HardwareErrorCode.BleWriteCharacteristicError:return new o.BleWriteCharacteristicError(e);case n.HardwareErrorCode.BleScanError:return new o.BleScanError({message:s});case n.HardwareErrorCode.BleAlreadyConnected:return new o.BleAlreadyConnectedError(e);case n.HardwareErrorCode.RuntimeError:return-1!==s.indexOf("EIP712 blind sign is disabled")?new o.OpenBlindSign(e):-1!==s.indexOf("Unknown message")||-1!==s.indexOf("Failure_UnexpectedMessage")?new o.UnknownMethod(e):new o.UnknownHardwareError(e);case n.HardwareErrorCode.PinInvalid:return new o.InvalidPIN(e);case n.HardwareErrorCode.DeviceCheckPassphraseStateError:return new o.InvalidPassphrase(e);case n.HardwareErrorCode.DeviceOpenedPassphrase:return new o.DeviceOpenedPassphrase(e);case n.HardwareErrorCode.DeviceNotOpenedPassphrase:return new o.DeviceNotOpenedPassphrase(e);case n.HardwareErrorCode.PinCancelled:case n.HardwareErrorCode.ActionCancelled:return new o.UserCancel(e);case n.HardwareErrorCode.BridgeNotInstalled:case o.CustomOneKeyHardwareError.NeedOneKeyBridge:return new o.NeedOneKeyBridge(e);case n.HardwareErrorCode.BridgeNetworkError:return new o.BridgeNetworkError(e);case n.HardwareErrorCode.BridgeTimeoutError:return new o.BridgeTimeoutError(e);case n.HardwareErrorCode.PollingTimeout:return new o.ConnectTimeoutError(e);case n.HardwareErrorCode.PollingStop:return new o.ConnectPollingStopError(e);case n.HardwareErrorCode.BlindSignDisabled:return new o.OpenBlindSign(e);case n.HardwareErrorCode.FileAlreadyExists:return new o.FileAlreadyExistError(e);case n.HardwareErrorCode.CheckDownloadFileError:return new o.IncompleteFileError(e);case n.HardwareErrorCode.NotInSigningMode:return new o.NotInSigningModeError(e);case n.HardwareErrorCode.DataOverload:return new o.DeviceDataOverload(e);default:return new o.UnknownHardwareError(e)}}}}]);