"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[26289],{526289:(e,t,n)=>{n.r(t),n.d(t,{default:()=>W});var o=n(539144),r=n(53594),a=n(481047),l=n(877531),i=n(669083),s=n(634795),u=n(196234),d=n(921311),c=n(202784),f=n(783112),m=n(945821),h=n(859071),g=n(826771),p=n(958698),y=n(648431),v=n(280553),b=n(552322);const I=function(){var e,t,n,r,a=(0,f.default)(),I=(0,o.default)(),w=(0,h.useActiveWalletAccount)(),_=w.accountId,x=w.networkId,j=(0,p.default)().sourceInfo,k=null==j?void 0:j.data.params,M=(0,g.default)({id:null!=(e=null==j?void 0:j.id)?e:"",closeWindowAfterResolved:!0}),A=(0,d.default)({defaultValues:{amount:`${null!=(t=k.amount)?t:""}`,description:null!=(n=k.defaultMemo)?n:""}}),C=A.handleSubmit,P=(0,h.useNativeToken)(x),R=(0,c.useState)(!1),W=(0,u.default)(R,2),N=W[0],S=W[1],V=(0,c.useRef)(),D=(0,c.useCallback)(function(){var e=(0,s.default)((function*(e){if(!N&&x&&_){S(!0);var t=e.amount||"0";try{var n=yield m.default.serviceLightningNetwork.createInvoice({networkId:x,accountId:_,amount:t,description:e.description});i.default.show({title:"Invoice created"}),yield M.resolve({close:V.current,result:{paymentRequest:n.payment_request,paymentHash:n.payment_hash}})}catch(l){var o=l.key,r=l.info;return o&&"onekey_error"!==o?(i.default.show({title:a.formatMessage({id:o},null!=r?r:{})},{type:"error"}),!1):(i.default.show({title:(null==l?void 0:l.message)||l},{type:"error"}),M.reject(),!1)}finally{S(!1)}}}));return function(t){return e.apply(this,arguments)}}(),[N,x,a,_,M]),T=C(D);return(0,b.jsx)(l.default,{header:a.formatMessage({id:"title__create_invoice"}),headerDescription:(0,b.jsx)(v.LNModalDescription,{networkId:x}),primaryActionTranslationId:"action__create",primaryActionProps:{isDisabled:N,isLoading:N},onPrimaryActionPress:function(e){var t=e.close;V.current=t,T()},secondaryActionTranslationId:"action__cancel",onModalClose:M.reject,onSecondaryActionPress:function(e){var t=e.close;M.reject(),t()},height:"auto",scrollViewProps:{contentContainerStyle:{flex:1,paddingVertical:I?16:24},children:(0,b.jsx)(y.default,{isWebln:!0,accountId:_,networkId:null!=x?x:"",useFormReturn:A,amount:Number(k.amount),minimumAmount:Number(k.minimumAmount),maximumAmount:Number(k.maximumAmount),origin:null!=(r=null==j?void 0:j.origin)?r:"",memo:k.defaultMemo,nativeToken:P,amountReadOnly:Number(k.amount)>0})}})};var w=n(18861),_=n(866904),x=n(566147),j=n(46486),k=n(261961),M=n(517972);const A=function(e){var t,n=e.networkId,o=e.useFormReturn,r=e.origin,a=e.message,l=e.signature,i=(0,f.default)(),s=o.control,u=(0,M.useInteractWithInfo)({sourceInfo:{id:"mockId",hostname:"",scope:"webln",origin:r,data:{method:"signMessage"}}});return(0,b.jsxs)(x.default,{children:[(0,b.jsx)(x.default.Item,{label:i.formatMessage({id:"form__request_from"}),name:"requestFrom",control:s,formControlProps:{width:"full"},children:(0,b.jsx)(k.TxInteractInfo,{origin:null!=(t=null==u?void 0:u.url)?t:"",name:null==u?void 0:u.name,icon:null==u?void 0:u.icons[0],networkId:n,mb:0})}),(0,b.jsx)(x.default.Item,{label:i.formatMessage({id:"form__message_uppercase"}),control:s,name:"message",formControlProps:{width:"full"},defaultValue:"",children:(0,b.jsx)(w.default,{display:"flex",flexDirection:"row",justifyContent:"flex-start",alignItems:"center",borderWidth:j.default.hairlineWidth,borderColor:"border-default",borderRadius:"xl",py:2,px:3,bgColor:"action-secondary-default",children:(0,b.jsx)(_.default,{typography:"Body2Mono",color:"text-subdued",lineHeight:"1.5em",children:a})})}),l&&l.length>0?(0,b.jsx)(x.default.Item,{label:"Signature",control:s,name:"message",formControlProps:{width:"full"},defaultValue:"",children:(0,b.jsx)(w.default,{display:"flex",flexDirection:"row",justifyContent:"flex-start",alignItems:"center",borderWidth:j.default.hairlineWidth,borderColor:"border-default",borderRadius:"xl",py:2,px:3,bgColor:"action-secondary-default",children:(0,b.jsx)(_.default,{typography:"Body2Mono",color:"text-subdued",lineHeight:"1.5em",numberOfLines:10,children:l})})}):null]})};const C=function(){var e,t,n=(0,f.default)(),r=(0,o.default)(),a=(0,p.default)(),h=a.sourceInfo,y=a.networkId,I=a.accountId,w=null==h?void 0:h.data.params,_=w.message,x=w.signature,j=(0,g.default)({id:null!=(e=null==h?void 0:h.id)?e:"",closeWindowAfterResolved:!0}),k=(0,d.default)(),M=(0,c.useState)(!1),C=(0,u.default)(M,2),P=C[0],R=C[1],W=(0,c.useCallback)(function(){var e=(0,s.default)((function*(e){var t=e.close;if(!P){R(!0);try{var o=yield m.default.serviceLightningNetwork.weblnVerifyMessage({accountId:null!=I?I:"",networkId:null!=y?y:"",message:_,signature:x});i.default.show({title:n.formatMessage({id:o?"msg__message_verification_successful":"msg__verification_error_invalid_signature"})}),setTimeout((function(){if(!o)return j.reject(),void(null==t||t());j.resolve({close:t,result:o})}),300)}catch(l){var r=l.key,a=l.info;return r&&"onekey_error"!==r?(i.default.show({title:n.formatMessage({id:r},null!=a?a:{})},{type:"error"}),j.reject(),!1):(i.default.show({title:(null==l?void 0:l.message)||l},{type:"error"}),!1)}finally{R(!1)}}}));return function(t){return e.apply(this,arguments)}}(),[n,P,I,y,j,_,x]);return(0,b.jsx)(l.default,{header:n.formatMessage({id:"title__verify_message"}),headerDescription:(0,b.jsx)(v.LNModalDescription,{networkId:y}),primaryActionTranslationId:"action__verify__webln",primaryActionProps:{isDisabled:P,isLoading:P},onPrimaryActionPress:function(e){var t=e.close;W({close:t})},secondaryActionTranslationId:"action__cancel",onModalClose:j.reject,onSecondaryActionPress:function(e){var t=e.close;j.reject(),t()},height:"auto",scrollViewProps:{contentContainerStyle:{flex:1,paddingVertical:r?16:24},children:(0,b.jsx)(A,{accountId:null!=I?I:"",networkId:null!=y?y:"",useFormReturn:k,origin:null!=(t=null==h?void 0:h.origin)?t:"",message:_,signature:x})}})};var P=(0,n(324665).default)(),R=[{name:a.WeblnModalRoutes.MakeInvoice,component:I},{name:a.WeblnModalRoutes.VerifyMessage,component:C},{name:a.WeblnModalRoutes.WeblnAuthentication,component:r.default}];const W=function(){var e=(0,o.default)();return(0,b.jsx)(P.Navigator,{screenOptions:{headerShown:!1,animationEnabled:!!e},children:R.map((function(e){return(0,b.jsx)(P.Screen,{name:e.name,component:e.component},e.name)}))})}}}]);