"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[11702],{786141:(e,t,n)=>{n.r(t),n.d(t,{VaultBase:()=>N,VaultBaseChainOnly:()=>P});var r=n(72579),o=n.n(r),i=n(256666),a=n(301842),u=n.n(a),s=n(634795),c=n(887371),d=n(545754),l=n(411987),f=n(695058),p=n(206391),h=n.n(p),y=n(636393),v=n(613549),g=n(292147),m=n(213208),w=n(992431),I=n(940915),T=n(278489),x=n(969618),b=n(398514),O=n(114540),E=n(348834).Buffer;function C(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function k(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?C(Object(n),!0).forEach((function(t){(0,i.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):C(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function A(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,f.default)(e);if(t){var o=(0,f.default)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return(0,l.default)(this,n)}}if(m.default.isExtensionUi)throw new Error("engine/VaultBase is not allowed imported from ui");var P=function(e){(0,d.default)(n,e);var t=A(n);function n(){return t.apply(this,arguments)}var r=n.prototype;return r.initProvider=function(){var e=(0,s.default)((function*(){var e=(yield this.getNetwork()).impl;u()(x.IMPL_MAPPINGS[e])||(this.engineProvider=yield this.engine.providerManager.getProvider(this.networkId))}));return function(){return e.apply(this,arguments)}}(),r.proxyJsonRPCCall=function(){var e=(0,s.default)((function*(e){throw new I.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),r.createClientFromURL=function(e){throw new I.NotImplemented},r.getEthersProvider=function(){var e=(0,s.default)((function*(){throw new I.NotImplemented}));return function(){return e.apply(this,arguments)}}(),r.getClientEndpointStatus=function(){var e=(0,s.default)((function*(e){var t=this.createClientFromURL(e),n=performance.now(),r=(yield t.getInfo()).bestBlockNumber;return{responseTime:Math.floor(performance.now()-n),latestBlock:r}}));return function(t){return e.apply(this,arguments)}}(),r.checkRpcBatchSupport=function(){var e=(0,s.default)((function*(e){throw new I.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),r.getDisplayAddress=function(){var e=(0,s.default)((function*(e){return Promise.resolve(e)}));return function(t){return e.apply(this,arguments)}}(),r.validateAddress=function(){var e=(0,s.default)((function*(e){var t=yield this.engineProvider.verifyAddress(e),n=t.normalizedAddress;if(!t.isValid||!n)throw new I.InvalidAddress;return Promise.resolve(n)}));return function(t){return e.apply(this,arguments)}}(),r.validateImportedCredential=function(e){return Promise.resolve(this.settings.importedAccountEnabled&&/^(0x)?[0-9a-zA-Z]{64}$/.test(e))},r.validateWatchingCredential=function(){var e=(0,s.default)((function*(e){return Promise.resolve(this.settings.watchingAccountEnabled&&(yield this.engineProvider.verifyAddress(e)).isValid)}));return function(t){return e.apply(this,arguments)}}(),r.validateTokenAddress=function(){var e=(0,s.default)((function*(e){var t=yield this.engineProvider.verifyTokenAddress(e),n=t.normalizedAddress;if(!t.isValid||"undefined"===typeof n)throw new I.InvalidTokenAddress;return Promise.resolve(n)}));return function(t){return e.apply(this,arguments)}}(),r.validateCanCreateNextAccount=function(){var e=(0,s.default)((function*(e,t){return Promise.resolve(!0)}));return function(t,n){return e.apply(this,arguments)}}(),r.checkAccountExistence=function(){var e=(0,s.default)((function*(e,t){return Promise.resolve(!0)}));return function(t,n){return e.apply(this,arguments)}}(),r.getBalances=function(){var e=(0,s.default)((function*(e,t,n){return(yield this.engine.providerManager.getClient(this.networkId)).getBalances(e.map((function(e){var t=e.address,n=e.tokenAddress;return{address:t,coin:k({},"string"===typeof n?{tokenAddress:n}:{})}})))}));return function(t,n,r){return e.apply(this,arguments)}}(),r.getFrozenBalance=function(){var e=(0,s.default)((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.password,e.useRecycleBalance,e.ignoreInscriptions,e.useCustomAddressesBalance;return 0}));return function(){return e.apply(this,arguments)}}(),r.fetchBalanceDetails=function(){var e=(0,s.default)((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.password,e.useRecycleBalance,e.ignoreInscriptions,e.useCustomAddressesBalance;return Promise.resolve(void 0)}));return function(){return e.apply(this,arguments)}}(),r.getTransactionStatuses=function(e){return this.engine.providerManager.getTransactionStatuses(this.networkId,e)},r.getTransactionFeeInNative=function(e){return Promise.resolve("")},r.isContractAddress=function(){var e=(0,s.default)((function*(e){return!1}));return function(t){return e.apply(this,arguments)}}(),r.getAccountNameInfoMap=function(){var e=(0,s.default)((function*(){var e=yield this.getNetwork();return(0,T.getAccountNameInfoByImpl)(e.impl)}));return function(){return e.apply(this,arguments)}}(),r.canAutoCreateNextAccount=function(){var e=(0,s.default)((function*(e){return Promise.resolve(!1)}));return function(t){return e.apply(this,arguments)}}(),r.filterAccounts=function(){var e=(0,s.default)((function*(e){var t=e.accounts;e.networkId;return Promise.resolve(t)}));return function(t){return e.apply(this,arguments)}}(),r.shouldChangeAccountWhenNetworkChanged=function(){var e=(0,s.default)((function*(e){e.previousNetwork,e.newNetwork,e.activeAccountId;return Promise.resolve({shouldReloadAccountList:!1,shouldChangeActiveAccount:!1})}));return function(t){return e.apply(this,arguments)}}(),r.getAccountNameInfosByImportedOrWatchingCredential=function(){var e=(0,s.default)((function*(e){return Promise.resolve([])}));return function(t){return e.apply(this,arguments)}}(),r.checkIsUnlimitedAllowance=function(){var e=(0,s.default)((function*(e){throw new I.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),r.checkIsApprovedForAll=function(){var e=(0,s.default)((function*(e){throw new I.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),r.checkIsBatchTransfer=function(){var e=(0,s.default)((function*(e){throw new I.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),r.getFeePricePerUnit=function(){var e=(0,s.default)((function*(){throw new I.NotImplemented}));return function(){return e.apply(this,arguments)}}(),r.fetchRpcChainId=function(){var e=(0,s.default)((function*(e){return null}));return function(t){return e.apply(this,arguments)}}(),r.getTxWaitingSeconds=function(){var e=(0,s.default)((function*(){return[]}));return function(){return e.apply(this,arguments)}}(),r.getUserNFTAssets=function(){var e=(0,s.default)((function*(e){e.serviceData;return Promise.resolve(void 0)}));return function(t){return e.apply(this,arguments)}}(),r.getTransactionDetail=function(){var e=(0,s.default)((function*(e){return Promise.resolve(void 0)}));return function(t){return e.apply(this,arguments)}}(),(0,c.default)(n)}(O.VaultContext),N=function(e){(0,d.default)(n,e);var t=A(n);function n(){for(var e,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).uuid=y.default.v4().toString(),e}var r=n.prototype;return r.init=function(){var e=(0,s.default)((function*(e){yield this.initProvider(),yield this.initKeyring(e)}));return function(t){return e.apply(this,arguments)}}(),r.initKeyring=function(){var e=(0,s.default)((function*(e){this.keyring=yield e.keyringCreator(this)}));return function(t){return e.apply(this,arguments)}}(),r.signTransaction=function(){var e=(0,s.default)((function*(e,t){return this.keyring.signTransaction(e,t)}));return function(t,n){return e.apply(this,arguments)}}(),r.signAndSendTransaction=function(){var e=(0,s.default)((function*(e,t,n){var r=yield this.signTransaction(e,t);return n?k(k({},r),{},{encodedTx:e.encodedTx}):this.broadcastTransaction(k(k({},r),{},{encodedTx:e.encodedTx}))}));return function(t,n,r){return e.apply(this,arguments)}}(),r.broadcastTransaction=function(){var e=(0,s.default)((function*(e,t){g.default.engine.info("broadcastTransaction START:",{rawTx:e.rawTx});var n=yield this.engine.providerManager.broadcastTransaction(this.networkId,e.rawTx,t);return g.default.engine.info("broadcastTransaction END:",{txid:n,rawTx:e.rawTx}),k(k({},e),{},{txid:n,encodedTx:e.encodedTx})}));return function(t,n){return e.apply(this,arguments)}}(),r.buildEncodedTxFromBatchTransfer=function(){var e=(0,s.default)((function*(e){throw new I.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),r.buildEncodedTxsFromSetApproveForAll=function(){var e=(0,s.default)((function*(e,t){throw new I.NotImplemented}));return function(t,n){return e.apply(this,arguments)}}(),r.activateAccount=function(){var e=(0,s.default)((function*(){throw new I.NotImplemented}));return function(){return e.apply(this,arguments)}}(),r.activateToken=function(){var e=(0,s.default)((function*(e,t){throw new I.NotImplemented}));return function(t,n){return e.apply(this,arguments)}}(),r.getTokenAllowance=function(){var e=(0,s.default)((function*(e,t){throw new I.NotImplemented}));return function(t,n){return e.apply(this,arguments)}}(),r.batchTokensAllowance=function(){var e=(0,s.default)((function*(e,t){throw new I.NotImplemented}));return function(t,n){return e.apply(this,arguments)}}(),r.getOutputAccount=function(){var e=(0,s.default)((function*(){var e=yield this.getDbAccount({noCache:!0});return{id:e.id,name:e.name,type:e.type,path:e.path,coinType:e.coinType,tokens:[],address:e.address,template:e.template,pubKey:o()(e,"pub","")}}));return function(){return e.apply(this,arguments)}}(),r.getAccountBalance=function(){var e=(0,s.default)((function*(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,o=(yield this.getDbAccount()).address;return this.getBalances((t?[{address:o}]:[]).concat(e.map((function(e){return{address:o,tokenAddress:e}}))),n,r)}));return function(t){return e.apply(this,arguments)}}(),r.updatePendingTxs=function(){var e=(0,s.default)((function*(e){throw new I.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),r.getAccountNonce=function(){var e=(0,s.default)((function*(){return Promise.resolve(null)}));return function(){return e.apply(this,arguments)}}(),r.fixActionDirection=function(){var e=(0,s.default)((function*(e){var t,n,r,o,i=e.action,a=e.accountAddress;(i.direction=b.IDecodedTxDirection.OTHER,i.type===b.IDecodedTxActionType.NATIVE_TRANSFER)&&(i.direction=yield this.buildTxActionDirection({from:(null==(t=i.nativeTransfer)?void 0:t.from)||"",to:(null==(n=i.nativeTransfer)?void 0:n.to)||"",address:a}));i.type===b.IDecodedTxActionType.TOKEN_TRANSFER&&(i.direction=yield this.buildTxActionDirection({from:(null==(r=i.tokenTransfer)?void 0:r.from)||"",to:(null==(o=i.tokenTransfer)?void 0:o.to)||"",address:a}));return i}));return function(t){return e.apply(this,arguments)}}(),r.fixDecodedTx=function(){var e=(0,s.default)((function*(e){var t,n;e.createdAt=null!=(t=e.createdAt)?t:Date.now();var r=null==(n=e.encodedTx)?void 0:n.nonce;e.nonce=u()(r)?e.nonce:new(h())(r).toNumber();for(var o=e.owner,i=0;i<e.actions.length;i+=1){var a=e.actions[i];yield this.fixActionDirection({action:a,accountAddress:o})}if(e.outputActions)for(var s=0;s<e.outputActions.length;s+=1){var c=e.outputActions[s];yield this.fixActionDirection({action:c,accountAddress:o})}return Promise.resolve(e)}));return function(t){return e.apply(this,arguments)}}(),r.fixHistoryTx=function(){var e=(0,s.default)((function*(e){return e.decodedTx=yield this.fixDecodedTx(e.decodedTx),Promise.resolve(e)}));return function(t){return e.apply(this,arguments)}}(),r.buildHistoryTx=function(){var e=(0,s.default)((function*(e){var t=e.historyTxToMerge,n=(e.encodedTx,e.decodedTx),r=e.signedTx,o=e.isSigner,i=e.isLocalCreated,a=(null==r?void 0:r.txid)||(null==n?void 0:n.txid)||"";if(!a)throw new Error("buildHistoryTx txid not found");var u=yield this.getAccountAddress();n.txid=a||n.txid,n.owner=u,o&&(n.signer=u),null!=r&&r.txKey&&(n.extraInfo?n.extraInfo.txKey=r.txKey:n.extraInfo={txKey:r.txKey});var s=k(k({id:`${this.networkId}_${a}_${this.accountId}`,isLocalCreated:Boolean(i)},t),{},{decodedTx:n});return s=yield this.fixHistoryTx(s),Promise.resolve(s)}));return function(t){return e.apply(this,arguments)}}(),r.checkIsScamHistoryTx=function(){var e=(0,s.default)((function*(e){return!1}));return function(t){return e.apply(this,arguments)}}(),r.fetchOnChainHistory=function(){var e=(0,s.default)((function*(e){throw new I.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),r.fixAddressCase=function(e){return Promise.resolve(e)},r.buildTxActionDirection=function(){var e=(0,s.default)((function*(e){var t=e.from,n=e.to,r=e.address;return t=yield this.fixAddressCase(t||""),n=yield this.fixAddressCase(n),r=yield this.fixAddressCase(r),t===n&&t===r?b.IDecodedTxDirection.SELF:t&&t===r?b.IDecodedTxDirection.OUT:n&&n===r?b.IDecodedTxDirection.IN:b.IDecodedTxDirection.OTHER}));return function(t){return e.apply(this,arguments)}}(),r.getNextNonce=function(){var e=(0,s.default)((function*(e,t){var n,r=null==(n=(yield this.engine.providerManager.getAddresses(e,[t.address]))[0])?void 0:n.nonce;if(u()(r))throw new I.OneKeyError("Get on-chain nonce failed.");yield this.engine.getHistory(e,t.id,void 0,!1);var o=yield w.default.history.getMaxPendingNonce({accountId:this.accountId,networkId:e}),i=yield w.default.history.getPendingNonceList({accountId:this.accountId,networkId:e}),a=Math.max(u()(o)?0:o+1,r);if(Number.isNaN(a)&&(a=r),a>r)for(var s=r;s<a;s+=1)if(!i.includes(s)){a=s;break}if(a<r&&(a=r),a-r>=v.HISTORY_CONSTS.PENDING_QUEUE_MAX_LENGTH)throw new I.PendingQueueTooLong(v.HISTORY_CONSTS.PENDING_QUEUE_MAX_LENGTH);return a}));return function(t,n){return e.apply(this,arguments)}}(),r.validateSendAmount=function(e,t,n){return Promise.resolve(!0)},r.notifyChainChanged=function(e,t){},r.getFetchBalanceAddress=function(e){return Promise.resolve(e.address)},r.getPrivateKeyByCredential=function(e){return Promise.resolve(E.from(e.startsWith("0x")?e.slice(2):e,"hex"))},r.getMinDepositAmount=function(){var e=(0,s.default)((function*(){return"0"}));return function(){return e.apply(this,arguments)}}(),r.specialCheckEncodedTx=function(){var e=(0,s.default)((function*(e){return{success:!0}}));return function(t){return e.apply(this,arguments)}}(),r.getAllUsedAddress=function(){var e=(0,s.default)((function*(){return Promise.resolve([])}));return function(){return e.apply(this,arguments)}}(),(0,c.default)(n)}(P)},911702:(e,t,n)=>{n.r(t),n.d(t,{default:()=>Xe});var r=n(545455),o=n.n(r),i=n(301842),a=n.n(i),u=n(72579),s=n.n(u),c=n(256666),d=n(968079),l=n(196234),f=n(634795),p=n(887371),h=n(545754),y=n(411987),v=n(695058),g=n(84658),m=n(206391),w=n.n(m),I=n(717254),T=n(940915),x=n(849877),b=n(901187),O=n(740727),E=n(506885),C=n(398514),k=n(392853),A=n(368652),P=n(786141),N=n(942013),S=n(799075),B=n(292147),D=n(396564),M=n(961500),K=n(703599),R=n(398145),F=n(153546),H=n(613549),_=n(82406),j=n(429666),U=n(153929),W=n(266534),$=function(e,t){var n="secp256k1"===e?function(e){if(33!==e.length)throw new Error(`Invalid Secp256k1 pubkey length (compressed): ${e.length}`);return(0,j.ripemd160)((0,U.sha256)(e))}(t):function(e){if(32!==e.length)throw new Error(`Invalid Ed25519 pubkey length: ${e.length}`);return(0,U.sha256)(e).slice(0,20)}(t);return(0,g.bytesToHex)(n)},L=function(e,t){return W.bech32.encode(e,W.bech32.toWords((0,g.hexToBytes)(t)))},V=function(e,t){try{var n=W.bech32.decode(e),r=n.prefix,o=n.words;return r===t&&20===W.bech32.fromWords(o).length}catch(i){return!1}},q=n(217428),G=n(522204),Y=n(587326),z=n(820478),J=n(348834).Buffer,Q=function(e,t){if(e["@type"]===z.MessageType.SEND){var n=e.amount;return 1===n.length&&n[0].denom===t?C.IDecodedTxActionType.NATIVE_TRANSFER:C.IDecodedTxActionType.TOKEN_TRANSFER}return C.IDecodedTxActionType.UNKNOWN},X=function(e,t){if("unpacked"in e&&(e.typeUrl===z.MessageType.SEND||e.typeUrl===Y.defaultAminoMsgOpts.send.native.type)){var n=e.unpacked.amount;return 1===n.length&&n[0].denom===t?C.IDecodedTxActionType.NATIVE_TRANSFER:C.IDecodedTxActionType.TOKEN_TRANSFER}return C.IDecodedTxActionType.UNKNOWN},Z=function(e){var t=!1,n=e;return"string"===typeof e?(n=J.from(e).toString("base64"),t=!0):n=J.from(e).toString("base64"),[n,t]},ee=function(e,t){return{chain_id:"",account_number:"0",sequence:"0",fee:{gas:"0",amount:[]},msgs:[{type:"sign/MsgSignData",value:{signer:e,data:t}}],memo:""}},te=n(348834).Buffer;function ne(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function re(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ne(Object(n),!0).forEach((function(t){(0,c.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ne(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function oe(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,v.default)(e);if(t){var o=(0,v.default)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return(0,y.default)(this,n)}}var ie=`m/44'/${H.COINTYPE_COSMOS}'`,ae=function(e){(0,h.default)(n,e);var t=oe(n);function n(){return t.apply(this,arguments)}var r=n.prototype;return r.getChainInfo=function(){var e=(0,f.default)((function*(){return this.engine.providerManager.getChainInfoByNetworkId(this.networkId)}));return function(){return e.apply(this,arguments)}}(),r.getPublicKey=function(){var e=(0,f.default)((function*(e,t,n){var r,o,i,a=yield this.getChainInfo(),u=null!=(r=null==a||null==(o=a.implOptions)?void 0:o.curve)?r:"secp256k1",s=yield this.getHardwareSDKInstance(),c=yield this.getWalletPassphraseState();try{i=yield s.cosmosGetPublicKey(e,t,re({bundle:n.map((function(e){return{path:e,curve:u}}))},c))}catch(d){throw B.default.common.error(d),new T.OneKeyHardwareError(d)}if(!i.success)throw B.default.common.error(i.payload),(0,F.convertDeviceError)(i.payload);return i.payload.map((function(e){return e.publicKey})).filter((function(e){return!!e}))}));return function(t,n,r){return e.apply(this,arguments)}}(),r.prepareAccounts=function(){var e=(0,f.default)((function*(e){var t,n,r,o=e.indexes,i=e.names,a=o.map((function(e){return`${ie}/0'/0/${e}`})),u=yield this.getHardwareSDKInstance(),s=yield this.getHardwareInfo(),c=s.connectId,d=s.deviceId,l=yield this.getWalletPassphraseState(),f=yield this.getChainInfo(),p=null!=(t=null==f||null==(n=f.implOptions)?void 0:n.curve)?t:"secp256k1";if("ed25519"===p)throw new K.HardwareError("ed25519 curve is not supported");try{r=yield u.cosmosGetPublicKey(c,d,re({bundle:a.map((function(e){return{path:e,curve:p,showOnOneKey:false}}))},l))}catch(O){throw B.default.common.error(O),new T.OneKeyHardwareError(O)}if(!r.success)throw B.default.common.error(r.payload),(0,F.convertDeviceError)(r.payload);var h=[],y=0;for(var v of r.payload){var m=v.path,w=v.publicKey,I=(0,g.hexToBytes)(w),x=$(p,I),b=(i||[])[y]||`COSMOS #${o[y]+1}`;h.push({id:`${this.walletId}--${m}`,name:b,type:R.AccountType.VARIANT,path:m,coinType:H.COINTYPE_COSMOS,pub:w,address:x,addresses:{}}),y+=1}return h}));return function(t){return e.apply(this,arguments)}}(),r.getAddress=function(){var e=(0,f.default)((function*(e){var t,n,r,o,i=yield this.getHardwareSDKInstance(),a=yield this.getHardwareInfo(),u=a.connectId,s=a.deviceId,c=yield this.getWalletPassphraseState(),d=yield this.getChainInfo(),l=null!=(t=null==d||null==(n=d.implOptions)?void 0:n.curve)?t:"secp256k1",f=null==d||null==(r=d.implOptions)?void 0:r.addressPrefix;if("ed25519"===l)throw new K.HardwareError("ed25519 curve is not supported");var p,h=yield i.cosmosGetAddress(u,s,re({path:e.path,hrp:f,showOnOneKey:e.showOnOneKey},c));if(h.success&&null!=(o=h.payload)&&o.address)return null==(p=h.payload)?void 0:p.address;throw(0,F.convertDeviceError)(h.payload)}));return function(t){return e.apply(this,arguments)}}(),r.batchGetAddress=function(){var e=(0,f.default)((function*(e){var t,n,r,o=yield this.getHardwareSDKInstance(),i=yield this.getHardwareInfo(),a=i.connectId,u=i.deviceId,s=yield this.getWalletPassphraseState(),c=yield this.getChainInfo(),d=null!=(t=null==c||null==(n=c.implOptions)?void 0:n.curve)?t:"secp256k1",l=null==c||null==(r=c.implOptions)?void 0:r.addressPrefix;if("ed25519"===d)throw new K.HardwareError("ed25519 curve is not supported");var f=yield o.cosmosGetAddress(a,u,re(re({},s),{},{bundle:e.map((function(e){var t=e.path,n=e.showOnOneKey;return{path:t,hrp:l,showOnOneKey:!!n}}))}));if(!f.success)throw(0,F.convertDeviceError)(f.payload);return f.payload.map((function(e){var t,n;return{path:null!=(t=e.path)?t:"",address:null!=(n=e.address)?n:""}}))}));return function(t){return e.apply(this,arguments)}}(),r.signTransaction=function(){var e=(0,f.default)((function*(e){var t,n;B.default.common.info("signTransaction",e);var r=yield this.getDbAccount(),o=null==(t=e.inputs)||null==(n=t[0])?void 0:n.publicKey;if(!o)throw new T.OneKeyInternalError("Unable to get sender public key.");var i=e.payload.encodedTx,a=(0,q.generateSignBytes)(i),u=(0,g.bytesToHex)(a),s=yield this.getHardwareInfo(),c=s.connectId,d=s.deviceId,l=yield this.getWalletPassphraseState(),f=yield this.getHardwareSDKInstance(),p=yield f.cosmosSignTransaction(c,d,re({path:r.path,rawTx:u},l));if(p.success){var h=p.payload.signature,y=(0,q.serializeSignedTx)({txWrapper:i,signature:{signatures:[(0,g.hexToBytes)((0,A.stripHexPrefix)(h))]},publicKey:{pubKey:o}});return{txid:"",rawTx:te.from(y).toString("base64")}}throw(0,F.convertDeviceError)(p.payload)}));return function(t){return e.apply(this,arguments)}}(),r.signMessage=function(){var e=(0,f.default)((function*(e){var t=this,n=yield this.getDbAccount();return Promise.all(e.map(function(){var e=(0,f.default)((function*(e){var r=JSON.parse(e.message),o=r.data,i=r.signer,a=Z(o),u=(0,l.default)(a,1)[0],s=ee(i,u),c=G.TransactionWrapper.fromAminoSignDoc(s,void 0);return(yield t.signTransaction({inputs:[{address:n.address,value:new(w())(0),publicKey:n.pub}],outputs:[],payload:{encodedTx:c}})).rawTx}));return function(t){return e.apply(this,arguments)}}()))}));return function(t){return e.apply(this,arguments)}}(),(0,p.default)(n)}(_.KeyringHardwareBase),ue=n(794292),se=n(605851),ce=n(810887),de=n(348834).Buffer;function le(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,v.default)(e);if(t){var o=(0,v.default)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return(0,y.default)(this,n)}}var fe=`m/44'/${H.COINTYPE_COSMOS}'/0'/0`,pe=`m/44'/${H.COINTYPE_COSMOS}'/0'/0'`,he=function(e){(0,h.default)(n,e);var t=le(n);function n(){return t.apply(this,arguments)}var r=n.prototype;return r.getChainInfo=function(){var e=(0,f.default)((function*(){return this.engine.providerManager.getChainInfoByNetworkId(this.networkId)}));return function(){return e.apply(this,arguments)}}(),r.getSigners=function(){var e=(0,f.default)((function*(e,t){var n,r,o,i=yield this.getDbAccount(),a=i.address;if(1!==t.length)throw new T.OneKeyInternalError("Cosmos signers number should be 1.");if(t[0]!==a)throw new T.OneKeyInternalError("Wrong address required for signing.");var u=(yield this.getPrivateKeys(e))[i.path];if("undefined"===typeof u)throw new T.OneKeyInternalError("Unable to get signer.");var s=yield this.getChainInfo();return(o={})[a]=new ue.Signer(u,e,null!=(n=null==s||null==(r=s.implOptions)?void 0:r.curve)?n:"secp256k1"),o}));return function(t,n){return e.apply(this,arguments)}}(),r.prepareAccounts=function(){var e=(0,f.default)((function*(e){var t,n,r=e.password,o=e.indexes,i=e.names,a=(yield this.engine.dbApi.getCredential(this.walletId,r)).seed,u=yield this.getChainInfo(),s=null!=(t=null==u||null==(n=u.implOptions)?void 0:n.curve)?t:"secp256k1",c=(0,se.batchGetPublicKeys)(s,a,r,"secp256k1"===s?fe:pe,"secp256k1"===s?o.map((function(e){return e.toString()})):o.map((function(e){return`${e.toString()}'`})));if(c.length!==o.length)throw new T.OneKeyInternalError("Unable to get publick key.");var d=[],l=0;for(var f of c){var p=f.path,h=f.extendedKey.key,y=$(s,h),v=(i||[])[l]||`COSMOS #${o[l]+1}`;d.push({id:`${this.walletId}--${p}`,name:v,type:R.AccountType.VARIANT,path:p,coinType:H.COINTYPE_COSMOS,pub:h.toString("hex"),address:y,addresses:{}}),l+=1}return d}));return function(t){return e.apply(this,arguments)}}(),r.signTransaction=function(){var e=(0,f.default)((function*(e,t){var n,r;B.default.common.info("signTransaction result",e);var o=yield this.getDbAccount();B.default.common.info("signTransaction dbAccount",o);var i=(yield this.getSigners(t.password||"",[o.address]))[o.address],a=null==(n=e.inputs)||null==(r=n[0])?void 0:r.publicKey;if(!a)throw new T.OneKeyInternalError("Unable to get sender public key.");var u=e.payload.encodedTx,s=(0,q.serializeTxForSignature)(u),c=yield i.sign(de.from((0,U.sha256)(s))),d=(0,l.default)(c,1)[0],f=(0,q.serializeSignedTx)({txWrapper:u,signature:{signatures:[d]},publicKey:{pubKey:a}});return{txid:"",rawTx:de.from(f).toString("base64")}}));return function(t,n){return e.apply(this,arguments)}}(),r.signMessage=function(){var e=(0,f.default)((function*(e,t){var n=this,r=yield this.getDbAccount();return Promise.all(e.map(function(){var e=(0,f.default)((function*(e){var o=JSON.parse(e.message),i=o.data,a=o.signer,u=Z(i),s=(0,l.default)(u,1)[0],c=ee(a,s),d=G.TransactionWrapper.fromAminoSignDoc(c,void 0);return(yield n.signTransaction({inputs:[{address:r.address,value:new(w())(0),publicKey:r.pub}],outputs:[],payload:{encodedTx:d}},t)).rawTx}));return function(t){return e.apply(this,arguments)}}()))}));return function(t,n){return e.apply(this,arguments)}}(),(0,p.default)(n)}(ce.KeyringHdBase),ye=n(478557),ve=n(255942),ge=n(348834).Buffer;function me(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,v.default)(e);if(t){var o=(0,v.default)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return(0,y.default)(this,n)}}var we=function(e){(0,h.default)(n,e);var t=me(n);function n(){return t.apply(this,arguments)}var r=n.prototype;return r.getChainInfo=function(){var e=(0,f.default)((function*(){return this.engine.providerManager.getChainInfoByNetworkId(this.networkId)}));return function(){return e.apply(this,arguments)}}(),r.getSigners=function(){var e=(0,f.default)((function*(e,t){var n,r,o,i=yield this.getDbAccount(),a=i.address;if(1!==t.length)throw new T.OneKeyInternalError("Cosmos signers number should be 1.");if(t[0]!==a)throw new T.OneKeyInternalError("Wrong address required for signing.");var u=(yield this.getPrivateKeys(e))[i.path];if("undefined"===typeof u)throw new T.OneKeyInternalError("Unable to get signer.");var s=yield this.getChainInfo();return(o={})[a]=new ue.Signer(u,e,null!=(n=null==s||null==(r=s.implOptions)?void 0:r.curve)?n:"secp256k1"),o}));return function(t,n){return e.apply(this,arguments)}}(),r.getCurve=function(e){switch(e){case"ed25519":return ye.ed25519;case"secp256k1":return ye.secp256k1;default:throw new T.OneKeyInternalError("Unsupported curve")}},r.prepareAccounts=function(){var e=(0,f.default)((function*(e){var t,n,r=e.privateKey,o=e.name;if(32!==r.length)throw new T.OneKeyInternalError("Invalid private key.");var i=yield this.getChainInfo(),a=null!=(t=null==i||null==(n=i.implOptions)?void 0:n.curve)?t:"secp256k1",u=this.getCurve(a).publicFromPrivate(r),s=u.toString("hex"),c=$(a,u);return Promise.resolve([{id:`imported--${H.COINTYPE_COSMOS}--${s}`,name:o||"",type:R.AccountType.VARIANT,path:"",coinType:H.COINTYPE_COSMOS,pub:s,address:c,addresses:{}}])}));return function(t){return e.apply(this,arguments)}}(),r.signTransaction=function(){var e=(0,f.default)((function*(e,t){var n,r;B.default.common.info("signTransaction result",e);var o=yield this.getDbAccount();B.default.common.info("signTransaction dbAccount",o);var i=(yield this.getSigners(t.password||"",[o.address]))[o.address],a=null==(n=e.inputs)||null==(r=n[0])?void 0:r.publicKey;if(!a)throw new T.OneKeyInternalError("Unable to get sender public key.");var u=e.payload.encodedTx,s=(0,q.generateSignBytes)(u),c=yield i.sign(ge.from((0,U.sha256)(s))),d=(0,l.default)(c,1)[0],f=(0,q.serializeSignedTx)({txWrapper:u,signature:{signatures:[d]},publicKey:{pubKey:a}});return{txid:"",rawTx:ge.from(f).toString("base64")}}));return function(t,n){return e.apply(this,arguments)}}(),(0,p.default)(n)}(ve.KeyringImportedBase);function Ie(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,v.default)(e);if(t){var o=(0,v.default)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return(0,y.default)(this,n)}}var Te=function(e){(0,h.default)(n,e);var t=Ie(n);function n(){return t.apply(this,arguments)}return n.prototype.prepareAccounts=function(){var e=(0,f.default)((function*(e){var t,n=e.name,r=e.target,o=e.accountIdPrefix,i=yield this.vault.validateAddress(r);if("undefined"===typeof i)throw new T.InvalidAddress;return Promise.resolve([{id:`${o}--${H.COINTYPE_COSMOS}--${r}`,name:n||"",type:R.AccountType.VARIANT,path:"",coinType:H.COINTYPE_COSMOS,pub:"",address:"",addresses:(t={},t[this.networkId]=i,t)}])}));return function(t){return e.apply(this,arguments)}}(),(0,p.default)(n)}(n(701625).KeyringWatchingBase),xe=n(789644),be=n.n(xe),Oe=function(){function e(e){this.axios=be().create({baseURL:e.endsWith("/")?e.slice(0,-1):e,timeout:3e4})}var t=e.prototype;return t.fetchNodeInfo=function(){var e=(0,f.default)((function*(){return(yield this.axios.get("/node_info")).data.node_info}));return function(){return e.apply(this,arguments)}}(),t.fetchBlockHeader=function(){var e=(0,f.default)((function*(){return(yield this.axios.get("/blocks/latest")).data.block.header}));return function(){return e.apply(this,arguments)}}(),t.fetchBlockHeaderV1beta1=function(){var e=(0,f.default)((function*(){return(yield this.axios.get("/cosmos/base/tendermint/v1beta1/blocks/latest")).data.block.header}));return function(){return e.apply(this,arguments)}}(),t.getAccountInfo=function(){var e=(0,f.default)((function*(e){var t=yield this.axios.get(`/cosmos/auth/v1beta1/accounts/${e}`);return 404===t.status?null:t.data.account}));return function(t){return e.apply(this,arguments)}}(),t.getAccountBalances=function(){var e=(0,f.default)((function*(e){var t;return null!=(t=(yield this.axios.get(`/cosmos/bank/v1beta1/balances/${e}`)).data.balances)?t:[]}));return function(t){return e.apply(this,arguments)}}(),t.getTransactionInfo=function(){var e=(0,f.default)((function*(e){return this.axios.get(`/cosmos/tx/v1beta1/txs/${e}`).then((function(e){return e.data.tx_response})).catch((function(e){var t;throw new T.OneKeyError(null==(t=e.response)?void 0:t.status.toString())}))}));return function(t){return e.apply(this,arguments)}}(),t.broadcastTransaction=function(){var e=(0,f.default)((function*(e){var t,n,r={mode:"BROADCAST_MODE_SYNC",tx_bytes:e},o=yield this.axios.post("/cosmos/tx/v1beta1/txs",r,{headers:{"Content-Type":"application/json"}}),i=o.data.tx_response.raw_log,a=o.data.tx_response.code;if(null!=a&&0!==a){if(-1!==i.indexOf("account sequence mismatch"))throw new T.OneKeyInternalError(i,"msg__broadcast_tx_sequence_number_error");if(-1!==i.indexOf("insufficient fees"))throw new T.OneKeyInternalError(i,"msg__broadcast_tx_Insufficient_fee");throw new T.OneKeyInternalError(i)}return null!=(t=null==(n=o.data.tx_response)?void 0:n.txhash)?t:null}));return function(t){return e.apply(this,arguments)}}(),t.simulationTransaction=function(){var e=(0,f.default)((function*(e){var t;return null!=(t=(yield this.axios.post("/cosmos/tx/v1beta1/simulate",e,{headers:{"Content-Type":"application/json"}})).data.gas_info)?t:null}));return function(t){return e.apply(this,arguments)}}(),(0,p.default)(e)}(),Ee=function(){function e(){}return e.prototype.makeTxWrapper=function(e,t){return G.TransactionWrapper.fromAminoSignDoc({chain_id:t.chainId,account_number:t.accountNumber,sequence:t.nonce,fee:{amount:[{amount:t.feeAmount,denom:t.mainCoinDenom}],gas:t.gasLimit},msgs:e.aminoMsgs,memo:t.memo},e)},(0,p.default)(e)}(),Ce=n(348834).Buffer,ke=function(){function e(){}var t=e.prototype;return t.queryContract=function(){var e=(0,f.default)((function*(e,t,n){var r=Ce.from(JSON.stringify(n),"utf-8").toString("base64");return e.get(`/cosmwasm/wasm/v1/contract/${t}/smart/${r}`).then((function(e){return e.data.data}))}));return function(t,n,r){return e.apply(this,arguments)}}(),t.queryCw20TokenInfo=function(){var e=(0,f.default)((function*(e,t){var n=this,r=e.axios;if(!r)throw new Error("axios is not defined");return Promise.all(t.map((function(e){return n.queryContract(r,e,{token_info:{}}).then((function(t){return{contractAddress:e,name:t.name,decimals:t.decimals,symbol:t.symbol}}))})))}));return function(t,n){return e.apply(this,arguments)}}(),t.queryCw20TokenBalance=function(){var e=(0,f.default)((function*(e,t,n){var r=this,o=e.axios;if(!o)throw new Error("axios is not defined");return Promise.all(n.map((function(e){return r.queryContract(o,t,{balance:{address:e}}).then((function(e){var t;try{t=new(w())(s()(e,"balance","0"))}catch(n){t=new(w())(0)}return{address:e,balance:t}}))})))}));return function(t,n,r){return e.apply(this,arguments)}}(),(0,p.default)(e)}(),Ae=n(112889),Pe=function(){function e(){this.axios=be().create({baseURL:`${(0,Ae.getFiatEndpoint)()}/cosmos`,timeout:2e4})}var t=e.prototype;return t.fetchCw20TokenInfos=function(){var e=(0,f.default)((function*(e){return Promise.resolve([])}));return function(t){return e.apply(this,arguments)}}(),t.queryCw20TokenInfo=function(){var e=(0,f.default)((function*(e,t){return Promise.resolve([])}));return function(t,n){return e.apply(this,arguments)}}(),t.queryCw20TokenBalance=function(){var e=(0,f.default)((function*(e,t,n){var r=n.reduce((function(e,t){return e.push({address:t,balance:new(w())("0")}),e}),[]);return Promise.resolve(r)}));return function(t,n,r){return e.apply(this,arguments)}}(),t.fetchAssertInfos=function(){var e=(0,f.default)((function*(e){try{var t;return null!=(t=(yield this.axios.get(`/assets/${e}`)).data.data)?t:[]}catch(n){throw new Error("Failed to obtain assets info")}}));return function(t){return e.apply(this,arguments)}}(),t.fetchContractsInfo=function(){var e=(0,f.default)((function*(e,t){return Promise.resolve(void 0)}));return function(t,n){return e.apply(this,arguments)}}(),t.fetchAccountTxs=function(){var e=(0,f.default)((function*(e,t){return Promise.resolve(void 0)}));return function(t,n){return e.apply(this,arguments)}}(),(0,p.default)(e)}(),Ne=function(){function e(){}var t=e.prototype;return t.queryCw20TokenInfo=function(e,t){throw new Error("Not implemented")},t.queryCw20TokenBalance=function(e,t,n){throw new Error("Not implemented")},(0,p.default)(e)}(),Se=new(function(){function e(){this.registryMap=new Map}var t=e.prototype;return t.get=function(e){return this.registryMap.get(e)},t.register=function(e,t){this.registryMap.set(e,t)},(0,p.default)(e)}()),Be=new ke;Se.register(N.OnekeyNetwork.juno,Be),Se.register(N.OnekeyNetwork.osmosis,Be),Se.register(N.OnekeyNetwork.secretnetwork,new Ne);var De=new Pe;Se.register(N.OnekeyNetwork.cosmoshub,De),Se.register(N.OnekeyNetwork.akash,De),Se.register(N.OnekeyNetwork.fetch,De);var Me=n(316635),Ke=(n(63184),n(348076));n(348834).Buffer;var Re=function(){function e(){}var t=e.prototype;return t.makeExecuteContractMsg=function(e,t,n,r){return{type:Y.defaultAminoMsgOpts.executeWasm.type,value:{sender:e,contract:t,msg:n,funds:r}}},t.makeSendNativeMsg=function(e,t,n,r){return{type:Y.defaultAminoMsgOpts.send.native.type,value:{from_address:e,to_address:t,amount:[{amount:n,denom:r}]}}},t.makeSendCwTokenMsg=function(e,t,n,r){return this.makeExecuteContractMsg(e,t,{transfer:{recipient:n,amount:r}},[])},(0,p.default)(e)}(),Fe=(n(892681),n(884317),n(336686),n(427808),n(348834).Buffer);function He(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _e(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?He(Object(n),!0).forEach((function(t){(0,c.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):He(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function je(e){return null!==e&&"object"===typeof e?Object.entries(e).filter((function(e){return null!=(0,l.default)(e,2)[1]})).reduce((function(e,t){var n,r=(0,l.default)(t,2),o=r[0],i=r[1];return _e(_e({},e),{},((n={})[o]=i!==Object(i)||Array.isArray(i)?i:je(i),n))}),{}):e}var Ue,We=function(){function e(){}var t=e.prototype;return t.makeExecuteContractMsg=function(e,t,n,r){var o=Ke.MsgExecuteContract.encode(Ke.MsgExecuteContract.fromPartial({sender:e,contract:t,msg:Fe.from(JSON.stringify(je(n))),funds:r})).finish();return{typeUrl:z.MessageType.EXECUTE_CONTRACT,value:(0,g.bytesToHex)(o)}},t.makeSendNativeMsg=function(e,t,n,r){var o=Me.MsgSend.encode(Me.MsgSend.fromPartial({fromAddress:e,toAddress:t,amount:[{amount:n,denom:r}]})).finish();return{typeUrl:z.MessageType.SEND,value:(0,g.bytesToHex)(o)}},t.makeSendCwTokenMsg=function(e,t,n,r){return this.makeExecuteContractMsg(e,t,{transfer:{recipient:n,amount:r}},[])},(0,p.default)(e)}(),$e=function(){function e(){this.aminoMsgBuilder=new Re,this.protoMsgBuilder=new We}var t=e.prototype;return t.makeProtoMsgsOrWithAminoMsgs=function(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),o=2;o<n;o++)r[o-2]=arguments[o];return{aminoMsgs:[e.apply(void 0,r)],protoMsgs:[t.apply(void 0,r)]}},t.makeSendNativeMsg=function(e,t,n,r){return this.makeProtoMsgsOrWithAminoMsgs(this.aminoMsgBuilder.makeSendNativeMsg.bind(this.aminoMsgBuilder),this.protoMsgBuilder.makeSendNativeMsg.bind(this.protoMsgBuilder),e,t,n,r)},t.makeSendCwTokenMsg=function(e,t,n,r){return this.makeProtoMsgsOrWithAminoMsgs(this.aminoMsgBuilder.makeSendCwTokenMsg.bind(this.aminoMsgBuilder),this.protoMsgBuilder.makeSendCwTokenMsg.bind(this.protoMsgBuilder),e,t,n,r)},t.makeExecuteContractMsg=function(e,t,n,r){return this.makeProtoMsgsOrWithAminoMsgs(this.aminoMsgBuilder.makeExecuteContractMsg.bind(this.aminoMsgBuilder),this.protoMsgBuilder.makeExecuteContractMsg.bind(this.protoMsgBuilder),e,t,n,r)},(0,p.default)(e)}(),Le=n(94857),Ve=n(539299),qe=n(348834).Buffer;function Ge(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ye(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ge(Object(n),!0).forEach((function(t){(0,c.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ge(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ze(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,v.default)(e);if(t){var o=(0,v.default)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return(0,y.default)(this,n)}}var Je=((Ue={})[N.OnekeyNetwork.juno]="1.2",Ue.default="1.3",Ue),Qe=["0.01","0.025","0.04"],Xe=function(e){(0,h.default)(n,e);var t=ze(n);function n(){for(var e,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).keyringMap={hd:he,hw:ae,imported:we,watching:Te,external:Te},e.settings=Ve.default,e.getClientCache=(0,D.memoizee)((function(t){return e.getNodeClient(t)}),{promise:!0,max:1}),e.msgBuilder=new $e,e.txBuilder=new Ee,e}var r=n.prototype;return r.getContractClient=function(){var e=(0,f.default)((function*(){return Promise.resolve(Se.get(this.networkId))}));return function(){return e.apply(this,arguments)}}(),r.getNodeClient=function(e){return new Oe(e)},r.getClient=function(){var e=(0,f.default)((function*(){var e=(yield this.engine.getNetwork(this.networkId)).rpcURL;return this.getClientCache(e)}));return function(){return e.apply(this,arguments)}}(),r.getChainInfo=function(){var e=(0,f.default)((function*(){return yield this.engine.providerManager.getChainInfoByNetworkId(this.networkId)}));return function(){return e.apply(this,arguments)}}(),r.getChainImplInfo=function(){var e=(0,f.default)((function*(){return(yield this.engine.providerManager.getChainInfoByNetworkId(this.networkId)).implOptions}));return function(){return e.apply(this,arguments)}}(),r.getClientEndpointStatus=function(){var e=(0,f.default)((function*(e){var t=this.getNodeClient(e),n=performance.now(),r=(yield t.fetchBlockHeaderV1beta1()).height,o=parseInt(r);return{responseTime:Math.floor(performance.now()-n),latestBlock:o}}));return function(t){return e.apply(this,arguments)}}(),r._getPublicKey=function(){var e=(0,f.default)((function*(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).prefix,t=void 0===e||e,n=(yield this.getDbAccount()).pub;return t&&(n=(0,A.addHexPrefix)(n)),Promise.resolve(n)}));return function(){return e.apply(this,arguments)}}(),r.getKey=function(){var e=(0,f.default)((function*(e,t){var n,r,o=yield this.engine.dbApi.getAccount(t),i=yield this.engine.providerManager.getChainInfoByNetworkId(e),a=L(null!=(n=null==(r=i.implOptions)?void 0:r.addressPrefix)?n:"cosmos",o.address),u=yield this.engine.getWalletSafe(this.walletId);return{name:o.name,algo:"secp251k1",pubKey:o.pub,address:o.address,bech32Address:a,isNanoLedger:(null==u?void 0:u.type)===E.WALLET_TYPE_HW}}));return function(t,n){return e.apply(this,arguments)}}(),r.normalIBCAddress=function(e){if(this.isIbcToken(e)){var t=e.split("/"),n=(0,l.default)(t,2),r=n[0],o=n[1];return`${r.toLowerCase()}/${o.toUpperCase()}`}},r.validateAddress=function(){var e=(0,f.default)((function*(e){var t=yield this.getChainInfo();return V(e,t.implOptions.addressPrefix)?Promise.resolve(e):Promise.reject(new T.InvalidAddress)}));return function(t){return e.apply(this,arguments)}}(),r.isIbcToken=function(e){return-1!==e.indexOf("/")&&"ibc"===e.split("/")[0].toLowerCase()},r.validateTokenAddress=function(){var e=(0,f.default)((function*(e){var t=this,n=yield this.getChainInfo();if(this.isIbcToken(e)){var r,o=null!=(r=this.normalIBCAddress(e))?r:e,i=new Pe,a=yield i.fetchAssertInfos(this.networkId);return a&&a.find((function(e){return"ics20"===e.type_asset&&t.normalIBCAddress(e.base)===o}))?Promise.resolve(o):Promise.reject(new T.InvalidTokenAddress)}return function(e,t){try{var n=W.bech32.decode(e),r=n.prefix,o=n.words;if(r!==t)return!1;var i=W.bech32.fromWords(o);return 32===i.length||20===i.length}catch(a){return!1}}(e,n.implOptions.addressPrefix)?Promise.resolve(e):Promise.reject(new T.InvalidTokenAddress)}));return function(t){return e.apply(this,arguments)}}(),r.validateWatchingCredential=function(e){return this.settings.watchingAccountEnabled?this.validateAddress(e).then((function(e){return!!e&&e.length>0})).catch((function(){return!1})):Promise.resolve(!1)},r.checkAccountExistence=function(){var e=(0,f.default)((function*(e){var t=yield this.getClient();return!!(yield t.getAccountInfo(e))}));return function(t){return e.apply(this,arguments)}}(),r.getAccountNonce=function(){var e=(0,f.default)((function*(){var e,t=yield this.getClient(),n=yield t.getAccountInfo(yield this.getAccountAddress());return new(w())(null!=(e=null==n?void 0:n.sequence)?e:"0").toNumber()}));return function(){return e.apply(this,arguments)}}(),r.getBalances=function(){var e=(0,f.default)((function*(e){var t=this,n=yield this.getClient(),r=(yield this.getChainInfo()).implOptions,o=yield this.getContractClient();return Promise.all(e.map(function(){var e=(0,f.default)((function*(e){var i=e.address,a=e.tokenAddress;try{var u,s=null!=(u=null==a?void 0:a.trim())?u:void 0,c=!s,d=s&&t.isIbcToken(s);if(c||d){var l=yield n.getAccountBalances(i);if(c){var f,p=l.find((function(e){return e.denom===r.mainCoinDenom}));return new(w())(null!=(f=null==p?void 0:p.amount)?f:"0")}if(d){var h,y=l.find((function(e){return t.normalIBCAddress(e.denom)===t.normalIBCAddress(s)}));return new(w())(null!=(h=null==y?void 0:y.amount)?h:"0")}}if(!o)throw new Error("Contract client not found");return yield o.queryCw20TokenBalance({networkId:t.networkId,axios:n.axios},s,[i]).then((function(e){return e[0].balance}))}catch(v){}}));return function(t){return e.apply(this,arguments)}}()))}));return function(t){return e.apply(this,arguments)}}(),r.fetchTokenInfos=function(){var e=(0,f.default)((function*(e){var t=this,n=e.filter((function(e){return t.isIbcToken(e)})).reduce((function(e,n){var r=t.normalIBCAddress(n);return r&&e.add(r),e}),new Set),r=[];if(n.size>0){var o=new Pe,i=yield o.fetchAssertInfos(this.networkId);if(!i)return Promise.resolve([]);var a=i.reduce((function(e,r){var o,i=null!=(o=t.normalIBCAddress(r.base))?o:r.base;if("ics20"===r.type_asset&&n.has(i)){var a,u,s,c,d,l,f=null==(a=r.denom_units.find((function(e){return e.denom===r.display})))?void 0:a.exponent;if(void 0===f)return e;var p=null!=(u=null==(s=r.traces)||null==(c=s.at(0))||null==(d=c.chain)||null==(l=d.channel_id)?void 0:l.toUpperCase())?u:"";e.push({name:`${r.symbol}${(null==p?void 0:p.length)>0?`(${p})`:""}`,symbol:r.symbol,decimals:f})}return e}),[]);r.push.apply(r,(0,d.default)(a))}if(r.length===e.length)return r;try{var u=yield this.getContractClient();if(!u)return r;var s=yield this.getClient(),c=e.filter((function(e){return!t.isIbcToken(e)}));yield u.queryCw20TokenInfo({networkId:this.networkId,axios:s.axios},c).then((function(e){return e.map((function(e){return{name:e.name,symbol:e.symbol,decimals:e.decimals}}))})).then((function(e){r.push.apply(r,(0,d.default)(e))})).catch((function(){}))}catch(l){}return r}));return function(t){return e.apply(this,arguments)}}(),r.attachFeeInfoToEncodedTx=function(){var e=(0,f.default)((function*(e){var t,n,r,o=e.feeInfoValue,i=o.price,a=o.limit;if(!i||"string"!==typeof i)throw new T.OneKeyInternalError("Invalid gas price.");if("string"!==typeof a)throw new T.OneKeyInternalError("Invalid fee limit");var u=yield this.getNetwork(),s=(0,k.convertFeeGweiToValue)({value:i,network:u}),c=new(w())(parseFloat(s)*parseFloat(a)).toFixed(0),d=(0,Le.getFee)(e.encodedTx),l=yield this.getChainImplInfo(),f=[];d&&d.amount.length>0?(d.amount[0].denom!==l.mainCoinDenom&&B.default.engine.warn("Cosmos Invalid fee denom:",{network:u,transaction:e.encodedTx}),f=[{denom:l.mainCoinDenom,amount:c}]):f=[{denom:l.mainCoinDenom,amount:c}];var p={amount:f,gas_limit:a,payer:null!=(t=null==d?void 0:d.payer)?t:"",granter:null!=(n=null==d?void 0:d.granter)?n:"",feePayer:null!=(r=null==d?void 0:d.feePayer)?r:""};return(0,Le.setFee)(e.encodedTx,p)}));return function(t){return e.apply(this,arguments)}}(),r.decodedTxToLegacy=function(e){return Promise.resolve({})},r.decodeTx=function(){var e=(0,f.default)((function*(e,t){var n,r=yield this.engine.getNetwork(this.networkId),o=yield this.getDbAccount(),i=yield this.engine.getNativeTokenInfo(this.networkId),a=yield this.getChainInfo(),u=(0,Le.getMsgs)(e),s=[];for(var c of u){var d,l=null,f=X(c,null==a||null==(d=a.implOptions)?void 0:d.mainCoinDenom);if(f===C.IDecodedTxActionType.NATIVE_TRANSFER||f===C.IDecodedTxActionType.TOKEN_TRANSFER){var p,h="nativeTransfer",y="unpacked"in c?c.unpacked:c.value,v=y.amount,g=y.fromAddress,m=y.toAddress,I=v[0].amount,T=v[0].denom;if(f===C.IDecodedTxActionType.TOKEN_TRANSFER&&(h="tokenTransfer",!(i=yield this.engine.ensureTokenInDB(this.networkId,T))))throw new Error("Invalid token address");var x={tokenInfo:i,to:m,from:g,amount:new(w())(I).shiftedBy(-i.decimals).toFixed(),amountValue:I,extraInfo:null};(p={type:f})[h]=x,l=p}else l={type:C.IDecodedTxActionType.UNKNOWN,direction:C.IDecodedTxDirection.OTHER,unknownAction:{extraInfo:{}}};l&&s.push(l)}var b,O,E=(0,Le.getFee)(e),A=(0,Le.getSequence)(e),P=Qe[0];null!=E&&E.gas_limit&&(P=new(w())(null!=(b=null==E||null==(O=E.amount[0])?void 0:O.amount)?b:"1").div(null==E?void 0:E.gas_limit).toFixed(6));var N={txid:"",owner:o.address,signer:o.address,nonce:A.toNumber(),actions:s,status:C.IDecodedTxStatus.Pending,networkId:this.networkId,accountId:this.accountId,feeInfo:{price:(0,k.convertFeeValueToGwei)({value:P,network:r}),limit:null!=(n=null==E?void 0:E.gas_limit)?n:void 0},extraInfo:null,encodedTx:e};return Promise.resolve(N)}));return function(t,n){return e.apply(this,arguments)}}(),r.buildEncodedTxFromTransfer=function(){var e=(0,f.default)((function*(e){var t,n;if(!e.to)throw new Error("Invalid transferInfo.to params");var r=e.to,o=e.amount,i=e.token,a=(yield this.getDbAccount()).address,u=yield this.getChainInfo(),s=(0,x.parseNetworkId)(this.networkId).chainId;if(!s)throw new Error("Invalid networkId");var c,d=null!=(t=e.destinationTag)?t:"";if(!V(r,u.implOptions.addressPrefix)&&r.indexOf("#")>-1){var f=r.split("#"),p=(0,l.default)(f,2),h=p[0],y=p[1];r=h,d=null!=y?y:"",yield this.validateAddress(h)}if(i&&""!==i){var v=yield this.engine.ensureTokenInDB(this.networkId,i);if("undefined"===typeof v)throw new T.OneKeyInternalError("Failed to get token info.");var m=new(w())(o).shiftedBy(v.decimals).toFixed();c=this.isIbcToken(i)?this.msgBuilder.makeSendNativeMsg(a,r,m,i):this.msgBuilder.makeSendCwTokenMsg(a,i,r,m)}else{var I,b=yield this.getNetwork(),O=new(w())(o).shiftedBy(b.decimals).toFixed();c=this.msgBuilder.makeSendNativeMsg(a,r,O,null==u||null==(I=u.implOptions)?void 0:I.mainCoinDenom)}var E=yield this.getClient(),C=yield E.getAccountInfo(a);if(!C)throw new Error("Invalid account");var k=(0,g.hexToBytes)((0,A.stripHexPrefix)(yield this._getPublicKey()));return this.txBuilder.makeTxWrapper(c,{memo:d,gasLimit:"0",feeAmount:"1",pubkey:k,mainCoinDenom:null==u||null==(n=u.implOptions)?void 0:n.mainCoinDenom,chainId:s,accountNumber:C.account_number,nonce:C.sequence})}));return function(t){return e.apply(this,arguments)}}(),r.buildEncodedTxFromApprove=function(e){throw new T.NotImplemented},r.updateEncodedTxTokenApprove=function(e,t){throw new T.NotImplemented},r.buildUnsignedTxFromEncodedTx=function(){var e=(0,f.default)((function*(e){var t=yield this.getDbAccount();return Promise.resolve({inputs:[{address:t.address,value:new(w())(0),publicKey:t.pub}],outputs:[],payload:{encodedTx:e},encodedTx:e})}));return function(t){return e.apply(this,arguments)}}(),r.fetchFeeConfig=function(){var e=(0,f.default)((function*(){var e=(yield this.getChainInfo()).implOptions.gasPriceStep||{},t=e.low,n=e.normal,r=e.high;return[new(w())(null!=t?t:Qe[0]),new(w())(null!=n?n:Qe[1]),new(w())(null!=r?r:Qe[2])]}));return function(){return e.apply(this,arguments)}}(),r.fixFeeAmount=function(){var e=(0,f.default)((function*(e){var t,n,r,o=(0,Le.getFee)(e),i=yield this.getChainImplInfo(),a=[];o&&o.amount.length>0?(o.amount[0].denom!==i.mainCoinDenom&&B.default.engine.warn("Cosmos Invalid fee denom:",{network:this.networkId,transaction:e}),a=[{denom:i.mainCoinDenom,amount:o.amount[0].amount}]):a=[{denom:i.mainCoinDenom,amount:"100000"}];var u={amount:a,gas_limit:o.gas_limit,payer:null!=(t=null==o?void 0:o.payer)?t:"",granter:null!=(n=null==o?void 0:o.granter)?n:"",feePayer:null!=(r=null==o?void 0:o.feePayer)?r:""};return(0,Le.setFee)(e,u)}));return function(t){return e.apply(this,arguments)}}(),r.fetchFeeInfo=function(){var e=(0,f.default)((function*(e){var t=yield Promise.all([this.getNetwork(),this.buildUnsignedTxFromEncodedTx(e)]),n=(0,l.default)(t,2),r=n[0],o=n[1],i=yield this.fixFeeAmount(o.encodedTx),a=(0,Le.getFee)(i).gas_limit,u=(yield this.fetchFeeConfig()).map((function(e){return(0,k.convertFeeValueToGwei)({value:e.toFixed(),network:r})}));try{var s,c=yield this.getClient(),d=yield this._getPublicKey(),f=(0,q.serializeSignedTx)({txWrapper:i,signature:{signatures:[new Uint8Array(64)]},publicKey:{pubKey:d}});if(!f)throw new Error("Invalid rawTxBytes");var p=yield c.simulationTransaction({tx_bytes:qe.from(f).toString("base64")});if(!p)throw new Error("Failed to get tx simulation");a=new(w())(p.gas_used).multipliedBy(null!=(s=Je[this.networkId])?s:Je.default).toFixed(0)}catch(m){var h=(0,Le.getMsgs)(i).find((function(e){return(null==e?void 0:e.typeUrl)===Y.defaultAminoMsgOpts.send.native.type||(null==e?void 0:e.type)===z.MessageType.SEND}));if(h){var y,v=("unpacked"in h?h.unpacked:h.value).amount,g=yield this.getChainInfo();v&&v.length>0&&v[0].denom===(null==g||null==(y=g.implOptions)?void 0:y.mainCoinDenom)&&(a="100000")}if(!a||""===a)throw m}return{nativeSymbol:r.symbol,nativeDecimals:r.decimals,feeSymbol:r.feeSymbol,feeDecimals:r.feeDecimals,limit:a,prices:u,defaultPresetIndex:"1"}}));return function(t){return e.apply(this,arguments)}}(),r.broadcastTransaction=function(){var e=(0,f.default)((function*(e){var t=yield this.getClient();B.default.engine.info("broadcastTransaction START:",{rawTx:e.rawTx});try{var n=yield t.broadcastTransaction(e.rawTx);if(B.default.engine.info("broadcastTransaction Done:",{txid:n,rawTx:e.rawTx}),!n)throw new Error("broadcastTransaction failed");return Ye(Ye({},e),{},{txid:n})}catch(a){if(a instanceof T.OneKeyInternalError)throw a;var r=a||{},o=r.errorCode,i=r.message;throw new T.OneKeyInternalError(`${null!=o?o:""} ${i}`)}}));return function(t){return e.apply(this,arguments)}}(),r.updateEncodedTx=function(){var e=(0,f.default)((function*(e,t,n){var r=(0,Le.getMsgs)(e);if(n.type===C.IEncodedTxUpdateType.transfer&&r.length>0&&r[0].typeUrl===Y.defaultAminoMsgOpts.send.native.type){var o=yield this.getNetwork();return Promise.resolve((0,Le.setSendAmount)(e,new(w())(t.amount).shiftedBy(o.decimals).toFixed()))}return Promise.resolve(e)}));return function(t,n,r){return e.apply(this,arguments)}}(),r.getExportedCredential=function(){var e=(0,f.default)((function*(e){var t=yield this.getDbAccount();if(t.id.startsWith("hd-")||t.id.startsWith("imported")){var n=this.keyring,r=Object.values(yield n.getPrivateKeys(e)),o=(0,l.default)(r,1)[0];return`0x${(0,b.decrypt)(e,o).toString("hex")}`}throw new T.OneKeyInternalError("Only credential of HD or imported accounts can be exported")}));return function(t){return e.apply(this,arguments)}}(),r.fetchOnChainHistory=function(){var e=(0,f.default)((function*(e){var t,n=this,r=e.localHistory,o=void 0===r?[]:r;if(e.tokenIdOnNetwork)return Promise.resolve([]);var i=(yield(0,S.CoreSDKLoader)()).getTimeStamp,a=yield this.getDbAccount(),u=yield this.getChainInfo(),s=new Pe,c=(null!=(t=yield s.fetchAccountTxs(this.networkId,a.address))?t:[]).map(function(){var e=(0,f.default)((function*(e){var t=o.find((function(t){return(0,M.equalsIgnoreCase)(t.decodedTx.txid,e.data.txhash)}));if(t&&t.decodedTx.isFinal)return Promise.resolve(void 0);try{var r,s,c,d,l,f=yield n.engine.getNativeTokenInfo(n.networkId),p=e.data.code,h=C.IDecodedTxStatus.Pending;p?h=C.IDecodedTxStatus.Failed:new(w())(e.data.height).gt(0)&&(h=C.IDecodedTxStatus.Confirmed);var y=e.data.tx.body.messages,v=e.data.tx.auth_info.fee,g=e.data.tx.auth_info.signer_infos[0].sequence,m="",T="",x=[];for(var b of y){var O,E=null,k=Q(b,null==u||null==(O=u.implOptions)?void 0:O.mainCoinDenom);if(k===C.IDecodedTxActionType.NATIVE_TRANSFER||k===C.IDecodedTxActionType.TOKEN_TRANSFER){var A,P="nativeTransfer",N=b.amount,S=b.from_address,B=b.to_address;m=S,T=B;var D=N[0].amount,K=N[0].denom;if(k===C.IDecodedTxActionType.TOKEN_TRANSFER&&(P="tokenTransfer",f=yield n.engine.ensureTokenInDB(n.networkId,K)),!f)throw new Error("Invalid token address");var R={tokenInfo:f,to:B,from:S,amount:new(w())(D).shiftedBy(-f.decimals).toFixed(),amountValue:D,extraInfo:null};(A={type:k})[P]=R,E=A}else E={type:C.IDecodedTxActionType.UNKNOWN,direction:C.IDecodedTxDirection.OTHER,unknownAction:{extraInfo:{}}};E&&x.push(E)}var F={from:m,to:T,value:""},H=new(w())(null!=(r=null==v||null==(s=v.amount[0])?void 0:s.amount)?r:"0"),_={txid:e.data.txhash,owner:a.address,signer:m,nonce:parseInt(g),actions:x,status:h,networkId:n.networkId,accountId:n.accountId,encodedTx:F,extraInfo:null,totalFeeInNative:new(w())(H).shiftedBy(-(null!=(c=null==(d=f)?void 0:d.decimals)?c:6)).toFixed()};return _.updatedAt=null!=(l=(0,I.default)(new Date(e.data.timestamp)))?l:i(),_.createdAt=_.updatedAt,_.isFinal=_.status===C.IDecodedTxStatus.Confirmed,yield n.buildHistoryTx({decodedTx:_,historyTxToMerge:t})}catch(j){return}}));return function(t){return e.apply(this,arguments)}}());return(yield Promise.all(c)).filter(Boolean)}));return function(t){return e.apply(this,arguments)}}(),r.getTransactionStatuses=function(){var e=(0,f.default)((function*(e){var t=yield this.getClient();return Promise.all(e.map(function(){var e=(0,f.default)((function*(e){try{var n=yield t.getTransactionInfo(e),r=s()(n,"code",void 0),o=O.TransactionStatus.PENDING;return r?o=O.TransactionStatus.CONFIRM_BUT_FAILED:new(w())(n.height).gt(0)&&(o=O.TransactionStatus.CONFIRM_AND_SUCCESS),yield Promise.resolve(o)}catch(r){var i=r.message;if("404"===i||"400"===i)return Promise.resolve(O.TransactionStatus.NOT_FOUND)}}));return function(t){return e.apply(this,arguments)}}()))}));return function(t){return e.apply(this,arguments)}}(),r.addressFromBase=function(){var e=(0,f.default)((function*(e){var t,n=e,r=null==(t=n.addresses[this.networkId])?void 0:t.trim();if(a()(r)||o()(r)){var i,u,s=yield this.getChainInfo();return L(null!=(i=null==(u=s.implOptions)?void 0:u.addressPrefix)?i:"cosmos",n.address)}return n.addresses[this.networkId]}));return function(t){return e.apply(this,arguments)}}(),(0,p.default)(n)}(P.VaultBase)},565147:(e,t,n)=>{n.r(t),n.d(t,{KeyringBase:()=>c,KeyringBaseMock:()=>d});var r=n(634795),o=n(887371),i=n(545754),a=n(411987),u=n(695058);function s(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,u.default)(e);if(t){var o=(0,u.default)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return(0,a.default)(this,n)}}var c=function(e){(0,i.default)(n,e);var t=s(n);function n(e){var n;return(n=t.call(this,e.options)).vault=e,n}return n.prototype.addressFromBase=function(){var e=(0,r.default)((function*(e){return this.vault.addressFromBase(e)}));return function(t){return e.apply(this,arguments)}}(),(0,o.default)(n)}(n(114540).VaultContext),d=function(e){(0,i.default)(n,e);var t=s(n);function n(){return t.apply(this,arguments)}return(0,o.default)(n)}(c)},82406:(e,t,n)=>{n.r(t),n.d(t,{KeyringHardwareBase:()=>l});var r=n(634795),o=n(887371),i=n(545754),a=n(411987),u=n(695058),s=n(799075),c=n(814817);function d(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,u.default)(e);if(t){var o=(0,u.default)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return(0,a.default)(this,n)}}var l=function(e){(0,i.default)(a,e);var t=d(a);function a(){return t.apply(this,arguments)}var u=a.prototype;return u.getHardwareInfo=function(){var e=(0,r.default)((function*(){var e,t,n,r=yield this.engine.getHWDeviceByWalletId(this.vault.walletId);return{connectId:null!=(e=null==r?void 0:r.mac)?e:"",deviceId:null!=(t=null==r?void 0:r.deviceId)?t:"",deviceType:null!=(n=null==r?void 0:r.deviceType)?n:""}}));return function(){return e.apply(this,arguments)}}(),u.getWalletPassphraseState=function(){var e=(0,r.default)((function*(){var e=yield this.engine.getWallet(this.vault.walletId);return{passphraseState:null==e?void 0:e.passphraseState,useEmptyPassphrase:!(0,c.isPassphraseWallet)(e)}}));return function(){return e.apply(this,arguments)}}(),u.getHardwareSDKInstance=function(){var e=(0,r.default)((function*(){var e,t,r,o,i;return null!=(i=yield null==(e=n.g)||null==(t=e.$backgroundApiProxy)||null==(r=t.backgroundApi)||null==(o=r.serviceHardware)||null==o.getSDKInstance?void 0:o.getSDKInstance())?i:s.HardwareSDK}));return function(){return e.apply(this,arguments)}}(),u.prepareAccountByAddressIndex=function(e){throw new Error("Method not implemented.")},(0,o.default)(a)}(n(565147).KeyringBase)},810887:(e,t,n)=>{n.r(t),n.d(t,{KeyringHdBase:()=>h});var r=n(256666),o=n(634795),i=n(887371),a=n(545754),u=n(411987),s=n(695058),c=n(605851),d=n(940915);function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function f(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){(0,r.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function p(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,s.default)(e);if(t){var o=(0,s.default)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return(0,u.default)(this,n)}}var h=function(e){(0,a.default)(n,e);var t=p(n);function n(){return t.apply(this,arguments)}var r=n.prototype;return r.getPrivateKeys=function(){var e=(0,o.default)((function*(e,t){var n=(yield this.getDbAccount()).path.split("/"),r=t||[n.pop()],o=n.join("/"),i=(yield this.engine.dbApi.getCredential(this.walletId,e)).seed;if("undefined"===typeof i)throw new d.OneKeyInternalError("Unable to get credential.");var a=(yield this.engine.providerManager.getChainInfoByNetworkId(this.networkId)).curve;return(0,c.batchGetPrivateKeys)(a,i,e,o,r).reduce((function(e,t){var n;return f(f({},e),{},((n={})[t.path]=t.extendedKey.key,n))}),{})}));return function(t,n){return e.apply(this,arguments)}}(),r.getAddress=function(){throw new Error("Method not implemented.")},r.batchGetAddress=function(){throw new Error("Method not implemented.")},r.prepareAccountByAddressIndex=function(e){throw new Error("Method not implemented.")},(0,i.default)(n)}(n(280306).KeyringSoftwareBase)},255942:(e,t,n)=>{n.r(t),n.d(t,{KeyringImportedBase:()=>d});var r=n(634795),o=n(887371),i=n(545754),a=n(411987),u=n(695058),s=n(940915);function c(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,u.default)(e);if(t){var o=(0,u.default)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return(0,a.default)(this,n)}}var d=function(e){(0,i.default)(n,e);var t=c(n);function n(){return t.apply(this,arguments)}var a=n.prototype;return a.getPrivateKeys=function(){var e=(0,r.default)((function*(e,t){if("undefined"!==typeof t)throw new s.NotImplemented("Getting private keys from extended private key");var n=(yield this.engine.dbApi.getCredential(this.accountId,e)).privateKey;if("undefined"===typeof n)throw new s.OneKeyInternalError("Unable to get credential.");return{"":n}}));return function(t,n){return e.apply(this,arguments)}}(),a.getAddress=function(){throw new Error("Method not implemented.")},a.batchGetAddress=function(){throw new Error("Method not implemented.")},a.prepareAccountByAddressIndex=function(){throw new Error("Method not implemented.")},(0,o.default)(n)}(n(280306).KeyringSoftwareBase)},280306:(e,t,n)=>{n.r(t),n.d(t,{KeyringSoftwareBase:()=>y});var r=n(196234),o=n(256666),i=n(634795),a=n(887371),u=n(545754),s=n(411987),c=n(695058),d=n(292147),l=n(940915);function f(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?f(Object(n),!0).forEach((function(t){(0,o.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function h(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,c.default)(e);if(t){var o=(0,c.default)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return(0,s.default)(this,n)}}var y=function(e){(0,u.default)(n,e);var t=h(n);function n(){return t.apply(this,arguments)}var o=n.prototype;return o.signTransaction=function(){var e=(0,i.default)((function*(e,t){var n=t.password;if("undefined"===typeof n)throw new l.OneKeyInternalError("Software signing requires a password.");var r=yield this.getSigners(n,e.inputs.map((function(e){return e.address})));return d.default.engine.info("signTransaction",this.networkId,e),p(p({},yield this.engine.providerManager.signTransaction(this.networkId,e,r)),{},{encodedTx:e.encodedTx})}));return function(t,n){return e.apply(this,arguments)}}(),o.signMessage=function(){var e=(0,i.default)((function*(e,t){var n=this,o=t.password;if("undefined"===typeof o)throw new l.OneKeyInternalError("Software signing requires a password.");var i=yield this.getDbAccount(),a=Object.values(yield this.getSigners(o,[i.address])),u=(0,r.default)(a,1)[0];return d.default.engine.info("signMessage",this.networkId,e),Promise.all(e.map((function(e){return n.engine.providerManager.signMessage(n.networkId,e,u)})))}));return function(t,n){return e.apply(this,arguments)}}(),o.getAddress=function(){throw new Error("Method not implemented.")},o.batchGetAddress=function(){throw new Error("Method not implemented.")},o.prepareAccountByAddressIndex=function(e){throw new Error("Method not implemented.")},(0,a.default)(n)}(n(565147).KeyringBase)},701625:(e,t,n)=>{n.r(t),n.d(t,{KeyringWatchingBase:()=>d});var r=n(634795),o=n(887371),i=n(545754),a=n(411987),u=n(695058),s=n(940915);function c(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,u.default)(e);if(t){var o=(0,u.default)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return(0,a.default)(this,n)}}var d=function(e){(0,i.default)(n,e);var t=c(n);function n(){return t.apply(this,arguments)}var a=n.prototype;return a.signTransaction=function(){var e=(0,r.default)((function*(e,t){throw new s.OneKeyInternalError("signTransaction is not supported for watching accounts")}));return function(t,n){return e.apply(this,arguments)}}(),a.signMessage=function(){var e=(0,r.default)((function*(e,t){throw new s.OneKeyInternalError("signMessage is not supported for watching accounts")}));return function(t,n){return e.apply(this,arguments)}}(),a.getAddress=function(){throw new Error("Method not implemented.")},a.batchGetAddress=function(){throw new Error("Method not implemented.")},a.prepareAccountByAddressIndex=function(){throw new Error("Method not implemented.")},(0,o.default)(n)}(n(565147).KeyringBase)},153546:(e,t,n)=>{n.r(t),n.d(t,{convertDeviceError:()=>u});var r=n(703599),o=n(302478),i=n(292147);n(213208);function a(e,t){return"string"!==typeof t?null:e===r.HardwareErrorCode.DeviceInitializeFailed&&t.includes("ECONNABORTED")?new o.ConnectTimeoutError({message:t}):t.includes("Bridge network error")?new o.BridgeNetworkError({message:t}):null}function u(e){var t,n=e||{},u=n.code,s=n.error,c=n.message,d=null!=(t=null!=s?s:c)?t:"Unknown error";if(a(u,d))return a(u,d);switch(i.default.hardwareSDK.info("Device Utils Convert Device Error:",u,d),u){case r.HardwareErrorCode.UnknownError:return new o.UnknownHardwareError(e);case r.HardwareErrorCode.DeviceFwException:return new o.FirmwareVersionTooLow(e);case r.HardwareErrorCode.DeviceUnexpectedMode:return"string"===typeof d&&-1!==d.indexOf("ui-device_bootloader_mode")?new o.NotInBootLoaderMode(e):new o.UnknownHardwareError(e);case r.HardwareErrorCode.DeviceCheckDeviceIdError:return new o.DeviceNotSame(e);case r.HardwareErrorCode.DeviceNotFound:return new o.DeviceNotFind(e);case r.HardwareErrorCode.DeviceUnexpectedBootloaderMode:return new o.NotInBootLoaderMode(e);case r.HardwareErrorCode.DeviceInterruptedFromOutside:case r.HardwareErrorCode.DeviceInterruptedFromUser:return new o.UserCancelFromOutside(e);case r.HardwareErrorCode.DeviceNotSupportPassphrase:return new o.NotSupportPassphraseError(e);case r.HardwareErrorCode.IFrameLoadFail:return new o.InitIframeLoadFail(e);case r.HardwareErrorCode.IframeTimeout:return new o.InitIframeTimeout(e);case r.HardwareErrorCode.FirmwareUpdateDownloadFailed:return new o.FirmwareDownloadFailed(e);case r.HardwareErrorCode.FirmwareUpdateManuallyEnterBoot:return new o.FirmwareUpdateManuallyEnterBoot(e);case r.HardwareErrorCode.FirmwareUpdateAutoEnterBootFailure:return new o.FirmwareUpdateAutoEnterBootFailure(e);case r.HardwareErrorCode.FirmwareUpdateLimitOneDevice:return new o.FirmwareUpdateLimitOneDevice(e);case r.HardwareErrorCode.CallMethodNeedUpgradeFirmware:return new o.FirmwareVersionTooLow(e);case r.HardwareErrorCode.NewFirmwareUnRelease:return new o.NewFirmwareUnRelease(e);case r.HardwareErrorCode.NewFirmwareForceUpdate:return new o.NewFirmwareForceUpdate(e);case r.HardwareErrorCode.NetworkError:return new o.NetworkError(e);case r.HardwareErrorCode.BlePermissionError:return new o.NeedBluetoothTurnedOn(e);case r.HardwareErrorCode.BleLocationError:return new o.NeedBluetoothPermissions({message:d});case r.HardwareErrorCode.BleLocationServicesDisabled:return new o.BleLocationServiceError({message:d});case r.HardwareErrorCode.BleDeviceNotBonded:return new o.DeviceNotBonded(e);case r.HardwareErrorCode.BleDeviceBondError:return new o.DeviceBondError(e);case r.HardwareErrorCode.BleWriteCharacteristicError:return new o.BleWriteCharacteristicError(e);case r.HardwareErrorCode.BleScanError:return new o.BleScanError({message:d});case r.HardwareErrorCode.BleAlreadyConnected:return new o.BleAlreadyConnectedError(e);case r.HardwareErrorCode.RuntimeError:return-1!==d.indexOf("EIP712 blind sign is disabled")?new o.OpenBlindSign(e):-1!==d.indexOf("Unknown message")||-1!==d.indexOf("Failure_UnexpectedMessage")?new o.UnknownMethod(e):new o.UnknownHardwareError(e);case r.HardwareErrorCode.PinInvalid:return new o.InvalidPIN(e);case r.HardwareErrorCode.DeviceCheckPassphraseStateError:return new o.InvalidPassphrase(e);case r.HardwareErrorCode.DeviceOpenedPassphrase:return new o.DeviceOpenedPassphrase(e);case r.HardwareErrorCode.DeviceNotOpenedPassphrase:return new o.DeviceNotOpenedPassphrase(e);case r.HardwareErrorCode.PinCancelled:case r.HardwareErrorCode.ActionCancelled:return new o.UserCancel(e);case r.HardwareErrorCode.BridgeNotInstalled:case o.CustomOneKeyHardwareError.NeedOneKeyBridge:return new o.NeedOneKeyBridge(e);case r.HardwareErrorCode.BridgeNetworkError:return new o.BridgeNetworkError(e);case r.HardwareErrorCode.BridgeTimeoutError:return new o.BridgeTimeoutError(e);case r.HardwareErrorCode.PollingTimeout:return new o.ConnectTimeoutError(e);case r.HardwareErrorCode.PollingStop:return new o.ConnectPollingStopError(e);case r.HardwareErrorCode.BlindSignDisabled:return new o.OpenBlindSign(e);case r.HardwareErrorCode.FileAlreadyExists:return new o.FileAlreadyExistError(e);case r.HardwareErrorCode.CheckDownloadFileError:return new o.IncompleteFileError(e);case r.HardwareErrorCode.NotInSigningMode:return new o.NotInSigningModeError(e);case r.HardwareErrorCode.DataOverload:return new o.DeviceDataOverload(e);default:return new o.UnknownHardwareError(e)}}}}]);