"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[37814],{37814:(e,t,n)=>{n.r(t),n.d(t,{default:()=>_e});var r=n(539144),a=n(877531),o=n(785192),i=n(561220),s=n(435581),u=n(866904),l=n(719392),d=n(18861),c=n(510374),f=n(259924),p=n(196234),m=n(202784),h=n(472719),g=n(789644),y=n.n(g),b=n(470310),x=n(361301),_=n(783112),j=n(213208),v=n(945821),O=n(747225),w=n(74008),P=n(481047),R=n(877097),M=n(218513),k=n(552322),S=function(){var e=(0,_.default)(),t=(0,O.useSettings)().instanceId,n=(0,w.default)().formatDate,r=(0,h.useNavigation)(),g=(0,m.useState)([]),S=(0,p.default)(g,2),C=S[0],q=S[1],A=(0,m.useState)("loading"),E=(0,p.default)(A,2),D=E[0],I=E[1],T=(0,m.useCallback)((function(){I("loading"),y().get((0,R.listUri)(t)).then((function(e){if(e.data.success){var t=e.data.data;I(t.length>0?"data":"empty"),q(t)}})).catch((function(){I("network")}))}),[t]),H=function(){j.default.isExtensionUiPopup?(v.default.serviceApp.openExtensionExpandTab({routes:[P.RootRoutes.Modal,P.ModalRoutes.SubmitRequest],params:{screen:P.SubmitRequestModalRoutes.SubmitRequestModal}}),setTimeout((function(){window.close()}),300)):r.navigate(M.HistoryRequestRoutes.SubmitRequestModal)},B=(0,m.useMemo)((function(){return(0,k.jsx)(f.default,{dismiss:!0,alertType:"info",title:e.formatMessage({id:"conten__please_be_patient_as_net_work"})})}),[e]),z=(0,m.useCallback)((function(t){var a=t.item,o="";return a.custom_fields.forEach((function(e){360013393195===e.id&&(o=e.value)})),(0,k.jsx)(i.default,{onPress:function(){r.navigate(M.HistoryRequestRoutes.TicketDetailModal,{order:a})},children:(0,k.jsx)(b.default,{bgColor:"surface-default",height:"96px",padding:"16px",borderRadius:"12px",children:(0,k.jsxs)(b.default,{flex:1,alignItems:"center",space:"12px",children:[(0,k.jsxs)(x.default,{flex:1,children:[(0,k.jsx)(u.default,{typography:{sm:"Body1Strong",md:"Body2Strong"},children:function(t){switch(t){case"hardware":return e.formatMessage({id:"form__hardware"});case"app_on_android":return e.formatMessage({id:"form__app_on_android"});case"app_on_ios":return e.formatMessage({id:"form__app_on_ios"});case"app_on_desktop":return e.formatMessage({id:"form__app_on_desktop"});case"app_on_browser":return e.formatMessage({id:"form__app_on_browser"});default:return t}}(o)}),(0,k.jsx)(u.default,{typography:"Body2",numberOfLines:1,color:"text-subdued",children:a.description}),(0,k.jsx)(u.default,{typography:"Body2",color:"text-subdued",children:n(a.created_at,{hideYear:!0})})]}),(0,k.jsx)(s.default,{name:"ChevronRightMini",color:"icon-subdued",size:20})]})})},a.id)}),[n,e,r]);(0,m.useEffect)((function(){T()}),[T]);var L=(0,m.useCallback)((function(){return(0,k.jsx)(d.default,{mb:"16px",children:B})}),[B]),N=(0,m.useCallback)((function(){return(0,k.jsx)(o.default,{height:"24px",bgColor:"surface-subdued"})}),[]);return(0,k.jsx)(a.default,{height:"560px",header:e.formatMessage({id:"form__s_request_history"}),footer:"data"===D?void 0:null,hideSecondaryAction:!0,hidePrimaryAction:!("data"===D),primaryActionProps:{type:"basic"},onPrimaryActionPress:H,primaryActionTranslationId:"form__submit_a_request",flatListProps:"data"===D?{height:"560px",data:C,renderItem:z,ListHeaderComponent:L,ItemSeparatorComponent:N,keyExtractor:function(e){return e.created_at}}:void 0,children:"data"!==D?(0,k.jsx)(d.default,{flex:1,alignItems:"center",justifyContent:"center",position:"relative",children:function(){switch(D){case"network":return(0,k.jsx)(c.default,{emoji:"\ud83c\udf10",title:e.formatMessage({id:"title__no_connection"}),subTitle:e.formatMessage({id:"title__no_connection_desc"}),actionTitle:e.formatMessage({id:"action__retry"}),handleAction:function(){return T()}});case"empty":return(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(d.default,{position:"absolute",top:0,left:0,right:0,children:B}),(0,k.jsx)(c.default,{emoji:"\ud83d\udcac",title:e.formatMessage({id:"title__no_request_history"}),subTitle:e.formatMessage({id:"title__no_request_history_desc"}),actionTitle:e.formatMessage({id:"form__submit_a_request"}),handleAction:H})]});case"loading":return(0,k.jsx)(l.default,{size:"sm"});default:return null}}()}):null})};var C=n(566147),q=n(433996),A=n(795116),E=n(256666),D=n(968079),I=n(669083),T=n(634795),H=n(921311),B=n(912576),z=n(980124),L=n(13334),N=n(636393),$=n(97450),F=n(603833);function U(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function W(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?U(Object(n),!0).forEach((function(t){(0,E.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):U(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var V=function(){var e,t=(0,_.default)(),n=(0,L.default)().width,o=(0,r.default)(),u=(0,h.useNavigation)(),l=(0,O.useSettings)().instanceId,d=(0,h.useRoute)(),c=((null==d?void 0:d.params.order)||{}).id,f=null==d?void 0:d.params.order.submitter_id,g=((o?n:400)-2*(o?16:24))/4,x=(0,H.default)({mode:"onChange"}),j=x.control,v=x.handleSubmit,w=x.formState.isValid,P=(0,m.useState)([]),M=(0,p.default)(P,2),S=M[0],E=M[1],U=(0,m.useCallback)(function(){var e=(0,T.default)((function*(e){return y().post((0,R.updateTicketUri)(c,l),{comment:{body:e.comment,author_id:f,uploads:function(){var e=[];return S.forEach((function(t){t.token&&e.push(t.token)})),e}()}}).then((function(e){e.data.success&&(I.default.show({title:t.formatMessage({id:"msg__submitted_successfully"})}),u.goBack())})).catch((function(e){console.log(e)}))}));return function(t){return e.apply(this,arguments)}}(),[c,S,l,t,u,f]),V=(0,m.useCallback)((0,T.default)((function*(){var e=yield(0,B.launchImageLibraryAsync)({mediaTypes:z.MediaTypeOptions.Images,allowsEditing:!1,base64:!0,aspect:[4,3],quality:.3});if(!e.canceled){var n=`${N.default.v4()}.png`,r=e.assets[0],a={loading:!0,localPath:r.uri,filename:n},o=r.uri;0,E((function(e){return[].concat((0,D.default)(e),[a])})),(0,R.uploadImage)({filename:n,image:o},l,(function(e,r){e?(E((function(e){var t=e.findIndex((function(e){return e.filename===n}));return t<0?e:[].concat((0,D.default)(e.slice(0,t)),(0,D.default)(e.slice(t+1)))})),I.default.show({title:t.formatMessage({id:"msg__upload_failed"})},{type:"error"})):E((function(e){var t=e.findIndex((function(e){return e.filename===n}));return t<0?e:[].concat((0,D.default)(e.slice(0,t)),[W(W({},e[t]),{},{loading:!1,token:r.data.upload.token})],(0,D.default)(e.slice(t+1)))}))}))}})),[l]);return(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)($.SkipAppLock,{}),(0,k.jsx)(a.default,{header:t.formatMessage({id:"action__reply"}),hideSecondaryAction:!0,primaryActionProps:{isDisabled:!(w&&(null==(e=S.filter((function(e){return!(null!=e&&e.token)})))||!e.length)),onPromise:function(){return v(U)()}},primaryActionTranslationId:"action__submit",scrollViewProps:{height:"560px",children:(0,k.jsxs)(C.default,{children:[(0,k.jsx)(C.default.Item,{label:t.formatMessage({id:"form__your_reply"}),control:j,labelAddon:(0,k.jsx)(q.default,{type:"plain",size:"xs",name:"PhotoMini",onPress:function(){S.length<4&&V()}}),rules:{required:t.formatMessage({id:"form__field_is_required"}),maxLength:{value:1e3,message:t.formatMessage({id:"msg__exceeding_the_maximum_word_limit"})},validate:function(e){}},name:"comment",formControlProps:{width:"full"},defaultValue:"",children:(0,k.jsx)(C.default.Textarea,{borderRadius:"12px"})}),(0,k.jsxs)(b.default,{children:[S.map((function(e,t){return(0,k.jsx)(F.ImageView,{imageModel:e,onDelete:function(e){E((function(t){var n=t.findIndex((function(t){return t.filename===e.filename}));return n<0?t:[].concat((0,D.default)(t.slice(0,n)),(0,D.default)(t.slice(n+1)))}))}},t)})),S.length<4?(0,k.jsx)(i.default,{onPress:V,children:(0,k.jsx)(A.default,{mt:"8px",width:g-8+"px",height:g-8+"px",borderRadius:"12px",borderWidth:1,borderColor:"border-default",children:(0,k.jsx)(s.default,{size:20,name:"PlusMini"})})}):null]})]})}})]})};var Y=n(550398),X=n(459740),G=n(377485),J=n.n(G),K=n(608979),Q=n.n(K),Z=n(190769),ee=n(254887),te=n(360446),ne=n(936160),re=n.n(ne);function ae(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function oe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ae(Object(n),!0).forEach((function(t){(0,E.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ae(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ie=n(503834),se=["theme"],ue=function(e,t,n,r,a){var o=(0,te.extractInObject)(r,["children","style","onPress","icon","onOpen","onClose"]),i=(0,p.default)(o,2),s=i[0],u=i[1],l=function(e,t,n){var r;if("web"!==n)return oe(oe({},t),e);var a=null!==(r=t.style)&&void 0!==r?r:{},o=(0,te.extractInObject)(e,["shadowColor","shadowOffset","shadowOpacity","shadowRadius"]),i=(0,p.default)(o,2),s=i[0],u=i[1];return re()(s)||(a=oe(oe({},a),s)),oe(oe(oe({},u),t),{},{style:a})}((0,ie.calculateProps)(e,t,n,u,a),s,Z.default.OS);return(0,te.omitUndefined)(l)};var le=n(586758),de=["columns","space","spacingX","spacingY","minChildWidth","children"];function ce(){return ce=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},ce.apply(this,arguments)}var fe={rows:{},cols:{}};const pe=m.memo(m.forwardRef((function(e,t){var n=function(e,t){var n,r=(0,ee.useNativeBase)(),a=r.theme,o=(0,X.default)(r,se),i=J()(a,"components.".concat(e)),s=null===(n=(0,L.default)())||void 0===n?void 0:n.width;return ue(Q()(a,["components"]),o,i,t,s)}("SimpleGrid",e),r=n.columns,a=n.space,o=n.spacingX,i=n.spacingY,s=n.minChildWidth,u=n.children,l=(0,X.default)(n,de);if((0,le.useHasResponsiveProps)(e))return m.createElement(m.Fragment,null);var c=null!==a&&void 0!==a?a:0,f=null!==o&&void 0!==o?o:c,p=null!==i&&void 0!==i?i:c,h=m.Children.toArray(u);if(r){for(var g=[],y=0;y<h.length;y+=r)g.push(h.slice(y,y+r));return m.createElement(x.default,ce({},fe.rows,{space:p},l,{ref:t}),g.map((function(e,t){return m.createElement(b.default,{space:f,key:t},e.map((function(e){return m.createElement(d.default,ce({},fe.cols,{key:e.key}),e)})))})))}return s?m.createElement(d.default,ce({flexDirection:"row",flexWrap:"wrap",justifyContent:"center"},l,{ref:t}),h.map((function(e){return m.createElement(d.default,ce({},fe.cols,{mx:f,my:p,key:e.key,minWidth:s}),e)}))):m.createElement(m.Fragment,null)})));function me(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function he(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?me(Object(n),!0).forEach((function(t){(0,E.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):me(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ge=function(e){var t=e.id,n=e.size,r=(0,O.useSettings)().instanceId,a=(0,m.useState)(""),o=(0,p.default)(a,2),i=o[0],s=o[1];return(0,m.useEffect)((function(){y().get((0,R.attachmentUri)(t,r)).then((function(e){e.data&&s(e.data.data)}))}),[t]),(0,k.jsx)(k.Fragment,{children:i.length>0?(0,k.jsx)(Y.default,{width:`${n}px`,height:`${n}px`,src:i,borderRadius:"12px",preview:!0,bgColor:"surface-selected"},i):(0,k.jsx)(d.default,{width:n,height:n,bgColor:"surface-selected",borderRadius:"12px"})})};var ye=function(){var e=(0,_.default)(),t=(0,h.useIsFocused)(),n=(0,h.useRoute)(),r=((null==n?void 0:n.params.order)||{}).id,o=n.params.order.submitter_id,i=244/3,s=(0,h.useNavigation)(),l=(0,O.useSettings)().version,c=(0,O.useSettings)().instanceId,f=(0,w.default)().formatDate,g=(0,m.useState)([]),b=(0,p.default)(g,2),x=b[0],v=b[1],P=(0,m.useCallback)((function(e){var t=e.item,n=e.index,r=function(e,t){return e===t}(t.author_id,o),a=t.body;0===n&&(a=`${a}\n\n${j.default.isNativeIOS?"App on iOS":j.default.isNativeAndroid?"App on Android":j.default.isRuntimeBrowser?"App on Browser":"Hardware"}\nAppVersion: ${l}`);return(0,k.jsx)(d.default,{flex:1,flexDirection:"row",justifyContent:r?"flex-end":"flex-start",children:(0,k.jsxs)(d.default,{flexDirection:"column",paddingBottom:"24px",children:[(0,k.jsxs)(d.default,{flexDirection:"column",bgColor:"surface-default",padding:"16px",borderRadius:"12px",flex:1,children:[(0,k.jsx)(u.default,{selectable:!0,maxWidth:"260px",typography:{sm:"Body1",md:"Body2"},mb:t.attachments.length>0?"12px":"0px",children:a}),t.attachments.length>0?(0,k.jsx)(pe,{columns:3,spacingX:2,spacingY:3,mt:"12px",children:t.attachments.map((function(e,t){return(0,k.jsx)(d.default,{size:i,children:(0,k.jsx)(ge,he(he({},e),{},{size:i}))},`attachment${t}`)}))}):null]}),(0,k.jsx)(u.default,{mt:"8px",typography:"Body2",color:"text-subdued",textAlign:r?"right":"left",children:f(t.created_at,{hideYear:!0})})]})})}),[f,i,o,l]),S=(0,m.useCallback)((function(){y().get((0,R.commentsUri)(r,c)).then((function(e){v(e.data.data)})).catch((function(){}))}),[r,c]);return(0,m.useEffect)((function(){t&&S()}),[S,t]),(0,k.jsx)(a.default,{header:e.formatMessage({id:"title__request_details"}),hideSecondaryAction:!0,primaryActionProps:{type:"basic"},primaryActionTranslationId:"action__reply",onPrimaryActionPress:function(){s.navigate(M.HistoryRequestRoutes.ReplyTicketModel,{order:null==n?void 0:n.params.order})},flatListProps:{height:"420px",data:x,renderItem:P,keyExtractor:function(e){return e.created_at}}})};var be=(0,n(324665).default)(),xe=[{name:M.HistoryRequestRoutes.HistoryRequestModal,component:S},{name:M.HistoryRequestRoutes.TicketDetailModal,component:ye},{name:M.HistoryRequestRoutes.ReplyTicketModel,component:V},{name:M.HistoryRequestRoutes.SubmitRequestModal,component:F.SubmitRequest}];const _e=function(){var e=(0,r.default)();return(0,k.jsx)(be.Navigator,{screenOptions:{headerShown:!1,animationEnabled:!!e},children:xe.map((function(e){return(0,k.jsx)(be.Screen,{name:e.name,component:e.component},e.name)}))})}},218513:(e,t,n)=>{var r;n.r(t),n.d(t,{HistoryRequestRoutes:()=>r}),function(e){e.HistoryRequestModal="HistoryRequestModal",e.TicketDetailModal="TicketDetailModal",e.ReplyTicketModel="ReplyTicketModel",e.SubmitRequestModal="SubmitRequestModal"}(r||(r={}))}}]);