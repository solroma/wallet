"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[999],{786141:(e,t,r)=>{r.r(t),r.d(t,{VaultBase:()=>C,VaultBaseChainOnly:()=>S});var n=r(72579),i=r.n(n),o=r(256666),a=r(301842),u=r.n(a),s=r(634795),c=r(887371),l=r(545754),d=r(411987),f=r(695058),p=r(206391),y=r.n(p),h=r(636393),v=r(613549),g=r(292147),w=r(213208),m=r(992431),b=r(940915),T=r(278489),I=r(969618),O=r(398514),x=r(114540),E=r(348834).Buffer;function P(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function A(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?P(Object(r),!0).forEach((function(t){(0,o.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):P(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function k(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,f.default)(e);if(t){var i=(0,f.default)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,d.default)(this,r)}}if(w.default.isExtensionUi)throw new Error("engine/VaultBase is not allowed imported from ui");var S=function(e){(0,l.default)(r,e);var t=k(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.initProvider=function(){var e=(0,s.default)((function*(){var e=(yield this.getNetwork()).impl;u()(I.IMPL_MAPPINGS[e])||(this.engineProvider=yield this.engine.providerManager.getProvider(this.networkId))}));return function(){return e.apply(this,arguments)}}(),n.proxyJsonRPCCall=function(){var e=(0,s.default)((function*(e){throw new b.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.createClientFromURL=function(e){throw new b.NotImplemented},n.getEthersProvider=function(){var e=(0,s.default)((function*(){throw new b.NotImplemented}));return function(){return e.apply(this,arguments)}}(),n.getClientEndpointStatus=function(){var e=(0,s.default)((function*(e){var t=this.createClientFromURL(e),r=performance.now(),n=(yield t.getInfo()).bestBlockNumber;return{responseTime:Math.floor(performance.now()-r),latestBlock:n}}));return function(t){return e.apply(this,arguments)}}(),n.checkRpcBatchSupport=function(){var e=(0,s.default)((function*(e){throw new b.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.getDisplayAddress=function(){var e=(0,s.default)((function*(e){return Promise.resolve(e)}));return function(t){return e.apply(this,arguments)}}(),n.validateAddress=function(){var e=(0,s.default)((function*(e){var t=yield this.engineProvider.verifyAddress(e),r=t.normalizedAddress;if(!t.isValid||!r)throw new b.InvalidAddress;return Promise.resolve(r)}));return function(t){return e.apply(this,arguments)}}(),n.validateImportedCredential=function(e){return Promise.resolve(this.settings.importedAccountEnabled&&/^(0x)?[0-9a-zA-Z]{64}$/.test(e))},n.validateWatchingCredential=function(){var e=(0,s.default)((function*(e){return Promise.resolve(this.settings.watchingAccountEnabled&&(yield this.engineProvider.verifyAddress(e)).isValid)}));return function(t){return e.apply(this,arguments)}}(),n.validateTokenAddress=function(){var e=(0,s.default)((function*(e){var t=yield this.engineProvider.verifyTokenAddress(e),r=t.normalizedAddress;if(!t.isValid||"undefined"===typeof r)throw new b.InvalidTokenAddress;return Promise.resolve(r)}));return function(t){return e.apply(this,arguments)}}(),n.validateCanCreateNextAccount=function(){var e=(0,s.default)((function*(e,t){return Promise.resolve(!0)}));return function(t,r){return e.apply(this,arguments)}}(),n.checkAccountExistence=function(){var e=(0,s.default)((function*(e,t){return Promise.resolve(!0)}));return function(t,r){return e.apply(this,arguments)}}(),n.getBalances=function(){var e=(0,s.default)((function*(e,t,r){return(yield this.engine.providerManager.getClient(this.networkId)).getBalances(e.map((function(e){var t=e.address,r=e.tokenAddress;return{address:t,coin:A({},"string"===typeof r?{tokenAddress:r}:{})}})))}));return function(t,r,n){return e.apply(this,arguments)}}(),n.getFrozenBalance=function(){var e=(0,s.default)((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.password,e.useRecycleBalance,e.ignoreInscriptions,e.useCustomAddressesBalance;return 0}));return function(){return e.apply(this,arguments)}}(),n.fetchBalanceDetails=function(){var e=(0,s.default)((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.password,e.useRecycleBalance,e.ignoreInscriptions,e.useCustomAddressesBalance;return Promise.resolve(void 0)}));return function(){return e.apply(this,arguments)}}(),n.getTransactionStatuses=function(e){return this.engine.providerManager.getTransactionStatuses(this.networkId,e)},n.getTransactionFeeInNative=function(e){return Promise.resolve("")},n.isContractAddress=function(){var e=(0,s.default)((function*(e){return!1}));return function(t){return e.apply(this,arguments)}}(),n.getAccountNameInfoMap=function(){var e=(0,s.default)((function*(){var e=yield this.getNetwork();return(0,T.getAccountNameInfoByImpl)(e.impl)}));return function(){return e.apply(this,arguments)}}(),n.canAutoCreateNextAccount=function(){var e=(0,s.default)((function*(e){return Promise.resolve(!1)}));return function(t){return e.apply(this,arguments)}}(),n.filterAccounts=function(){var e=(0,s.default)((function*(e){var t=e.accounts;e.networkId;return Promise.resolve(t)}));return function(t){return e.apply(this,arguments)}}(),n.shouldChangeAccountWhenNetworkChanged=function(){var e=(0,s.default)((function*(e){e.previousNetwork,e.newNetwork,e.activeAccountId;return Promise.resolve({shouldReloadAccountList:!1,shouldChangeActiveAccount:!1})}));return function(t){return e.apply(this,arguments)}}(),n.getAccountNameInfosByImportedOrWatchingCredential=function(){var e=(0,s.default)((function*(e){return Promise.resolve([])}));return function(t){return e.apply(this,arguments)}}(),n.checkIsUnlimitedAllowance=function(){var e=(0,s.default)((function*(e){throw new b.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.checkIsApprovedForAll=function(){var e=(0,s.default)((function*(e){throw new b.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.checkIsBatchTransfer=function(){var e=(0,s.default)((function*(e){throw new b.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.getFeePricePerUnit=function(){var e=(0,s.default)((function*(){throw new b.NotImplemented}));return function(){return e.apply(this,arguments)}}(),n.fetchRpcChainId=function(){var e=(0,s.default)((function*(e){return null}));return function(t){return e.apply(this,arguments)}}(),n.getTxWaitingSeconds=function(){var e=(0,s.default)((function*(){return[]}));return function(){return e.apply(this,arguments)}}(),n.getUserNFTAssets=function(){var e=(0,s.default)((function*(e){e.serviceData;return Promise.resolve(void 0)}));return function(t){return e.apply(this,arguments)}}(),n.getTransactionDetail=function(){var e=(0,s.default)((function*(e){return Promise.resolve(void 0)}));return function(t){return e.apply(this,arguments)}}(),(0,c.default)(r)}(x.VaultContext),C=function(e){(0,l.default)(r,e);var t=k(r);function r(){for(var e,r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return(e=t.call.apply(t,[this].concat(n))).uuid=h.default.v4().toString(),e}var n=r.prototype;return n.init=function(){var e=(0,s.default)((function*(e){yield this.initProvider(),yield this.initKeyring(e)}));return function(t){return e.apply(this,arguments)}}(),n.initKeyring=function(){var e=(0,s.default)((function*(e){this.keyring=yield e.keyringCreator(this)}));return function(t){return e.apply(this,arguments)}}(),n.signTransaction=function(){var e=(0,s.default)((function*(e,t){return this.keyring.signTransaction(e,t)}));return function(t,r){return e.apply(this,arguments)}}(),n.signAndSendTransaction=function(){var e=(0,s.default)((function*(e,t,r){var n=yield this.signTransaction(e,t);return r?A(A({},n),{},{encodedTx:e.encodedTx}):this.broadcastTransaction(A(A({},n),{},{encodedTx:e.encodedTx}))}));return function(t,r,n){return e.apply(this,arguments)}}(),n.broadcastTransaction=function(){var e=(0,s.default)((function*(e,t){g.default.engine.info("broadcastTransaction START:",{rawTx:e.rawTx});var r=yield this.engine.providerManager.broadcastTransaction(this.networkId,e.rawTx,t);return g.default.engine.info("broadcastTransaction END:",{txid:r,rawTx:e.rawTx}),A(A({},e),{},{txid:r,encodedTx:e.encodedTx})}));return function(t,r){return e.apply(this,arguments)}}(),n.buildEncodedTxFromBatchTransfer=function(){var e=(0,s.default)((function*(e){throw new b.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.buildEncodedTxsFromSetApproveForAll=function(){var e=(0,s.default)((function*(e,t){throw new b.NotImplemented}));return function(t,r){return e.apply(this,arguments)}}(),n.activateAccount=function(){var e=(0,s.default)((function*(){throw new b.NotImplemented}));return function(){return e.apply(this,arguments)}}(),n.activateToken=function(){var e=(0,s.default)((function*(e,t){throw new b.NotImplemented}));return function(t,r){return e.apply(this,arguments)}}(),n.getTokenAllowance=function(){var e=(0,s.default)((function*(e,t){throw new b.NotImplemented}));return function(t,r){return e.apply(this,arguments)}}(),n.batchTokensAllowance=function(){var e=(0,s.default)((function*(e,t){throw new b.NotImplemented}));return function(t,r){return e.apply(this,arguments)}}(),n.getOutputAccount=function(){var e=(0,s.default)((function*(){var e=yield this.getDbAccount({noCache:!0});return{id:e.id,name:e.name,type:e.type,path:e.path,coinType:e.coinType,tokens:[],address:e.address,template:e.template,pubKey:i()(e,"pub","")}}));return function(){return e.apply(this,arguments)}}(),n.getAccountBalance=function(){var e=(0,s.default)((function*(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,i=(yield this.getDbAccount()).address;return this.getBalances((t?[{address:i}]:[]).concat(e.map((function(e){return{address:i,tokenAddress:e}}))),r,n)}));return function(t){return e.apply(this,arguments)}}(),n.updatePendingTxs=function(){var e=(0,s.default)((function*(e){throw new b.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.getAccountNonce=function(){var e=(0,s.default)((function*(){return Promise.resolve(null)}));return function(){return e.apply(this,arguments)}}(),n.fixActionDirection=function(){var e=(0,s.default)((function*(e){var t,r,n,i,o=e.action,a=e.accountAddress;(o.direction=O.IDecodedTxDirection.OTHER,o.type===O.IDecodedTxActionType.NATIVE_TRANSFER)&&(o.direction=yield this.buildTxActionDirection({from:(null==(t=o.nativeTransfer)?void 0:t.from)||"",to:(null==(r=o.nativeTransfer)?void 0:r.to)||"",address:a}));o.type===O.IDecodedTxActionType.TOKEN_TRANSFER&&(o.direction=yield this.buildTxActionDirection({from:(null==(n=o.tokenTransfer)?void 0:n.from)||"",to:(null==(i=o.tokenTransfer)?void 0:i.to)||"",address:a}));return o}));return function(t){return e.apply(this,arguments)}}(),n.fixDecodedTx=function(){var e=(0,s.default)((function*(e){var t,r;e.createdAt=null!=(t=e.createdAt)?t:Date.now();var n=null==(r=e.encodedTx)?void 0:r.nonce;e.nonce=u()(n)?e.nonce:new(y())(n).toNumber();for(var i=e.owner,o=0;o<e.actions.length;o+=1){var a=e.actions[o];yield this.fixActionDirection({action:a,accountAddress:i})}if(e.outputActions)for(var s=0;s<e.outputActions.length;s+=1){var c=e.outputActions[s];yield this.fixActionDirection({action:c,accountAddress:i})}return Promise.resolve(e)}));return function(t){return e.apply(this,arguments)}}(),n.fixHistoryTx=function(){var e=(0,s.default)((function*(e){return e.decodedTx=yield this.fixDecodedTx(e.decodedTx),Promise.resolve(e)}));return function(t){return e.apply(this,arguments)}}(),n.buildHistoryTx=function(){var e=(0,s.default)((function*(e){var t=e.historyTxToMerge,r=(e.encodedTx,e.decodedTx),n=e.signedTx,i=e.isSigner,o=e.isLocalCreated,a=(null==n?void 0:n.txid)||(null==r?void 0:r.txid)||"";if(!a)throw new Error("buildHistoryTx txid not found");var u=yield this.getAccountAddress();r.txid=a||r.txid,r.owner=u,i&&(r.signer=u),null!=n&&n.txKey&&(r.extraInfo?r.extraInfo.txKey=n.txKey:r.extraInfo={txKey:n.txKey});var s=A(A({id:`${this.networkId}_${a}_${this.accountId}`,isLocalCreated:Boolean(o)},t),{},{decodedTx:r});return s=yield this.fixHistoryTx(s),Promise.resolve(s)}));return function(t){return e.apply(this,arguments)}}(),n.checkIsScamHistoryTx=function(){var e=(0,s.default)((function*(e){return!1}));return function(t){return e.apply(this,arguments)}}(),n.fetchOnChainHistory=function(){var e=(0,s.default)((function*(e){throw new b.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.fixAddressCase=function(e){return Promise.resolve(e)},n.buildTxActionDirection=function(){var e=(0,s.default)((function*(e){var t=e.from,r=e.to,n=e.address;return t=yield this.fixAddressCase(t||""),r=yield this.fixAddressCase(r),n=yield this.fixAddressCase(n),t===r&&t===n?O.IDecodedTxDirection.SELF:t&&t===n?O.IDecodedTxDirection.OUT:r&&r===n?O.IDecodedTxDirection.IN:O.IDecodedTxDirection.OTHER}));return function(t){return e.apply(this,arguments)}}(),n.getNextNonce=function(){var e=(0,s.default)((function*(e,t){var r,n=null==(r=(yield this.engine.providerManager.getAddresses(e,[t.address]))[0])?void 0:r.nonce;if(u()(n))throw new b.OneKeyError("Get on-chain nonce failed.");yield this.engine.getHistory(e,t.id,void 0,!1);var i=yield m.default.history.getMaxPendingNonce({accountId:this.accountId,networkId:e}),o=yield m.default.history.getPendingNonceList({accountId:this.accountId,networkId:e}),a=Math.max(u()(i)?0:i+1,n);if(Number.isNaN(a)&&(a=n),a>n)for(var s=n;s<a;s+=1)if(!o.includes(s)){a=s;break}if(a<n&&(a=n),a-n>=v.HISTORY_CONSTS.PENDING_QUEUE_MAX_LENGTH)throw new b.PendingQueueTooLong(v.HISTORY_CONSTS.PENDING_QUEUE_MAX_LENGTH);return a}));return function(t,r){return e.apply(this,arguments)}}(),n.validateSendAmount=function(e,t,r){return Promise.resolve(!0)},n.notifyChainChanged=function(e,t){},n.getFetchBalanceAddress=function(e){return Promise.resolve(e.address)},n.getPrivateKeyByCredential=function(e){return Promise.resolve(E.from(e.startsWith("0x")?e.slice(2):e,"hex"))},n.getMinDepositAmount=function(){var e=(0,s.default)((function*(){return"0"}));return function(){return e.apply(this,arguments)}}(),n.specialCheckEncodedTx=function(){var e=(0,s.default)((function*(e){return{success:!0}}));return function(t){return e.apply(this,arguments)}}(),n.getAllUsedAddress=function(){var e=(0,s.default)((function*(){return Promise.resolve([])}));return function(){return e.apply(this,arguments)}}(),(0,c.default)(r)}(S)},700999:(e,t,r)=>{r.r(t),r.d(t,{default:()=>Fe});var n=r(968079),i=r(256666),o=r(545455),a=r.n(o),u=r(72579),s=r.n(u),c=r(196234),l=r(703440),d=r.n(l),f=r(634795),p=r(887371),y=r(545754),h=r(411987),v=r(695058),g=r(609650),w=r(206391),m=r.n(w),b=r(901187),T=r(740727),I=r(776553),O=r(292147),x=r(396564),E=r(940915),P=r(398514),A=r(392853),k=r(368652),S=r(786141),C=r(84658),D=r(153546),B=r(613549),N=r(398145),j=r(82406),R=r(115258),K="0x2::sui::SUI",H=g.SUI_TYPE_ARG;function F(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=(0,g.messageWithIntent)(g.IntentScope.TransactionData,e);return t?r:(0,R.blake2b)(r,{dkLen:32})}function M(e,t,r){return U.apply(this,arguments)}function U(){return(U=(0,f.default)((function*(e,t,r){var n;if(r instanceof Uint8Array)n=r;else{var i=g.TransactionBlock.from(r.rawTx);i.setSenderIfNotSet(t),n=yield i.build({provider:e})}return n}))).apply(this,arguments)}var _=function(e){return e?e.replace(/_/g," "):""};function L(){return(L=(0,f.default)((function*(e){var t;if(g.TransactionBlock.is(e.transactionBlock))e.transactionBlock.setSenderIfNotSet(e.sender),t=yield e.transactionBlock.build({provider:e.provider});else if("string"===typeof e.transactionBlock)t=(0,g.fromB64)(e.transactionBlock);else{if(!(e.transactionBlock instanceof Uint8Array))throw new Error("Unknown transaction format");t=e.transactionBlock}return e.provider.dryRunTransactionBlock({transactionBlock:t})}))).apply(this,arguments)}function G(e){if(e!==g.SUI_TYPE_ARG){var t=e.split("::"),r=(0,c.default)(t,3),n=r[0],i=r[1],o=r[2];if(i&&o)try{return`${(0,g.normalizeSuiAddress)(n).toLowerCase()}::${i}::${o}`}catch(a){}}return e}var $=r(348834).Buffer;function W(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function V(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?W(Object(r),!0).forEach((function(t){(0,i.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):W(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function z(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,v.default)(e);if(t){var i=(0,v.default)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,h.default)(this,r)}}var Y=`m/44'/${B.COINTYPE_SUI}'`,q=function(e){(0,y.default)(r,e);var t=z(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.getPublicKey=function(){var e=(0,f.default)((function*(e,t,r){var n,i=yield this.getHardwareSDKInstance(),o=yield this.getWalletPassphraseState();try{n=yield i.suiGetPublicKey(e,t,V({bundle:r.map((function(e){return{path:e}}))},o))}catch(a){throw O.default.common.error(a),new E.OneKeyHardwareError(a)}if(!n.success)throw O.default.common.error(n.payload),(0,D.convertDeviceError)(n.payload);return n.payload.map((function(e){return e.publicKey})).filter((function(e){return!!e}))}));return function(t,r,n){return e.apply(this,arguments)}}(),n.prepareAccounts=function(){var e=(0,f.default)((function*(e){var t,r=e.type,n=e.indexes,i=e.names,o=n.map((function(e){return`${Y}/${e}'/0'/0'`})),a="SEARCH_ACCOUNTS"===r,u=yield this.getHardwareSDKInstance(),s=yield this.getHardwareInfo(),c=s.connectId,l=s.deviceId,d=yield this.getWalletPassphraseState();try{t=yield u.suiGetAddress(c,l,V({bundle:o.map((function(e){return{path:e,showOnOneKey:false}}))},d))}catch(I){throw O.default.common.error(I),new E.OneKeyHardwareError(I)}if(!t.success)throw O.default.common.error(t.payload),(0,D.convertDeviceError)(t.payload);var f,p,y=[];a||(!(null==(f=t.payload)||null==(p=f[0])||!p.publicKey)||(y=yield this.getPublicKey(c,l,o)));var h=[],v=0;for(var g of t.payload){var w=g.address,m=g.path,b=g.publicKey;if(w){var T=(i||[])[v]||`SUI #${n[v]+1}`;h.push({id:`${this.walletId}--${m}`,name:T,type:N.AccountType.SIMPLE,path:m,coinType:B.COINTYPE_SUI,pub:null!=b?b:y[v]||"",address:(0,k.addHexPrefix)(w)}),v+=1}}return h}));return function(t){return e.apply(this,arguments)}}(),n.getAddress=function(){var e=(0,f.default)((function*(e){var t,r=yield this.getHardwareSDKInstance(),n=yield this.getHardwareInfo(),i=n.connectId,o=n.deviceId,a=yield this.getWalletPassphraseState(),u=yield r.suiGetAddress(i,o,V({path:e.path,showOnOneKey:e.showOnOneKey},a));if(u.success&&null!=(t=u.payload)&&t.address)return u.payload.address.toLowerCase();throw(0,D.convertDeviceError)(u.payload)}));return function(t){return e.apply(this,arguments)}}(),n.batchGetAddress=function(){var e=(0,f.default)((function*(e){var t=yield this.getHardwareSDKInstance(),r=yield this.getHardwareInfo(),n=r.connectId,i=r.deviceId,o=yield this.getWalletPassphraseState(),a=yield t.suiGetAddress(n,i,V(V({},o),{},{bundle:e.map((function(e){return{path:e.path,showOnOneKey:!!e.showOnOneKey}}))}));if(!a.success)throw(0,D.convertDeviceError)(a.payload);return a.payload.map((function(e){var t,r;return{path:null!=(t=e.path)?t:"",address:null!=(r=e.address)?r:""}}))}));return function(t){return e.apply(this,arguments)}}(),n.signTransaction=function(){var e=(0,f.default)((function*(e,t){var r,n;O.default.common.info("signTransaction",e);var i=yield this.getDbAccount(),o=(yield this.engine.getNetwork(this.networkId)).rpcURL,a=new g.JsonRpcProvider(new g.Connection({fullnode:o})),u=i.address,s=null==(r=e.inputs)||null==(n=r[0])?void 0:n.publicKey;if(!s)throw new E.OneKeyInternalError("Unable to get sender public key.");var c=e.payload.encodedTx,l=yield M(a,u,c),d=F(l,!0),f=yield this.getHardwareInfo(),p=f.connectId,y=f.deviceId,h=yield this.getWalletPassphraseState(),v=yield this.getHardwareSDKInstance(),w=yield v.suiSignTransaction(p,y,V({path:i.path,rawTx:(0,k.hexlify)($.from(d))},h));if(w.success){var m=w.payload.signature,b=(0,g.toSerializedSignature)({signatureScheme:"ED25519",signature:(0,C.hexToBytes)(m),pubKey:new g.Ed25519PublicKey((0,C.hexToBytes)(s))});return{txid:"",rawTx:(0,g.toB64)(l),signatureScheme:"ed25519",signature:b,publicKey:(0,k.addHexPrefix)(s)}}throw(0,D.convertDeviceError)(w.payload)}));return function(t,r){return e.apply(this,arguments)}}(),n.signMessage=function(){var e=(0,f.default)((function*(e){O.default.common.info("signMessage",e);var t=yield this.getDbAccount(),r=yield this.getHardwareSDKInstance(),n=yield this.getHardwareInfo(),i=n.connectId,o=n.deviceId,a=yield this.getWalletPassphraseState();return Promise.all(e.map(function(){var e=(0,f.default)((function*(e){var n=yield r.suiSignMessage(i,o,V({path:t.path,messageHex:(0,k.hexlify)((0,C.hexToBytes)(e.message))},a));if(!n.success)throw(0,D.convertDeviceError)(n.payload);return(0,g.toSerializedSignature)({signatureScheme:"ED25519",signature:(0,C.hexToBytes)(n.payload.signature),pubKey:new g.Ed25519PublicKey((0,C.hexToBytes)(t.pub))})}));return function(t){return e.apply(this,arguments)}}()))}));return function(t){return e.apply(this,arguments)}}(),(0,p.default)(r)}(j.KeyringHardwareBase),J=r(605851),Q=r(794292),X=r(810887),Z=r(348834).Buffer;function ee(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,v.default)(e);if(t){var i=(0,v.default)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,h.default)(this,r)}}var te=`m/44'/${B.COINTYPE_SUI}'`,re=function(e){(0,y.default)(r,e);var t=ee(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.getSigners=function(){var e=(0,f.default)((function*(e,t){var r,n=yield this.getDbAccount();if(1!==t.length)throw new E.OneKeyInternalError("Sui signers number should be 1.");if(t[0]!==n.address)throw new E.OneKeyInternalError("Wrong address required for signing.");var i=(yield this.getPrivateKeys(e))[n.path];if("undefined"===typeof i)throw new E.OneKeyInternalError("Unable to get signer.");return(r={})[n.address]=new Q.Signer(i,e,"ed25519"),r}));return function(t,r){return e.apply(this,arguments)}}(),n.prepareAccounts=function(){var e=(0,f.default)((function*(e){var t=e.password,r=e.indexes,n=e.names,i=(yield this.engine.dbApi.getCredential(this.walletId,t)).seed,o=(0,J.batchGetPublicKeys)("ed25519",i,t,te,r.map((function(e){return`${e.toString()}'/0'/0'`})));if(o.length!==r.length)throw new E.OneKeyInternalError("Unable to get publick key.");var a=[],u=0;for(var s of o){var c=s.path,l=s.extendedKey.key,d=l.toString("hex"),f=new g.Ed25519PublicKey(l),p=(0,k.addHexPrefix)(f.toSuiAddress()),y=(n||[])[u]||`SUI #${r[u]+1}`;a.push({id:`${this.walletId}--${c}`,name:y,type:N.AccountType.SIMPLE,path:c,coinType:B.COINTYPE_SUI,pub:d,address:p}),u+=1}return a}));return function(t){return e.apply(this,arguments)}}(),n.signTransaction=function(){var e=(0,f.default)((function*(e,t){var r,n;O.default.common.info("signTransaction result",e);var i=yield this.getDbAccount(),o=(yield this.engine.getNetwork(this.networkId)).rpcURL,a=new g.JsonRpcProvider(new g.Connection({fullnode:o})),u=i.address,s=(yield this.getSigners(t.password||"",[u]))[u],l=null==(r=e.inputs)||null==(n=r[0])?void 0:n.publicKey;if(!l)throw new E.OneKeyInternalError("Unable to get sender public key.");var d=e.payload.encodedTx,f=yield M(a,u,d),p=yield s.sign(Z.from(F(f))),y=(0,c.default)(p,1)[0],h=(0,g.toSerializedSignature)({signatureScheme:"ED25519",signature:y,pubKey:new g.Ed25519PublicKey((0,C.hexToBytes)(l))});return{txid:"",rawTx:(0,g.toB64)(f),signatureScheme:"ed25519",signature:h,publicKey:(0,k.addHexPrefix)(l)}}));return function(t,r){return e.apply(this,arguments)}}(),n.signMessage=function(){var e=(0,f.default)((function*(e,t){var r=yield this.getDbAccount(),n=(yield this.getSigners(t.password||"",[r.address]))[r.address];return Promise.all(e.map(function(){var e=(0,f.default)((function*(e){var t=(0,g.messageWithIntent)(g.IntentScope.PersonalMessage,g.bcs.ser(["vector","u8"],(0,C.hexToBytes)(e.message)).toBytes()),i=(0,R.blake2b)(t,{dkLen:32}),o=yield n.sign(Z.from(i)),a=(0,c.default)(o,1)[0];return(0,g.toSerializedSignature)({signatureScheme:"ED25519",signature:a,pubKey:new g.Ed25519PublicKey((0,C.hexToBytes)(r.pub))})}));return function(t){return e.apply(this,arguments)}}()))}));return function(t,r){return e.apply(this,arguments)}}(),(0,p.default)(r)}(X.KeyringHdBase),ne=r(478557),ie=r(255942),oe=r(348834).Buffer;function ae(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,v.default)(e);if(t){var i=(0,v.default)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,h.default)(this,r)}}var ue=function(e){(0,y.default)(r,e);var t=ae(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.getSigners=function(){var e=(0,f.default)((function*(e,t){var r,n=yield this.getDbAccount();if(1!==t.length)throw new E.OneKeyInternalError("Starcoin signers number should be 1.");if(t[0]!==n.address)throw new E.OneKeyInternalError("Wrong address required for signing.");var i=(yield this.getPrivateKeys(e))[n.path];if("undefined"===typeof i)throw new E.OneKeyInternalError("Unable to get signer.");return(r={})[n.address]=new Q.Signer(i,e,"ed25519"),r}));return function(t,r){return e.apply(this,arguments)}}(),n.prepareAccounts=function(){var e=(0,f.default)((function*(e){var t=e.privateKey,r=e.name;if(32!==t.length)throw new E.OneKeyInternalError("Invalid private key.");var n=ne.ed25519.publicFromPrivate(t),i=n.toString("hex"),o=new g.Ed25519PublicKey(n),a=(0,k.addHexPrefix)(o.toSuiAddress());return Promise.resolve([{id:`imported--${B.COINTYPE_SUI}--${i}`,name:r||"",type:N.AccountType.SIMPLE,path:"",coinType:B.COINTYPE_SUI,pub:i,address:a}])}));return function(t){return e.apply(this,arguments)}}(),n.signTransaction=function(){var e=(0,f.default)((function*(e,t){var r,n,i=yield this.getDbAccount(),o=(yield this.engine.getNetwork(this.networkId)).rpcURL,a=new g.JsonRpcProvider(new g.Connection({fullnode:o})),u=i.address,s=(yield this.getSigners(t.password||"",[i.address]))[u],l=null==(r=e.inputs)||null==(n=r[0])?void 0:n.publicKey;if(!l)throw new E.OneKeyInternalError("Unable to get sender public key.");var d=e.payload.encodedTx,f=yield M(a,u,d),p=F(f),y=yield s.sign(oe.from(p)),h=(0,c.default)(y,1)[0],v=(0,g.toSerializedSignature)({signatureScheme:"ED25519",signature:h,pubKey:new g.Ed25519PublicKey((0,C.hexToBytes)(l))});return{txid:"",rawTx:(0,g.toB64)(f),signatureScheme:"ed25519",signature:v,publicKey:(0,k.addHexPrefix)(l)}}));return function(t,r){return e.apply(this,arguments)}}(),n.signMessage=function(){var e=(0,f.default)((function*(e,t){var r=yield this.getDbAccount(),n=(yield this.getSigners(t.password||"",[r.address]))[r.address];return Promise.all(e.map(function(){var e=(0,f.default)((function*(e){var t=(0,g.messageWithIntent)(g.IntentScope.PersonalMessage,(0,C.hexToBytes)(e.message)),i=(0,R.blake2b)(t,{dkLen:32}),o=yield n.sign(oe.from(i)),a=(0,c.default)(o,1)[0];return(0,g.toSerializedSignature)({signatureScheme:"ED25519",signature:a,pubKey:new g.Ed25519PublicKey((0,C.hexToBytes)(r.pub))})}));return function(t){return e.apply(this,arguments)}}()))}));return function(t,r){return e.apply(this,arguments)}}(),(0,p.default)(r)}(ie.KeyringImportedBase);function se(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,v.default)(e);if(t){var i=(0,v.default)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,h.default)(this,r)}}var ce=function(e){(0,y.default)(r,e);var t=se(r);function r(){return t.apply(this,arguments)}return r.prototype.prepareAccounts=function(){var e=(0,f.default)((function*(e){var t=e.name,r=e.target,n=e.accountIdPrefix,i=yield this.vault.validateAddress(r);if("undefined"===typeof i)throw new E.InvalidAddress;return Promise.resolve([{id:`${n}--${B.COINTYPE_SUI}--${r}`,name:t||"",type:N.AccountType.SIMPLE,path:"",coinType:B.COINTYPE_SUI,pub:"",address:i}])}));return function(t){return e.apply(this,arguments)}}(),(0,p.default)(r)}(r(701625).KeyringWatchingBase);function le(e){return de.apply(this,arguments)}function de(){return(de=(0,f.default)((function*(e){var t,r,n,i,o=new Map,a=null!=(t=null==(r=e.payments)?void 0:r.map((function(e){return{objectId:e.objectId,version:`${e.version}`}})))?t:[],u=null!=(n=yield null==(i=e.client)?void 0:i.tryMultiGetPastObjects({past_objects:a,options:{showType:!0,showOwner:!0,showContent:!0,showPreviousTransaction:!1,showDisplay:!1,showBcs:!1,showStorageRebate:!1}}))?n:[];for(var s of u)if("VersionNotFound"!==s.status){var c,l=null==(c=s.details.type)?void 0:c.match(/<([^>]+)>/);if(l){var d=l[1];if(s.details.type.startsWith("0x2::coin::Coin<")){var f,p=null!=(f=o.get(d))?f:BigInt(0);o.set(d,p+BigInt(s.details.content.fields.balance))}}}return o}))).apply(this,arguments)}function fe(){return(fe=(0,f.default)((function*(e,t,r){var n=(0,c.default)(e,2),i=n[0],o=n[1],a="",u=[];if("string"===typeof i&&"GasCoin"===i)a=K;else if("object"===typeof i&&"Input"in i){var s=t[i.Input];if("object"===s.type&&"immOrOwnedObject"===s.objectType){var l=yield null==r?void 0:r.tryGetPastObject({object_id:s.objectId,version:new(m())(s.version).toNumber(),options:{showType:!0,showOwner:!0,showContent:!0,showPreviousTransaction:!1,showDisplay:!1,showBcs:!1,showStorageRebate:!1}});if("VersionNotFound"!==(null==l?void 0:l.status)){var d=null==l?void 0:l.details.type.match(/<([^>]+)>/);if(d){var f=d[1];null!=l&&l.details.type.startsWith("0x2::coin::Coin<")&&(a=f)}}}}if(Array.isArray(o))for(var p of o)"object"===typeof p&&"Input"in p&&u.push(t[p.Input]);return{coin:a,amounts:u}}))).apply(this,arguments)}function pe(e){return ye.apply(this,arguments)}function ye(){return ye=(0,f.default)((function*(e){var t=new Map,r=yield function(e,t,r){return fe.apply(this,arguments)}(e.argument,e.inputs,e.client),n=r.coin,i=r.amounts;for(var o of i)"pure"===(null==o?void 0:o.type)&&"u64"===o.valueType&&t.set(n,o.value);return t})),ye.apply(this,arguments)}function he(){return(he=(0,f.default)((function*(e){var t="",r=new Map,n=(0,c.default)(e.argument,2),i=n[0],o=n[1];if(Array.isArray(i))for(var a=0;a<i.length;a+=1){var u=i[a];if(0===a&&"string"===typeof u&&"GasCoin"===u){var s=yield le({payments:e.payments,client:e.client});for(var l of s.entries()){var d=(0,c.default)(l,2),f=d[0],p=d[1];r.has(f)?r.set(f,r.get(f)+p):r.set(f,p)}}if("object"===typeof u&&"Result"in u){var y=e.actions[u.Result];if("SplitCoins"in y){var h=yield pe({argument:y.SplitCoins,inputs:e.inputs,client:e.client});for(var v of h.entries()){var g=(0,c.default)(v,2),w=g[0],m=g[1];r.has(w)?r.set(w,h.get(w)+m):r.set(w,m)}}}}if("object"===typeof o&&"Input"in o){var b=e.inputs[o.Input];"address"===b.valueType&&(t=b.value)}return{receive:t,amounts:r}}))).apply(this,arguments)}var ve=r(871200);function ge(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,v.default)(e);if(t){var i=(0,v.default)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,h.default)(this,r)}}var we=(0,ve.object)({balance:(0,ve.string)(),id:(0,ve.string)()}),me=(0,ve.object)({dataType:(0,ve.string)(),type:(0,ve.string)(),hasPublicTransfer:(0,ve.boolean)(),fields:we}),be=(0,ve.object)({status:(0,ve.string)(),details:(0,ve.object)({objectId:(0,ve.string)(),version:(0,ve.string)(),digest:(0,ve.string)(),type:(0,ve.string)(),owner:(0,ve.object)({AddressOwner:(0,ve.string)()}),content:me})}),Te=function(e){(0,y.default)(r,e);var t=ge(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.tryGetPastObject=function(){var e=(0,f.default)((function*(e){return this.client.requestWithType("sui_tryGetPastObject",[e.object_id,e.version,e.options],be)}));return function(t){return e.apply(this,arguments)}}(),n.tryMultiGetPastObjects=function(){var e=(0,f.default)((function*(e){return this.client.requestWithType("sui_tryMultiGetPastObjects",[e.past_objects,e.options],(0,ve.array)(be))}));return function(t){return e.apply(this,arguments)}}(),(0,p.default)(r)}(g.JsonRpcProvider),Ie=r(514607),Oe=r(746840);function xe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Ee(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?xe(Object(r),!0).forEach((function(t){(0,i.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):xe(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Pe=50;function Ae(e,t,r){return ke.apply(this,arguments)}function ke(){return(ke=(0,f.default)((function*(e,t,r){var n=null,i=[];do{var o=yield e.getCoins({owner:t,coinType:r,cursor:n,limit:Pe}),a=o.data,u=o.nextCursor;if(!a||!a.length)break;for(var s of a){var c=G(s.coinType);i.push(Ee(Ee({},s),{},{coinType:c}))}n=u}while(n);return i}))).apply(this,arguments)}function Se(e){return Ce.apply(this,arguments)}function Ce(){return(Ce=(0,f.default)((function*(e){var t=e.client,r=e.address,n=e.to,i=e.amount,o=e.coinType,a=void 0===o?g.SUI_TYPE_ARG:o,u=e.isPayAllSui,s=new g.TransactionBlock,c=yield Ae(t,r,a),l=null==c?void 0:c.filter((function(e){return!e.lockedUntilEpoch}));if(u&&a===g.SUI_TYPE_ARG)return s.transferObjects([s.gas],s.pure(n)),s.setGasPayment(l.filter((function(e){return G(e.coinType)===G(a)})).map((function(e){return{objectId:e.coinObjectId,digest:e.digest,version:e.version}}))),s;var d=l.filter((function(e){return G(e.coinType)===G(a)})),f=(0,Oe.default)(d),p=f[0],y=f.slice(1);if(a===g.SUI_TYPE_ARG){var h=s.splitCoins(s.gas,[s.pure(i)]);s.transferObjects([h],s.pure(n))}else{var v=s.object(p.coinObjectId);y.length&&s.mergeCoins(v,y.map((function(e){return s.object(e.coinObjectId)})));var w=s.splitCoins(v,[s.pure(i)]);s.transferObjects([w],s.pure(n))}return s}))).apply(this,arguments)}function De(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Be(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?De(Object(r),!0).forEach((function(t){(0,i.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):De(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Ne(e,t,r,n,i){return je.apply(this,arguments)}function je(){return(je=(0,f.default)((function*(e,t,r,n,i){if("TransferObjects"!==t.kind)throw new Error("Invalid transaction kind");var o=new(m())("0"),a=H;for(var u of t.objects)if("GasCoin"===u.kind&&i){a=H;var c=null==i?void 0:i.reduce((function(e,t){return t.objectId&&e.push(t.objectId),e}),new Array(n.length));o=(yield e.multiGetObjects({ids:c,options:{showType:!0,showOwner:!0,showContent:!0}})).reduce((function(e,t){var r,n=e,i=null==(r=t.data)?void 0:r.content;if("moveObject"===(null==i?void 0:i.dataType)){var o,a=null==(o=i.fields)?void 0:o.balance;n=n.plus(new(m())(a))}return n}),new(m())(0))}else if("Result"===u.kind){var l=r[u.index];if("SplitCoins"===l.kind&&"Input"===l.coin.kind){var d,f,p=yield e.getObject({id:l.coin.value,options:{showType:!0,showOwner:!0,showContent:!0}}),y=null==(d=p.data)||null==(f=d.type)?void 0:f.match(/<([^>]+)>/);if(y){var h,v,w=y[1];null!=(h=p.data)&&null!=(v=h.type)&&v.startsWith("0x2::coin::Coin<")&&(a=w)}o=l.amounts.reduce((function(e,t){var r=e;return"Input"===t.kind&&(r=r.plus(new(m())(t.value))),r}),new(m())(0));break}}else if("Input"===u.kind){var b=n[u.index];if("pure"===b.type){o=new(m())(b.value);break}b.type}else if("NestedResult"===u.kind){var T,I=n[u.index];o.plus(new(m())(null!=(T=I.value)?T:"0"))}var O="";if("Input"===t.address.kind){var x=s()(t.address.value,"Pure",void 0);if(x)try{O=g.builder.de("vector<u8>",x)}catch(A){try{O=x.toString()}catch(k){}}else O=t.address.value}var E=a===H;return{type:E?P.IDecodedTxActionType.NATIVE_TRANSFER:P.IDecodedTxActionType.TOKEN_TRANSFER,isNative:E,coinType:a,amount:o,recipient:O}}))).apply(this,arguments)}function Re(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Ke(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Re(Object(r),!0).forEach((function(t){(0,i.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Re(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function He(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,v.default)(e);if(t){var i=(0,v.default)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,h.default)(this,r)}}var Fe=function(e){(0,y.default)(r,e);var t=He(r);function r(){for(var e,r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return(e=t.call.apply(t,[this].concat(n))).keyringMap={hd:re,hw:q,imported:ue,watching:ce,external:ce},e.settings=Ie.default,e.getClientCache=(0,x.memoizee)(function(){var t=(0,f.default)((function*(t){return e.getSuiClient(t)}));return function(e){return t.apply(this,arguments)}}(),{promise:!0,max:1,maxAge:(0,I.getTimeDurationMs)({minute:3})}),e}var i=r.prototype;return i.getClient=function(){var e=(0,f.default)((function*(){var e=(yield this.engine.getNetwork(this.networkId)).rpcURL;return this.getClientCache(e)}));return function(){return e.apply(this,arguments)}}(),i.getSuiClient=function(e){return new Te(new g.Connection({fullnode:e,faucet:"https://faucet.testnet.sui.io/gas"}))},i.getClientEndpointStatus=function(){var e=(0,f.default)((function*(e){var t=yield this.getClientCache(e),r=performance.now(),n=yield t.getTotalTransactionBlocks();return{responseTime:Math.floor(performance.now()-r),latestBlock:Number(n)}}));return function(t){return e.apply(this,arguments)}}(),i._getPublicKey=function(){var e=(0,f.default)((function*(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).prefix,t=void 0===e||e,r=(yield this.getDbAccount()).pub;return t&&(r=(0,k.addHexPrefix)(r)),Promise.resolve(r)}));return function(){return e.apply(this,arguments)}}(),i.validateAddress=function(){var e=(0,f.default)((function*(e){return(0,g.isValidSuiAddress)(e)?Promise.resolve(e):Promise.reject(new E.InvalidAddress)}));return function(t){return e.apply(this,arguments)}}(),i.validateWatchingCredential=function(e){var t=this;return this.validateAddress(e).then((function(e){return t.settings.watchingAccountEnabled&&!!e})).catch((function(){return!1}))},i.checkAccountExistence=function(){var e=(0,f.default)((function*(e){var t=yield this.getClient();return!(yield t.getObject({id:(0,k.stripHexPrefix)(e)})).error}));return function(t){return e.apply(this,arguments)}}(),i.getBalances=function(){var e=(0,f.default)((function*(e){var t=yield this.getClient(),r=d()(e,(function(e){return e.address})),n=new Map;return yield Promise.all(Object.entries(r).map(function(){var e=(0,f.default)((function*(e){var r=(0,c.default)(e,2),i=r[0],o=r[1];try{var a=yield t.getAllBalances({owner:i}),u={};for(var s of a)u[s.coinType]=s.totalBalance.toString();o.forEach((function(e){var t,r,o=e.tokenAddress,a=null!=o?G(o):H,s=(null!=o?o:H).replace(/^0x0*/,"0x"),c=null!=(t=null==(r=u[s])?void 0:r.toString())?t:"0",l=`${i}-${a}`;try{n.set(l,new(m())(c))}catch(d){}}))}catch(l){}}));return function(t){return e.apply(this,arguments)}}())),e.map((function(e){var t,r=e.address,i=e.tokenAddress,o=`${r}-${null!=i?i:H}`;return null!=(t=n.get(o))?t:new(m())(0)}))}));return function(t){return e.apply(this,arguments)}}(),i.activateAccount=function(){var e=(0,f.default)((function*(){var e=yield this.getClient();yield e.requestSuiFromFaucet(yield this.getAccountAddress())}));return function(){return e.apply(this,arguments)}}(),i.fetchTokenInfos=function(){var e=(0,f.default)((function*(e){var t=yield this.getClient();return Promise.all(e.map(function(){var e=(0,f.default)((function*(e){try{var r=yield t.getCoinMetadata({coinType:G(e)});if(!r)return;return yield Promise.resolve({name:r.name,symbol:r.symbol,decimals:r.decimals})}catch(n){}}));return function(t){return e.apply(this,arguments)}}()))}));return function(t){return e.apply(this,arguments)}}(),i.validateTokenAddress=function(){var e=(0,f.default)((function*(e){var t=e.split("::"),r=(0,c.default)(t,3),n=r[0],i=r[1],o=r[2];if(i&&o)try{return`${(yield this.validateAddress(n)).toLowerCase()}::${i}::${o}`}catch(a){}throw new E.InvalidTokenAddress}));return function(t){return e.apply(this,arguments)}}(),i.attachFeeInfoToEncodedTx=function(){var e=(0,f.default)((function*(e){var t=e.feeInfoValue,r=t.price,n=t.limit;if("undefined"!==typeof r&&"string"!==typeof r)throw new E.OneKeyInternalError("Invalid gas price.");if("string"!==typeof n)throw new E.OneKeyInternalError("Invalid fee limit");var i=g.TransactionBlock.from(e.encodedTx.rawTx);return i.blockData.gasConfig.price=r,i.blockData.gasConfig.budget=n,Promise.resolve({rawTx:i.serialize(),feeInfo:{price:r,limit:n}})}));return function(t){return e.apply(this,arguments)}}(),i.decodedTxToLegacy=function(e){return Promise.resolve({})},i.decodeTx=function(){var e=(0,f.default)((function*(e,t){var r=yield this.engine.getNetwork(this.networkId),n=yield this.getDbAccount(),i=yield this.engine.getNativeTokenInfo(this.networkId),o=yield this.getClient(),a=yield this.getAccountAddress(),u=g.TransactionBlock.from(e.rawTx);if(!u)throw new E.OneKeyError("Invalid transaction data.");var c,l=[],d=u.blockData,f=d.inputs,p=d.transactions,y=d.gasConfig,h="0";u.blockData.gasConfig.budget&&(h=null!=(c=u.blockData.gasConfig.budget)?c:"0");try{for(var v of p)switch(v.kind){case"TransferObjects":var w=yield Ne(o,v,p,f,y.payment);if(w&&"string"===typeof w.recipient){var b,T,I,O,x="nativeTransfer";if(!w.isNative){if(x="tokenTransfer",!w.coinType)throw new E.OneKeyInternalError("Invalid coin type");if(!(i=yield this.engine.ensureTokenInDB(this.networkId,G(w.coinType))))throw new E.OneKeyInternalError("Invalid coin type")}l.push(((O={type:w.type})[x]={tokenInfo:i,from:a,to:w.recipient,amount:new(m())(null!=(b=w.amount.toString())?b:"0").shiftedBy(-i.decimals).toFixed(),amountValue:null!=(T=null==(I=w.amount)?void 0:I.toString())?T:"0",extraInfo:null},O))}break;case"MoveCall":var k;if("MoveCall"!==v.kind)break;var S=[],C=void 0;for(var D of null!=(B=v.arguments)?B:[]){var B;switch(D.kind){case"Input":case"Result":case"NestedResult":if("pure"===(C=f[D.index]).type){var N=s()(C.value,"Pure",C.value);try{S.push(g.builder.de("vector<u8>",N))}catch(K){try{S.push(N.toString())}catch(H){}}}else if("object"===C.type)try{S.push(JSON.stringify(C.value))}catch(K){S.push("unable to parse object")}}}var j=_(v.target).split("::");l.push({type:P.IDecodedTxActionType.FUNCTION_CALL,functionCall:{target:`${null==j?void 0:j[1]}::${null==j?void 0:j[2]}`,functionName:null!=(k=null==j?void 0:j[0])?k:"",args:S,extraInfo:null}});break;case"MakeMoveVec":case"SplitCoins":case"MergeCoins":break;default:l.push({type:P.IDecodedTxActionType.UNKNOWN,direction:P.IDecodedTxDirection.OTHER,unknownAction:{extraInfo:{}}})}}catch(K){}var R={txid:"",owner:n.address,signer:n.address,nonce:0,actions:l,status:P.IDecodedTxStatus.Pending,networkId:this.networkId,accountId:this.accountId,feeInfo:{price:(0,A.convertFeeValueToGwei)({value:"1",network:r}),limit:h},extraInfo:null,encodedTx:e};return Promise.resolve(R)}));return function(t,r){return e.apply(this,arguments)}}(),i.buildEncodedTxFromTransfer=function(){var e=(0,f.default)((function*(e){if(!e.to)throw new Error("Invalid transferInfo.to params");var t,r=e.to,n=e.amount,i=e.token,o=(yield this.getDbAccount()).address,u=(0,k.addHexPrefix)(r),s=(0,k.addHexPrefix)(o),c=null==i||a()(i);if(c){var l=yield this.getNetwork();t=new(m())(n).shiftedBy(l.decimals).toFixed()}else{var d=yield this.engine.ensureTokenInDB(this.networkId,i);if("undefined"===typeof d)throw new E.OneKeyInternalError("Failed to get token info.");t=new(m())(n).shiftedBy(d.decimals).toFixed()}var f=yield this.getClient(),p=c?H:i;return{rawTx:(yield Se({client:f,address:s,to:u,amount:t,coinType:G(p)})).serialize()}}));return function(t){return e.apply(this,arguments)}}(),i.buildEncodedTxFromApprove=function(e){throw new E.NotImplemented},i.updateEncodedTxTokenApprove=function(e,t){throw new E.NotImplemented},i.updateEncodedTx=function(){var e=(0,f.default)((function*(e,t,r){if("transfer"===r.type){var n,i=e.rawTx,o=g.TransactionBlock.from(i),a=o.blockData.transactions.find((function(e){return"TransferObjects"===e.kind?e:void 0}));if(!a||"TransferObjects"!==a.kind)return Promise.resolve(e);var u=yield this.getClient(),c=yield Se({client:u,address:null!=(n=o.blockData.sender)?n:yield this.getAccountAddress(),to:s()(a.address,"value"),amount:t.amount,coinType:H,isPayAllSui:!0});return Ke(Ke({},e),{},{rawTx:c.serialize()})}return Promise.resolve(e)}));return function(t,r,n){return e.apply(this,arguments)}}(),i.buildUnsignedTxFromEncodedTx=function(){var e=(0,f.default)((function*(e){var t=e,r=yield this.getDbAccount();return Promise.resolve({inputs:[{address:(0,k.stripHexPrefix)(r.address),value:new(m())(0),publicKey:(0,k.stripHexPrefix)(r.pub)}],outputs:[],payload:{encodedTx:t},encodedTx:t})}));return function(t){return e.apply(this,arguments)}}(),i.tryFixFeePayment=function(){var e=(0,f.default)((function*(e){var t=g.TransactionBlock.from(e.rawTx);if(!t.blockData.gasConfig.payment){var r,n=yield this.getClient(),i=yield this.getAccountAddress(),o=yield Ae(n,i,null),a=o[0];t.blockData.gasConfig.payment=[{objectId:a.coinObjectId,version:a.version,digest:a.digest}];var u={rawTx:g.TransactionBlock.from(t.serialize()).serialize()},s=yield this.fetchFeeInfo(u),c=new(m())(null!=(r=s.limit)?r:"0").toNumber(),l=[],d=new(m())(0);do{var f=o.shift();if(!f)throw new E.OneKeyInternalError("Insufficient balance");var p,y=new(m())(null!=(p=null==f?void 0:f.balance)?p:"0");d=d.plus(y),l.push(f)}while(d.isLessThan(c));return t.blockData.gasConfig.payment=l.map((function(e){return{objectId:e.coinObjectId,version:e.version,digest:e.digest}})),Ke(Ke({},e),{},{rawTx:g.TransactionBlock.from(t.serialize()).serialize()})}return e}));return function(t){return e.apply(this,arguments)}}(),i.fetchFeeInfo=function(){var e=(0,f.default)((function*(e){var t,r,n=yield this.getClient(),i=yield this.getNetwork(),o=(0,A.convertFeeValueToGwei)({value:"1",network:i});try{var a=g.TransactionBlock.from(e.rawTx),u=(yield function(e){return L.apply(this,arguments)}({provider:n,sender:yield this.getAccountAddress(),transactionBlock:a})).effects;if(!u)throw new E.OneKeyError;var s,c,l,d=(null==u||null==(s=u.gasUsed)?void 0:s.computationCost)||"0",f=(null==(c=u.gasUsed)?void 0:c.storageCost)||"0",p=(null==(l=u.gasUsed)?void 0:l.storageRebate)||"0",y=new(m())(1e3).multipliedBy(1),h=new(m())(d).plus(y),v=h.plus(f).minus(p),w=v.gt(h)?v:h;if(w.isEqualTo(0))throw new E.OneKeyError;t=w.multipliedBy(1.1).toFixed()}catch(I){var b=g.TransactionBlock.from(e.rawTx);if(!b.blockData.transactions.some((function(e){return"TransferObjects"===e.kind})))throw new E.OneKeyError;var T=b.blockData.inputs;t=(r=T.length,150*Math.max(2,Math.min(100,r/2))).toString()}return{nativeSymbol:i.symbol,nativeDecimals:i.decimals,feeSymbol:i.feeSymbol,feeDecimals:i.feeDecimals,limit:t,prices:[o],defaultPresetIndex:"0"}}));return function(t){return e.apply(this,arguments)}}(),i.broadcastTransaction=function(){var e=(0,f.default)((function*(e){var t=yield this.getClient();O.default.engine.info("broadcastTransaction START:",{rawTx:e.rawTx});try{var r=e.signature,n=e.signatureScheme,i=e.publicKey;switch(n){case"ed25519":"ED25519";break;case"secp256k1":"Secp256k1";break;default:throw new E.OneKeyInternalError("Unsupported signature scheme")}if(!r)throw new Error("signature is empty");if(!i)throw new Error("publicKey is empty");var o=yield t.executeTransactionBlock({transactionBlock:e.rawTx,signature:r,requestType:e.encodedTx.requestType}),a=(0,g.getTransactionDigest)(o);return O.default.engine.info("broadcastTransaction Done:",{txid:a,rawTx:e.rawTx,transactionResponse:o}),Ke(Ke({},e),{},{txid:a})}catch(d){var u=d||{},s=u.errorCode,c=u.message,l=`${null!=s?s:""} ${c}`;throw-1!==c.indexOf("Insufficient gas:")?new E.OneKeyInternalError(l,"msg__broadcast_tx_Insufficient_fee"):new E.OneKeyInternalError(l)}}));return function(t){return e.apply(this,arguments)}}(),i.getExportedCredential=function(){var e=(0,f.default)((function*(e){var t=yield this.getDbAccount();if(t.id.startsWith("hd-")||t.id.startsWith("imported")){var r=this.keyring,n=Object.values(yield r.getPrivateKeys(e)),i=(0,c.default)(n,1)[0];return`0x${(0,b.decrypt)(e,i).toString("hex")}`}throw new E.OneKeyInternalError("Only credential of HD or imported accounts can be exported")}));return function(t){return e.apply(this,arguments)}}(),i.fetchOnChainHistory=function(){var e=(0,f.default)((function*(e){var t=this,r=e.localHistory,i=void 0===r?[]:r;if(e.tokenIdOnNetwork)return Promise.resolve([]);var o=yield this.getClient(),a=yield this.getDbAccount(),u=(yield this.engine.getNativeTokenInfo(this.networkId)).decimals,s=yield o.queryTransactionBlocks({filter:{FromAddress:a.address},limit:20,order:"descending"}),l=yield o.queryTransactionBlocks({filter:{ToAddress:a.address},limit:20,order:"descending"}),d=s.data.map((function(e){return e.digest})),p=l.data.map((function(e){return e.digest})),y=[].concat((0,n.default)(d),(0,n.default)(p));if(!y||!y.length)return[];var h,v=(yield o.multiGetTransactionBlocks({digests:(h=y,h?h.filter((function(e,t,r){return r.indexOf(e)===t})):[]),options:{showInput:!0,showEffects:!0}})).map(function(){var e=(0,f.default)((function*(e){var r=i.find((function(t){return t.decodedTx.txid===(0,g.getTransactionDigest)(e)}));if(r&&r.decodedTx.isFinal)return Promise.resolve(null);try{var n,s,l,d,p,y,h,v,w,b=yield t.engine.getNativeTokenInfo(t.networkId),T=(0,g.getExecutionStatus)(e),x="success"===(null==T?void 0:T.status),E="failure"===(null==T?void 0:T.status);if(!e)throw new Error("current transaction is empty, continue");var A=null!=(n=(0,g.getTimestampFromTransactionResponse)(e))?n:(0,I.getTimeStamp)(),k=null==(s=(0,g.getTransaction)(e))||null==(l=s.data)?void 0:l.transaction,S=null==(d=(0,g.getTransaction)(e))||null==(p=d.data)?void 0:p.gasData.payment;if(!k||"ProgrammableTransaction"!==k.kind)throw new Error("current transaction is empty, continue");var C=k.transactions,D=null!=(y=(0,g.getTransactionSender)(e))?y:"",B=[],N="";yield Promise.all(C.map(function(){var e=(0,f.default)((function*(e){var r=new(m())("0");if("TransferObjects"in e){var n,i,a,u,s,l,d="nativeTransfer",f=P.IDecodedTxActionType.NATIVE_TRANSFER,p=yield function(e){return he.apply(this,arguments)}({argument:e.TransferObjects,actions:C,inputs:k.inputs,payments:S,client:o});if(N=p.receive,p.amounts.has(K))d="nativeTransfer",f=P.IDecodedTxActionType.NATIVE_TRANSFER,r=new(m())(null!=(s=null==(l=p.amounts.get(K))?void 0:l.toString())?s:"0");else for(var y of(d="tokenTransfer",f=P.IDecodedTxActionType.TOKEN_TRANSFER,p.amounts.entries())){var h=(0,c.default)(y,2),v=h[0],g=h[1];r=new(m())(g.toString()),d="tokenTransfer",b=yield t.engine.ensureTokenInDB(t.networkId,v)}if(!b)return null;B.push(((u={type:f})[d]={tokenInfo:b,from:D,to:N,amount:new(m())(null!=(n=r)?n:"0").shiftedBy(-b.decimals).toFixed(),amountValue:null!=(i=null==(a=r)?void 0:a.toString())?i:"0",extraInfo:null},u))}else if("MoveCall"in e){var w,T,I=e.MoveCall,O="";if(I.package&&"object"===typeof I.package)O=null!=(w=null==(T=I.package)?void 0:T.objectId)?w:"";else O=I.package;var x=[];for(var E of null!=(A=I.arguments)?A:[]){var A;if("object"===typeof E)if("Input"in E){var j=E.Input,R=k.inputs[j];"pure"===R.type?x.push(R.value.toString()):"object"===R.type&&x.push(R.objectId)}else if("Result"in E){var H=E.Result,F=k.inputs[H];"pure"===F.type?x.push(F.value.toString()):"object"===F.type&&x.push(F.objectId)}else if("NestedResult"in E){var M=(0,c.default)(E.NestedResult,1)[0],U=k.inputs[M];"pure"===U.type?x.push(U.value.toString()):"object"===U.type&&x.push(U.objectId)}}B.push({type:P.IDecodedTxActionType.FUNCTION_CALL,functionCall:{target:_(I.function),functionName:O,args:x,extraInfo:null}})}else"SplitCoins"in e||"MergeCoins"in e||"MakeMoveVec"in e||B.push({type:P.IDecodedTxActionType.UNKNOWN,direction:P.IDecodedTxDirection.OTHER,unknownAction:{extraInfo:{}}})}));return function(t){return e.apply(this,arguments)}}()));var j={from:D,to:N,value:""},R=null!=(h=null==(v=(0,g.getTotalGasUsed)(e))?void 0:v.toString())?h:"0",H=P.IDecodedTxStatus.Pending;E?H=P.IDecodedTxStatus.Failed:x&&(H=P.IDecodedTxStatus.Confirmed);var F={txid:(0,g.getTransactionDigest)(e),owner:a.address,signer:D,nonce:0,actions:B,status:H,networkId:t.networkId,accountId:t.accountId,encodedTx:j,extraInfo:null,totalFeeInNative:new(m())(R).shiftedBy(-u).toFixed()};return"number"===typeof A?F.updatedAt=A:"string"===typeof A&&(F.updatedAt=parseInt(A)),F.createdAt=null!=(w=null==r?void 0:r.decodedTx.createdAt)?w:F.updatedAt,F.isFinal=F.status===P.IDecodedTxStatus.Confirmed,yield t.buildHistoryTx({decodedTx:F,historyTxToMerge:r})}catch(M){O.default.common.error(M)}return Promise.resolve(null)}));return function(t){return e.apply(this,arguments)}}());return(yield Promise.all(v)).filter(Boolean)}));return function(t){return e.apply(this,arguments)}}(),i.getTransactionStatuses=function(){var e=(0,f.default)((function*(e){var t=yield this.getClient(),r=yield t.multiGetTransactionBlocks({digests:e}),n=new Map;return r.forEach(function(){var e=(0,f.default)((function*(e){var t=(0,g.getTransactionDigest)(e);try{var r=(0,g.getExecutionStatus)(e),i="success"===(null==r?void 0:r.status),o="failure"===(null==r?void 0:r.status),a=T.TransactionStatus.PENDING;o?a=T.TransactionStatus.CONFIRM_BUT_FAILED:i&&(a=T.TransactionStatus.CONFIRM_AND_SUCCESS),n.set(t,a)}catch(u){-1!==u.message.indexOf("Could not find the referenced transaction")&&n.set(t,T.TransactionStatus.NOT_FOUND)}}));return function(t){return e.apply(this,arguments)}}()),e.map((function(e){return n.get(e)}))}));return function(t){return e.apply(this,arguments)}}(),i.getTransactionByTxId=function(){var e=(0,f.default)((function*(e,t){var r=yield this.getClient();return yield r.getTransactionBlock({digest:e,options:t})}));return function(t,r){return e.apply(this,arguments)}}(),i.waitPendingTransaction=function(){var e=(0,f.default)((function*(e,t){return function(e,t,r){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:10,o=0,a=function(){var u=(0,f.default)((function*(){var u,s,c,l,d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2e3;o+=1;try{l=yield e.getTransactionBlock({digest:t,options:Be(Be({},r),{},{showEffects:!0})})}catch(f){if(n&&-32e3!==f.code&&-32602!==f.code)return Promise.reject(new E.OneKeyError(f))}return!0===("success"===(null==(u=l)||null==(s=u.effects)||null==(c=s.status)?void 0:c.status))?Promise.resolve(l):o>i?Promise.reject(new E.OneKeyError("transaction timeout")):new Promise((function(e){return setTimeout((function(){return e(a(d))}),d)}))}));return function(){return u.apply(this,arguments)}}();return a()}(yield this.getClient(),e,t)}));return function(t,r){return e.apply(this,arguments)}}(),(0,p.default)(r)}(S.VaultBase)},565147:(e,t,r)=>{r.r(t),r.d(t,{KeyringBase:()=>c,KeyringBaseMock:()=>l});var n=r(634795),i=r(887371),o=r(545754),a=r(411987),u=r(695058);function s(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,u.default)(e);if(t){var i=(0,u.default)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,a.default)(this,r)}}var c=function(e){(0,o.default)(r,e);var t=s(r);function r(e){var r;return(r=t.call(this,e.options)).vault=e,r}return r.prototype.addressFromBase=function(){var e=(0,n.default)((function*(e){return this.vault.addressFromBase(e)}));return function(t){return e.apply(this,arguments)}}(),(0,i.default)(r)}(r(114540).VaultContext),l=function(e){(0,o.default)(r,e);var t=s(r);function r(){return t.apply(this,arguments)}return(0,i.default)(r)}(c)},82406:(e,t,r)=>{r.r(t),r.d(t,{KeyringHardwareBase:()=>d});var n=r(634795),i=r(887371),o=r(545754),a=r(411987),u=r(695058),s=r(799075),c=r(814817);function l(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,u.default)(e);if(t){var i=(0,u.default)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,a.default)(this,r)}}var d=function(e){(0,o.default)(a,e);var t=l(a);function a(){return t.apply(this,arguments)}var u=a.prototype;return u.getHardwareInfo=function(){var e=(0,n.default)((function*(){var e,t,r,n=yield this.engine.getHWDeviceByWalletId(this.vault.walletId);return{connectId:null!=(e=null==n?void 0:n.mac)?e:"",deviceId:null!=(t=null==n?void 0:n.deviceId)?t:"",deviceType:null!=(r=null==n?void 0:n.deviceType)?r:""}}));return function(){return e.apply(this,arguments)}}(),u.getWalletPassphraseState=function(){var e=(0,n.default)((function*(){var e=yield this.engine.getWallet(this.vault.walletId);return{passphraseState:null==e?void 0:e.passphraseState,useEmptyPassphrase:!(0,c.isPassphraseWallet)(e)}}));return function(){return e.apply(this,arguments)}}(),u.getHardwareSDKInstance=function(){var e=(0,n.default)((function*(){var e,t,n,i,o;return null!=(o=yield null==(e=r.g)||null==(t=e.$backgroundApiProxy)||null==(n=t.backgroundApi)||null==(i=n.serviceHardware)||null==i.getSDKInstance?void 0:i.getSDKInstance())?o:s.HardwareSDK}));return function(){return e.apply(this,arguments)}}(),u.prepareAccountByAddressIndex=function(e){throw new Error("Method not implemented.")},(0,i.default)(a)}(r(565147).KeyringBase)},810887:(e,t,r)=>{r.r(t),r.d(t,{KeyringHdBase:()=>y});var n=r(256666),i=r(634795),o=r(887371),a=r(545754),u=r(411987),s=r(695058),c=r(605851),l=r(940915);function d(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function f(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?d(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function p(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,s.default)(e);if(t){var i=(0,s.default)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,u.default)(this,r)}}var y=function(e){(0,a.default)(r,e);var t=p(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.getPrivateKeys=function(){var e=(0,i.default)((function*(e,t){var r=(yield this.getDbAccount()).path.split("/"),n=t||[r.pop()],i=r.join("/"),o=(yield this.engine.dbApi.getCredential(this.walletId,e)).seed;if("undefined"===typeof o)throw new l.OneKeyInternalError("Unable to get credential.");var a=(yield this.engine.providerManager.getChainInfoByNetworkId(this.networkId)).curve;return(0,c.batchGetPrivateKeys)(a,o,e,i,n).reduce((function(e,t){var r;return f(f({},e),{},((r={})[t.path]=t.extendedKey.key,r))}),{})}));return function(t,r){return e.apply(this,arguments)}}(),n.getAddress=function(){throw new Error("Method not implemented.")},n.batchGetAddress=function(){throw new Error("Method not implemented.")},n.prepareAccountByAddressIndex=function(e){throw new Error("Method not implemented.")},(0,o.default)(r)}(r(280306).KeyringSoftwareBase)},255942:(e,t,r)=>{r.r(t),r.d(t,{KeyringImportedBase:()=>l});var n=r(634795),i=r(887371),o=r(545754),a=r(411987),u=r(695058),s=r(940915);function c(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,u.default)(e);if(t){var i=(0,u.default)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,a.default)(this,r)}}var l=function(e){(0,o.default)(r,e);var t=c(r);function r(){return t.apply(this,arguments)}var a=r.prototype;return a.getPrivateKeys=function(){var e=(0,n.default)((function*(e,t){if("undefined"!==typeof t)throw new s.NotImplemented("Getting private keys from extended private key");var r=(yield this.engine.dbApi.getCredential(this.accountId,e)).privateKey;if("undefined"===typeof r)throw new s.OneKeyInternalError("Unable to get credential.");return{"":r}}));return function(t,r){return e.apply(this,arguments)}}(),a.getAddress=function(){throw new Error("Method not implemented.")},a.batchGetAddress=function(){throw new Error("Method not implemented.")},a.prepareAccountByAddressIndex=function(){throw new Error("Method not implemented.")},(0,i.default)(r)}(r(280306).KeyringSoftwareBase)},280306:(e,t,r)=>{r.r(t),r.d(t,{KeyringSoftwareBase:()=>h});var n=r(196234),i=r(256666),o=r(634795),a=r(887371),u=r(545754),s=r(411987),c=r(695058),l=r(292147),d=r(940915);function f(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?f(Object(r),!0).forEach((function(t){(0,i.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):f(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function y(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,c.default)(e);if(t){var i=(0,c.default)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,s.default)(this,r)}}var h=function(e){(0,u.default)(r,e);var t=y(r);function r(){return t.apply(this,arguments)}var i=r.prototype;return i.signTransaction=function(){var e=(0,o.default)((function*(e,t){var r=t.password;if("undefined"===typeof r)throw new d.OneKeyInternalError("Software signing requires a password.");var n=yield this.getSigners(r,e.inputs.map((function(e){return e.address})));return l.default.engine.info("signTransaction",this.networkId,e),p(p({},yield this.engine.providerManager.signTransaction(this.networkId,e,n)),{},{encodedTx:e.encodedTx})}));return function(t,r){return e.apply(this,arguments)}}(),i.signMessage=function(){var e=(0,o.default)((function*(e,t){var r=this,i=t.password;if("undefined"===typeof i)throw new d.OneKeyInternalError("Software signing requires a password.");var o=yield this.getDbAccount(),a=Object.values(yield this.getSigners(i,[o.address])),u=(0,n.default)(a,1)[0];return l.default.engine.info("signMessage",this.networkId,e),Promise.all(e.map((function(e){return r.engine.providerManager.signMessage(r.networkId,e,u)})))}));return function(t,r){return e.apply(this,arguments)}}(),i.getAddress=function(){throw new Error("Method not implemented.")},i.batchGetAddress=function(){throw new Error("Method not implemented.")},i.prepareAccountByAddressIndex=function(e){throw new Error("Method not implemented.")},(0,a.default)(r)}(r(565147).KeyringBase)},701625:(e,t,r)=>{r.r(t),r.d(t,{KeyringWatchingBase:()=>l});var n=r(634795),i=r(887371),o=r(545754),a=r(411987),u=r(695058),s=r(940915);function c(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,u.default)(e);if(t){var i=(0,u.default)(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return(0,a.default)(this,r)}}var l=function(e){(0,o.default)(r,e);var t=c(r);function r(){return t.apply(this,arguments)}var a=r.prototype;return a.signTransaction=function(){var e=(0,n.default)((function*(e,t){throw new s.OneKeyInternalError("signTransaction is not supported for watching accounts")}));return function(t,r){return e.apply(this,arguments)}}(),a.signMessage=function(){var e=(0,n.default)((function*(e,t){throw new s.OneKeyInternalError("signMessage is not supported for watching accounts")}));return function(t,r){return e.apply(this,arguments)}}(),a.getAddress=function(){throw new Error("Method not implemented.")},a.batchGetAddress=function(){throw new Error("Method not implemented.")},a.prepareAccountByAddressIndex=function(){throw new Error("Method not implemented.")},(0,i.default)(r)}(r(565147).KeyringBase)},153546:(e,t,r)=>{r.r(t),r.d(t,{convertDeviceError:()=>u});var n=r(703599),i=r(302478),o=r(292147);r(213208);function a(e,t){return"string"!==typeof t?null:e===n.HardwareErrorCode.DeviceInitializeFailed&&t.includes("ECONNABORTED")?new i.ConnectTimeoutError({message:t}):t.includes("Bridge network error")?new i.BridgeNetworkError({message:t}):null}function u(e){var t,r=e||{},u=r.code,s=r.error,c=r.message,l=null!=(t=null!=s?s:c)?t:"Unknown error";if(a(u,l))return a(u,l);switch(o.default.hardwareSDK.info("Device Utils Convert Device Error:",u,l),u){case n.HardwareErrorCode.UnknownError:return new i.UnknownHardwareError(e);case n.HardwareErrorCode.DeviceFwException:return new i.FirmwareVersionTooLow(e);case n.HardwareErrorCode.DeviceUnexpectedMode:return"string"===typeof l&&-1!==l.indexOf("ui-device_bootloader_mode")?new i.NotInBootLoaderMode(e):new i.UnknownHardwareError(e);case n.HardwareErrorCode.DeviceCheckDeviceIdError:return new i.DeviceNotSame(e);case n.HardwareErrorCode.DeviceNotFound:return new i.DeviceNotFind(e);case n.HardwareErrorCode.DeviceUnexpectedBootloaderMode:return new i.NotInBootLoaderMode(e);case n.HardwareErrorCode.DeviceInterruptedFromOutside:case n.HardwareErrorCode.DeviceInterruptedFromUser:return new i.UserCancelFromOutside(e);case n.HardwareErrorCode.DeviceNotSupportPassphrase:return new i.NotSupportPassphraseError(e);case n.HardwareErrorCode.IFrameLoadFail:return new i.InitIframeLoadFail(e);case n.HardwareErrorCode.IframeTimeout:return new i.InitIframeTimeout(e);case n.HardwareErrorCode.FirmwareUpdateDownloadFailed:return new i.FirmwareDownloadFailed(e);case n.HardwareErrorCode.FirmwareUpdateManuallyEnterBoot:return new i.FirmwareUpdateManuallyEnterBoot(e);case n.HardwareErrorCode.FirmwareUpdateAutoEnterBootFailure:return new i.FirmwareUpdateAutoEnterBootFailure(e);case n.HardwareErrorCode.FirmwareUpdateLimitOneDevice:return new i.FirmwareUpdateLimitOneDevice(e);case n.HardwareErrorCode.CallMethodNeedUpgradeFirmware:return new i.FirmwareVersionTooLow(e);case n.HardwareErrorCode.NewFirmwareUnRelease:return new i.NewFirmwareUnRelease(e);case n.HardwareErrorCode.NewFirmwareForceUpdate:return new i.NewFirmwareForceUpdate(e);case n.HardwareErrorCode.NetworkError:return new i.NetworkError(e);case n.HardwareErrorCode.BlePermissionError:return new i.NeedBluetoothTurnedOn(e);case n.HardwareErrorCode.BleLocationError:return new i.NeedBluetoothPermissions({message:l});case n.HardwareErrorCode.BleLocationServicesDisabled:return new i.BleLocationServiceError({message:l});case n.HardwareErrorCode.BleDeviceNotBonded:return new i.DeviceNotBonded(e);case n.HardwareErrorCode.BleDeviceBondError:return new i.DeviceBondError(e);case n.HardwareErrorCode.BleWriteCharacteristicError:return new i.BleWriteCharacteristicError(e);case n.HardwareErrorCode.BleScanError:return new i.BleScanError({message:l});case n.HardwareErrorCode.BleAlreadyConnected:return new i.BleAlreadyConnectedError(e);case n.HardwareErrorCode.RuntimeError:return-1!==l.indexOf("EIP712 blind sign is disabled")?new i.OpenBlindSign(e):-1!==l.indexOf("Unknown message")||-1!==l.indexOf("Failure_UnexpectedMessage")?new i.UnknownMethod(e):new i.UnknownHardwareError(e);case n.HardwareErrorCode.PinInvalid:return new i.InvalidPIN(e);case n.HardwareErrorCode.DeviceCheckPassphraseStateError:return new i.InvalidPassphrase(e);case n.HardwareErrorCode.DeviceOpenedPassphrase:return new i.DeviceOpenedPassphrase(e);case n.HardwareErrorCode.DeviceNotOpenedPassphrase:return new i.DeviceNotOpenedPassphrase(e);case n.HardwareErrorCode.PinCancelled:case n.HardwareErrorCode.ActionCancelled:return new i.UserCancel(e);case n.HardwareErrorCode.BridgeNotInstalled:case i.CustomOneKeyHardwareError.NeedOneKeyBridge:return new i.NeedOneKeyBridge(e);case n.HardwareErrorCode.BridgeNetworkError:return new i.BridgeNetworkError(e);case n.HardwareErrorCode.BridgeTimeoutError:return new i.BridgeTimeoutError(e);case n.HardwareErrorCode.PollingTimeout:return new i.ConnectTimeoutError(e);case n.HardwareErrorCode.PollingStop:return new i.ConnectPollingStopError(e);case n.HardwareErrorCode.BlindSignDisabled:return new i.OpenBlindSign(e);case n.HardwareErrorCode.FileAlreadyExists:return new i.FileAlreadyExistError(e);case n.HardwareErrorCode.CheckDownloadFileError:return new i.IncompleteFileError(e);case n.HardwareErrorCode.NotInSigningMode:return new i.NotInSigningModeError(e);case n.HardwareErrorCode.DataOverload:return new i.DeviceDataOverload(e);default:return new i.UnknownHardwareError(e)}}}}]);