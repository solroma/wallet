"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[67988],{786141:(e,t,r)=>{r.r(t),r.d(t,{VaultBase:()=>k,VaultBaseChainOnly:()=>N});var n=r(72579),o=r.n(n),i=r(256666),a=r(301842),u=r.n(a),c=r(634795),s=r(887371),d=r(545754),l=r(411987),f=r(695058),p=r(206391),y=r.n(p),h=r(636393),v=r(613549),g=r(292147),m=r(213208),w=r(992431),T=r(940915),I=r(278489),A=r(969618),E=r(398514),P=r(114540),O=r(348834).Buffer;function b(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function S(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?b(Object(r),!0).forEach((function(t){(0,i.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):b(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function x(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,f.default)(e);if(t){var o=(0,f.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,l.default)(this,r)}}if(m.default.isExtensionUi)throw new Error("engine/VaultBase is not allowed imported from ui");var N=function(e){(0,d.default)(r,e);var t=x(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.initProvider=function(){var e=(0,c.default)((function*(){var e=(yield this.getNetwork()).impl;u()(A.IMPL_MAPPINGS[e])||(this.engineProvider=yield this.engine.providerManager.getProvider(this.networkId))}));return function(){return e.apply(this,arguments)}}(),n.proxyJsonRPCCall=function(){var e=(0,c.default)((function*(e){throw new T.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.createClientFromURL=function(e){throw new T.NotImplemented},n.getEthersProvider=function(){var e=(0,c.default)((function*(){throw new T.NotImplemented}));return function(){return e.apply(this,arguments)}}(),n.getClientEndpointStatus=function(){var e=(0,c.default)((function*(e){var t=this.createClientFromURL(e),r=performance.now(),n=(yield t.getInfo()).bestBlockNumber;return{responseTime:Math.floor(performance.now()-r),latestBlock:n}}));return function(t){return e.apply(this,arguments)}}(),n.checkRpcBatchSupport=function(){var e=(0,c.default)((function*(e){throw new T.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.getDisplayAddress=function(){var e=(0,c.default)((function*(e){return Promise.resolve(e)}));return function(t){return e.apply(this,arguments)}}(),n.validateAddress=function(){var e=(0,c.default)((function*(e){var t=yield this.engineProvider.verifyAddress(e),r=t.normalizedAddress;if(!t.isValid||!r)throw new T.InvalidAddress;return Promise.resolve(r)}));return function(t){return e.apply(this,arguments)}}(),n.validateImportedCredential=function(e){return Promise.resolve(this.settings.importedAccountEnabled&&/^(0x)?[0-9a-zA-Z]{64}$/.test(e))},n.validateWatchingCredential=function(){var e=(0,c.default)((function*(e){return Promise.resolve(this.settings.watchingAccountEnabled&&(yield this.engineProvider.verifyAddress(e)).isValid)}));return function(t){return e.apply(this,arguments)}}(),n.validateTokenAddress=function(){var e=(0,c.default)((function*(e){var t=yield this.engineProvider.verifyTokenAddress(e),r=t.normalizedAddress;if(!t.isValid||"undefined"===typeof r)throw new T.InvalidTokenAddress;return Promise.resolve(r)}));return function(t){return e.apply(this,arguments)}}(),n.validateCanCreateNextAccount=function(){var e=(0,c.default)((function*(e,t){return Promise.resolve(!0)}));return function(t,r){return e.apply(this,arguments)}}(),n.checkAccountExistence=function(){var e=(0,c.default)((function*(e,t){return Promise.resolve(!0)}));return function(t,r){return e.apply(this,arguments)}}(),n.getBalances=function(){var e=(0,c.default)((function*(e,t,r){return(yield this.engine.providerManager.getClient(this.networkId)).getBalances(e.map((function(e){var t=e.address,r=e.tokenAddress;return{address:t,coin:S({},"string"===typeof r?{tokenAddress:r}:{})}})))}));return function(t,r,n){return e.apply(this,arguments)}}(),n.getFrozenBalance=function(){var e=(0,c.default)((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.password,e.useRecycleBalance,e.ignoreInscriptions,e.useCustomAddressesBalance;return 0}));return function(){return e.apply(this,arguments)}}(),n.fetchBalanceDetails=function(){var e=(0,c.default)((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.password,e.useRecycleBalance,e.ignoreInscriptions,e.useCustomAddressesBalance;return Promise.resolve(void 0)}));return function(){return e.apply(this,arguments)}}(),n.getTransactionStatuses=function(e){return this.engine.providerManager.getTransactionStatuses(this.networkId,e)},n.getTransactionFeeInNative=function(e){return Promise.resolve("")},n.isContractAddress=function(){var e=(0,c.default)((function*(e){return!1}));return function(t){return e.apply(this,arguments)}}(),n.getAccountNameInfoMap=function(){var e=(0,c.default)((function*(){var e=yield this.getNetwork();return(0,I.getAccountNameInfoByImpl)(e.impl)}));return function(){return e.apply(this,arguments)}}(),n.canAutoCreateNextAccount=function(){var e=(0,c.default)((function*(e){return Promise.resolve(!1)}));return function(t){return e.apply(this,arguments)}}(),n.filterAccounts=function(){var e=(0,c.default)((function*(e){var t=e.accounts;e.networkId;return Promise.resolve(t)}));return function(t){return e.apply(this,arguments)}}(),n.shouldChangeAccountWhenNetworkChanged=function(){var e=(0,c.default)((function*(e){e.previousNetwork,e.newNetwork,e.activeAccountId;return Promise.resolve({shouldReloadAccountList:!1,shouldChangeActiveAccount:!1})}));return function(t){return e.apply(this,arguments)}}(),n.getAccountNameInfosByImportedOrWatchingCredential=function(){var e=(0,c.default)((function*(e){return Promise.resolve([])}));return function(t){return e.apply(this,arguments)}}(),n.checkIsUnlimitedAllowance=function(){var e=(0,c.default)((function*(e){throw new T.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.checkIsApprovedForAll=function(){var e=(0,c.default)((function*(e){throw new T.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.checkIsBatchTransfer=function(){var e=(0,c.default)((function*(e){throw new T.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.getFeePricePerUnit=function(){var e=(0,c.default)((function*(){throw new T.NotImplemented}));return function(){return e.apply(this,arguments)}}(),n.fetchRpcChainId=function(){var e=(0,c.default)((function*(e){return null}));return function(t){return e.apply(this,arguments)}}(),n.getTxWaitingSeconds=function(){var e=(0,c.default)((function*(){return[]}));return function(){return e.apply(this,arguments)}}(),n.getUserNFTAssets=function(){var e=(0,c.default)((function*(e){e.serviceData;return Promise.resolve(void 0)}));return function(t){return e.apply(this,arguments)}}(),n.getTransactionDetail=function(){var e=(0,c.default)((function*(e){return Promise.resolve(void 0)}));return function(t){return e.apply(this,arguments)}}(),(0,s.default)(r)}(P.VaultContext),k=function(e){(0,d.default)(r,e);var t=x(r);function r(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))).uuid=h.default.v4().toString(),e}var n=r.prototype;return n.init=function(){var e=(0,c.default)((function*(e){yield this.initProvider(),yield this.initKeyring(e)}));return function(t){return e.apply(this,arguments)}}(),n.initKeyring=function(){var e=(0,c.default)((function*(e){this.keyring=yield e.keyringCreator(this)}));return function(t){return e.apply(this,arguments)}}(),n.signTransaction=function(){var e=(0,c.default)((function*(e,t){return this.keyring.signTransaction(e,t)}));return function(t,r){return e.apply(this,arguments)}}(),n.signAndSendTransaction=function(){var e=(0,c.default)((function*(e,t,r){var n=yield this.signTransaction(e,t);return r?S(S({},n),{},{encodedTx:e.encodedTx}):this.broadcastTransaction(S(S({},n),{},{encodedTx:e.encodedTx}))}));return function(t,r,n){return e.apply(this,arguments)}}(),n.broadcastTransaction=function(){var e=(0,c.default)((function*(e,t){g.default.engine.info("broadcastTransaction START:",{rawTx:e.rawTx});var r=yield this.engine.providerManager.broadcastTransaction(this.networkId,e.rawTx,t);return g.default.engine.info("broadcastTransaction END:",{txid:r,rawTx:e.rawTx}),S(S({},e),{},{txid:r,encodedTx:e.encodedTx})}));return function(t,r){return e.apply(this,arguments)}}(),n.buildEncodedTxFromBatchTransfer=function(){var e=(0,c.default)((function*(e){throw new T.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.buildEncodedTxsFromSetApproveForAll=function(){var e=(0,c.default)((function*(e,t){throw new T.NotImplemented}));return function(t,r){return e.apply(this,arguments)}}(),n.activateAccount=function(){var e=(0,c.default)((function*(){throw new T.NotImplemented}));return function(){return e.apply(this,arguments)}}(),n.activateToken=function(){var e=(0,c.default)((function*(e,t){throw new T.NotImplemented}));return function(t,r){return e.apply(this,arguments)}}(),n.getTokenAllowance=function(){var e=(0,c.default)((function*(e,t){throw new T.NotImplemented}));return function(t,r){return e.apply(this,arguments)}}(),n.batchTokensAllowance=function(){var e=(0,c.default)((function*(e,t){throw new T.NotImplemented}));return function(t,r){return e.apply(this,arguments)}}(),n.getOutputAccount=function(){var e=(0,c.default)((function*(){var e=yield this.getDbAccount({noCache:!0});return{id:e.id,name:e.name,type:e.type,path:e.path,coinType:e.coinType,tokens:[],address:e.address,template:e.template,pubKey:o()(e,"pub","")}}));return function(){return e.apply(this,arguments)}}(),n.getAccountBalance=function(){var e=(0,c.default)((function*(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,o=(yield this.getDbAccount()).address;return this.getBalances((t?[{address:o}]:[]).concat(e.map((function(e){return{address:o,tokenAddress:e}}))),r,n)}));return function(t){return e.apply(this,arguments)}}(),n.updatePendingTxs=function(){var e=(0,c.default)((function*(e){throw new T.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.getAccountNonce=function(){var e=(0,c.default)((function*(){return Promise.resolve(null)}));return function(){return e.apply(this,arguments)}}(),n.fixActionDirection=function(){var e=(0,c.default)((function*(e){var t,r,n,o,i=e.action,a=e.accountAddress;(i.direction=E.IDecodedTxDirection.OTHER,i.type===E.IDecodedTxActionType.NATIVE_TRANSFER)&&(i.direction=yield this.buildTxActionDirection({from:(null==(t=i.nativeTransfer)?void 0:t.from)||"",to:(null==(r=i.nativeTransfer)?void 0:r.to)||"",address:a}));i.type===E.IDecodedTxActionType.TOKEN_TRANSFER&&(i.direction=yield this.buildTxActionDirection({from:(null==(n=i.tokenTransfer)?void 0:n.from)||"",to:(null==(o=i.tokenTransfer)?void 0:o.to)||"",address:a}));return i}));return function(t){return e.apply(this,arguments)}}(),n.fixDecodedTx=function(){var e=(0,c.default)((function*(e){var t,r;e.createdAt=null!=(t=e.createdAt)?t:Date.now();var n=null==(r=e.encodedTx)?void 0:r.nonce;e.nonce=u()(n)?e.nonce:new(y())(n).toNumber();for(var o=e.owner,i=0;i<e.actions.length;i+=1){var a=e.actions[i];yield this.fixActionDirection({action:a,accountAddress:o})}if(e.outputActions)for(var c=0;c<e.outputActions.length;c+=1){var s=e.outputActions[c];yield this.fixActionDirection({action:s,accountAddress:o})}return Promise.resolve(e)}));return function(t){return e.apply(this,arguments)}}(),n.fixHistoryTx=function(){var e=(0,c.default)((function*(e){return e.decodedTx=yield this.fixDecodedTx(e.decodedTx),Promise.resolve(e)}));return function(t){return e.apply(this,arguments)}}(),n.buildHistoryTx=function(){var e=(0,c.default)((function*(e){var t=e.historyTxToMerge,r=(e.encodedTx,e.decodedTx),n=e.signedTx,o=e.isSigner,i=e.isLocalCreated,a=(null==n?void 0:n.txid)||(null==r?void 0:r.txid)||"";if(!a)throw new Error("buildHistoryTx txid not found");var u=yield this.getAccountAddress();r.txid=a||r.txid,r.owner=u,o&&(r.signer=u),null!=n&&n.txKey&&(r.extraInfo?r.extraInfo.txKey=n.txKey:r.extraInfo={txKey:n.txKey});var c=S(S({id:`${this.networkId}_${a}_${this.accountId}`,isLocalCreated:Boolean(i)},t),{},{decodedTx:r});return c=yield this.fixHistoryTx(c),Promise.resolve(c)}));return function(t){return e.apply(this,arguments)}}(),n.checkIsScamHistoryTx=function(){var e=(0,c.default)((function*(e){return!1}));return function(t){return e.apply(this,arguments)}}(),n.fetchOnChainHistory=function(){var e=(0,c.default)((function*(e){throw new T.NotImplemented}));return function(t){return e.apply(this,arguments)}}(),n.fixAddressCase=function(e){return Promise.resolve(e)},n.buildTxActionDirection=function(){var e=(0,c.default)((function*(e){var t=e.from,r=e.to,n=e.address;return t=yield this.fixAddressCase(t||""),r=yield this.fixAddressCase(r),n=yield this.fixAddressCase(n),t===r&&t===n?E.IDecodedTxDirection.SELF:t&&t===n?E.IDecodedTxDirection.OUT:r&&r===n?E.IDecodedTxDirection.IN:E.IDecodedTxDirection.OTHER}));return function(t){return e.apply(this,arguments)}}(),n.getNextNonce=function(){var e=(0,c.default)((function*(e,t){var r,n=null==(r=(yield this.engine.providerManager.getAddresses(e,[t.address]))[0])?void 0:r.nonce;if(u()(n))throw new T.OneKeyError("Get on-chain nonce failed.");yield this.engine.getHistory(e,t.id,void 0,!1);var o=yield w.default.history.getMaxPendingNonce({accountId:this.accountId,networkId:e}),i=yield w.default.history.getPendingNonceList({accountId:this.accountId,networkId:e}),a=Math.max(u()(o)?0:o+1,n);if(Number.isNaN(a)&&(a=n),a>n)for(var c=n;c<a;c+=1)if(!i.includes(c)){a=c;break}if(a<n&&(a=n),a-n>=v.HISTORY_CONSTS.PENDING_QUEUE_MAX_LENGTH)throw new T.PendingQueueTooLong(v.HISTORY_CONSTS.PENDING_QUEUE_MAX_LENGTH);return a}));return function(t,r){return e.apply(this,arguments)}}(),n.validateSendAmount=function(e,t,r){return Promise.resolve(!0)},n.notifyChainChanged=function(e,t){},n.getFetchBalanceAddress=function(e){return Promise.resolve(e.address)},n.getPrivateKeyByCredential=function(e){return Promise.resolve(O.from(e.startsWith("0x")?e.slice(2):e,"hex"))},n.getMinDepositAmount=function(){var e=(0,c.default)((function*(){return"0"}));return function(){return e.apply(this,arguments)}}(),n.specialCheckEncodedTx=function(){var e=(0,c.default)((function*(e){return{success:!0}}));return function(t){return e.apply(this,arguments)}}(),n.getAllUsedAddress=function(){var e=(0,c.default)((function*(){return Promise.resolve([])}));return function(){return e.apply(this,arguments)}}(),(0,s.default)(r)}(N)},367988:(e,t,r)=>{r.r(t),r.d(t,{default:()=>Le});var n=r(817620),o=r.n(n),i=r(545455),a=r.n(i),u=r(986152),c=r.n(u),s=r(616951),d=r.n(s),l=r(968079),f=r(256666),p=r(301842),y=r.n(p),h=r(196234),v=r(634795),g=r(887371),m=r(545754),w=r(411987),T=r(695058),I=r(126249),A=r(809535),E=r(330020),P=r(722009),O=r(166636),b=r(899934),S=r(652751),x=r(28423),N=r(81071),k=r(477754),C=r(789644),B=r.n(C),R=r(206391),D=r.n(R),F=r(817022),_=r.n(F),H=r(478557),M=r(901187),K=r(776553),U=r(613549),j=r(292147),L=r(396564),G=r(992431),z=r(940915),V=r(278489),W=r(790656),$=r(794292),Y=r(556658),q=r(398514),J=r(786141),Q=r(153546),X=r(398145),Z=r(82406),ee=r(348834).Buffer;function te(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function re(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?te(Object(r),!0).forEach((function(t){(0,f.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):te(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function ne(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,T.default)(e);if(t){var o=(0,T.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,w.default)(this,r)}}var oe=function(e){(0,m.default)(r,e);var t=ne(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.signTransaction=function(){var e=(0,v.default)((function*(e,t){var r=yield this.getDbAccount(),n=yield this.getHardwareSDKInstance(),o=yield this.getHardwareInfo(),i=o.connectId,a=o.deviceId,u=yield this.getWalletPassphraseState(),c=e.payload,s=c.nativeTx,d=c.feePayer,l=s instanceof k.VersionedTransaction,f=yield n.solSignTransaction(i,a,re({path:r.path,rawTx:l?ee.from(s.message.serialize()).toString("hex"):s.serializeMessage().toString("hex")},u));if(f.success&&f.payload.signature){var p=f.payload.signature;return s.addSignature(d,ee.from(p,"hex")),{txid:p,rawTx:ee.from(s.serialize({requireAllSignatures:!1})).toString("base64")}}throw(0,Q.convertDeviceError)(f.payload)}));return function(t,r){return e.apply(this,arguments)}}(),n.signMessage=function(e,t){throw new z.NotImplemented("Signing solana message is not supported yet.")},n.prepareAccounts=function(){var e=(0,v.default)((function*(e){var t,r=this,n=e.indexes,o=e.names,i=e.template,a=n.map((function(e){return i.replace(U.INDEX_PLACEHOLDER,`${e}`)})),u=yield this.getHardwareSDKInstance(),c=yield this.getHardwareInfo(),s=c.connectId,d=c.deviceId,l=yield this.getWalletPassphraseState();try{t=yield u.solGetAddress(s,d,re({bundle:a.map((function(e){return{path:e,showOnOneKey:false}}))},l))}catch(y){throw j.default.common.error(y),new z.OneKeyHardwareError(y)}if(!t.success)throw j.default.common.error(t.payload),(0,Q.convertDeviceError)(t.payload);var f=yield this.getNetworkImpl(),p=(0,V.getAccountNameInfoByTemplate)(f,i).prefix;return t.payload.map((function(e,t){var i=e.address,a=e.path;return{id:`${r.walletId}--${a}`,name:(o||[])[t]||`${p} #${n[t]+1}`,type:X.AccountType.SIMPLE,path:a,coinType:U.COINTYPE_SOL,pub:null!=i?i:"",address:null!=i?i:""}})).filter((function(e){return!!e.address}))}));return function(t){return e.apply(this,arguments)}}(),n.getAddress=function(){var e=(0,v.default)((function*(e){var t,r=yield this.getHardwareSDKInstance(),n=yield this.getHardwareInfo(),o=n.connectId,i=n.deviceId,a=yield this.getWalletPassphraseState(),u=yield r.solGetAddress(o,i,re({path:e.path,showOnOneKey:e.showOnOneKey},a));if(u.success&&null!=(t=u.payload)&&t.address)return u.payload.address;throw(0,Q.convertDeviceError)(u.payload)}));return function(t){return e.apply(this,arguments)}}(),n.batchGetAddress=function(){var e=(0,v.default)((function*(e){var t=yield this.getHardwareSDKInstance(),r=yield this.getHardwareInfo(),n=r.connectId,o=r.deviceId,i=yield this.getWalletPassphraseState(),a=yield t.solGetAddress(n,o,re(re({},i),{},{bundle:e.map((function(e){return{path:e.path,showOnOneKey:!!e.showOnOneKey}}))}));if(!a.success)throw(0,Q.convertDeviceError)(a.payload);return a.payload.map((function(e){var t,r;return{path:null!=(t=e.path)?t:"",address:null!=(r=e.address)?r:""}}))}));return function(t){return e.apply(this,arguments)}}(),(0,g.default)(r)}(Z.KeyringHardwareBase),ie=r(605851),ae=r(997293),ue=r(810887),ce=r(348834).Buffer,se=new k.PublicKey("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),de=new k.PublicKey("auth9SigNpDKz4sJJ1DfCTuZrZNSAgh9sFD3rboVmgg");function le(e){return k.PublicKey.findProgramAddressSync([ce.from("metadata"),se.toBuffer(),e.toBuffer()],se)[0]}function fe(e,t){return k.PublicKey.findProgramAddressSync([ce.from("metadata"),se.toBuffer(),e.toBuffer(),ce.from("token_record"),t.toBuffer()],se)[0]}function pe(e){return k.PublicKey.findProgramAddressSync([ce.from("metadata"),se.toBuffer(),e.toBuffer(),ce.from("edition")],se)[0]}function ye(e,t){return he.apply(this,arguments)}function he(){return(he=(0,v.default)((function*(e,t){var r=e.payload,n=r.nativeTx,o=r.feePayer,i=n instanceof k.VersionedTransaction,a=yield t.sign(i?ce.from(n.message.serialize()):n.serializeMessage()),u=(0,h.default)(a,1)[0];return n.addSignature(o,u),{txid:_().encode(u),rawTx:ce.from(n.serialize({requireAllSignatures:!1})).toString("base64")}}))).apply(this,arguments)}function ve(e,t){return ge.apply(this,arguments)}function ge(){return(ge=(0,v.default)((function*(e,t){var r=yield t.sign(ce.from(e)),n=(0,h.default)(r,1)[0];return _().encode(n)}))).apply(this,arguments)}function me(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,T.default)(e);if(t){var o=(0,T.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,w.default)(this,r)}}var we=function(e){(0,m.default)(r,e);var t=me(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.getSigners=function(){var e=(0,v.default)((function*(e,t){var r,n=yield this.getDbAccount();if(1!==t.length)throw new z.OneKeyInternalError("SOL signers number should be 1.");if(t[0]!==n.address)throw new z.OneKeyInternalError("Wrong address required for signing");var o=(yield this.getPrivateKeys(e))[n.path];if("undefined"===typeof o)throw new z.OneKeyInternalError("Unable to get signer.");return(r={})[n.address]=new $.Signer(o,e,"ed25519"),r}));return function(t,r){return e.apply(this,arguments)}}(),n.prepareAccounts=function(){var e=(0,v.default)((function*(e){var t=this,r=e.password,n=e.indexes,o=e.names,i=e.template,a=(yield this.engine.dbApi.getCredential(this.walletId,r)).seed,u=(0,ae.slicePathTemplate)(i),c=u.pathPrefix,s=u.pathSuffix,d=(0,ie.batchGetPublicKeys)("ed25519",a,r,c,n.map((function(e){return s.replace("{index}",e.toString())})));if(d.length!==n.length)throw new z.OneKeyInternalError("Unable to get public keys");var l=yield this.getNetworkImpl(),f=(0,V.getAccountNameInfoByTemplate)(l,i).prefix;return d.map((function(e,r){var i=e.path,a=e.extendedKey.key,u=new k.PublicKey(a).toBase58();return{id:`${t.walletId}--${i}`,name:(o||[])[r]||`${f} #${n[r]+1}`,type:X.AccountType.SIMPLE,path:i,coinType:U.COINTYPE_SOL,pub:u,address:u}}))}));return function(t){return e.apply(this,arguments)}}(),n.signTransaction=function(){var e=(0,v.default)((function*(e,t){var r=yield this.getDbAccount();return ye(e,(yield this.getSigners(t.password||"",[r.address]))[r.address])}));return function(t,r){return e.apply(this,arguments)}}(),n.signMessage=function(){var e=(0,v.default)((function*(e,t){var r=yield this.getDbAccount(),n=(yield this.getSigners(t.password||"",[r.address]))[r.address];return Promise.all(e.map((function(e){return ve(e.message,n)})))}));return function(t,r){return e.apply(this,arguments)}}(),(0,g.default)(r)}(ue.KeyringHdBase);function Te(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,T.default)(e);if(t){var o=(0,T.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,w.default)(this,r)}}var Ie=function(e){(0,m.default)(r,e);var t=Te(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.prepareAccounts=function(){var e=(0,v.default)((function*(e){var t=e.name,r=e.privateKey;if(32!==r.length)throw new z.OneKeyInternalError("Invalid private key.");var n=new k.PublicKey(H.ed25519.publicFromPrivate(r)).toBase58();return Promise.resolve([{id:`imported--${U.COINTYPE_SOL}--${n}`,name:t||"",type:X.AccountType.SIMPLE,path:"",coinType:U.COINTYPE_SOL,pub:n,address:n}])}));return function(t){return e.apply(this,arguments)}}(),n.getSigners=function(){var e=(0,v.default)((function*(e,t){var r,n=yield this.getDbAccount();if(1!==t.length)throw new z.OneKeyInternalError("SOL signers number should be 1.");if(t[0]!==n.address)throw new z.OneKeyInternalError("Wrong address required for signing.");var o=(yield this.getPrivateKeys(e))[n.path];if("undefined"===typeof o)throw new z.OneKeyInternalError("Unable to get signer.");return(r={})[n.address]=new $.Signer(o,e,"ed25519"),r}));return function(t,r){return e.apply(this,arguments)}}(),n.signTransaction=function(){var e=(0,v.default)((function*(e,t){var r=yield this.getDbAccount();return ye(e,(yield this.getSigners(t.password||"",[r.address]))[r.address])}));return function(t,r){return e.apply(this,arguments)}}(),n.signMessage=function(){var e=(0,v.default)((function*(e,t){var r=yield this.getDbAccount(),n=(yield this.getSigners(t.password||"",[r.address]))[r.address];return Promise.all(e.map((function(e){return ve(e.message,n)})))}));return function(t,r){return e.apply(this,arguments)}}(),(0,g.default)(r)}(r(255942).KeyringImportedBase);function Ae(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,T.default)(e);if(t){var o=(0,T.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,w.default)(this,r)}}var Ee,Pe,Oe=function(e){(0,m.default)(r,e);var t=Ae(r);function r(){return t.apply(this,arguments)}return r.prototype.prepareAccounts=function(){var e=(0,v.default)((function*(e){var t=e.name,r=e.target;if(!(yield this.vault.validateWatchingCredential(r)))throw new z.InvalidAddress;return Promise.resolve([{id:`watching--${U.COINTYPE_SOL}--${r}`,name:t||"",type:X.AccountType.SIMPLE,path:"",coinType:U.COINTYPE_SOL,pub:r,address:r}])}));return function(t){return e.apply(this,arguments)}}(),(0,g.default)(r)}(r(701625).KeyringWatchingBase),be=r(516760),Se=r.n(be),xe=r(371644),Ne=r.n(xe),ke=r(764550),Ce=r(85397),Be=r(740727);function Re(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function De(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Re(Object(r),!0).forEach((function(t){(0,f.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Re(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Fe(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,T.default)(e);if(t){var o=(0,T.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,w.default)(this,r)}}!function(e){e.SEND_TRANSACTION="sendTransaction",e.GET_EPOCH_INFO="getEpochInfo",e.GET_HEALTH="getHealth",e.GET_ACCOUNT_INFO="getAccountInfo",e.GET_TOKEN_ACCOUNTS_BY_OWNER="getTokenAccountsByOwner",e.GET_FEES="getFees",e.GET_FEES_FOR_MESSAGE="getFeeForMessage",e.GET_RECENT_PRIORITIZATION_FEES="getRecentPrioritizationFees",e.GET_TRANSACTION="getTransaction",e.GET_MINIMUM_BALANCE_FOR_RENT_EXEMPTION="getMinimumBalanceForRentExemption",e.GET_LATEST_BLOCK_HASH="getLatestBlockhash"}(Ee||(Ee={})),function(e){e.BASE64="base64",e.JSON_PARSED="jsonParsed"}(Pe||(Pe={}));var _e=function(e){(0,m.default)(r,e);var t=Fe(r);function r(e){var r;return(r=t.call(this)).getTokenInfos=function(){var e=(0,v.default)((function*(e){var t=e.map((function(e){return[Ee.GET_ACCOUNT_INFO,[e,{encoding:Pe.JSON_PARSED}]]})),n=yield r.rpc.batchCall(t),o=[];return n.forEach((function(t,r){if("undefined"!==typeof t)if(null!==t.value&&"mint"===t.value.data.parsed.type){var n=t.value.data.parsed.info.decimals,i=e[r].slice(0,4);o.push({name:i,symbol:i.toUpperCase(),decimals:n})}else console.error("invalid token address"),o.push(void 0);else o.push(void 0)})),o}));return function(t){return e.apply(this,arguments)}}(),r.rpc=new Ce.JsonRPCRequest(e),r}var n=r.prototype;return n.broadcastTransaction=function(){var e=(0,v.default)((function*(e,t){return this.rpc.call(Ee.SEND_TRANSACTION,[e,De({encoding:Pe.BASE64},t||{})])}));return function(t,r){return e.apply(this,arguments)}}(),n.getInfo=function(){var e=(0,v.default)((function*(){var e=yield this.rpc.batchCall([[Ee.GET_EPOCH_INFO,[]],[Ee.GET_HEALTH,[]]]),t=(0,h.default)(e,2),r=t[0],n=t[1];return{bestBlockNumber:r.absoluteSlot,isReady:"ok"===n}}));return function(){return e.apply(this,arguments)}}(),n.getAddresses=function(){var e=(0,v.default)((function*(e){var t=e.map((function(e){return[Ee.GET_ACCOUNT_INFO,[e,{encoding:Pe.JSON_PARSED}]]})),r=yield this.rpc.batchCall(t),n=[];for(var o of r)if("undefined"!==typeof o){var i,a=new(D())(null==o||null==(i=o.value)?void 0:i.lamports),u=a.isFinite()&&a.gte(0);n.push({existing:u,balance:u?a:new(D())(0)})}else n.push(void 0);return n}));return function(t){return e.apply(this,arguments)}}(),n.getBalances=function(){var e=(0,v.default)((function*(e){var t=e.map((function(e){var t;return null!=(t=e.coin)&&t.tokenAddress?[Ee.GET_TOKEN_ACCOUNTS_BY_OWNER,[e.address,{mint:e.coin.tokenAddress},{encoding:Pe.JSON_PARSED,commitment:"processed"}]]:[Ee.GET_ACCOUNT_INFO,[e.address,{encoding:Pe.JSON_PARSED,commitment:"processed"}]]})),r=yield this.rpc.batchCall(t),n=[];return r.forEach((function(t,r){if("undefined"!==typeof t){var o,i=new(D())(0);if(null!=(o=e[r].coin)&&o.tokenAddress)for(var a of t.value){var u=a.account.data.parsed.info;u.owner===e[r].address&&(i=D().sum(i,u.tokenAmount.amount))}else null!==t.value&&(i=new(D())(t.value.lamports));n.push(i)}else n.push(void 0)})),n}));return function(t){return e.apply(this,arguments)}}(),n.getAccountInfo=function(){var e=(0,v.default)((function*(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Pe.JSON_PARSED;return(yield this.rpc.call(Ee.GET_ACCOUNT_INFO,[e,{encoding:t}])).value}));return function(t){return e.apply(this,arguments)}}(),n.getTokenAccountsByOwner=function(){var e=(0,v.default)((function*(e){var t=e.address,r=e.programId,n=void 0===r?E.TOKEN_PROGRAM_ID:r;return(yield this.rpc.call(Ee.GET_TOKEN_ACCOUNTS_BY_OWNER,[t,{programId:n.toString()},{encoding:Pe.JSON_PARSED}])).value}));return function(t){return e.apply(this,arguments)}}(),n.getFeePricePerUnit=function(){var e=(0,v.default)((function*(){var e=yield this.getFees(),t=(0,h.default)(e,1)[0];return{normal:{price:new(D())(t)}}}));return function(){return e.apply(this,arguments)}}(),n.getFees=function(){var e=(0,v.default)((function*(){var e=yield this.rpc.call(Ee.GET_FEES);return[e.value.feeCalculator.lamportsPerSignature,e.value.blockhash]}));return function(){return e.apply(this,arguments)}}(),n.getFeesForMessage=function(){var e=(0,v.default)((function*(e){return(yield this.rpc.call(Ee.GET_FEES_FOR_MESSAGE,[e,{commitment:"confirmed"}])).value}));return function(t){return e.apply(this,arguments)}}(),n.getRecentPrioritizationFees=function(){var e=(0,v.default)((function*(e){return yield this.rpc.call(Ee.GET_RECENT_PRIORITIZATION_FEES,[e])}));return function(t){return e.apply(this,arguments)}}(),n.getRecentMaxPrioritizationFees=function(){var e=(0,v.default)((function*(e){var t=yield this.getRecentPrioritizationFees(e);return Ne()(Se()(t,"prioritizationFee"))||0}));return function(t){return e.apply(this,arguments)}}(),n.getLatestBlockHash=function(){var e=(0,v.default)((function*(){var e=yield this.rpc.call(Ee.GET_LATEST_BLOCK_HASH,[{commitment:"confirmed"}]);return{blockhash:e.value.blockhash,lastValidBlockHeight:e.value.lastValidBlockHeight}}));return function(){return e.apply(this,arguments)}}(),n.getTransactionStatuses=function(){var e=(0,v.default)((function*(e){var t=e.map((function(e){return[Ee.GET_TRANSACTION,[e,{encoding:Pe.JSON_PARSED,maxSupportedTransactionVersion:0}]]})),r=[],n=yield this.rpc.batchCall(t);for(var o of n)"undefined"!==typeof o?null===o?r.push(Be.TransactionStatus.NOT_FOUND):r.push(null===o.meta.err?Be.TransactionStatus.CONFIRM_AND_SUCCESS:Be.TransactionStatus.CONFIRM_BUT_FAILED):r.push(void 0);return r}));return function(t){return e.apply(this,arguments)}}(),n.getMinimumBalanceForRentExemption=function(){var e=(0,v.default)((function*(e){return yield this.rpc.call(Ee.GET_MINIMUM_BALANCE_FOR_RENT_EXEMPTION,[e])}));return function(t){return e.apply(this,arguments)}}(),(0,g.default)(r)}(ke.BaseClient),He=r(838730),Me=r(348834).Buffer;function Ke(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Ue(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ke(Object(r),!0).forEach((function(t){(0,f.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ke(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function je(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,T.default)(e);if(t){var o=(0,T.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,w.default)(this,r)}}var Le=function(e){(0,m.default)(r,e);var t=je(r);function r(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))).keyringMap={hd:we,hw:oe,imported:Ie,watching:Oe,external:Oe},e.settings=He.default,e.getApiExplorerCache=(0,L.memoizee)((function(e){return B().create({baseURL:e})}),{promise:!0,max:1,maxAge:(0,K.getTimeDurationMs)({minute:3})}),e.getMinimumBalanceForRentExemption=(0,L.memoizee)(function(){var t=(0,v.default)((function*(t){var r,n=yield e.getClient(),o=(null!=(r=yield n.getAccountInfo(t,Pe.BASE64))?r:{}).data[0],i=Me.from(o,Pe.BASE64).length;return yield n.getMinimumBalanceForRentExemption(i)}));return function(e){return t.apply(this,arguments)}}(),{promise:!0,primitive:!0,max:50,maxAge:(0,K.getTimeDurationMs)({minute:3})}),e.getAssociatedAccountInfo=(0,L.memoizee)(function(){var t=(0,v.default)((function*(t){var r,n=yield e.getClient(),o=(null!=(r=yield n.getAccountInfo(t))?r:{}).data.parsed.info;return{mint:o.mint,owner:o.owner}}));return function(e){return t.apply(this,arguments)}}(),{promise:!0,primitive:!0,max:50,maxAge:(0,K.getTimeDurationMs)({minute:3})}),e.createClientFromURL=(0,L.memoizee)((function(e){return new _e(e)}),{max:1,maxAge:(0,K.getTimeDurationMs)({minute:3})}),e}var n=r.prototype;return n.getApiExplorer=function(){return this.getApiExplorerCache("https://api.solscan.io/")},n.getClient=function(){var e=(0,v.default)((function*(){var e=yield this.getRpcUrl();return this.createClientFromURL(e)}));return function(){return e.apply(this,arguments)}}(),n.decodeNativeTxActions=function(){var e=(0,v.default)((function*(e){var t=[],r={};if(!e.instructions)return[{type:q.IDecodedTxActionType.UNKNOWN}];for(var n of e.instructions)if(n.programId.toString()===k.SystemProgram.programId.toString())try{if("Transfer"===k.SystemInstruction.decodeInstructionType(n)){var o=yield this.engine.getNativeTokenInfo(this.networkId),i=k.SystemInstruction.decodeTransfer(n),a=i.fromPubkey,u=i.toPubkey,c=i.lamports,s=new(D())(c.toString());t.push({type:q.IDecodedTxActionType.NATIVE_TRANSFER,nativeTransfer:{tokenInfo:o,from:a.toString(),to:u.toString(),amount:s.shiftedBy(-o.decimals).toFixed(),amountValue:s.toFixed(),extraInfo:null}})}}catch(L){}else if(n.programId.toString()===E.ASSOCIATED_TOKEN_PROGRAM_ID.toString()&&0===n.data.length&&n.keys[4].pubkey.toString()===k.SystemProgram.programId.toString()&&n.keys[5].pubkey.toString()===E.TOKEN_PROGRAM_ID.toString()){var d=(0,h.default)(n.keys,4),l=d[1],f=d[2],p=d[3];l&&f&&p&&(r[l.pubkey.toString()]={owner:f.pubkey.toString(),mint:p.pubkey.toString()})}else if(n.programId.toString()===E.TOKEN_PROGRAM_ID.toString())try{var y=(0,P.decodeInstruction)(n).data.instruction,v=void 0,g=void 0,m=void 0,w=void 0;if(y===O.TokenInstruction.TransferChecked){var T=(0,b.decodeTransferCheckedInstruction)(n),I=T.data.amount,A=T.keys,x=A.owner,N=A.mint,C=A.destination;v=new(D())(I.toString()),g=x.pubkey.toString(),m=N.pubkey.toString(),w=C.pubkey.toString()}else if(y===O.TokenInstruction.Transfer){var B=(0,S.decodeTransferInstruction)(n),R=B.data.amount,F=B.keys,_=F.owner,H=F.destination;v=new(D())(R.toString()),g=_.pubkey.toString(),w=H.pubkey.toString()}if(v&&g&&w){var M=r[w]||(yield this.getAssociatedAccountInfo(w)),K=M.mint,U=M.owner;m=m||K;var j=yield this.engine.ensureTokenInDB(this.networkId,m);j&&t.push({type:q.IDecodedTxActionType.TOKEN_TRANSFER,tokenTransfer:{tokenInfo:j,from:g,to:null!=U?U:w,amount:v.shiftedBy(-j.decimals).toFixed(),amountValue:v.toFixed(),extraInfo:null}})}}catch(G){}return 0===t.length&&t.push({type:q.IDecodedTxActionType.UNKNOWN}),t}));return function(t){return e.apply(this,arguments)}}(),n.getTransactionStatuses=function(){var e=(0,v.default)((function*(e){return(yield this.getClient()).getTransactionStatuses(e)}));return function(t){return e.apply(this,arguments)}}(),n.proxyJsonRPCCall=function(){var e=(0,v.default)((function*(e){var t=yield this.getClient();try{return yield t.rpc.call(e.method,e.params)}catch(r){throw(0,$.extractResponseError)(r)}}));return function(t){return e.apply(this,arguments)}}(),n.getNextNonce=function(){var e=(0,v.default)((function*(e,t){var r,n,o=yield this.getClient(),i=null!=(r=null==(n=(yield o.getAddresses([t.address]))[0])?void 0:n.nonce)?r:0,a=(yield this.engine.getHistory(e,t.id,void 0,!1),yield G.default.history.getMaxPendingNonce({accountId:this.accountId,networkId:e})),u=yield G.default.history.getPendingNonceList({accountId:this.accountId,networkId:e}),c=Math.max(y()(a)?0:a+1,i);if(Number.isNaN(c)&&(c=i),c>i)for(var s=i;s<c;s+=1)if(!u.includes(s)){c=s;break}if(c<i&&(c=i),c-i>=U.HISTORY_CONSTS.PENDING_QUEUE_MAX_LENGTH)throw new z.PendingQueueTooLong(U.HISTORY_CONSTS.PENDING_QUEUE_MAX_LENGTH);return c}));return function(t,r){return e.apply(this,arguments)}}(),n.getBalances=function(){var e=(0,v.default)((function*(e){var t=e.map((function(e){var t=e.address,r=e.tokenAddress;return{address:t,coin:Ue({},"string"===typeof r?{tokenAddress:r}:{})}}));return(yield this.getClient()).getBalances(t)}));return function(t){return e.apply(this,arguments)}}(),n.fetchTokenInfos=function(){var e=(0,v.default)((function*(e){return(yield this.getClient()).getTokenInfos(e)}));return function(t){return e.apply(this,arguments)}}(),n.validateAddress=function(e){try{var t=new k.PublicKey(e);if(k.PublicKey.isOnCurve(e)||k.PublicKey.isOnCurve(t.encode()))return Promise.resolve(e)}catch(r){}return Promise.reject(new z.InvalidAddress)},n.validateTokenAddress=function(e){try{return new k.PublicKey(e),Promise.resolve(e)}catch(t){}return Promise.reject(new z.InvalidAddress)},n.validateImportedCredential=function(e){if(this.settings.importedAccountEnabled)try{var t=_().decode(e);if(64===t.length){var r=[t.slice(0,32),t.slice(32)],n=r[0],o=r[1];return Promise.resolve(H.ed25519.publicFromPrivate(n).toString("hex")===o.toString("hex"))}}catch(i){}return Promise.resolve(!1)},n.validateWatchingCredential=function(){var e=(0,v.default)((function*(e){var t=!1;if(this.settings.watchingAccountEnabled)try{yield this.validateAddress(e),t=!0}catch(r){}return Promise.resolve(t)}));return function(t){return e.apply(this,arguments)}}(),n.attachFeeInfoToEncodedTx=function(e){return Promise.resolve(e.encodedTx)},n.decodeTx=function(){var e=(0,v.default)((function*(e,t){var r,n,o=yield this.helper.parseToNativeTx(e),i=yield this.decodeNativeTxActions(o),a=o instanceof k.VersionedTransaction?o.signatures[0]:o.signature;if(null!=(r=a)&&r.every((function(e){return 0===e}))&&(a=null),"InternalSwap"===(null==t?void 0:t.type)&&null!=t&&t.swapInfo&&(i=[{type:q.IDecodedTxActionType.INTERNAL_SWAP,internalSwap:Ue(Ue({},t.swapInfo),{},{extraInfo:null})}]),"Transfer"===(null==t?void 0:t.type)&&(null!=t&&t.nftInfo||null!=t&&t.nftInfos)){var u=t.nftInfos?t.nftInfos:[t.nftInfo];i=[],u.map((function(e){return i.push({type:q.IDecodedTxActionType.NFT_TRANSFER,nftTransfer:{asset:e.asset,amount:e.amount,send:e.from,receive:e.to,extraInfo:null}})}))}var c=yield this.getAccountAddress();return{txid:a?_().encode(a):"",owner:c,signer:(null==(n=o.feePayer)?void 0:n.toString())||c,nonce:0,actions:i,status:q.IDecodedTxStatus.Pending,networkId:this.networkId,accountId:this.accountId,extraInfo:null,encodedTx:e}}));return function(t,r){return e.apply(this,arguments)}}(),n.decodedTxToLegacy=function(e){return Promise.resolve({})},n.buildEncodedTxFromTransfer=function(){var e=(0,v.default)((function*(e){if(!e.to)throw new Error("Invalid transferInfo.to params");return this.buildEncodedTxFromBatchTransfer({transferInfos:[e]})}));return function(t){return e.apply(this,arguments)}}(),n.buildEncodedTxFromBatchTransfer=function(){var e=(0,v.default)((function*(e){var t=e.transferInfos,r=0,n="",o=yield this.getClient(),i=yield this.getAccountAddress(),a=t[0],u=a.from,c=a.to,s=a.isNFT,d=new k.PublicKey(u),f=new k.Transaction,p=function(){var e=(0,v.default)((function*(){try{return yield o.getLatestBlockHash()}catch(t){var e=null==t?void 0:t.data;t&&e&&(n=e.message)}}));return function(){return e.apply(this,arguments)}}();do{if((r+=1)>5)throw new Error(`Solana getLatestBlockHash retry times exceeded: ${n||""}`);var y=yield p();f.recentBlockhash=null==y?void 0:y.blockhash,f.lastValidBlockHeight=null==y?void 0:y.lastValidBlockHeight,yield(0,K.wait)(1e3)}while(!f.recentBlockhash);f.feePayer=d;var h=yield o.getRecentMaxPrioritizationFees([i]),g=k.ComputeBudgetProgram.setComputeUnitPrice({microLamports:Math.max(1e3,h)});f.add(g);for(var m=0;m<t.length;m+=1){var w=t[m],T=w.token,I=w.amount,A=w.to,E=w.tokenSendAddress,P=new k.PublicKey(A||c),O=yield this.engine.ensureTokenInDB(this.networkId,null!=T?T:"");if(!O)throw new z.OneKeyInternalError(`Token not found: ${T||"main"}`);if(T){var b=new k.PublicKey(T),S=P,x=E?new k.PublicKey(E):yield this.getAssociatedTokenAddress({mint:b,owner:d,isNFT:s});k.PublicKey.isOnCurve(P.toString())&&(S=yield this.getAssociatedTokenAddress({mint:b,owner:P,isNFT:s}));var N=yield o.getAccountInfo(S.toString());if(s){var C=yield this.checkIsProgrammableNFT(b),B=C.isProgrammableNFT,R=C.metadata;if(B)f.add.apply(f,(0,l.default)(yield this.buildProgrammableNFTInstructions({mint:b,source:d,sourceAta:x,destination:P,destinationAta:S,destinationAtaInfo:N,amount:I,metadata:R})));else{var F=yield this.checkIsOpenCreatorProtocol(b);F?f.add.apply(f,(0,l.default)(this.buildOpenCreatorProtocolInstructions({mint:b,source:d,sourceAta:x,destination:P,destinationAta:S,destinationAtaInfo:N,mintState:F}))):f.add.apply(f,(0,l.default)(this.buildTransferTokenInstructions({mint:b,source:d,sourceAta:x,destination:P,destinationAta:S,destinationAtaInfo:N,token:O,amount:I})))}}else f.add.apply(f,(0,l.default)(this.buildTransferTokenInstructions({mint:b,source:d,sourceAta:x,destination:P,destinationAta:S,destinationAtaInfo:N,token:O,amount:I})))}else f.add(k.SystemProgram.transfer({fromPubkey:new k.PublicKey(u),toPubkey:new k.PublicKey(A),lamports:BigInt(new(D())(I).shiftedBy(O.decimals).toFixed())}))}return _().encode(f.serialize({requireAllSignatures:!1}))}));return function(t){return e.apply(this,arguments)}}(),n.buildProgrammableNFTInstructions=function(){var e=(0,v.default)((function*(e){var t=e.mint,r=e.source,n=e.sourceAta,o=e.destination,i=e.destinationAta,a=(e.destinationAtaInfo,e.amount),u=e.metadata,c=yield this.getClient(),s=[],d=fe(t,n),l=yield c.getAccountInfo(d.toString());if(l){var f,p,y=A.TokenRecord.fromAccountInfo(Ue(Ue({},l),{},{data:Me.from(l.data[0],"base64")}))[0];if(y.state===A.TokenState.Locked)throw new Error("token account is locked");if(y.state===A.TokenState.Listed)throw new Error("token is listed");if(u.programmableConfig)f=null!=(p=u.programmableConfig.ruleSet)?p:void 0;var h={authority:r,tokenOwner:r,token:n,metadata:le(t),mint:t,edition:pe(t),destinationOwner:o,destination:i,payer:r,splTokenProgram:E.TOKEN_PROGRAM_ID,splAtaProgram:E.ASSOCIATED_TOKEN_PROGRAM_ID,sysvarInstructions:k.SYSVAR_INSTRUCTIONS_PUBKEY,authorizationRules:f,authorizationRulesProgram:de,ownerTokenRecord:d,destinationTokenRecord:fe(t,i)},v={transferArgs:{__kind:"V1",amount:Number(a),authorizationData:null}};s.push((0,A.createTransferInstruction)(h,v))}return s}));return function(t){return e.apply(this,arguments)}}(),n.buildOpenCreatorProtocolInstructions=function(e){var t=e.mint,r=e.source,n=e.sourceAta,o=e.destination,i=e.destinationAta,a=e.destinationAtaInfo,u=e.mintState,c=[];return c.push(I.computeBudgetIx),a||c.push((0,I.createInitAccountInstruction)({policy:u.policy,freezeAuthority:(0,I.findFreezeAuthorityPk)(u.policy),mint:t,metadata:le(t),mintState:(0,I.findMintStatePk)(t),from:o,fromAccount:i,cmtProgram:I.CMT_PROGRAM,instructions:k.SYSVAR_INSTRUCTIONS_PUBKEY,payer:r,associatedTokenProgram:E.ASSOCIATED_TOKEN_PROGRAM_ID})),c.push((0,I.createTransferInstruction)({policy:u.policy,freezeAuthority:(0,I.findFreezeAuthorityPk)(u.policy),mint:t,metadata:le(t),mintState:(0,I.findMintStatePk)(t),from:r,fromAccount:n,cmtProgram:I.CMT_PROGRAM,instructions:k.SYSVAR_INSTRUCTIONS_PUBKEY,to:o,toAccount:i})),c},n.buildTransferTokenInstructions=function(e){var t=e.mint,r=e.source,n=e.sourceAta,o=e.destination,i=e.destinationAta,a=e.destinationAtaInfo,u=e.token,c=e.amount,s=[];return null===a&&s.push((0,x.createAssociatedTokenAccountInstruction)(r,i,o,t)),s.push((0,b.createTransferCheckedInstruction)(n,t,i,r,BigInt(new(D())(c).shiftedBy(u.decimals).toFixed()),u.decimals)),s},n.checkIsProgrammableNFT=function(){var e=(0,v.default)((function*(e){try{var t=yield this.getClient(),r=le(e),n=yield t.getAccountInfo(r.toString());if(n){var o=A.Metadata.fromAccountInfo(Ue(Ue({},n),{},{data:Me.from(n.data[0],"base64")}))[0];return{metadata:o,isProgrammableNFT:o.tokenStandard===A.TokenStandard.ProgrammableNonFungible||o.tokenStandard===A.TokenStandard.ProgrammableNonFungibleEdition}}return{isProgrammableNFT:!1}}catch(i){return console.log(i),{isProgrammableNFT:!1}}}));return function(t){return e.apply(this,arguments)}}(),n.checkIsOpenCreatorProtocol=function(){var e=(0,v.default)((function*(e){var t=yield this.getClient(),r=(0,I.findMintStatePk)(e),n=yield t.getAccountInfo(r.toString());return null!==n?I.MintState.fromAccountInfo(Ue(Ue({},n),{},{data:Me.from(n.data[0],"base64")}))[0]:null}));return function(t){return e.apply(this,arguments)}}(),n.getAssociatedTokenAddress=function(){var e=(0,v.default)((function*(e){var t=e.mint,r=e.owner;if(e.isNFT){var n=yield this.getClient(),o=yield n.getTokenAccountsByOwner({address:r.toString()}),i=null==o?void 0:o.find((function(e){return e.account.data.parsed.info.mint===t.toString()}));if(i)return new k.PublicKey(i.pubkey)}return Promise.resolve((0,N.getAssociatedTokenAddressSync)(t,r))}));return function(t){return e.apply(this,arguments)}}(),n.buildEncodedTxFromApprove=function(e){throw new z.NotImplemented},n.updateEncodedTxTokenApprove=function(e,t){throw new z.NotImplemented},n.updateEncodedTx=function(){var e=(0,v.default)((function*(e,t,r){if(r.type===q.IEncodedTxUpdateType.advancedSettings)return Promise.resolve(e);var n=yield this.helper.parseToNativeTx(e);try{if(r.type===q.IEncodedTxUpdateType.priorityFees){var o,i,a=n instanceof k.VersionedTransaction,u=[];u=a?(i=k.TransactionMessage.decompile(n.message)).instructions:n.instructions;try{for(var c of u)o=k.ComputeBudgetInstruction.decodeSetComputeUnitPrice(c)}catch(E){}if(y()(o)){var s,d=yield this.getClient(),l=yield this.getAccountAddress(),f=yield d.getRecentMaxPrioritizationFees([l]),p=k.ComputeBudgetProgram.setComputeUnitPrice({microLamports:Math.max(1e3,f)});if(a)null==(s=i)||s.instructions.push(p);else n.add(p)}return a?_().encode(new k.VersionedTransaction(i.compileToV0Message()).serialize()):_().encode(n.serialize({requireAllSignatures:!1}))}}catch(P){return e}var v=n,g=(0,h.default)(v.instructions,1)[0];if("transfer"===r.type&&1===v.instructions.length&&g.programId.toString()===k.SystemProgram.programId.toString()&&"Transfer"===k.SystemInstruction.decodeInstructionType(g)){var m=k.SystemInstruction.decodeTransfer(g),w=m.fromPubkey,T=m.toPubkey,I=yield this.engine.getNativeTokenInfo(this.networkId),A=t.amount;return v.instructions=[k.SystemProgram.transfer({fromPubkey:w,toPubkey:T,lamports:BigInt(new(D())(A).shiftedBy(I.decimals).toFixed())})],_().encode(v.serialize({requireAllSignatures:!1}))}return Promise.resolve(e)}));return function(t,r,n){return e.apply(this,arguments)}}(),n.broadcastTransaction=function(){var e=(0,v.default)((function*(e){var t=!1,r=0,n="",o=yield this.getClient(),i=yield this.getNetwork(),a=function(){var r=(0,v.default)((function*(){try{var r=t?{preflightCommitment:"confirmed"}:{};j.default.engine.info("broadcastTransaction START:",{rawTx:e.rawTx});var a=yield o.broadcastTransaction(e.rawTx,r||{});return j.default.engine.info("broadcastTransaction END:",{txid:a,rawTx:e.rawTx}),Ue(Ue({},e),{},{txid:a,encodedTx:e.encodedTx})}catch(g){var u,c;j.default.engine.error("broadcastTransaction error:",g);var s=null!=(u=null==g?void 0:g.data)?u:null==g||null==(c=g.response)?void 0:c.error;if(g&&s){if(-32002===s.code&&s.message.endsWith("insufficient funds for rent"))throw t=!1,new z.MinimumTransferBalanceRequiredError("0.00089088",i.symbol);if(-32002===s.code&&s.message.startsWith("Transaction simulation failed")){var l,f,p=null!=(l=null==(f=s.data)?void 0:f.logs)?l:[];for(var y of p){var h=y.match(/Transfer: insufficient lamports \d+, need (\d+)/),v=Number(null==h?void 0:h[1]);if(!d()(v))throw t=!1,new z.MinimumTransferBalanceRequiredForSendingAssetError("NFT",new(D())(v).shiftedBy(-i.decimals).toFixed(),i.symbol)}}if(-32005===s.code||-32002===s.code)return t=!0,void(n=s.message)}throw g}}));return function(){return r.apply(this,arguments)}}();do{if((r+=1)>8)throw t=!1,new Error(`Solana broadcastTransaction retry times exceeded: ${n||""}`);var u=yield a();if(u)return u;yield(0,K.wait)(1e3)}while(t);throw new Error("Solana broadcastTransaction retry failed")}));return function(t){return e.apply(this,arguments)}}(),n.buildUnsignedTxFromEncodedTx=function(){var e=(0,v.default)((function*(e){var t=yield this.getDbAccount(),r=yield this.helper.parseToNativeTx(e);yield this.getClient();return{inputs:[],outputs:[],payload:{nativeTx:r,feePayer:new k.PublicKey(t.pub)},encodedTx:e}}));return function(t){return e.apply(this,arguments)}}(),n.getFrozenBalance=function(){var e=(0,v.default)((function*(){var e=yield this.getAccountAddress(),t=(yield this.engine.getNativeTokenInfo(this.networkId)).decimals;try{var r=yield this.getMinimumBalanceForRentExemption(e);return{main:new(D())(null!=r?r:0).shiftedBy(-t).toNumber()}}catch(n){return 0}}));return function(){return e.apply(this,arguments)}}(),n.fetchBalanceDetails=function(){var e=(0,v.default)((function*(){var e,t=(yield this.engine.getNativeTokenInfo(this.networkId)).decimals,r=yield this.getAccountAddress(),n=yield Promise.all([this.getBalances([{address:r}]),this.getFrozenBalance()]),o=(0,h.default)(n,2),i=(0,h.default)(o[0],1)[0],a=o[1],u=new(D())(null!=(e=a.main)?e:"0"),c=new(D())(null!=i?i:"0").shiftedBy(-t),s=c.minus(u);return{total:c.toFixed(),available:s.isGreaterThan(0)?s.toFixed():"0",unavailable:u.toFixed()}}));return function(){return e.apply(this,arguments)}}(),n.getFeePricePerUnit=function(){var e=(0,v.default)((function*(){return(yield this.getClient()).getFeePricePerUnit()}));return function(){return e.apply(this,arguments)}}(),n.fetchFeeInfo=function(){var e=(0,v.default)((function*(e){var t=yield this.getClient(),r=yield this.helper.parseToNativeTx(e),n="";n=r instanceof k.VersionedTransaction?Me.from(r.message.serialize()).toString("base64"):r.compileMessage().serialize().toString("base64");var o=yield Promise.all([this.getNetwork(),t.getFeesForMessage(n)]),i=(0,h.default)(o,2),a=i[0],u=i[1],c=[new(D())(u).shiftedBy(-a.feeDecimals).toFixed()];return{nativeSymbol:a.symbol,nativeDecimals:a.decimals,feeSymbol:a.feeSymbol,feeDecimals:a.feeDecimals,limit:r.signatures.length.toString(),prices:c,defaultPresetIndex:"0",tx:null}}));return function(t){return e.apply(this,arguments)}}(),n.getExportedCredential=function(){var e=(0,v.default)((function*(e){var t=yield this.getDbAccount();if(t.id.startsWith("hd-")||t.id.startsWith("imported")){var r=this.keyring,n=Object.values(yield r.getPrivateKeys(e)),o=(0,h.default)(n,1)[0];return _().encode(Me.concat([(0,M.decrypt)(e,o),_().decode(t.pub)]))}throw new z.OneKeyInternalError("Only credential of HD or imported accounts can be exported")}));return function(t){return e.apply(this,arguments)}}(),n.mergeNFTTx=function(e){var t=e.address,r=e.decodedTx,n=e.nftTxs;if(n){var o=n.map((function(e){return(0,W.createOutputActionFromNFTTransaction)({transaction:e,address:t})})).filter(Boolean);r.actions=o}return r},n.mergeDecodedTx=function(){var e=(0,v.default)((function*(e){var t=e.decodedTx,r=e.nftTxs,n=yield this.getAccountAddress();if(r&&r.length>0){var o=this.mergeNFTTx({address:n,decodedTx:t,nftTxs:r});return Promise.resolve(o)}return Promise.resolve(t)}));return function(t){return e.apply(this,arguments)}}(),n.fetchOnChainHistory=function(){var e=(0,v.default)((function*(e){var t=this,r=e.localHistory,n=void 0===r?[]:r;if(e.tokenIdOnNetwork)return Promise.resolve([]);var o=yield this.getNetwork(),i=this.getApiExplorer(),u=yield this.getClient(),s=yield this.getDbAccount(),d=(yield this.engine.getNativeTokenInfo(this.networkId)).decimals,f=[];if(o.isTestnet)f=yield u.rpc.call("getSignaturesForAddress",[s.address,{limit:50}]);else{var p,y,g,m,w,T,I=i.get("/account/soltransfer/txs",{params:{address:s.address,offset:0,limit:25}}),A=i.get("/account/token/txs",{params:{address:s.address,offset:0,limit:25}}),E=yield Promise.all([I,A]),P=(0,h.default)(E,2),O=P[0],b=P[1],S=(null==O||null==(p=O.data)||null==(y=p.data)||null==(g=y.tx)?void 0:g.transactions)||[],x=(null==b||null==(m=b.data)||null==(w=m.data)||null==(T=w.tx)?void 0:T.transactions)||[];f=[].concat((0,l.default)(S),(0,l.default)(x))}var N=yield u.rpc.batchCall(f.map((function(e){var t=e.signature;return["getTransaction",[e.txHash||(c()(t)?t[0]:t),{encoding:"base58",maxSupportedTransactionVersion:0}]]}))),k=yield(0,W.getNFTTransactionHistory)(s.address,this.networkId),C=N.map(function(){var e=(0,v.default)((function*(e,r){var o,i=f[r],u=i.txHash||(c()(i.signature)?i.signature&&i.signature[0]:i.signature)||"",s=n.find((function(e){return e.decodedTx.txid===u})),l=!0;if(s&&s.decodedTx.isFinal)return Promise.resolve(null);var p=k[u];i&&(0===i.decimals||0===(null==(o=i.change)?void 0:o.decimals))&&a()(p)&&(l=!1);try{var y,v,g=e.blockTime,m=(0,h.default)(e.transaction,1)[0],w=e.meta,T=w.fee,I=w.err,A=1e3*g,E=Ue(Ue({},null!=(y=null==s?void 0:s.decodedTx)?y:yield t.decodeTx(m)),{},{txid:u,totalFeeInNative:new(D())(T).shiftedBy(-d).toFixed(),status:I?q.IDecodedTxStatus.Failed:q.IDecodedTxStatus.Confirmed,updatedAt:A,createdAt:null!=(v=null==s?void 0:s.decodedTx.createdAt)?v:A,isFinal:l});return E=yield t.mergeDecodedTx({decodedTx:E,nftTxs:p}),yield t.buildHistoryTx({decodedTx:E,historyTxToMerge:s})}catch(P){j.default.common.error(P)}return Promise.resolve(null)}));return function(t,r){return e.apply(this,arguments)}}());return(yield Promise.all(C)).filter(Boolean)}));return function(t){return e.apply(this,arguments)}}(),n.getPrivateKeyByCredential=function(){var e=(0,v.default)((function*(e){var t,r=_().decode(e);return 64===r.length&&(t=r.slice(0,32)),Promise.resolve(t)}));return function(t){return e.apply(this,arguments)}}(),n.refreshRecentBlockBash=function(){var e=(0,v.default)((function*(e){var t=yield this.helper.parseToNativeTx(e),r=yield this.getClient(),n=yield r.getLatestBlockHash(),o=n.blockhash,i=n.lastValidBlockHeight;return t.recentBlockhash=o,t.lastValidBlockHeight=i,_().encode(t.serialize({requireAllSignatures:!1}))}));return function(t){return e.apply(this,arguments)}}(),n.getAccountNameInfoMap=function(){var e=(0,v.default)((function*(){var e=this.walletId.startsWith("hw"),t=yield this.getNetwork(),r=(0,V.getAccountNameInfoByImpl)(t.impl);return e||!this.walletId?o()(r,"ledgerLive"):r}));return function(){return e.apply(this,arguments)}}(),n.canAutoCreateNextAccount=function(){var e=(0,v.default)((function*(e){return Promise.resolve(!0)}));return function(t){return e.apply(this,arguments)}}(),n.getUserNFTAssets=function(){var e=(0,v.default)((function*(e){var t=e.serviceData;return Promise.resolve({type:Y.NFTAssetType.SOL,data:t})}));return function(t){return e.apply(this,arguments)}}(),(0,g.default)(r)}(J.VaultBase)},565147:(e,t,r)=>{r.r(t),r.d(t,{KeyringBase:()=>s,KeyringBaseMock:()=>d});var n=r(634795),o=r(887371),i=r(545754),a=r(411987),u=r(695058);function c(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,u.default)(e);if(t){var o=(0,u.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,a.default)(this,r)}}var s=function(e){(0,i.default)(r,e);var t=c(r);function r(e){var r;return(r=t.call(this,e.options)).vault=e,r}return r.prototype.addressFromBase=function(){var e=(0,n.default)((function*(e){return this.vault.addressFromBase(e)}));return function(t){return e.apply(this,arguments)}}(),(0,o.default)(r)}(r(114540).VaultContext),d=function(e){(0,i.default)(r,e);var t=c(r);function r(){return t.apply(this,arguments)}return(0,o.default)(r)}(s)},82406:(e,t,r)=>{r.r(t),r.d(t,{KeyringHardwareBase:()=>l});var n=r(634795),o=r(887371),i=r(545754),a=r(411987),u=r(695058),c=r(799075),s=r(814817);function d(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,u.default)(e);if(t){var o=(0,u.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,a.default)(this,r)}}var l=function(e){(0,i.default)(a,e);var t=d(a);function a(){return t.apply(this,arguments)}var u=a.prototype;return u.getHardwareInfo=function(){var e=(0,n.default)((function*(){var e,t,r,n=yield this.engine.getHWDeviceByWalletId(this.vault.walletId);return{connectId:null!=(e=null==n?void 0:n.mac)?e:"",deviceId:null!=(t=null==n?void 0:n.deviceId)?t:"",deviceType:null!=(r=null==n?void 0:n.deviceType)?r:""}}));return function(){return e.apply(this,arguments)}}(),u.getWalletPassphraseState=function(){var e=(0,n.default)((function*(){var e=yield this.engine.getWallet(this.vault.walletId);return{passphraseState:null==e?void 0:e.passphraseState,useEmptyPassphrase:!(0,s.isPassphraseWallet)(e)}}));return function(){return e.apply(this,arguments)}}(),u.getHardwareSDKInstance=function(){var e=(0,n.default)((function*(){var e,t,n,o,i;return null!=(i=yield null==(e=r.g)||null==(t=e.$backgroundApiProxy)||null==(n=t.backgroundApi)||null==(o=n.serviceHardware)||null==o.getSDKInstance?void 0:o.getSDKInstance())?i:c.HardwareSDK}));return function(){return e.apply(this,arguments)}}(),u.prepareAccountByAddressIndex=function(e){throw new Error("Method not implemented.")},(0,o.default)(a)}(r(565147).KeyringBase)},810887:(e,t,r)=>{r.r(t),r.d(t,{KeyringHdBase:()=>y});var n=r(256666),o=r(634795),i=r(887371),a=r(545754),u=r(411987),c=r(695058),s=r(605851),d=r(940915);function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function f(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){(0,n.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function p(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,c.default)(e);if(t){var o=(0,c.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,u.default)(this,r)}}var y=function(e){(0,a.default)(r,e);var t=p(r);function r(){return t.apply(this,arguments)}var n=r.prototype;return n.getPrivateKeys=function(){var e=(0,o.default)((function*(e,t){var r=(yield this.getDbAccount()).path.split("/"),n=t||[r.pop()],o=r.join("/"),i=(yield this.engine.dbApi.getCredential(this.walletId,e)).seed;if("undefined"===typeof i)throw new d.OneKeyInternalError("Unable to get credential.");var a=(yield this.engine.providerManager.getChainInfoByNetworkId(this.networkId)).curve;return(0,s.batchGetPrivateKeys)(a,i,e,o,n).reduce((function(e,t){var r;return f(f({},e),{},((r={})[t.path]=t.extendedKey.key,r))}),{})}));return function(t,r){return e.apply(this,arguments)}}(),n.getAddress=function(){throw new Error("Method not implemented.")},n.batchGetAddress=function(){throw new Error("Method not implemented.")},n.prepareAccountByAddressIndex=function(e){throw new Error("Method not implemented.")},(0,i.default)(r)}(r(280306).KeyringSoftwareBase)},255942:(e,t,r)=>{r.r(t),r.d(t,{KeyringImportedBase:()=>d});var n=r(634795),o=r(887371),i=r(545754),a=r(411987),u=r(695058),c=r(940915);function s(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,u.default)(e);if(t){var o=(0,u.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,a.default)(this,r)}}var d=function(e){(0,i.default)(r,e);var t=s(r);function r(){return t.apply(this,arguments)}var a=r.prototype;return a.getPrivateKeys=function(){var e=(0,n.default)((function*(e,t){if("undefined"!==typeof t)throw new c.NotImplemented("Getting private keys from extended private key");var r=(yield this.engine.dbApi.getCredential(this.accountId,e)).privateKey;if("undefined"===typeof r)throw new c.OneKeyInternalError("Unable to get credential.");return{"":r}}));return function(t,r){return e.apply(this,arguments)}}(),a.getAddress=function(){throw new Error("Method not implemented.")},a.batchGetAddress=function(){throw new Error("Method not implemented.")},a.prepareAccountByAddressIndex=function(){throw new Error("Method not implemented.")},(0,o.default)(r)}(r(280306).KeyringSoftwareBase)},280306:(e,t,r)=>{r.r(t),r.d(t,{KeyringSoftwareBase:()=>h});var n=r(196234),o=r(256666),i=r(634795),a=r(887371),u=r(545754),c=r(411987),s=r(695058),d=r(292147),l=r(940915);function f(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?f(Object(r),!0).forEach((function(t){(0,o.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):f(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function y(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,s.default)(e);if(t){var o=(0,s.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,c.default)(this,r)}}var h=function(e){(0,u.default)(r,e);var t=y(r);function r(){return t.apply(this,arguments)}var o=r.prototype;return o.signTransaction=function(){var e=(0,i.default)((function*(e,t){var r=t.password;if("undefined"===typeof r)throw new l.OneKeyInternalError("Software signing requires a password.");var n=yield this.getSigners(r,e.inputs.map((function(e){return e.address})));return d.default.engine.info("signTransaction",this.networkId,e),p(p({},yield this.engine.providerManager.signTransaction(this.networkId,e,n)),{},{encodedTx:e.encodedTx})}));return function(t,r){return e.apply(this,arguments)}}(),o.signMessage=function(){var e=(0,i.default)((function*(e,t){var r=this,o=t.password;if("undefined"===typeof o)throw new l.OneKeyInternalError("Software signing requires a password.");var i=yield this.getDbAccount(),a=Object.values(yield this.getSigners(o,[i.address])),u=(0,n.default)(a,1)[0];return d.default.engine.info("signMessage",this.networkId,e),Promise.all(e.map((function(e){return r.engine.providerManager.signMessage(r.networkId,e,u)})))}));return function(t,r){return e.apply(this,arguments)}}(),o.getAddress=function(){throw new Error("Method not implemented.")},o.batchGetAddress=function(){throw new Error("Method not implemented.")},o.prepareAccountByAddressIndex=function(e){throw new Error("Method not implemented.")},(0,a.default)(r)}(r(565147).KeyringBase)},701625:(e,t,r)=>{r.r(t),r.d(t,{KeyringWatchingBase:()=>d});var n=r(634795),o=r(887371),i=r(545754),a=r(411987),u=r(695058),c=r(940915);function s(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,u.default)(e);if(t){var o=(0,u.default)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,a.default)(this,r)}}var d=function(e){(0,i.default)(r,e);var t=s(r);function r(){return t.apply(this,arguments)}var a=r.prototype;return a.signTransaction=function(){var e=(0,n.default)((function*(e,t){throw new c.OneKeyInternalError("signTransaction is not supported for watching accounts")}));return function(t,r){return e.apply(this,arguments)}}(),a.signMessage=function(){var e=(0,n.default)((function*(e,t){throw new c.OneKeyInternalError("signMessage is not supported for watching accounts")}));return function(t,r){return e.apply(this,arguments)}}(),a.getAddress=function(){throw new Error("Method not implemented.")},a.batchGetAddress=function(){throw new Error("Method not implemented.")},a.prepareAccountByAddressIndex=function(){throw new Error("Method not implemented.")},(0,o.default)(r)}(r(565147).KeyringBase)},153546:(e,t,r)=>{r.r(t),r.d(t,{convertDeviceError:()=>u});var n=r(703599),o=r(302478),i=r(292147);r(213208);function a(e,t){return"string"!==typeof t?null:e===n.HardwareErrorCode.DeviceInitializeFailed&&t.includes("ECONNABORTED")?new o.ConnectTimeoutError({message:t}):t.includes("Bridge network error")?new o.BridgeNetworkError({message:t}):null}function u(e){var t,r=e||{},u=r.code,c=r.error,s=r.message,d=null!=(t=null!=c?c:s)?t:"Unknown error";if(a(u,d))return a(u,d);switch(i.default.hardwareSDK.info("Device Utils Convert Device Error:",u,d),u){case n.HardwareErrorCode.UnknownError:return new o.UnknownHardwareError(e);case n.HardwareErrorCode.DeviceFwException:return new o.FirmwareVersionTooLow(e);case n.HardwareErrorCode.DeviceUnexpectedMode:return"string"===typeof d&&-1!==d.indexOf("ui-device_bootloader_mode")?new o.NotInBootLoaderMode(e):new o.UnknownHardwareError(e);case n.HardwareErrorCode.DeviceCheckDeviceIdError:return new o.DeviceNotSame(e);case n.HardwareErrorCode.DeviceNotFound:return new o.DeviceNotFind(e);case n.HardwareErrorCode.DeviceUnexpectedBootloaderMode:return new o.NotInBootLoaderMode(e);case n.HardwareErrorCode.DeviceInterruptedFromOutside:case n.HardwareErrorCode.DeviceInterruptedFromUser:return new o.UserCancelFromOutside(e);case n.HardwareErrorCode.DeviceNotSupportPassphrase:return new o.NotSupportPassphraseError(e);case n.HardwareErrorCode.IFrameLoadFail:return new o.InitIframeLoadFail(e);case n.HardwareErrorCode.IframeTimeout:return new o.InitIframeTimeout(e);case n.HardwareErrorCode.FirmwareUpdateDownloadFailed:return new o.FirmwareDownloadFailed(e);case n.HardwareErrorCode.FirmwareUpdateManuallyEnterBoot:return new o.FirmwareUpdateManuallyEnterBoot(e);case n.HardwareErrorCode.FirmwareUpdateAutoEnterBootFailure:return new o.FirmwareUpdateAutoEnterBootFailure(e);case n.HardwareErrorCode.FirmwareUpdateLimitOneDevice:return new o.FirmwareUpdateLimitOneDevice(e);case n.HardwareErrorCode.CallMethodNeedUpgradeFirmware:return new o.FirmwareVersionTooLow(e);case n.HardwareErrorCode.NewFirmwareUnRelease:return new o.NewFirmwareUnRelease(e);case n.HardwareErrorCode.NewFirmwareForceUpdate:return new o.NewFirmwareForceUpdate(e);case n.HardwareErrorCode.NetworkError:return new o.NetworkError(e);case n.HardwareErrorCode.BlePermissionError:return new o.NeedBluetoothTurnedOn(e);case n.HardwareErrorCode.BleLocationError:return new o.NeedBluetoothPermissions({message:d});case n.HardwareErrorCode.BleLocationServicesDisabled:return new o.BleLocationServiceError({message:d});case n.HardwareErrorCode.BleDeviceNotBonded:return new o.DeviceNotBonded(e);case n.HardwareErrorCode.BleDeviceBondError:return new o.DeviceBondError(e);case n.HardwareErrorCode.BleWriteCharacteristicError:return new o.BleWriteCharacteristicError(e);case n.HardwareErrorCode.BleScanError:return new o.BleScanError({message:d});case n.HardwareErrorCode.BleAlreadyConnected:return new o.BleAlreadyConnectedError(e);case n.HardwareErrorCode.RuntimeError:return-1!==d.indexOf("EIP712 blind sign is disabled")?new o.OpenBlindSign(e):-1!==d.indexOf("Unknown message")||-1!==d.indexOf("Failure_UnexpectedMessage")?new o.UnknownMethod(e):new o.UnknownHardwareError(e);case n.HardwareErrorCode.PinInvalid:return new o.InvalidPIN(e);case n.HardwareErrorCode.DeviceCheckPassphraseStateError:return new o.InvalidPassphrase(e);case n.HardwareErrorCode.DeviceOpenedPassphrase:return new o.DeviceOpenedPassphrase(e);case n.HardwareErrorCode.DeviceNotOpenedPassphrase:return new o.DeviceNotOpenedPassphrase(e);case n.HardwareErrorCode.PinCancelled:case n.HardwareErrorCode.ActionCancelled:return new o.UserCancel(e);case n.HardwareErrorCode.BridgeNotInstalled:case o.CustomOneKeyHardwareError.NeedOneKeyBridge:return new o.NeedOneKeyBridge(e);case n.HardwareErrorCode.BridgeNetworkError:return new o.BridgeNetworkError(e);case n.HardwareErrorCode.BridgeTimeoutError:return new o.BridgeTimeoutError(e);case n.HardwareErrorCode.PollingTimeout:return new o.ConnectTimeoutError(e);case n.HardwareErrorCode.PollingStop:return new o.ConnectPollingStopError(e);case n.HardwareErrorCode.BlindSignDisabled:return new o.OpenBlindSign(e);case n.HardwareErrorCode.FileAlreadyExists:return new o.FileAlreadyExistError(e);case n.HardwareErrorCode.CheckDownloadFileError:return new o.IncompleteFileError(e);case n.HardwareErrorCode.NotInSigningMode:return new o.NotInSigningModeError(e);case n.HardwareErrorCode.DataOverload:return new o.DeviceDataOverload(e);default:return new o.UnknownHardwareError(e)}}}}]);